(function(exports){"use strict";const FREESTAR_LOCATION_HOST="freestar.com",CORE_BUCKET_LOCATION="https://a.pub.network/core",GEO_BASED_NETWORK_BIDDING_DISABLED_BY_SITE=[{siteId:285,restrictedCountries:["IN","VN","NP","DZ","IQ","MA","AF","TR","EG","PK","ID","MA","BD","RS","PH","TN","BG"]}],NETWORKS_TO_BLOCK_IF_PAGE_SPEED_OPTIMIZED=["triplelift"],PRODUCTS_TO_BLOCK_IF_PAGE_SPEED_OPTIMIZED=["revolvingRail","slidingUnit","superflex","interstitial","stickyRail"],PREBID_ACCEPTED_SIZES=[[468,60],[728,90],[970,90],[970,250],[300,50],[300,100],[320,50],[320,100],[120,600],[160,600],[300,250],[300,600],[336,280],[1,1],[0,0]],FS_DFP_ID="15184186",FS_DFP_DEV_ID="1966186",PRICE_GRANULARITY_BUCKETS={v1:[{precision:2,min:0,max:20,increment:.01},{precision:2,min:20,max:40,increment:.5},{precision:2,min:40,max:100,increment:1},{precision:2,min:100,max:150,increment:2.5},{precision:2,min:150,max:250,increment:5},{precision:2,min:250,max:400,increment:10},{precision:2,min:400,max:800,increment:50}],v2:[{precision:2,min:0,max:2,increment:.01},{precision:2,min:2,max:10,increment:.05},{precision:2,min:10,max:20,increment:.5},{precision:2,min:20,max:100,increment:5}]},GDPR_MEMBER_GEOS=["AT","BE","BG","HR","CY","CZ","DK","EE","EL","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB","NO","IS","LI","CH"],USP_GEOS=["CA","CT","CO","VA","UT"],BIDSRESPONSE_COLLECTION_BLOCKLIST=[285],SPECIAL_CREATIVE_SELECTORS={gumgum:'[id^="ad_is"]',thirtyThreeAcross:'[class^="ttx-lb"]',undertone:'[class^="ut_container"]',kargo:'[class^="kargo-ad"]',yieldmo:'[class^="ym-adhesion"]',ogury:'[class^="ogy-footer-ad"]'},FREESTAR_IAB_TCF_VENDOR_ID=850,DIANOMI_SCRIPT_ID="dianomi_context_script",DIANOMI_SCRIPT_URL="https://www.dianomi.com/js/contextfeed.js",SCHAIN_BLOCKLIST=["sortable"],SCHAIN_TYPE_FREESTAR="FREESTAR",SCHAIN_TYPE_NONE="NONE",PAYMENT_RELATIONSHIP_MAP={FREESTAR:"FREESTAR",NONE:"PUBLISHER"},FREESTAR_DNT_COOKIE="00000000-0000-0000-0000-000000000000",VIDEO_DISALLOWED_GEOS=["BD","DZ","MM","NI","CM","MR","GN","CG","CN","ET","SS","PK","TN","PS","AO","BJ","VE","HT","TG","MG","SO","GM","KH","YE","IR","RU","SD","VG","TJ","SM","GL","BQ","TL","AX","MF","MH","MP","TD","VU","WS","BI","SY","DJ","NE","AS","AI","GQ","CU","PM","SB","PW","FM","YT","TO","CK","ER","MS","UM","GW","BL","NR","KM","KI","FK","CC","CF","TM","WF","ST","IO","TV","NF","SH","VA","EH","KP","NU","AQ","TK","CX","SJ","PN"],SOURCEPOINT_WRAPPING_MESSAGE_SCRIPT="https://cdn.privacy-mgmt.com/unified/wrapperMessagingWithoutDetection.js",DEFAULT_GDPR_SOURCEPOINT_PRIVACY_MANAGER_ID=899033,DEFAULT_MSPS_SOURCEPOINT_PRIVACY_MANAGER_ID=1035372,PUBFIG_CONFIG_SESSION_KEY="fs.config",AMAZON_BIDDER_SLUG="amazon";function getValueByPath(e,t,i){if(!t)return;const n=(Array.isArray(t)?t:t.match(/([^[.\]])+/g)).reduce(((e,t)=>e&&e[t]),e);return void 0===n?i:n}const getUrlParameter=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return new URLSearchParams(t.location?.search).get(e)??""},removeUrlParameter=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;const i=new URLSearchParams(t.location.search);i.has(e)&&i.delete(e),t.location.search=i.toString()};function isValidArrayWithLength(e){let{value:t}=e;return t&&Array.isArray(t)&&t.length>0}function isBoolean(e){return e===!!e}function isNumber(e){return"number"==typeof e}function replaceAll(e,t,i){return e.split(t).join(i)}function isString(e){return"string"==typeof e}function uniqBy(e,t){const i="function"==typeof t?t:e=>e[t];return[...e.reduce(((e,t)=>{const n=null==t?t:i(t);return e.has(n)||e.set(n,t),e}),new Map).values()]}const get=getValueByPath;function maxBy(e,t){const i=Math.max(...e.map(t));return e.find((e=>t(e)===i))}function remove(e,t){const i=[],n=e.filter(((e,n)=>t(e)&&i.push(n)));return i.reverse().forEach((t=>e.splice(t,1))),n}function uniq(e){return[...new Set(e)]}function getType(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function areArraysEqual(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!isEqual(e[i],t[i]))return!1;return!0}function areObjectsEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&!isEqual(e[i],t[i]))return!1;return!0}function areFunctionsEqual(e,t){return e.toString()===t.toString()}function arePrimativesEqual(e,t){return e===t}function isEqual(e,t){let i=getType(e);return i===getType(t)&&("array"===i?areArraysEqual(e,t):"object"===i?areObjectsEqual(e,t):"function"===i?areFunctionsEqual(e,t):arePrimativesEqual(e,t))}function isObject(e){return e instanceof Object}function isSymbol(e){return"symbol"==typeof e}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return NaN;if(isObject(e)){const t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(/^\s+|\s+$/g,"");const t=/^0b[01]+$/i.test(e);return t||/^0o[0-7]+$/i.test(e)?parseInt(e.slice(2),t?2:8):/^[-+]0x[0-9a-f]+$/i.test(e)?NaN:+e}function uniqArrayOfObjects(e){return[...new Set(e.map((e=>JSON.stringify(e))))].map((e=>JSON.parse(e)))}function isUspApplicable(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.freestar.locData;return!!e&&("US"===e.iso&&USP_GEOS.includes(e.state))}function getJsonParamSafe(e,t){let i=t&&t[e]||"";try{return JSON.parse(i)}catch(e){return i||""}}function isNil$1(e){return null==e}const getLargestPossibleDimensions$1=e=>{let{placement:t,sizesAllowed:i=!1}=e,{sizes:n}=t;return n=n.filter((e=>Array.isArray(e))),Array.isArray(i)&&(n=n.filter((e=>-1!==i.indexOf(e.join("x"))))),getLargestPossibleDimensions$1(n)},getIAIQuartileParam=()=>{const e=getUrlParameter("quartile");return e?Number(e):null},isFCDisabled=()=>"true"===getUrlParameter("disableFC");function debounce(e,t){let i=null;return function(){for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];const a=this;clearTimeout(i),i=setTimeout((()=>e.apply(a,s)),t)}}function extend(){let e={},t=!1,i=0,n=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],i++);let s=function(i){for(let n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t&&"[object Object]"===Object.prototype.toString.call(i[n])?e[n]=extend(!0,e[n],i[n]):e[n]=i[n])};for(;i<n;i++)s(arguments[i]);return e}var toStringFunction=Function.prototype.toString,create=Object.create,toStringObject=Object.prototype.toString,LegacyCache=function(){function e(){this._keys=[],this._values=[]}return e.prototype.has=function(e){return!!~this._keys.indexOf(e)},e.prototype.get=function(e){return this._values[this._keys.indexOf(e)]},e.prototype.set=function(e,t){this._keys.push(e),this._values.push(t)},e}();function createCacheLegacy(){return new LegacyCache}function createCacheModern(){return new WeakMap}var createCache="undefined"!=typeof WeakMap?createCacheModern:createCacheLegacy;function getCleanClone(e){if(!e)return create(null);var t=e.constructor;if(t===Object)return e===Object.prototype?{}:create(e);if(t&&~toStringFunction.call(t).indexOf("[native code]"))try{return new t}catch(e){}return create(e)}function getRegExpFlagsLegacy(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}function getRegExpFlagsModern(e){return e.flags}var getRegExpFlags="g"===/test/g.flags?getRegExpFlagsModern:getRegExpFlagsLegacy;function getTagLegacy(e){var t=toStringObject.call(e);return t.substring(8,t.length-1)}function getTagModern(e){return e[Symbol.toStringTag]||getTagLegacy(e)}var getTag="undefined"!=typeof Symbol?getTagModern:getTagLegacy,defineProperty=Object.defineProperty,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,getOwnPropertyNames=Object.getOwnPropertyNames,getOwnPropertySymbols=Object.getOwnPropertySymbols,_a=Object.prototype,hasOwnProperty=_a.hasOwnProperty,propertyIsEnumerable=_a.propertyIsEnumerable,SUPPORTS_SYMBOL="function"==typeof getOwnPropertySymbols;function getStrictPropertiesModern(e){return getOwnPropertyNames(e).concat(getOwnPropertySymbols(e))}var getStrictProperties=SUPPORTS_SYMBOL?getStrictPropertiesModern:getOwnPropertyNames;function copyOwnPropertiesStrict(e,t,i){for(var n=getStrictProperties(e),s=0,r=n.length,a=void 0,o=void 0;s<r;++s)if("callee"!==(a=n[s])&&"caller"!==a)if(o=getOwnPropertyDescriptor(e,a)){o.get||o.set||(o.value=i.copier(o.value,i));try{defineProperty(t,a,o)}catch(e){t[a]=o.value}}else t[a]=i.copier(e[a],i);return t}function copyArrayLoose(e,t){var i=new t.Constructor;t.cache.set(e,i);for(var n=0,s=e.length;n<s;++n)i[n]=t.copier(e[n],t);return i}function copyArrayStrict(e,t){var i=new t.Constructor;return t.cache.set(e,i),copyOwnPropertiesStrict(e,i,t)}function copyArrayBuffer(e,t){return e.slice(0)}function copyBlob(e,t){return e.slice(0,e.size,e.type)}function copyDataView(e,t){return new t.Constructor(copyArrayBuffer(e.buffer))}function copyDate(e,t){return new t.Constructor(e.getTime())}function copyMapLoose(e,t){var i=new t.Constructor;return t.cache.set(e,i),e.forEach((function(e,n){i.set(n,t.copier(e,t))})),i}function copyMapStrict(e,t){return copyOwnPropertiesStrict(e,copyMapLoose(e,t),t)}function copyObjectLooseLegacy(e,t){var i=getCleanClone(t.prototype);for(var n in t.cache.set(e,i),e)hasOwnProperty.call(e,n)&&(i[n]=t.copier(e[n],t));return i}function copyObjectLooseModern(e,t){var i=getCleanClone(t.prototype);for(var n in t.cache.set(e,i),e)hasOwnProperty.call(e,n)&&(i[n]=t.copier(e[n],t));for(var s=getOwnPropertySymbols(e),r=0,a=s.length,o=void 0;r<a;++r)o=s[r],propertyIsEnumerable.call(e,o)&&(i[o]=t.copier(e[o],t));return i}var copyObjectLoose=SUPPORTS_SYMBOL?copyObjectLooseModern:copyObjectLooseLegacy;function copyObjectStrict(e,t){var i=getCleanClone(t.prototype);return t.cache.set(e,i),copyOwnPropertiesStrict(e,i,t)}function copyPrimitiveWrapper(e,t){return new t.Constructor(e.valueOf())}function copyRegExp(e,t){var i=new t.Constructor(e.source,getRegExpFlags(e));return i.lastIndex=e.lastIndex,i}function copySelf(e,t){return e}function copySetLoose(e,t){var i=new t.Constructor;return t.cache.set(e,i),e.forEach((function(e){i.add(t.copier(e,t))})),i}function copySetStrict(e,t){return copyOwnPropertiesStrict(e,copySetLoose(e,t),t)}var isArray=Array.isArray,assign$1=Object.assign,getPrototypeOf=Object.getPrototypeOf||function(e){return e.__proto__},DEFAULT_LOOSE_OPTIONS={array:copyArrayLoose,arrayBuffer:copyArrayBuffer,blob:copyBlob,dataView:copyDataView,date:copyDate,error:copySelf,map:copyMapLoose,object:copyObjectLoose,regExp:copyRegExp,set:copySetLoose},DEFAULT_STRICT_OPTIONS=assign$1({},DEFAULT_LOOSE_OPTIONS,{array:copyArrayStrict,map:copyMapStrict,object:copyObjectStrict,set:copySetStrict});function getTagSpecificCopiers(e){return{Arguments:e.object,Array:e.array,ArrayBuffer:e.arrayBuffer,Blob:e.blob,Boolean:copyPrimitiveWrapper,DataView:e.dataView,Date:e.date,Error:e.error,Float32Array:e.arrayBuffer,Float64Array:e.arrayBuffer,Int8Array:e.arrayBuffer,Int16Array:e.arrayBuffer,Int32Array:e.arrayBuffer,Map:e.map,Number:copyPrimitiveWrapper,Object:e.object,Promise:copySelf,RegExp:e.regExp,Set:e.set,String:copyPrimitiveWrapper,WeakMap:copySelf,WeakSet:copySelf,Uint8Array:e.arrayBuffer,Uint8ClampedArray:e.arrayBuffer,Uint16Array:e.arrayBuffer,Uint32Array:e.arrayBuffer,Uint64Array:e.arrayBuffer}}function createCopier(e){var t=getTagSpecificCopiers(assign$1({},DEFAULT_LOOSE_OPTIONS,e)),i=t.Array,n=t.Object;function s(e,s){if(s.prototype=s.Constructor=void 0,!e||"object"!=typeof e)return e;if(s.cache.has(e))return s.cache.get(e);if(s.prototype=getPrototypeOf(e),s.Constructor=s.prototype&&s.prototype.constructor,!s.Constructor||s.Constructor===Object)return n(e,s);if(isArray(e))return i(e,s);var r=t[getTag(e)];return r?r(e,s):"function"==typeof e.then?e:n(e,s)}return function(e){return s(e,{Constructor:void 0,cache:createCache(),copier:s,prototype:void 0})}}function createStrictCopier(e){return createCopier(assign$1({},DEFAULT_STRICT_OPTIONS,e))}createStrictCopier({});var index=createCopier({});const PRODUCT_OPTIONS={DYNAMIC_AD_OPTIONS:"dynamicAdOptions",DYNAMIC_AD_OPTIONS_V2:"dynamicAdOptionsV2",PUSHDOWN_OPTIONS:"pushdownOptions",SIDE_WALL_OPTIONS:"sideWallOptions",SLIDING_UNIT_OPTIONS:"slidingUnitOptions",STICKY_AD_OPTIONS:"stickyAdOptions",STICKY_FOOTER_OPTIONS:"stickyFooterOptions"},ALL_POSSIBLE_OPTIONAL_MODULES="StickyFooter,SideWall,Video,SlidingUnit,StickyAd,Pushdown,StickyRail,DynamicAds,Interstitial,Superflex,Carousel,InImage",getEnabledModules=()=>ALL_POSSIBLE_OPTIONAL_MODULES.includes("ALL_POSSIBLE_MODULES")?[]:ALL_POSSIBLE_OPTIONAL_MODULES.split(",").map((e=>e.trim())),isOptionActive=e=>{let{placement:t,type:i}=e,n=t&&t[i]&&null!=t[i].active&&!1!==t[i].active;return!(n||!(i===PRODUCT_OPTIONS.DYNAMIC_AD_OPTIONS_V2&&t[i].dynamicAd2||i===PRODUCT_OPTIONS.PUSHDOWN_OPTIONS&&t[i].isPushdownUnit||i===PRODUCT_OPTIONS.SIDE_WALL_OPTIONS&&0!==t[i].type||i===PRODUCT_OPTIONS.STICKY_AD_OPTIONS&&t[i].stickyAdEnabled||i===PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS&&Object.keys(t[i]).length>0&&!1!==t[i].active))||n},optionObjectFetch=e=>{let{placement:t,type:i}=e;return isOptionActive({placement:t,type:i})?t[i]:{}};function getActiveAdTypes(e,t){const i=new Set,n=getEnabledModules();return e.forEach((e=>{(e.superflex||e.superflexV2)&&i.add("Superflex"),e.lazyAd&&i.add("LazyAd"),e.fluidAd&&i.add("FluidAd"),e.stickyFooterOptions&&e.stickyFooterOptions.active&&i.add("StickyFooter"),e.sideWallOptions&&0!==e.sideWallOptions.type&&i.add("SideWall"),e.pushdownOptions&&e.pushdownOptions.isPushdownUnit&&i.add("Pushdown"),e.revolvingRailOptions&&e.revolvingRailOptions.active&&i.add("RevolvingRail"),e.stickyRailOptions&&e.stickyRailOptions.active&&i.add("StickyRail"),e.interstitialOptions&&e.interstitialOptions.active&&i.add("Interstitial");const t=e.sizeMappings.some((e=>e?.elementTargetedConfig?.active));(e.dynamicAdOptions&&e.dynamicAdOptions.active||t)&&i.add("DynamicAds"),e.dynamicAdOptionsV2&&e.dynamicAdOptionsV2.dynamicAd2&&i.add("DynamicAds"),e.slidingUnitOptions&&e.slidingUnitOptions.active&&i.add("SlidingUnit"),e.stickyAdOptions&&e.stickyAdOptions.stickyAdEnabled&&i.add("StickyAd"),e.sizeMappings&&e.sizeMappings.forEach((e=>{e.videoEnabled&&i.add("Video"),e.superflex&&i.add("Superflex")}))})),t.forEach((e=>{e.active&&i.add("Video")})),Array.from(i).filter((e=>n.includes(e)))}const eventTypes=["click","scroll"],waits={},isPageSpeedOptimized=()=>void 0!==window.freestar.config.pageSpeedOptimized?window.freestar.config.pageSpeedOptimized:window.freestar.fsdata.pageSpeedOptimized,removeEvents=()=>{eventTypes.forEach((e=>document.removeEventListener(e,removeEvents)))},handleProductInit=e=>{let{name:t,callback:i}=e;waits[t].waiting&&!waits[t].called&&(waits[t].called=!0,removeEvents(),i())},waitForUserInteraction=e=>{let{name:t,callback:i}=e;Object.prototype.hasOwnProperty.call(waits,t)||(waits[t]={waiting:!0},eventTypes.forEach((e=>document.addEventListener(e,handleProductInit.bind(null,{name:t,callback:i}),{once:!0}))))},SESSION_STORAGE_TYPES={string:{type:"string",default:""},array:{type:"array",default:[]},object:{type:"object",default:{}},number:{type:"number",default:void 0}};function sessionStorageGet(e){let{key:t,type:i=SESSION_STORAGE_TYPES.string.type}=e;const n=sessionStorage.getItem(t);if(i===SESSION_STORAGE_TYPES.object.type){if(n){const e=JSON.parse(n);if(isObject(e))return e}return SESSION_STORAGE_TYPES.object.default}if(i===SESSION_STORAGE_TYPES.array.type){if(n){const e=JSON.parse(n);if(Array.isArray(e))return e}return SESSION_STORAGE_TYPES.array.default}if(i===SESSION_STORAGE_TYPES.number.type){const e=Number(n);return Number.isInteger(e)?e:SESSION_STORAGE_TYPES.number.default}return n}function sessionStorageSet(e){let{key:t,type:i=SESSION_STORAGE_TYPES.string,value:n}=e;n&&(i!==SESSION_STORAGE_TYPES.object&&i!==SESSION_STORAGE_TYPES.array||(n=JSON.stringify(n)),sessionStorage.setItem(t,n))}function sessionStorageRemove(e){let{key:t}=e;sessionStorage.removeItem(t)}const DEVICE_TYPE_DESKTOP="desktop",DEVICE_TYPE_MOBILE="mobile",DEVICE_TYPE_TABLET="tablet",PREBID_EXCLUDE_CONFIG_KEY="fs.exclude.bidders",prebidExcludeConfig={key:PREBID_EXCLUDE_CONFIG_KEY,type:SESSION_STORAGE_TYPES.array.type};function fetchAdQualityVendor(){if(freestar.fsdata.adQualityOptions.vendor)return freestar.deviceInfo.device.type===DEVICE_TYPE_DESKTOP&&freestar.fsdata.adQualityOptions.desktopEnabled||freestar.fsdata.adQualityOptions.mobileEnabled?freestar.fsdata.adQualityOptions.vendor:null;switch(freestar.deviceInfo.device.type){case DEVICE_TYPE_DESKTOP:return freestar.fsdata.adQualityDesktopVendor;case DEVICE_TYPE_MOBILE:return freestar.fsdata.adQualityMobileVendor;default:return null}}function fetchAdQualityBlockList(){return sessionStorageGet(prebidExcludeConfig)}function isNetworkAllowedViaAdQuality(e){let{network:t,adQualityBlockList:i}=e;return!isValidArrayWithLength({value:i})||!i.includes(t.slug)}const CLIENT_ALIAS_SUFFIX="FsClientAux",NAME_TO_ALIAS_MAP={},ALIAS_TO_NAME_MAP={},expectedKnownGvlids={appnexus:32,openx:69,pulsepoint:81,sonobi:104,gumgum:61,rubicon:52,pubmatic:76,sharethrough:80,criteo:91,justpremium:62,smaato:82,telaria:202,adtelligent:410,ix:10,triplelift:28,quantcast:11,medianet:142,unruly:36,undertone:677,nativo:263,teads:132,kargo:972,connectad:138,oftmedia:32,blockthrough:815,yieldmo:173,connatix:143,smartadserver:45,yahoossp:25,grid:686,tappx:628,spotx:165,dianomi:885,onetag:241,amx:737,liveintent:148,ttd:21,vidazoo:744,ogury:31,rise:1043,adform:50,aniview:780,insticator:910,seedtag:157,OperaAds:1135,minutemedia:918,cadent:183,yahooAds:25};function getAliasBidderOptions(e){return{gvlid:expectedKnownGvlids[e],useBaseGvlid:!0}}function aliasBidder(e){const t=unaliasBidder(e);if(!NAME_TO_ALIAS_MAP[t]){const e=`${t}${CLIENT_ALIAS_SUFFIX}`;NAME_TO_ALIAS_MAP[t]=e,ALIAS_TO_NAME_MAP[e]=t,fsprebid.que.push((()=>{fsprebid.aliasBidder(t,e,getAliasBidderOptions(t))}))}return NAME_TO_ALIAS_MAP[t]}function unaliasBidder(e){return ALIAS_TO_NAME_MAP[e]||e}function assign(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var defaultConverter={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function init(e,t){function i(i,n,s){if("undefined"!=typeof document){"number"==typeof(s=assign({},t,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var r="";for(var a in s)s[a]&&(r+="; "+a,!0!==s[a]&&(r+="="+s[a].split(";")[0]));return document.cookie=i+"="+e.write(n,i)+r}}return Object.create({set:i,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var i=document.cookie?document.cookie.split("; "):[],n={},s=0;s<i.length;s++){var r=i[s].split("="),a=r.slice(1).join("=");try{var o=decodeURIComponent(r[0]);if(n[o]=e.read(a,o),t===o)break}catch(e){}}return t?n[t]:n}},remove:function(e,t){i(e,"",assign({},t,{expires:-1}))},withAttributes:function(e){return init(this.converter,assign({},this.attributes,e))},withConverter:function(e){return init(assign({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}var api=init(defaultConverter,{path:"/"});function setCookie(e){let{name:t,value:i,expires:n,path:s,domain:r}=e;if(!t||!i)return!1;const a={secure:!0};return n&&(a.expires=n),s&&(a.path=s),r&&(a.domain=r),api.set(t,i,a),getCookie({name:t})}function getCookie(e){let{name:t}=e;return api.get(t)}const incrementSessionCounter=e=>{let t=Number(sessionStorage.getItem(e)||0);return sessionStorage.setItem(e,++t),t};function incrementPageviewCounter(){return freestar.msg.pageviewCount=incrementSessionCounter("pageviews")}function fsTestCookieFetch(){let e=getCookie({name:"_fs-test"});return e&&(e=JSON.parse(e),e.items.some(((t,i)=>{t==e.selection&&(e.selected=i,e.testGroup=t.indexOf("ab_test")>-1?1:0)}))),e}const QUERY_STRING_KEYS={fsLoadPubfigVersion:"fsLoadPubfigVersion",fsaltconfig:"fsaltconfig",fsdebug:"fsdebug"};let fsdebug=getUrlParameter(QUERY_STRING_KEYS.fsdebug);fsdebug&&"true"!==fsdebug&&!Number.isInteger(+fsdebug)&&fsdebug.split(",").map((e=>e.toUpperCase()));const prebidTable=()=>{const e=fsprebid.getBidResponses(),t=fsprebid.getAllWinningBids(),i=[];Object.keys(e).forEach((function(n){e[n].bids.forEach((function(e){i.push({bid:e,adunit:n,adId:e.adId,bidder:e.bidder,time:e.timeToRespond,dims:`${e.width}x${e.height}`,cpm:e.cpm,msg:e.status,rendered:!!t.find((function(t){return t.adId==e.adId}))})}))}))},LOG_INFO$7={title:"Pubfig"};class Logger$1{constructor(){this.logs=[]}add(e){this.logs.push(e)}show(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:LOG_INFO$7;if(!freestar.log)return;if(0===this.logs.length)return;let t=this.logs;this.logs=[],freestar.log(e,`\n${t.join("\n")}`)}}function sessionStorageGetWithExpiry(e){let{key:t}=e;const i=sessionStorageGet({key:t,type:SESSION_STORAGE_TYPES.object.type});if(i){const{value:e,expiry:n}=i;if(n&&!(n<Date.now()))return e;sessionStorageRemove({key:t})}return null}function sessionStorageSetWithExpiry(e){let{key:t,value:i,expiry:n}=e;sessionStorageSet({key:t,type:SESSION_STORAGE_TYPES.object,value:{value:i,expiry:n}})}function sessionStorageSetHour(e){let{key:t,value:i}=e;sessionStorageSetWithExpiry({key:t,value:i,expiry:Date.now()+36e5})}function sessionStorageSet15Min(e){let{key:t,value:i}=e;sessionStorageSetWithExpiry({key:t,value:i,expiry:Date.now()+9e5})}function sessionStorageSet5Min(e){let{key:t,value:i}=e;sessionStorageSetWithExpiry({key:t,value:i,expiry:Date.now()+3e5})}const SESSION_NAME$1="fs.session";class UserState{constructor(){this.cdep=!!freestar.cdep;const e=JSON.parse(sessionStorageGet({key:SESSION_NAME$1}));this.known=Number(e?.known??0)}_update(e){this.known=e;const t=JSON.parse(sessionStorageGet({key:SESSION_NAME$1}));if(t?.known!==this.known){const e=Object.assign({},t,{known:this.known});sessionStorageSet({key:SESSION_NAME$1,type:SESSION_STORAGE_TYPES.object,value:e})}}get isKnownByPrebidUser(){return!(!window.fsprebid?.getUserIds||!Object.keys(window.fsprebid.getUserIds()).length)}get isCDEPUser(){return this.cdep}get _isKnown(){return Number(!this.isCDEPUser&&this.isKnownByPrebidUser)}get isKnown(){return this._update(this._isKnown),this.known}}const userState=new UserState;class Fsxs2s{constructor(){this.slug="fsxs2s"}addToPlacementAsBidder(){return{bidder:this.slug,params:{}}}getSlug(){return this.slug}hasTopLevelStoredRequest(){const{topLevelStoredRequestId:e}=window.freestar.fsdata;return e&&e.length}hasImpLevelStoredRequests(){const{placements:e}=window.freestar.fsdata;return e.filter((e=>e.storedRequestId&&e.storedRequestId.length)).length}hasValidStoredRequests(){return this.hasImpLevelStoredRequests()||this.hasTopLevelStoredRequest()}}class ClassInit{static createInstance(e){let{ClassConstructor:t,instanceName:i,params:n=[]}=e;if(window.freestar=window.freestar||{},window.freestar.instances=window.freestar.instances||{},window.freestar.instances[i])return window.freestar.instances[i];const s=new t(...n);return window.freestar.instances[i]=s,s}static getInstanceFn(e){let{ClassConstructor:t,instanceName:i,params:n=[]}=e;return()=>this.createInstance({ClassConstructor:t,instanceName:i,params:n})}}class RequestHandler{constructor(){this.results={},this.ongoingRequests=new Map}clearClassCachedData(e){let{requestId:t}=e;Object.prototype.hasOwnProperty.call(this.results,t)&&delete this.results[t]}async fetch(e){let{fetchFn:t,requestId:i,onError:n,onSuccess:s}=e;if(this.results[i])return this.results[i];if(!this.ongoingRequests.has(i)){const e=t().then((e=>{const t={data:e,error:null};return this.results[i]=t,s&&s(e),t}),(e=>{const t={data:null,error:e};return this.results[i]=t,n&&n(e),t}));this.ongoingRequests.set(i,e)}return this.ongoingRequests.get(i).finally((()=>{this.ongoingRequests.delete(i)}))}get(e){let{requestId:t}=e;return this.results[t]}}const requestHandler=ClassInit.getInstanceFn({ClassConstructor:RequestHandler,instanceName:"requestHandler"}),FLOOR_API_KEY="4e799501-b8b6-4ef1-bad5-225b3dd1aa8d",FLOOR_API_LOCATION="https://api.floors.dev/sgw/v1/floors",IDEAL_AD_STACK_URL="https://optimise.net/",IDEAL_AD_STACK_SESSION_STORAGE_NAME="fs.idealadstack.config",DATA_SOURCE_SESSION_STORAGE="session storage",DATA_SOURCE_NETWORK_REQUEST="network request",BidderTypes=Object.freeze({CLIENT:"client",SERVER:"server",BOTH:"both"});function getDomain(){return window.freestar.fsdata.domain||location.host}function isGoogleInterstitialPlacement(e){return e.interstitialOptions&&e.interstitialOptions.active&&"GOOGLE_INTERSTITIAL"===e.interstitialOptions.type}function isGoogleInterstitial(e){let{event:t}=e;return window.freestar.googleInterstitialPlacement&&t.slot.getSlotElementId().includes(window.freestar.googleInterstitialPlacement.placement.dfpId)}const SITES_EXCLUDED=new Set([1542,6010,5958,5891,6832]),EXCLUDE_GOOGLE_INTERSTITIAL_PLACEMENT_SITES=new Set([533]);function floorsHardOffPlacement(e){let{siteId:t,placement:i}=e;return floorsHardOffSite({siteId:t})||EXCLUDE_GOOGLE_INTERSTITIAL_PLACEMENT_SITES.has(t)&&isGoogleInterstitialPlacement(i)}function floorsHardOffSite(e){let{siteId:t}=e;return SITES_EXCLUDED.has(t)}const getFormattedDeviceType=()=>{if(window.freestar)return"Apple"===window.freestar.deviceInfo.device.vendor?"smartphone-ios":window.freestar.deviceInfo.device.type},ALT_CONFIG_SESSION_KEY="fs.altConfig",ALT_CONFIG_ELEMENT_ID="fs-test-mode",ALT_CONFIG_CLASS_NAME="fs-test-mode-label";function getRequestQueryParams(){const e=new URLSearchParams;return e.set("k",userState.isKnown),e.set("d",getDomain()),e.set("t",getFormattedDeviceType()),freestar.locData&&e.set("c",freestar.locData.iso),getUrlParameter("fsiasdebug")&&e.set("g","experiment"),e.set("r",19),e.toString()}const getIdealAdstackConfigFromNetworkRequest=async()=>{const e=window.freestar?.fsdata?.isTriple13Enabled,t=e?"0":"1",{testGroup:i,testId:n,testType:s}=sessionStorageGet({key:PUBFIG_CONFIG_SESSION_KEY,type:SESSION_STORAGE_TYPES.object.type})?.pubfigSettings?.abtest||{},r=sessionStorageGet({key:ALT_CONFIG_SESSION_KEY}),a=null!==r&&!Number.isNaN(Number(r)),o=sessionStorageGet({key:PUBFIG_CONFIG_SESSION_KEY,type:SESSION_STORAGE_TYPES.object.type})?.altconfig||!1,d={};floorsHardOffSite({siteId:freestar.fsdata.siteId})||(d["x-api-key"]=FLOOR_API_KEY,d["x-lm"]=t),1===i&&"PUBFIG_SETTINGS"===s?d["x-ab-test-id"]=n:a&&o&&(d["x-test-config-id"]=r);let l=await fetch(`${IDEAL_AD_STACK_URL}?${getRequestQueryParams()}`,{method:"GET",credentials:"include",headers:d});const c=l.headers;l=await l.text(),l=JSON.parse(l);const{testGroup:u,knownUser:h}=l;return{data:{testGroup:u,knownUser:h,roundTripTime:c.get("fs-client-rtt"),...l.config},source:DATA_SOURCE_NETWORK_REQUEST}},getIdealAdstackConfig=async()=>{let e;const t=sessionStorageGetWithExpiry({key:IDEAL_AD_STACK_SESSION_STORAGE_NAME});return e=t?{data:t,source:DATA_SOURCE_SESSION_STORAGE}:await getIdealAdstackConfigFromNetworkRequest(),e},PUBFIG_FILE_NAME="pubfig.min.js",PUBFIG_BUCKET_BASE_PATH="https://a.pub.network/",getCurrentSitePath=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.document).querySelectorAll(`script[src*="${PUBFIG_FILE_NAME}"]`),t=Array.from(e).find((e=>!e.src.includes("/core/")));return t?t.src.split(PUBFIG_BUCKET_BASE_PATH)[1]?.split("/")[0]:"freestar-com"},DISPENSARY_URL="https://d.pub.network",COLLECTOR_URL="https://c.pub.network";getCurrentSitePath();const TEST_GROUP_KEY="fs.abtest.group",TEST_ID_KEY="fs.abtest.id",TEST_TYPE_KEY="fs.abtest.type",TEST_VARIANT_KEY="fs.abtest.variant_type",GAM_SLOT_RENDER_ENDED="slotRenderEnded",GAM_SLOT_REQUESTED="slotRequested",PREBID_AUCTION_INIT="auctionInit",PREBID_AUCTION_END="auctionEnd",PREBID_BID_RESPONSE="bidResponse",PREBID_BID_REQUESTED="bidRequested",PREBID_BID_WON="bidWon",PREBID_BID_TIMEOUT="bidTimeout",validateDependencies=e=>{const{dependencies:t,name:i}=e||{};if(t){if(!Array.isArray(t))throw new Error(`Module Definition Error: ${i}. Dependencies must be an array.`);t.forEach((e=>{const{token:t}="string"==typeof e?{token:e}:e;if(!t)throw new Error(`Module Definition Error: ${i}. Dependency must contain a token.`);if("string"!=typeof t)throw new Error(`Module Definition Error: ${i}. Token must be a string.`)}))}},getCamelCaseName=e=>e.charAt(0).toLowerCase()+e.slice(1),wrapIfDisabled=function(e){let{name:t,returnValue:i,warn:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e||function(){return n&&console.warn(`${t||"module"} is disabled`),i}},INJECTION_MODE={SINGLETON:"singleton",FOR_FEATURE:"forFeature"};class ModuleRegistry{constructor(){this._modules=new Map}static get instance(){return this._instance||(this._instance=new ModuleRegistry),this._instance}set(e,t){if(!e)throw new Error("Token must be provided");if(this._modules.has(e))throw new Error(`Module with token ${e} already exists`);this._modules.set(e,t)}get(e){return this._modules.get(e)}has(e){return this._modules.has(e)}delete(e){this._modules.delete(e)}getAlias(e){const t=this.get(e);return t?.defaultAlias}clear(){this._modules.clear()}static class(e){let{token:t,factory:i,dependencies:n=[],injectionMode:s=INJECTION_MODE.SINGLETON,defaultAlias:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Class must be provided");if(!t)throw new Error("Token must be provided");validateDependencies({dependencies:n,name:e.name}),ModuleRegistry.instance.set(t,{factory:i||(t=>{let{dependencies:i}=t;return new e(i)}),dependencies:n,injectionMode:s,defaultAlias:r||getCamelCaseName(t),type:"classModule"})}static object(){let{token:e,value:t,factory:i,dependencies:n,injectionMode:s=INJECTION_MODE.SINGLETON,defaultAlias:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)throw new Error("Token must be provided");if(!t&&!i)throw new Error("Value or factory must be provided");validateDependencies({dependencies:n,name:e}),ModuleRegistry.instance.set(e,{value:t,factory:i,dependencies:n,injectionMode:s,defaultAlias:r||getCamelCaseName(e),type:"object"})}static function(e){let{token:t,dependencies:i,defaultAlias:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Function must be provided");if(!t)throw new Error("Token must be provided");validateDependencies({dependencies:i,name:t}),ModuleRegistry.instance.set(t,{dependencies:i,defaultAlias:n||getCamelCaseName(t),func:e,type:"function"})}}class AppContainer{constructor(e){this._moduleRegistry=e,this._moduleInstances=new Map}static get instance(){return this._instance||(this._instance=new AppContainer(ModuleRegistry.instance)),this._instance}set(e,t){this._moduleInstances.set(e,t)}clear(){this._moduleInstances.clear()}get(e){return this._moduleInstances.get(e)}delete(e){this._moduleInstances.delete(e)}async call(e){const t=this._moduleRegistry.get(e);if(!t)throw new Error(`Module with token "${e}" does not exist`);const{dependencies:i,type:n,func:s}=t;if("function"!==n)throw new Error(`Module with token "${e}" is not a function type`);const r=await this._resolveDependencies({token:e,dependencies:i});for(var a=arguments.length,o=new Array(a>1?a-1:0),d=1;d<a;d++)o[d-1]=arguments[d];return s(r,...o)}async create(e){let{provide:t={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=this._moduleRegistry.get(e);if(!i)throw new Error(`Module with token "${e}" does not exist`);const{dependencies:n=[],factory:s,value:r,func:a}=i,o=n.filter((e=>{const i=this._getDependencyObject(e),n=i.alias||this._moduleRegistry.getAlias(i.token)||getCamelCaseName(i.token);return!t[n]}));return this._resolveDependencies({token:e,dependencies:o}).then((i=>this._createInstance({token:e,dependencies:{...i,...t},container:this,factory:s,value:r,func:a})))}async resolve(e,t){return this._resolve({token:e,optional:t})}has(e){return this._moduleInstances.has(e)}async _resolve(e){let{token:t,resolvedDeps:i=new Set,parentToken:n,optional:s}=e;if(!this._moduleRegistry.has(t)){if(s)return null;throw new Error(`${[...i,t].join(" -> ")}. Module with token "${t}" does not exist`)}const r=this._moduleRegistry.get(t),{dependencies:a=[],factory:o,value:d,func:l,injectionMode:c=INJECTION_MODE.SINGLETON}=r;if(n&&c===INJECTION_MODE.FOR_FEATURE&&(t=`${n}:${t}`),this.has(t))return this.get(t);if(i.has(t))throw new Error(`Circular dependency detected: ${Array.from(i).join(" -> ")} -> ${t}`);i.add(t);const u=this._resolveDependencies({token:t,dependencies:a,resolvedDeps:i}).then((e=>this._createInstance({token:t,dependencies:e,container:this,factory:o,value:d,func:l})));return this.set(t,u),u.then&&u.then((e=>{this.set(t,e)})),u}async _resolveDependencies(e){let{token:t,dependencies:i,resolvedDeps:n}=e,s=[];return i.length&&(s=await Promise.all(i.map((async e=>{const{token:i,alias:s,optional:r}=this._getDependencyObject(e),a=await this._resolve({token:i,resolvedDeps:new Set(n),parentToken:t,optional:r}),o=this._moduleRegistry.getAlias(i);return[s||o||i,a]})))),Object.fromEntries(s)}_getDependencyObject(e){return"string"==typeof e?{token:e}:e}_createInstance(e){let{dependencies:t,container:i,factory:n,value:s,token:r,func:a}=e;if(void 0!==s)return s;if(void 0!==a)return a.bind(null,t);if(!(n instanceof Function))throw new Error(`Container Error: ${r}. Factory must be a function`);const o=n({dependencies:t,container:i});if(!(o instanceof Object))throw new Error(`Container Error: ${r}. Factory must return an object`);return o}}function pick(e,t){return t.reduce(((t,i)=>(void 0!==e[i]&&(t[i]=e[i]),t)),{})}const NATIVE_RENDER_IFRAME_CONTAINER="_fs-ad-iframe-container",ANCILLARY_CONTROL_KEY="data-fs-ancillary",isNil=e=>null==e,clearExistingAd=e=>{const t=document.getElementById(e);if(!t)return;const i=t.querySelector(`#${NATIVE_RENDER_IFRAME_CONTAINER}`);i&&i.remove();t.querySelectorAll('div[id*="google_ads_iframe"]').forEach((e=>e.remove()))},TOKEN={ANALYTICS:"Analytics",PERFORMANCE_LOGGER:"PerformanceLogger",DISPENSARY_DATA:"DispensaryData",LOGGER:"Logger",EVENT_BUS:"EventBus",CONFIG_MANAGER:"ConfigManager",FREESTAR:"freestar",WINDOW:"window",PAGE:"Page",SESSION_STORAGE_MANAGER:"SessionStorageManager",PREBID_MANAGER:"PrebidManager",AMAZON_MANAGER:"AmazonManager",GAM_MANAGER:"GamManager",DEVICE_INFO:"deviceInfo",GEO_INFO:"geoInfo",FS_DATA:"fsdata",BID_RESPONSE_ANALYTICS_EVENT_FACTORY:"BidResponseAnalyticsEventFactory",BID_WON_ANALYTICS_EVENT_FACTORY:"BidWonAnalyticsEventFactory",BID_REQUESTED_ANALYTICS_EVENT_FACTORY:"BidRequestedAnalyticsEventFactory",ANALYTICS_EVENT_FACTORY:"AnalyticsEventFactory",MAIN_QUEUE:"MainQueue",ERROR_QUEUE:"ErrorQueue",IMMEDIATE_QUEUE:"ImmediateQueue",BEACON_QUEUE:"BeaconQueue",ANALYTICS_MESSAGE_FACTORY:"AnalyticsMessageFactory",DATA_COLLECTOR_API:"DataCollectorAPI",IDENTITY_CONFIG:"IdentityConfig",HASHED_EMAIL_PROVIDERS:"HashedEmailProviderManager",REALTIME_PROVIDERS:"RealtimeProvidersManager",IDENTITY_MANAGER:"IdentityManager",ATS_MANAGER:"atsManager",VIDEO:"Video",FOP_VIDEO_SCRIPTS:"FopVideoScripts",AUCTION_MANAGER:"AuctionManager",NATIVE_RENDER_MANAGER:"nativeRenderManager",CONFIANT:"Confiant",IN_BANNER_VIDEO_PLAYER:"InBannerVideoPlayer",OUTSTREAM_VIDEO_PLAYER:"OutstreamVideoPlayer",INCONTENT_VIDEO_AD:"InContentVideoAd",FLOATING_VIDEO_AD:"FloatingVideoAd",INCONTENT_TO_FLOATING_VIDEO_AD:"InContentToFloatingVideoAd",MEMORY_MONITOR:"MemoryMonitor",OPTABLE_MANAGER:"OptableManager",ANCILLARY:"Ancillary",BRANDING:"Branding",REPORT_AD:"ReportAd",IDEAL_AD_STACK_MANAGER:"IdealAdStackManager",IIQ_MANAGER:"IntentIqManager"};function dynamicSlotSet(e){let{placementName:t,slotId:i}=e;t&&i&&(freestar.dynamicSlotLibrary||(freestar.dynamicSlotLibrary={}),freestar.dynamicSlotLibrary[i]=t)}function dynamicSlotGet(e){let{slotId:t}=e;function i(){const e=getPlacementByName({name:t});return e&&e.name?e.name:"unknown"}return t?freestar.dynamicSlotLibrary&&freestar.dynamicSlotLibrary[t]?freestar.dynamicSlotLibrary[t]:(freestar.dynamicSlotLibrary&&freestar.dynamicSlotLibrary[t],i()):"unknown"}function dynamicPathSet(e){let{placementName:t,path:i}=e;t&&i&&(window.freestar.dynamicPathLibrary||(freestar.dynamicPathLibrary=[]),window.freestar.dynamicPathLibrary.push({placementName:t,path:i}))}function dynamicPathGet(e){let{path:t}=e;return t?window.freestar.dynamicPathLibrary.find((e=>e.path===t)):"unknown"}function dynamicSet(e){let{placementName:t,slotId:i,path:n}=e;i&&dynamicSlotSet({placementName:t,slotId:i}),n&&dynamicPathSet({placementName:t,path:n})}function dynamicGet(e){let{slotId:t=null,path:i=null}=e;return t?dynamicSlotGet({slotId:t}):!!i&&dynamicPathGet({path:i})}const lineItems=[],collectLineItem=function(e){const{lineItemId:t}=e,i=lineItems.findIndex((e=>e.lineItemId===t));if(t&&i&&i<0)lineItems.push({lineItemId:t,demandSourceType:null,slots:[e.slot.getSlotElementId()]});else if("undefined"!=i&&void 0!==lineItems[i]){lineItems[i].slots.find((t=>t===e.slot.getSlotElementId()))||lineItems[i].slots.push(e.slot.getSlotElementId())}};function setDirectAdRefresh(e){window.freestar.refreshLibrary[e]||(window.freestar.refreshLibrary[e]={});const t=window.freestar.refreshLibrary[e],i=window.freestar.fsdata.directAdRefreshRate;i>0?(t.refreshTime=i,t.disableRefresh=!1):(t.refreshTime=-1,t.disableRefresh=!0)}const getDemandSourceTypes=async function(){const e=lineItems.filter((e=>null===e.demandSourceType));if(e.length>0){const t=await fetch(`${freestar.msg.dispensaryURL}/demand-source`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lineItems:e.map((e=>e.lineItemId))}),credentials:"include"}),i=await t.json();i.demandSources&&(e=>{for(const t in e.demandSources){const i=lineItems.findIndex((e=>e.lineItemId===Number(t)));lineItems[i].demandSourceType=e.demandSources[t]}})(i),stopRefresh(),freestar.superflex&&freestar.superflex.checkLineItems&&freestar.superflex.checkLineItems({needed:e})}},stopRefresh=function(){lineItems.forEach((e=>{"DIRECT"!==e.demandSourceType&&"TRAFFICKED"!==e.demandSourceType||e.slots.forEach((e=>{setDirectAdRefresh(e)}))}))};function eventMatchesDirectAdRefresh(e){const t=["advertiserId","campaignId","lineItemId","creativeId"];for(const i of t){const t=e[i];if(null!=t&&window.freestar.fsdata.directAdRefreshTargeting.includes(t.toString()))return window.freestar.log(1,`found ${i} ${t} in directAdRefreshTargeting, setting refresh ${window.freestar.fsdata.directAdRefreshRate}.`),!0}return!1}const setOriginalRefreshRate=e=>{let t=freestar.fsdata.adRefreshRate;try{t=getRefreshRate(null!==e.getAttribute("name")?e.getAttribute("name"):e.id)}catch(e){freestar.log(1,`Error: ${e}`)}freestar.refreshLibrary[e.id].refreshTime=t},setRefreshRate=(e,t)=>{let{bidder:i,adUnitCode:n,testData:s}=e;s&&(freestar=s.freestar);const r=function(){const e=function(){let e=getPlacementByName({name:dynamicGet({slotId:n})});!e&&freestar.dynamicSlotLibrary[n]&&fsdata.placements[freestar.dynamicSlotLibrary[n]]&&(e=freestar.fsdata.placements[freestar.dynamicSlotLibrary[n]]);return e}();if(e&&1==e.outOfPage)return-1;if(e&&e.adRefreshRate&&e.adRefreshRate>0)return e.adRefreshRate;if(freestar.fsdata.adRefreshRate&&freestar.fsdata.adRefreshRate>0)return freestar.fsdata.adRefreshRate;return 0}();let a=isNumber(r)?r:void 0;return r&&a&&t&&a>0&&t.time>a&&(freestar.refreshLibrary[n]||(freestar.refreshLibrary[n]={}),freestar.refreshLibrary[n].refreshTime=t.time,a=t.time,freestar.log(10,`Set Refresh Rate: ${i} won. Changing refresh rate to ${t.time} due to ${t.rule}`)),a};function configOverrides(e){let{placement:t,refreshRate:i}=e;if(freestar.config&&freestar.config.products&&t){let e=!1;if(["stickyFooter","sideWall","pushdown","stickyFooter","revolvingRail","dynamicAd","stickyRail"].forEach((n=>{if(freestar.config.products[n]){const s=isOptionActive({placement:t,type:`${n}Options`}),{refreshDisabled:r,refreshInterval:a}=freestar.config.products[n];s&&(r&&(e=!0),a&&a>15&&(i=a))}})),e)return 0}return i}function getRefreshRate(e){const t=window.freestar.dynamicSlotLibrary[e];t&&(e=t);const i=getPlacementByName({name:dynamicGet({slotId:e})});return configOverrides({placement:i,refreshRate:i&&i.ignoreSiteRefresh?i.adRefreshRate:window.freestar.fsdata.adRefreshRate})}function refreshToggle(e){let{slotId:t,disableRefresh:i}=e;freestar.refreshLibrary[t].disableRefresh=i,freestar.refreshLibrary[t].refreshTime=i?0:getRefreshRate(t)}function hasRefreshLibrary(){return!!freestar.refreshLibrary||(freestar.log(1,"No refreshLibrary entries found, exiting..."),!1)}function validateSlotRefresh(e){let{slotId:t=!1,methodName:i}=e;return!!hasRefreshLibrary()&&(t?!!freestar.refreshLibrary[t]||(freestar.log(1,`No entry found, exiting ${i}...`),!1):(freestar.log(1,`No placement name provided, exiting ${i}...`),!1))}function refreshMapping(e){let{placementName:t,disableRefresh:i}=e;for(const e in freestar.refreshLibrary)freestar.refreshLibrary[e].placementName===t&&refreshToggle({slotId:e,disableRefresh:i})}function disableRefreshOn(e){let{slotId:t,placementName:i}=e;i?refreshMapping({placementName:i,disableRefresh:!1}):t&&validateSlotRefresh({slotId:t,methodName:"disableRefreshKey"})&&refreshToggle({slotId:t,disableRefresh:!0})}function enableRefreshOn(e){let{slotId:t,placementName:i}=e;i?refreshMapping({placementName:i,disableRefresh:!1}):t&&validateSlotRefresh({slotId:t,methodName:"enableRefreshOn"})&&refreshToggle({slotId:t,disableRefresh:!1})}function massRefreshUpdate(e){let{disableRefresh:t}=e;if(hasRefreshLibrary())for(const e in freestar.refreshLibrary)refreshToggle({slotId:e,disableRefresh:t})}function disableRefresh(){hasRefreshLibrary()&&massRefreshUpdate({disableRefresh:!0})}function enableRefresh(){hasRefreshLibrary()&&massRefreshUpdate({disableRefresh:!1})}function createCustomEvent(e){const{name:t,detail:i}=e,n=new CustomEvent(t,{detail:i});window.dispatchEvent(n)}function gamMapping(e){let{id:t,placement:i}=e;freestar.gamMap[t]||(freestar.gamMap[t]=i.dfpId.indexOf("/15184186/")>-1)}function hbpbRounder(e){let{cpm:t}=e;const i=t<=10?20:2;return(Math.round(t*i)/i).toFixed(2)}function getPrebidAdserverTargetingKeys(e){let{freestar:t}=e;if(t?.prebidAdserverTargetingKeys)return t.prebidAdserverTargetingKeys;const i={},n=t.fsdata.useFsAdserverTargetingKeys||getUrlParameter("use-fs-adserver-targeting-keys")?"fs_":"hb_";return["bidder","adid","pb","size","format","auction_id","source"].forEach((e=>{i[e]=`${n}${e}`})),t.prebidAdserverTargetingKeys=i,i}const QUEUE_POLL_INTERVAL_MS=500,MAX_MESSAGES_IN_BUFFER=30,CUSTOM_EVENT="customEvent",TOPIC={IMMEDIATE:"immediate",MAIN:"main",BEACON:"beacon",ERROR:"error"};class AnalyticsEvent{type="default";constructor(e,t){this._payload=this._buildPayload(e),this._topic=t}get payload(){return this._payload}get topic(){return this._topic||TOPIC.MAIN}setTopic(e){this._topic=e}setType(e){this.type=e}_buildPayload(e){return e||{}}}class CustomAnalyticsEvent extends AnalyticsEvent{type=(()=>CUSTOM_EVENT)();_buildPayload(e){const{eventType:t,data:i,eventName:n}=e;return{eventType:t,eventName:n,jsonValue:JSON.stringify(i)}}}class ContentRecommendationPartnerImpression extends AnalyticsEvent{type="contentRecommendationPartnerImpression";get payload(){const{partnerName:e,placementName:t,contextId:i}=this._payload;return{eventType:"contentRecommendationPartnerImpression",partnerName:e,placementName:t,contextId:i}}}function checkForValidity(){if("object"!=typeof window.freestar.fsdata)throw new Error("The fsdata object is not properly defined, exiting...");if(window.freestar.fsdata.onlyAllowedDomains&&window.freestar.fsdata.allowedDomains&&window.freestar.fsdata.allowedDomains.length&&!checkForAllowedDomainsToRunOn({domains:window.freestar.fsdata.allowedDomains}))throw new Error("The current domain is not in the allowed domains list, exiting...");if(window.freestar.fsdata.urlBlocklist&&window.freestar.fsdata.urlBlocklist.length&&checkForUrlBlocklist(window.freestar.fsdata.urlBlocklist))throw new Error("The current domain is in the blocked url list, exiting...")}function checkForAllowedDomainsToRunOn(e){let{domains:t}=e,i=0===t.length;return t.forEach((e=>{0===e.indexOf("*.")&&(e=e.slice(2)),i||(i=-1!==top.location.host.indexOf(e))})),!(!i&&fsdata.onlyAllowedDomains)}function checkForUrlBlocklist(e){const t=/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+$/,{href:i,pathname:n,host:s,search:r}=top.location,a=(e,t)=>e.includes("/*")?i.includes(e.replace("/*","")):t,o=e=>"/"===e[e.length-1]?e.substring(0,e.length-1):e;return e.find((e=>(e=>{try{return new URL(e),!0}catch(e){return!1}})(e)?a(e,o(i)===o(e)):(e=>{const i=e.split("/");return t.test(i[0])})(e)?a(e,o(s+n+r)===o(e)):n.includes(e)))}function createElement(e){let{type:t="div",classList:i=[],id:n=!1,src:s=!1,name:r=!1,attributes:a=[],children:o=[],style:d={},innerHTML:l,textContent:c}=e;const u=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:document).createElement(t);return i.length&&(u.className=i.join(" ")),s&&(u.src=s),n&&(u.id=n),r&&u.setAttribute("name",r),Array.isArray(a)?a.forEach((e=>{Object.entries(e).forEach((e=>{let[t,i]=e;u.setAttribute(t,i)}))})):Object.entries(a).forEach((e=>{let[t,i]=e;u.setAttribute(t,i)})),Object.keys(d).length&&applyStyles(u,d),l&&(u.innerHTML=l),c&&(u.textContent=c),o.length&&o.forEach((e=>{e&&u.appendChild(e)})),u}const applyStyles=(e,t)=>(e&&Object.entries(t).forEach((t=>{let[i,n]=t;e.style[i]=n})),e);function load_script$1(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0,s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],r=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0;try{const o=createElement({type:"script"});e&&(o.src=e),r&&o.setAttribute("data-owner","freestar"),n&&(o.textContent=n),i&&(o.id=i),s&&(o.async=s),o.type="text/javascript",t&&o.addEventListener("load",t,{once:!0}),a&&o.addEventListener("error",a),document.getElementsByTagName("head")[0].appendChild(o)}catch(e){}}const loadScriptAsync=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;return new Promise(((n,s)=>{load_script$1(e,n,t,i,!0,!0,s)}))};function disabledProductsTemporaryShim(){if(window.freestar.config.disabledProducts)for(const e in window.freestar.config.disabledProducts)Object.prototype.hasOwnProperty.call(window.freestar.config.disabledProducts,e)&&(void 0===window.freestar.config.products[e]?console.error(`Freestar product name: ${e} does not exist.`):window.freestar.config.products[e].disabled=window.freestar.config.disabledProducts[e])}class AdSlotConfig{constructor(e){this.adSlotId=e.getSlotElementId(),this.size=e.getSizes().map((e=>"fluid"===e?[1,1]:[e.getWidth(),e.getHeight()])),this.adUnitPath=e.getAdUnitPath()}}function iasQueuePush(e){let{slotArray:t}=e;window.__iasPET.queue=window.__iasPET.queue||[],window.__iasPET.queue.push({adSlots:t,dataHandler:function(){window.__iasPET.setTargetingForGPT()}})}function iasPETTargetingAllSlots(){const e=[];getSlots().forEach((t=>e.push(new AdSlotConfig(t)))),e.length&&iasQueuePush({slotArray:e})}function iasPETTargeting(e){let{slot:t=null}=e;void 0!==window.__iasPET&&(freestar.log(1,"Publisher SlotOperations IAS: iasPETTargeting found"),t?iasQueuePush({slotArray:[new AdSlotConfig(t)]}):iasPETTargetingAllSlots())}function iasDebugInit(){freestar.log(1,"Publisher SlotOperations Testing IAS: loading script"),load_script$1("//cdn.adsafeprotected.com/iasPET.1.js"),window.__iasPET=window.__iasPET||{};const e=window.__iasPET;e.queue=e.queue||[],e.pubId="10249"}function moatTargeting(e){let{slot:t=null}=e;window.moatPrebidApi&&("function"==typeof window.moatPrebidApi.slotDataAvailable&&window.moatPrebidApi.slotDataAvailable()||"function"==typeof window.moatPrebidApi.pageDataAvailable&&window.moatPrebidApi.pageDataAvailable())&&(freestar.log(1,"Publisher SlotOperations Moat: moatSlotTargetingReady"),t?window.top.moatPrebidApi.setMoatTargetingForSlot(t):window.moatPrebidApi.setMoatTargetingForAllSlots())}function moatDebugInit(e){e=e||0,e++,window.moatPrebidApi&&"function"==typeof window.moatPrebidApi.enableLogging?(freestar.log(1,"Publisher SlotOperations Testing Moat: Logging Enabled"),window.moatPrebidApi.enableLogging()):e<10&&(freestar.log(1,"Publisher SlotOperations Testing Moat: Not set in global try again."),setTimeout((function(){moatDebugInit(e)}),200))}function publisherSlotOperationsInit(e){let{slot:t=null}=e;iasPETTargeting({slot:t}),moatTargeting({slot:t})}function publisherSlotOperationsTesting(){switch(getUrlParameter("publisher-slot-op")){case"ias":freestar.log(1,"Publisher SlotOperations Testing IAS"),iasDebugInit();break;case"moat":freestar.log(1,"Publisher SlotOperations Testing MOAT"),moatDebugInit();break;default:freestar.log(1,"No Publisher SlotOperations Testing Params")}}const AUCTION_KVPS_INCLUDED_FIELDS=["fsrefresh","fsrebid","fs_uuid","floors_id","floors_hour","fs_placementName","fs_ad_product","fs_clientservermask","amznbid","amznp","fs-auuid","fsbid","fsitf","fs_session_id","fs_pageview_id","fs_version","user-agent","floors_user","floors_rtt","fs_testgroup","fs_carousel"],BID_WON_KVPS_INCLUDED_FIELDS=["fsrefresh"];class AdUnit{constructor(e){let{placement:t=null,prebid:i=null,slot:n=null}=e;this.placement=t,this.prebid=i,this.slot=n,this.trackedAdIds=new Set,this.states=[],this.renderMap=new Map}update(e){let{prebid:t=null,slot:i=null}=e;t&&(this.prebid=t),i&&(this.slot=i)}formatKVP(e,t){return`[${e}=${t}]`}getRefreshKVP(){if(!this.slot)return null;const e=this.slot.getTargetingMap();return Object.entries(e).flatMap((e=>{let[t,i]=e;return BID_WON_KVPS_INCLUDED_FIELDS.includes(t)?[this.formatKVP(t,i)]:[]}))}getKVPs(){if(!this.slot)return null;const e=this.slot.getTargetingMap();return[...Object.entries(e).flatMap((e=>{let[t,i]=e;return AUCTION_KVPS_INCLUDED_FIELDS.includes(t)?[this.formatKVP(t,i)]:[]})),...googletag.pubads().getTargetingKeys().flatMap((e=>{if(!AUCTION_KVPS_INCLUDED_FIELDS.includes(e))return[];return googletag.pubads().getTargeting(e).map((t=>this.formatKVP(e,t)))}))]}getWinningBid(){return null}setAUUID(e){let{fsAuctionId:t}=e;this.slot?.setTargeting?.("fs-auuid",t)}getStateByFsAuctionId(e){let{fsAuctionId:t}=e;return this.states.find((e=>e.fsAuctionId===t))||!1}saveState(e){let{fsAuctionId:t,auctionType:i,prebidAuctionId:n=null}=e,s={};const r=this.placement.name||this.prebid?.code||this.slot?.getSlotElementId();freestar.rebidManager&&r&&(s=freestar.rebidManager.getStatus({adUnitCode:r})),this.setAUUID({fsAuctionId:t}),this.states.push({fsAuctionId:t,prebidAuctionId:n,auctionType:i,rebid:s})}isDisplayAd(){return!["stickyFooter","sideWall","pushdown","revolvingRail","stickyRail"].some((e=>isOptionActive({placement:this.placement,type:`${e}Options`})))}getSlotId(){return this.prebid?.code||this.slot?.getSlotElementId()||this.placement?.name}}class AdUnitManager{constructor(){this.adUnits=new Map}add(e){let{placement:t=null,prebid:i=null,slot:n=null}=e;const s=n?.getSlotElementId()||i?.code;if(s)if(this.adUnits.has(s)){this.adUnits.get(s).update({prebid:i,slot:n})}else if(t||(t=i?getPlacementByName({name:dynamicSlotGet({slotId:i.code})}):n?getPlacementByName({name:dynamicPathGet({path:n.getAdUnitPath()}).placementName}):null),t){n=n??getSlot({elementId:s});const e=new AdUnit({placement:t,prebid:i,slot:n});this.adUnits.set(s,e)}}getAdUnitByPlacementName(e){return[...this.adUnits.values()].find((t=>t.placement?.name===e))||!1}getAdUnitByPrebidCode(e){return this.adUnits.get(e)||!1}getAdUnitBySlotElementId(e){return Array.from(this.adUnits.values()).find((t=>t.slot&&t.slot.getSlotElementId()===e))||!1}getAdUnitBySlotAdUnitPath(e){return[...this.adUnits.values()].find((t=>t.slot?.getAdUnitPath()===e))||!1}}const adUnitManager=new AdUnitManager;window.freestar&&window.freestar.queue&&window.freestar.queue.push((()=>{window.freestar.adUnitManager=adUnitManager}));const PERFORMANCE_MARKS_LIST={pubfigEngineLoadInit:"pubfig-engine-load-init",pubfigEngineSetupStart:"pubfig-engine-setup-start",pubfigEngineLoad:"pubfig-engine-load",pubfigSlotRequested:"pubfig-slotRequested",pubfigStickyFooterSlotRequested:"pubfig-sticky-footer-slotRequested",pubfigSlotRenderEnded:"pubfig-slotRenderEnded",pubfigEngineSetupEnd:"pubfig-engine-setup-end",pubfigStickyFooterSlotRenderEnded:"pubfig-sticky-footer-slotRenderEnded",pubfigPrebidFsRequestBids:"pubfig-prebid-fsRequestBids",pubfigPrebidAuctionInit:"pubfig-prebid-auctionInit",pubfigPrebidAuctionEnd:"pubfig-prebid-auctionEnd",pubfigLoaded:"pubfig-loaded",pubfigInitRequestStart:"pubfig-init-request-start",pubfigInitRequestEnd:"pubfig-init-request-end"},getAdServerRequestCanceledMessage=e=>`Adserver request cancelled for: ${e.toString()}`;function getAdUnitCodesWithNoBids(e){let{bidsReceived:t}=e,i=fsprebid.adUnits.map((e=>e.code)).reduce(((e,t)=>(e[t]=!1,e)),{});return t&&t.forEach((e=>{e.cpm>0&&(i[e.adUnitCode]=!0)})),Object.keys(i).filter((e=>0==i[e]))}function setNoBidTargeting(e){let{adUnitCodesWithNoBids:t,isTimeout:i}=e;getSlots().forEach((e=>{if(i)e.setTargeting("fsbid","timeout");else if(t){const i=e.getAdUnitPath(),n=getPlacementByAdUnitPath({adUnitPath:i});n&&t.indexOf(n.name)>-1&&e.setTargeting("fsbid","0")}}))}function handleNoBids(e){let{auctionData:t}=e;const{bidsReceived:i,noBids:n}=t;setNoBidTargeting({adUnitCodesWithNoBids:getAdUnitCodesWithNoBids({bidsReceived:i,noBids:n}),isTimeout:!1})}function validateElements(e){let{elementIds:t}=e;return t&&t.length?(Array.isArray(t)||(t=[t]),!(!t||!t.length)&&t):freestar.fsdata.placements.map((e=>{if(e.validAdSizes&&!e.stickyFooter&&!e.pushdownUnit&&0===e.sideWallType&&document.getElementById(e.name))return e.name})).filter((e=>void 0!==e))}function fsRequestBids(){let{elementIds:e,slots:t,timeout:i,callback:n,sendAdserverSignal:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e=validateElements({elementIds:e}),!e||!e.length)return;createCustomEvent({name:"auctionStarted",detail:!0}),freestar.performanceLogger.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigPrebidFsRequestBids});const r=i||window.freestar.fsdata.timeout,a={prebid:!1,aps:!1,adserverRequestSent:!1};freestar.requestReference.bidTimer=null,freestar.requestReference.requestNum=++freestar.bidRequestNum;let o=[];const d=idealAdStackManager().isGAMEnabled(),l=freestar.amazonNetwork;if(d){const e=setupAmazonSlots(t);Array.isArray(e)&&(o=e)}function c(t){freestar.debug&&freestar.debug>24&&"prebid"===t&&setTimeout((()=>{prebidTable()}),1500),freestar.log(1,`(${freestar.requestReference.requestNum}) Bidder back:`,t),a.prebid&&(!d||a.aps)&&d&&(s instanceof Promise?s.then((()=>f())).catch((()=>{freestar.log(1,getAdServerRequestCanceledMessage(e))})):f())}function u(e){let t,i,n=!0;const s=fsprebid.getBidResponses()[e.domId],r=getPlacementByName({name:dynamicGet({slotId:e.placementName})});return s&&r?(i=maxBy(s.bids,(function(e){return Number(e.cpm)})),t=r[`floor${freestar.deviceInfo.device.type.charAt(0).toUpperCase()+freestar.deviceInfo.device.type.slice(1)}`],isNumber(t)&&t>0&&i&&i.cpm&&i.cpm<t&&(n=!1),n):n}function h(e){return freestar.dynamicSlotLibrary[e]?freestar.dynamicSlotLibrary[e]:e}function f(){!0!==a.adserverRequestSent&&(a.adserverRequestSent=!0,freestar.requestReference.bidTimer&&clearTimeout(freestar.requestReference.bidTimer),freestar.log(2," ("+freestar.requestReference.requestNum+") Sending adserver request!"),googletag.cmd.push((function(){const t={activeIds:[],activeSlots:[]};if(Array.isArray(e)&&e.length){const i=[];freestar.log(2," ("+freestar.requestReference.requestNum+") Refresh Only:",e),freestar.amazonNetwork&&apstag.setDisplayBids(e),e.forEach((e=>{let t=document.getElementById(e);if(t){const e=getPlacementByName({name:dynamicGet({slotId:t.getAttribute("name")})});e&&i.push(e.name)}}));const n=function(){const t={activeIds:[],activeSlots:[]};return e.forEach((e=>{const i=getSlot({elementId:e});i&&t.activeSlots.push(i),u({placementName:h(e),domId:e})&&t.activeIds.push(e)})),t}();t.activeIds=n.activeIds,t.activeSlots=n.activeSlots}else freestar.log(2," ("+freestar.requestReference.requestNum+") Refresh All!"),freestar.amazonNetwork&&apstag.setDisplayBids(),t.activeIds=function(){const e=[];return getSlots().forEach((t=>{const i=t.getSlotElementId();freestar.bidsWon&&freestar.bidsWon[i]&&!freestar.bidsWon[i]&&(freestar.bidsWon[i].evaluated=!0,u({placementName:h(i),domId:i})&&e.push(i))})),e}();const i=fsTestCookieFetch();i&&(freestar.log(1,"Part of an A/B test... ",i),gamTargeting({key:"fs_test_variant_id",value:String(i.testGroup)})),t.activeSlots.length&&(t.activeIds.length&&fsprebid.setTargetingForGPTAsync(t.activeIds),displayGPTTargeting(t.activeSlots),function(e){!0===freestar.googletagCorrelatorUpdate?(googletag.pubads().refresh(e),freestar.googletagCorrelatorUpdate=!1):googletag.pubads().refresh(e,{changeCorrelator:!1})}(t.activeSlots)),n&&n()})))}freestar?.config?.setNonPersonalizedAds?(freestar.log(1," ("+freestar.requestReference.requestNum+") set to skip pre auctions, sending GAM request."),s instanceof Promise?s.then((()=>f())).catch((()=>{freestar.log(1,getAdServerRequestCanceledMessage(e))})):f()):(!function(e,t,i){d&&function(e){let{amazonSlots:t,bidTimeout:i,requestManager:n}=e;if(!d||!l||!t.length)return freestar.log(1,"Amazon bidding is not applicable or no valid amazon Slots"),n.aps=!0,void c("aps");freestar.log(1,"Requesting bids from Amazon:",t),apstag.fetchBids({slots:t,timeout:i||1e3},(function(e){freestar.log(1," ("+freestar.requestReference.requestNum+") aps bids:",e),n.aps=!0,c("aps")}))}({amazonSlots:e,bidTimeout:i,requestManager:a}),function(e){let{elementIds:t,bidTimeout:i,requestManager:n}=e;const s={timeout:i||1e3,bidsBackHandler:function(e){freestar.log(1," ("+freestar.requestReference.requestNum+") prebid bid responses:",e),n.prebid=!0,c("prebid")}};t&&(s.adUnitCodes=t),fsprebid.que.push((function(){fsprebid.requestBids(s)}))}({elementIds:t,bidTimeout:i,requestManager:a}),s instanceof Promise&&AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:"REFRESH_EARLY_BIDS",eventType:"BID_REQUEST",data:{elementIds:t}}))}))}(o,e,r),freestar.requestReference.bidTimer=window.setTimeout((function(){d&&(freestar.log(1," ("+freestar.requestReference.requestNum+") TIMEOUT!"),setNoBidTargeting({isTimeout:!0}),s instanceof Promise?s.then((()=>f())).catch((()=>{freestar.log(1,getAdServerRequestCanceledMessage(e))})):f())}),r))}function addAdUnits(e){let{adUnits:t}=e;Array.isArray(t)||(t=[t]);const i=t.filter((e=>e&&null!=e.bids&&e.bids.length>0)),n=t.filter((e=>!e||null==e.bids||0===e.bids.length));if(n.length>0){const e=n.map((e=>e&&e.code)).join(", ");freestar.log(20,`Not adding adUnits ${e} which have no bidders configured.`)}freestar.log(20,`Adding ${i.length} adUnits to fsprebid.`),fsprebid.que.push((function(){fsprebid.addAdUnits(i)})),i.forEach((e=>{adUnitManager.add({prebid:e})}))}function prebidAuctionEndEvent(){fsprebid.que.push((function(){fsprebid.onEvent(PREBID_AUCTION_END,(function(e){freestar.performanceLogger.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigPrebidAuctionEnd,compareTo:[PERFORMANCE_MARKS_LIST.pubfigPrebidAuctionInit]}),handleNoBids({auctionData:e})}))}))}function getSChainBidders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fsxs2s;const{placements:t,networks:i}=window.freestar.fsdata,{bidderOverrides:n=[],type:s=SCHAIN_TYPE_NONE}=window.freestar?.fsdata?.schain||{},r=e=>e.slug;let a=i.map(r).concat(t.filter((e=>e.networks.length)).map((e=>{let{networks:t}=e;return t.map(r)}))).flat();e.hasValidStoredRequests()&&a.push(e.getSlug());const o=n&&n.length;o&&s===SCHAIN_TYPE_FREESTAR?a=a.filter((e=>!n.includes(e))):o&&s===SCHAIN_TYPE_NONE&&(a=a.filter((e=>n.includes(e))));const d=a.filter(((e,t,i)=>i.indexOf(e)===t&&!SCHAIN_BLOCKLIST.includes(e))),l=[];return Object.entries(idealAdStackManager().getConfig().clientServer).forEach((e=>{let[t,i]=e;d.includes(t)&&"both"===i&&l.push(aliasBidder(t))})),d.concat(l)}function removeEmptyParamsFromNetwork(e){return e.sizes.forEach((e=>{Object.keys(e.params).forEach((t=>!e.params[t]&&delete e.params[t]))}))}class RebidManager{constructor(){this.map={}}getStatus(e){let{adUnitCode:t=null}=e;if(t)return this.getStatusByAdUnitCode({adUnitCode:t})}getStatusByAdUnitCode(e){let{adUnitCode:t}=e;return this.map[t]}isAbleToRebid(e){let{elementId:t}=e;return!this.map[t]||this.map[t].count<1}isValidPlacement(e){let{placement:t=!1}=e;return t&&!t.interstitialOptions.active}rebid(e){let{elementId:t,slot:i}=e;window.freestar.log(1,`Rebidding for ${t}`),fsRequestBids({elementIds:[t],slots:i})}handleNoBidScenario(e,t){const{slot:i}=e,n=getPlacementByName({name:dynamicGet({slotId:t})});if(AppContainer.instance.resolve(TOKEN.ANALYTICS).then((i=>{i.track(new CustomAnalyticsEvent({eventName:`EVENT_IS_EMPTY_CAN_REBID=${this.isValidPlacement({placement:n})&&this.isAbleToRebid({elementId:t})}`,eventType:"REBID",data:{event:e}}))})),this.isValidPlacement({placement:n})){if(this.isAbleToRebid({elementId:t}))return this.track({elementId:t}),this.updateKeyValues({slot:i,data:{fsrebid:String(this.map[t].count)}}),void floorsManager().getFloorsData({placement:n,slotId:t,callback:e=>{let{result:s}=e;window.freestar.log(1,`Floors called for rebid for blocked ad on ${n.name}`),s&&i.updateTargetingFromMap(s),this.rebid({elementId:t,slot:i})},isRebid:!0});window.freestar.log(1,`Rebid attempts exceeded ${t}`),this.reset({elementId:t})}}resetRebidStatus(e){this.map[e]&&(window.freestar.log(1,`Rebid successful ${e}`),this.reset({elementId:e}))}reset(e){let{elementId:t}=e;const i=getSlot({elementId:t});i&&i.setTargeting("fsrebid","0"),delete this.map[t]}track(e){let{elementId:t,type:i="EMPTYRESPONSE"}=e;this.map[t]||(this.map[t]={count:0,type:i}),this.map[t].count+=1}updateKeyValues(e){let{slot:t,data:i}=e;t.updateTargetingFromMap(i)}}const rebidManager=new RebidManager;function refreshRebidControl(e){const t=window.freestar.rebidControl[e];t&&(t.setTargeting(0),delete window.freestar.rebidControl[e])}function refreshRebidControls(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(null!=e?e:Object.keys(window.freestar.rebidControl)).forEach((e=>refreshRebidControl(e)))}class GlobalRefreshUserIDsState{constructor(){this.lastRefreshTime=0}allowed(){return Date.now()-this.lastRefreshTime>6e3}updateLastRefreshTime(){this.lastRefreshTime=Date.now()}}class RefreshUserIDs{constructor(){this.requiresRefresh=!0}reset(){this.requiresRefresh=!0}getRefreshThreshold(e){return.8*e}check(e,t){let{refreshCounter:i,refreshTime:n}=e;if(t.allowed()&&this.requiresRefresh){i>=this.getRefreshThreshold(n)&&i<n&&(t.updateLastRefreshTime(),this.requiresRefresh=!1,window.fsprebid.refreshUserIds())}}}const refresher=(e,t)=>{if(document.getElementById(e.name)){deleteAdSlots$1([e.name]);const i=createGAMSlot({placement:e,id:e.name});slotTargeting(i,e.name,null,{fs_ad_product:getSlotProduct(e)}),t.push(i)}},orientationChangeCallback=async function(){const e=[],t=freestar.config.removeRefresh||[],i=freestar.config.alwaysRefresh||[];buildPlacements(),freestar.fsdata.placements.forEach((n=>{(freestar.config.enabled_slots&&freestar.config.enabled_slots.indexOf(n.name)>-1&&!n.stickyFooter&&-1===t.indexOf(n.name)||i.indexOf(n.name)>-1)&&refresher(n,e)})),setupAdRefresherVersionCheck(e)},getDeviceOrientation=e=>{let{width:t,height:i}=e;return t>i?"landscape":"portrait"},deviceOrientationRefresh=()=>{window.addEventListener("resize",(()=>{setTimeout((()=>{const e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight;getDeviceOrientation({width:e,height:t})!==freestar.deviceOrientation&&(freestar.deviceOrientation=getDeviceOrientation({width:e,height:t}),orientationChangeCallback())}),100)}))};class VirtualKeyboardRefreshControl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;this.win=e}init(){this.dummyEl=this.createDummyElement(),this.maxViewportHeight=this.dummyEl.offsetHeight,this.keyboardIsOpen=!1,this.resizeDelay=1e3,this.dummyEl.remove(),this.initialOrientation=getDeviceOrientation({width:this.win?.visualViewport?.clientWidth,height:this.win?.visualViewport?.clientHeight}),this.onResizeDelayed=this.onResizeDelayed.bind(this),this.win.visualViewport.addEventListener("resize",this.onResizeDelayed)}createDummyElement(){const e=document.createElement("div");return e.style.position="absolute",e.style.top="0",e.style.left="0",e.style.width="1px",e.style.height="100svh",e.style.visibility="hidden",document.body.appendChild(e),e}onResizeDelayed(){this.keyboardIsOpen?(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>{this.onResize()}),window.freestar.keyboardRefreshControlDelay||this.resizeDelay)):(clearTimeout(this.resizeTimeout),this.onResize())}onResize(){const e=this.win.visualViewport.height,t=getDeviceOrientation({width:document?.documentElement?.clientWidth,height:document?.documentElement?.clientHeight});t!==this.initialOrientation?(this.initialOrientation=t,this.dummyEl=this.createDummyElement(),this.maxViewportHeight=this.dummyEl.offsetHeight,this.dummyEl.remove()):e>this.maxViewportHeight&&(this.maxViewportHeight=e),e<.9*this.maxViewportHeight?this.keyboardIsOpen||(this.keyboardIsOpen=!0,this.onKeyboardOpen()):this.keyboardIsOpen&&(this.keyboardIsOpen=!1,this.onKeyboardClose())}onKeyboardOpen(){window.freestar?.log(1,"Keyboard opened, pausing ad refresh."),this.win.freestar?.refreshLibrary&&Object.values(this.win.freestar.refreshLibrary).forEach((e=>{e.pauseRefresh=!0}))}onKeyboardClose(){window.freestar?.log(1,"Keyboard closed, resuming ad refresh."),this.win.freestar?.refreshLibrary&&Object.values(this.win.freestar.refreshLibrary).forEach((e=>{e.pauseRefresh=!1}))}destroy(){this.win.visualViewport.removeEventListener("resize",this.onResize)}}const REFRESH_LOG_TITLE="REFRESH",VIDEO_LOG_TITLE="VIDEO",STICKY_FOOTER_LOG_TITLE="STICKYFOOTER";class AuctionStartAnalyticsEvent extends AnalyticsEvent{type="auctionStart";static payloadProperties=["placementId","DfpId","fsAuctionId","auctionId","auctionType","location","userIds","kvps"];_buildPayload(e){return pick(e,AuctionStartAnalyticsEvent.payloadProperties)}}class AuctionEndAnalyticsEvent extends AnalyticsEvent{type="auctionEnd";static payloadProperties=(()=>[...AuctionStartAnalyticsEvent.payloadProperties,"fsAuctionId","winningBid","advertiserId","campaignId","isEmpty","lineItemId","serviceName","size","sourceAgnosticCreativeId","sourceAgnosticLineItemId","isNativeRender","isGamBypass","isS2SDisabled","unfilled"])();_buildPayload(e){return pick(e,AuctionEndAnalyticsEvent.payloadProperties)}}class BrowserInfoAnalyticsEvent extends AnalyticsEvent{type="browserInformation";static payloadProperties=["canonical","fpc","hitTime","loadTime","winHeight","winWidth","maxHeight","isServerToServer","googleVersion"];_buildPayload(e){return pick(e,BrowserInfoAnalyticsEvent.payloadProperties)}}class AnalyticsEventFactory{create(){return new AnalyticsEvent}}class BidAnalyticsEventFactory extends AnalyticsEventFactory{constructor(e){let{win:t,freestar:i,dispensaryData:n}=e;super(),this._win=t,this._freestar=i,this._dispensaryData=n,this._rebidManager=i.rebidManager,this._googletag=this._win.googletag}_getCpm(e){const{cpm:t=0}=e;return{cpm:Math.trunc(1e4*t),bidCpm:t,originalCpm:t}}_getAuctionTimeout(){const{fsdata:e}=this._dispensaryData;return"desktop"==this._freestar.deviceInfo.device.type?e.timeout:e.mobileTimeout}}function getMaxBidCpm(e){let{prebid:t,placementId:i}=e;if(!i)return 0;const n=t?.getBidResponsesForAdUnitCode?.(i);if(!n?.bids?.length)return 0;const s=n.bids.sort(((e,t)=>t.cpm-e.cpm)),[r]=s;return Number(r.cpm)}function getRefreshCount(e){let{adUnitCode:t,placementId:i,refreshLibrary:n}=e,s=t||i,r=n?.[s];return r||(s=dynamicGet({slotId:s}),r=n?.[s]),r?.timesRefreshed||0}function getRebid(e){let{bid:t,placementId:i,rebidManager:n,fsAuctionId:s,auctionManager:r}=e;const a={isRebid:!1,rebidType:"NONE",rebidAttempt:0};try{const{adUnitCode:e,slotId:o}=t||{},d=i||e||o;if(n){const e=n.getStatus({adUnitCode:d});if(e)return a.isRebid=e.count>0,a.rebidType=e.type||"NONE",a.rebidAttempt=e.count,a}if(s){const e=r.getAuctionByFsAuctionId(s);if(e){const t=Array.from(e.adUnits).find((e=>e.placement.name===d||e.prebid?.code===d||e.slot?.getSlotElementId()===d));if(t){const e=t.getStateByFsAuctionId({fsAuctionId:s});e&&e.rebid&&(a.isRebid=e.rebid.count>0,a.rebidType=e.rebid.type||"NONE",a.rebidAttempt=e.rebid.count)}}}}catch(e){console.error("Error in getRebid function:",e),console.error("Context:",{bid:t,placementId:i,fsAuctionId:s})}return a}function getPlacementId(e){let{adUnitCode:t,dynamicSlotLibrary:i}=e;const n=i?.[t];return n||t}function getFsuuid(e){let{slotId:t,slot:i,googletag:n}=e;if(!t&&!i)return;const s=n.pubads().getSlots().find((e=>[t,i].includes(e.getSlotElementId())));if(!s)return;return s.getTargeting("fs_uuid").toString()}class BidResponseAnalyticsEvent extends AnalyticsEvent{type="bidResponse";static payloadProperties=["bidderCode","width","height","statusMessage","adId","cpm","bidCpm","creativeId","pubapiId","currencyCode","requestId","responseTimestamp","requestTimestamp","bidder","adUnitCode","timeToRespond","adjustment","ttl","format","placementId","source","auctionTimeout","fsRefreshCount","fsRebidCount","auctionId","fsuuid","bidderResponseCode","fsAuctionId","bidCpm"];_buildPayload(e){return pick(e,BidResponseAnalyticsEvent.payloadProperties)}}class BidResponseAnalyticsEventFactory extends BidAnalyticsEventFactory{constructor(e){let{win:t,freestar:i,dispensaryData:n,auctionManager:s}=e;super({win:t,freestar:i,dispensaryData:n}),this._auctionManager=s,this._dispensaryData=n}create(e){const{mediaType:t,currency:i,auctionId:n}=e,s=this._auctionManager.getAuctionByPrebidAuctionId(n),r=s?s.fsAuctionId:null,a=getPlacementId({adUnitCode:e.adUnitCode,dynamicSlotLibrary:this._freestar.dynamicSlotLibrary}),{rebidAttempt:o}=getRebid({bid:e,placementId:a,rebidManager:this._freestar.rebidManager,auctionManager:this._auctionManager});return new BidResponseAnalyticsEvent({...e,...this._getCpm(e),fsRebidCount:o,currencyCode:i,fsuuid:getFsuuid({slotId:e.slotId,slot:e.slot,googletag:this._win.googletag}),placementId:a,fsRefreshCount:getRefreshCount({placementId:a,adUnitCode:e.adUnitCode,refreshLibrary:this._freestar.refreshLibrary}),fsAuctionId:r,auctionTimeout:this._getAuctionTimeout(),format:t.length?t:"unknown"})}}ModuleRegistry.class(BidResponseAnalyticsEventFactory,{token:"BidResponseAnalyticsEventFactory",defaultAlias:"bidResponseAnalyticsEventFactory",dependencies:[TOKEN.FREESTAR,{token:TOKEN.WINDOW,alias:"win"},TOKEN.DISPENSARY_DATA,TOKEN.AUCTION_MANAGER]});class BidWonAnalyticsEvent extends AnalyticsEvent{type="bidWon";static payloadProperties=["bidderCode","width","height","statusMessage","adId","creativeId","cpm","rawCpm","bidCpm","adUrl","requestId","responseTimestamp","requestTimestamp","bidder","adUnitCode","timeToRespond","pbLg","pbMg","pbHg","pbAg","pbDg","pbCg","size","alwaysUseBid","bidderRefresh","isRebid","format","placementId","source","rebidType","prebidAuctionStrategy","dropped","fsRefreshCount","fsRebidCount","dealId","adomain","networkCode","impressionId","countryCode","fsAdProduct","auctionId","originalCpm","fsuuid","cdep","isGamBypass","isS2SDisabled","fsAuctionId","auctionTimeout","paymentRelationship","kvps"];_buildPayload(e){return pick(e,BidWonAnalyticsEvent.payloadProperties)}}class BidWonAnalyticsEventFactory extends BidAnalyticsEventFactory{constructor(e){let{win:t,freestar:i,dispensaryData:n,auctionManager:s}=e;super({win:t,freestar:i,dispensaryData:n}),this._auctionManager=s,this._dispensaryData=n,this._adUnitManager=adUnitManager}create(e){const{mediaType:t,currency:i,adUnitCode:n,auctionId:s}=e,r=this._auctionManager.getAuctionByPrebidAuctionId(s),a=r?r.fsAuctionId:null,o=e.creative_id||e.creativeId,d=getPlacementId({adUnitCode:e.adUnitCode,dynamicSlotLibrary:this._freestar.dynamicSlotLibrary}),l=this._adUnitManager.getAdUnitByPrebidCode(n)||this._adUnitManager.getAdUnitBySlotElementId(d),{isRebid:c,rebidType:u,rebidAttempt:h}=getRebid({bid:e,placementId:d,rebidManager:this._freestar.rebidManager,fsAuctionId:a,auctionManager:this._auctionManager}),f=getPlacementByName({name:dynamicGet({slotId:n})});return new BidWonAnalyticsEvent({...e,...this._getMeta(e),...this._getCpm(e),isRebid:c,rebidType:u,fsRebidCount:h,isGamBypass:this._getIsGamBypass(),currencyCode:i,fsuuid:getFsuuid({slotId:e.slotId,slot:e.slot,googletag:this._win.googletag}),placementId:d,fsRefreshCount:getRefreshCount({placementId:d,adUnitCode:e.adUnitCode,refreshLibrary:this._freestar.refreshLibrary}),auctionTimeout:this._getAuctionTimeout(),format:t.length?t:"unknown",fsAdProduct:getSlotProduct(f),networkCode:Number(f.dfpId.split("/")[1]),impressionId:generateUUID(),isS2SDisabled:idealAdStackManager().isS2SDisabled(),adomain:this._getAdomain(e),creativeId:o&&String(o),cdep:this._dispensaryData.cdep||"",fsAuctionId:a,auctionId:s,paymentRelationship:this._getPaymentRelationship(e),kvps:l?.getRefreshKVP()},TOPIC.IMMEDIATE)}_getIsGamBypass(){return!idealAdStackManager().isGAMEnabled()}_getMeta(e){const{meta:t={}}=e;return Object.entries(t).reduce(((e,t)=>{let[i,n]=t;return e[i]=Array.isArray(n)?n.join(","):n,e}),{})}_getAdomain(e){const{meta:t={},advertiserDomains:i}=e,n=i||t?.advertiserDomains||[];return Array.isArray(n)?n.join(","):n}_getPaymentRelationship(e){const t=window.freestar?.fsdata?.schain?.type,i=window.freestar?.fsdata?.schain?.bidderOverrides;if(i&&i.length){if(t===SCHAIN_TYPE_FREESTAR&&i.includes(unaliasBidder(e.bidder)))return PAYMENT_RELATIONSHIP_MAP[SCHAIN_TYPE_NONE];if(t===SCHAIN_TYPE_NONE&&i.includes(unaliasBidder(e.bidder)))return PAYMENT_RELATIONSHIP_MAP[SCHAIN_TYPE_FREESTAR]}return PAYMENT_RELATIONSHIP_MAP[t]}}ModuleRegistry.class(BidWonAnalyticsEventFactory,{token:"BidWonAnalyticsEventFactory",defaultAlias:"bidWonAnalyticsEventFactory",dependencies:[TOKEN.FREESTAR,{token:TOKEN.WINDOW,alias:"win"},TOKEN.DISPENSARY_DATA,TOKEN.AUCTION_MANAGER]});class BidRequestedAnalyticsEvent extends AnalyticsEvent{type="bidRequested";static payloadProperties=["bidderCode","auctionId","bidderRequestId","start","timeout","bids","auctionStart","src"];_buildPayload(e){return pick(e,BidRequestedAnalyticsEvent.payloadProperties)}}class BidRequestedAnalyticsEventFactory extends BidAnalyticsEventFactory{constructor(e){let{win:t,freestar:i,dispensaryData:n,auctionManager:s}=e;super({win:t,freestar:i,dispensaryData:n}),this._auctionManager=s,this._dispensaryData=n}create(e){const t=e.bids.map((e=>({bidder:e.bidder,placementCode:e.adUnitCode,bidId:e.bidId,params:JSON.stringify(e.params)})));return new BidRequestedAnalyticsEvent({...e,bids:t})}}ModuleRegistry.class(BidRequestedAnalyticsEventFactory,{token:"BidRequestedAnalyticsEventFactory",defaultAlias:"bidRequestedAnalyticsEventFactory",dependencies:[TOKEN.FREESTAR,{token:TOKEN.WINDOW,alias:"win"},TOKEN.DISPENSARY_DATA,TOKEN.AUCTION_MANAGER]});class BidTimeoutAnalyticsEvent extends AnalyticsEvent{type="bidTimeout";static payloadProperties=["auctionId","bidderRequestId","bidId","bidder","adUnitCode","src","timeout"];_buildPayload(e){return pick(e,BidTimeoutAnalyticsEvent.payloadProperties)}}class DfpResponseAnalyticsEvent extends AnalyticsEvent{type="dfpResponse";static payloadProperties=["placementId","DfpId","advertiserId","campaignId","isEmpty","lineItemId","serviceName","size","sourceAgnosticCreativeId","sourceAgnosticLineItemId","complete","auctionId","dfpRefresh","maxBid","fsRefreshCount","fsRebidCount","fstrU","networkCode","impressionId","countryCode","fsAdProduct","fsuuid","itfTargetingValue","fsAuctionId"];_buildPayload(e){return pick(e,DfpResponseAnalyticsEvent.payloadProperties)}}class DfpResponseAnalyticsEventFactory extends AnalyticsEventFactory{constructor(e){let{win:t,freestar:i,prebidManager:n,auctionManager:s}=e;super(),this._window=t,this._freestar=i,this._prebidManager=n,this._auctionManager=s}create(e){const{parentDiv:t,advertiserId:i=0,campaignId:n=0,lineItemId:s=0,sourceAgnosticCreativeId:r=0,sourceAgnosticLineItemId:a=0,placementId:o,fsAuctionId:d,slotId:l}=e,c=this._window.document.getElementById(t),u=freestar.refreshLibrary?.[t]?.refreshId;let h=!1;if(c&&u){let e;const t=RegExp(u,"g");this._freestar.refreshSlots?.forEach(((i,n)=>{t.test(i.refreshId)&&(e=n,h=!0)})),this._freestar.refreshSlots.splice(e,1)}const f=getRefreshCount({placementId:o,refreshLibrary:this._freestar.refreshLibrary}),{rebidAttempt:p}=getRebid({bid:{fsAuctionId:d,slotId:l},placementId:o,rebidManager:this._freestar.rebidManager,fsAuctionId:d,auctionManager:this._auctionManager}),g=getMaxBidCpm({placementId:o,prebid:this._prebidManager.instance});return new DfpResponseAnalyticsEvent({...e,maxBid:Math.trunc(1e4*g),advertiserId:i,campaignId:n,lineItemId:s,dfpRefresh:h,fsRefreshCount:f,fsRebidCount:p,sourceAgnosticCreativeId:r,sourceAgnosticLineItemId:a,itfTargetingValue:this._freestar.identity.targeting,fsuuid:getFsuuid({slotId:l,googletag:this._window.googletag})})}}ModuleRegistry.class(DfpResponseAnalyticsEventFactory,{token:"DfpResponseAnalyticsEventFactory",dependencies:[TOKEN.FREESTAR,{token:TOKEN.WINDOW,alias:"win"},TOKEN.AUCTION_MANAGER],factory:e=>{let{dependencies:t}=e;return new DfpResponseAnalyticsEventFactory({...t,prebidManager:{get instance(){return t.win.fsprebid}}})}});class OutstreamBidWonAnalyticsEvent extends AnalyticsEvent{type="outstreamBidWon"}class OutstreamTagLoadAnalyticsEvent extends AnalyticsEvent{type="outstreamTagLoad"}class SnifferAnalyticsEvent extends AnalyticsEvent{type="sniffer"}class IaiHighImpactTrackingAnalyticsEvent extends AnalyticsEvent{type="iaiHighImpactTrackings"}class IaiHighImpactAdRequestAnalyticsEvent extends AnalyticsEvent{type="iaiHighImpactAdRequests"}class IaiHighImpactInteractionsAnalyticsEvent extends AnalyticsEvent{type="iaiHighImpactInteractions"}class AdBlockedEvent extends AnalyticsEvent{type="adBlocked"}function Frequency(e){let{placement:t,product:i,callback:n,timeout:s=!1,timestamp:r=!1}=e;this.placement=t,this.product=i,this.productKey=i+"Options",this.timeout=s,this.timestamp=r,this.resetIteration=()=>{this.iteration=0,sessionStorage.setItem(this.key,this.iteration.toString()),freestar.log(1,"Frequency Cap : reset iteration")},this.cleanUpIfTimedOut=()=>{this.timeout&&Date.now()-this.timestamp>=this.timeout&&(this.resetIteration(),this.timestamp=Date.now())},this.incrementIteration=()=>{this.iteration++,sessionStorage.setItem(this.key,this.iteration.toString())},this.subtractIteration=()=>{freestar.log(1,"Frequency Cap : iteration will remove this attempt as an iteration. Setting new sessionStorage item value."),this.iteration--,sessionStorage.setItem(this.key,this.iteration.toString())},this.fetchCap=()=>this.placement[this.productKey]&&t[this.productKey].cap>0?t[this.productKey].cap:-1,this.fetchIteration=()=>{const e=sessionStorage.getItem(this.key);return Number(e)?Number(e):0},this.allowProduct=()=>this.cap>0&&(this.iteration>=this.cap?(freestar.log(1,`Frequency Cap: iteration of ${this.iteration} is higher than cap of ${this.cap}. ${this.product} will not run again until the ${this.timeout?"timeout":"session"} ends.`),!1):(freestar.log(1,`Frequency Cap: iteration of ${this.iteration+1} is lower than or equal to the cap of ${this.cap}. Continue with  ${this.product}.`),!0)),this.cap=this.fetchCap(),this.key=`fs.${this.product}.${this.placement.name}.frequencycap`,this.iteration=this.fetchIteration(),this.callback=n}function frequencyGamEvaluation(e){const t=dynamicGet({slotId:e.slot.getSlotElementId()});t&&freestar.frequencyLibrary[t]&&freestar.frequencyLibrary[t].cap&&(e.isEmpty?e.isEmpty&&freestar.frequencyLibrary[t].callback&&freestar.frequencyLibrary[t].callback(!0):freestar.frequencyLibrary[t].incrementIteration())}const PRODUCT_SLUG$1="rbm",LOG_TITLE$3="RENDER BID MIDWAY V1.0.0",LOG_INFO$6={title:LOG_TITLE$3,styles:"background: black; color: white; border-radius: 3px; padding: 3px"},LOG_ERROR={level:1,title:LOG_TITLE$3,styles:"background: red; color: white; border-radius: 3px; padding: 3px"},FREQUENCY_CAP=1,testParams$1={blockedSiteIDs:[1575,1910,1748,1841,6326,2410,1783,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1985,2095,2132,2170,2232,2244,2511,5491,1756,2372,1556,2086,2087,2192,2193,2194,2195,2196,2197,2198,2199,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2351,2352,2353,2354,2355,2356,2357,2358,2359,2360,2361,2362,2363,2364,2365,2366,2367,2394,2395,2396,2397,2398,2399,2400,2401,2402,2403,2404,2405,2426,3516,5344,3107,3108,3109,3110,3111,3234,6152,6603,1556,1495,6302],default:{percentage:.4},siteSpecific:[{activeSiteIds:[6615,6125,533],percentage:.5},{activeSiteIds:[5926,5927,5928,5929,5930,5931,5932,5933,5934,5935,5936,5937,5938,5939,5940,5941,5942,5943,5944,5960],percentage:2},{activeSiteIds:[7185],percentage:.4,timeout:3e5}]},checkIfInTest$1=()=>{const e=JSON.parse(sessionStorageGet({key:`fs.${PRODUCT_SLUG$1}`}))||{};if(!testParams$1.blockedSiteIDs.includes(freestar.fsdata.siteId)&&void 0===e.inTest){const t=testParams$1.siteSpecific.filter((e=>{if(e.activeSiteIds.includes(freestar.fsdata.siteId))return e})).shift(),i=t?.percentage||testParams$1.default.percentage,n=Math.random();e.inTest=n<i,t?.timeout&&(e.timeout=t?.timeout,e.timestamp=Date.now()),sessionStorageSet({key:`fs.${PRODUCT_SLUG$1}`,value:e,type:SESSION_STORAGE_TYPES.object})}return e.inTest&&1===e.side&&freestar.log(LOG_INFO$6,"Session is participating in test..."),getUrlParameter(`fs-use-${PRODUCT_SLUG$1}`)||e.inTest},getTestDetails=()=>testParams$1.siteSpecific.filter((e=>{if(e.activeSiteIds.includes(freestar.fsdata.siteId))return e})).shift()||testParams$1.default,disallowedBidders=["ttd","ttdfsx","ttds2s"];class RenderBidMidway{constructor(e){let{placement:t,prebid:i=null}=e;this.placement=t,this.prebid=i,this.init()}init(){this.placement.rbmOptions={cap:FREQUENCY_CAP};const e=getTestDetails();this.frequencyCapManager=new Frequency({placement:this.placement,product:"rbm",timeout:e?.timeout,timestamp:e?.timestamp}),AppContainer.instance.resolve(TOKEN.NATIVE_RENDER_MANAGER).then((e=>{this.nativeRender=e}))}renderAd(){if(!this.prebid)return;if(!checkIfInTest$1())return;if(this.frequencyCapManager.cleanUpIfTimedOut(),freestar.log(LOG_INFO$6,this.prebid.code,`Can render an ad? ${this.frequencyCapManager.allowProduct()}`),!this.frequencyCapManager.allowProduct())return;const e=this.nativeRender.getHighestBid(unaliasBidder(this.prebid.code));e&&!disallowedBidders.includes(e.bidderCode)&&(freestar.log(LOG_INFO$6,this.prebid.code,`Found an ad?? ${null!==e}`),this.nativeRender.renderAd(e,this.prebid.code).then((()=>{this.frequencyCapManager.incrementIteration(),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((t=>{const{adId:i}=e;t.track(new CustomAnalyticsEvent({eventName:"RENDER_BID_MIDWAY",eventType:"SUCCESS",data:{adId:i}}))}))})).catch((e=>{freestar.log(LOG_INFO$6,this.prebid.code,`Error native rendering prebid ad: ${e}`)})))}}class RenderBidMidwayManager{constructor(){this.trackers={}}renderAd(e){let{elementId:t}=e;try{const e=this.getAdUnit(t);if(!e)return void freestar.log(LOG_ERROR,`No adUnit found for elementId: ${t}`);const{placement:i,prebid:n}=e;if(!i||!i.name)return void freestar.log(LOG_ERROR,`Invalid placement for elementId: ${t}`);this.ensureTracker(i,n),this.trackers[i.name].renderAd()}catch(e){freestar.log(LOG_ERROR,`Error in renderAd: ${e.message}`)}}getAdUnit(e){return this.adUnitManager||(this.adUnitManager=adUnitManager),this.adUnitManager.getAdUnitBySlotElementId(e)||this.adUnitManager.getAdUnitByPrebidCode(e)}ensureTracker(e,t){this.trackers[e.name]||(this.trackers[e.name]=new RenderBidMidway({placement:e,prebid:t}))}}const renderBidMidwayManager=new RenderBidMidwayManager;class Refresher{_bidRequestLibrary=(()=>new Map)();getSignal(e){return this._bidRequestLibrary.has(e)&&(this._bidRequestLibrary.get(e).reject(),this._bidRequestLibrary.delete(e)),new Promise(((t,i)=>{this._bidRequestLibrary.set(e,{resolve:t,reject:i})}))}getPendingRequest(e){return this._bidRequestLibrary.has(e)?()=>{this._bidRequestLibrary.get(e).resolve(),this._bidRequestLibrary.delete(e)}:null}shouldRefresh(){return!0}prepareToRefresh(){}refresh(){}}class DefaultRefresher extends Refresher{prepareToRefresh(e){let{elementId:t}=e;const i=this.getSignal(t);AdRefresher.refreshSlots({slotIds:[t],sendAdserverSignal:i},!1)}refresh(e){let{elementId:t,refreshAttributes:i}=e;const n=document.getElementById(t);setOriginalRefreshRate(n);const s=this.getPendingRequest(t);"function"==typeof s?s():AdRefresher.refreshSlots({slotIds:[t]},!1),i?.refreshUserIds&&i.refreshUserIds.reset()}}class StickyFooterRefresher extends Refresher{shouldRefresh(e){let{elementId:t}=e;return t===freestar.currentStickyFooter?.placement?.name}prepareToRefresh(e){let{elementId:t}=e;const i=freestar.currentStickyFooter?.footer||freestar.currentStickyFooter;if(i?.getIsNextVideo())return;const n=this.getSignal(t);freestar.currentStickyFooter.stickyFooterRefresh(n)}refresh(e){let{elementId:t,refreshAttributes:i}=e;i.timesRefreshed+=1;const n=this.getPendingRequest(t);"function"==typeof n?n():freestar.currentStickyFooter.stickyFooterRefresh(),i?.refreshUserIds&&i.refreshUserIds.reset()}}class SuperflexRefresher extends Refresher{constructor(){let{win:e=window}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.win=e}shouldRefresh(e){let{placement:t}=e;return this.win.freestar.superflex&&this.win.freestar.superflex.refresh&&this.win.freestar.superflex.isSuperflex&&this.win.freestar.superflex.isSuperflex({placement:t})}refresh(e){let{elementId:t,refreshAttributes:i,placement:n}=e;i.timesRefreshed+=1,this.win.freestar.superflex.refresh({elementId:t,placement:n}),i?.refreshUserIds&&i.refreshUserIds.reset()}}function createAdPayload(e){return{bidder:unaliasBidder(e.bidder),creativeId:e.creativeId,cpm:e.cpm,mediaType:e.mediaType,evaluated:!1,ad:e.ad,time:Date.now()}}function handleBidWonEvent(e){const{adUnitCode:t}=e;t&&(freestar.bidsWon[t]=createAdPayload(e))}function networkBidWonEvents(){fsprebid.que.push((function(){fsprebid.onEvent(PREBID_BID_WON,(e=>handleBidWonEvent(e)))}))}const logText="Bid Adjustment Log : ";function bidAdjustmentInit(e){let{bidder:t,cpm:i,siteAdjustment:n,networkAdjustment:s}=e;(n||s&&freestar.adjustments.isLogged)&&(freestar.log(logText,"bidder : ",t),freestar.log(logText,"cpm : ",JSON.stringify(i)),n&&freestar.log(logText,"siteAdjustment : ",n),s&&freestar.log(logText,"networkAdjustment : ",s))}function bidAdjustmentFinalized(e){let{cpm:t,siteAdjustment:i,networkAdjustment:n,bid:s}=e;(t&&i||n)&&(freestar.adjustments.isLogged&&freestar.log(logText,"final cpm value : ",t),s.rawCpm=s.cpm,s.adjustedCpm=t,freestar.adjustments.bids.push(index(s)))}function bidAdjustmentResponseLog(){freestar.adjustments.isLogged&&fsprebid.onEvent(PREBID_BID_RESPONSE,(function(e){const t=freestar.adjustments.bids.find((t=>t.requestId===e.requestId));t&&(freestar.log("Bid Adjustment Log: bid response after adjustment",e),freestar.log("Bid Adjustment Log: original bid",t))}))}class Publisher{constructor(){this.ext={fs_company:window.freestar.fsdata&&window.freestar.fsdata.companyId||"unknown"}}}class Content{constructor(){this.data=[{name:`www.${FREESTAR_LOCATION_HOST}`,ext:{taxonomyname:"iab_content_taxonomy"},segment:getIABSegments()}]}}class SiteExtData{constructor(){this.fs_optimized=this.getIsOptimized(window.freestar),this.fs_site=window.freestar.fsdata&&window.freestar.fsdata.siteId||"unknown"}getIsOptimized(e){let{config:t={}}=e;return!(!t||!t.pageSpeedOptimized)&&t.pageSpeedOptimized}}class SiteExt{constructor(){this.data=new SiteExtData}}class Site{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.name=window.freestar.fsdata.path||"",this.domain=window.freestar.fsdata.domain||"",this.cat=window.freestar.fsdata.categories||[],this.sectioncat=window.freestar.fsdata.categories||[],this.pagecat=window.freestar.fsdata.categories||[],this.page=window.location.href||"",this.mobile=e===DEVICE_TYPE_MOBILE?1:0,this.ref=document.referrer||"",this.content=new Content,this.ext=new SiteExt,this.publisher=new Publisher}}class User{constructor(){this.id=window.freestar.msg.fpc||""}isValid(){return this.id&&this.id.length&&this.id!==FREESTAR_DNT_COOKIE}}class OrtbChild{clean(){for(const e in this)"string"==typeof this[e]&&0===this[e].length&&delete this[e]}}class Geo extends OrtbChild{constructor(){super(),this.region=this.getRegion(),this.city=this.getCity(),this.country=this.getCountry(),this.ext={},this.clean()}getLocObj(){return!!window.freestar.locData&&window.freestar.locData}getRegion(){return void 0!==this.region?this.region:this.getLocObj().state||""}getCity(){return void 0!==this.city?this.city:this.getLocObj().city||""}validateCountryISO(e){return 2===e.length&&e}getCountry(){return void 0!==this.country&&this.validateCountryISO(this.country)?this.country:this.getLocObj().iso&&this.validateCountryISO(this.getLocObj().iso)?this.getLocObj().iso:""}}class DeviceType{constructor(){this.types={unknown:0,mobile:1,desktop:2,ctv:3,phone:4,tablet:5,connectedDevice:6,"set-top-box":7}}getType(){if(window.freestar.deviceInfo&&window.freestar.deviceInfo.device){if(6324===window.freestar.fsdata.siteId)return this.types.ctv;const{type:e="unknown"}=window.freestar.deviceInfo.device;if(e&&this.types[e])return this.types[e]}return this.types.unknown}}class Device{constructor(){this.ua=this.fetchFromDeviceInfo("ua"),this.geo=new Geo({}),this.dnt=this.getUserDNTStatus(),this.devicetype=(new DeviceType).getType(),this.make=this.getMobileDeviceInfo("vendor"),this.model=this.getMobileDeviceInfo("model"),this.os=this.getOSInfo("name"),this.osv=this.getOSInfo("version")}getUserDNTStatus(){return window.freestar.msg.fpc===FREESTAR_DNT_COOKIE?1:0}getOSInfo(e){return this.fetchFromDeviceInfo("os")[e]||""}fetchFromDeviceInfo(e){return window.freestar&&window.freestar.deviceInfo&&window.freestar.deviceInfo[e]?window.freestar.deviceInfo[e]:""}getMobileDeviceInfo(e){return this.fetchFromDeviceInfo("device")[e]||""}}class Prebid{constructor(){window.freestar.fsdata.topLevelStoredRequestId&&(this.storedrequest={id:window.freestar.fsdata.topLevelStoredRequestId})}}class Ortb2Ext{constructor(){this.prebid=new Prebid}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})})),i}var isMergeableObject=function(e){return isNonNullObject(e)&&!isSpecial(e)};function isNonNullObject(e){return!!e&&"object"==typeof e}function isSpecial(e){var t=Object.prototype.toString.call(e);return"[object RegExp]"===t||"[object Date]"===t||isReactElement(e)}var canUseSymbol="function"==typeof Symbol&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(e){return e.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(e){return Array.isArray(e)?[]:{}}function cloneUnlessOtherwiseSpecified(e,t){return!1!==t.clone&&t.isMergeableObject(e)?deepmerge(emptyTarget(e),e,t):e}function defaultArrayMerge(e,t,i){return e.concat(t).map((function(e){return cloneUnlessOtherwiseSpecified(e,i)}))}function getMergeFunction(e,t){if(!t.customMerge)return deepmerge;var i=t.customMerge(e);return"function"==typeof i?i:deepmerge}function getEnumerableOwnPropertySymbols(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e).filter((function(t){return Object.propertyIsEnumerable.call(e,t)})):[]}function getKeys(e){return Object.keys(e).concat(getEnumerableOwnPropertySymbols(e))}function propertyIsOnObject(e,t){try{return t in e}catch(e){return!1}}function propertyIsUnsafe(e,t){return propertyIsOnObject(e,t)&&!(Object.hasOwnProperty.call(e,t)&&Object.propertyIsEnumerable.call(e,t))}function mergeObject(e,t,i){var n={};return i.isMergeableObject(e)&&getKeys(e).forEach((function(t){n[t]=cloneUnlessOtherwiseSpecified(e[t],i)})),getKeys(t).forEach((function(s){propertyIsUnsafe(e,s)||(propertyIsOnObject(e,s)&&i.isMergeableObject(t[s])?n[s]=getMergeFunction(s,i)(e[s],t[s],i):n[s]=cloneUnlessOtherwiseSpecified(t[s],i))})),n}function deepmerge(e,t,i){(i=i||{}).arrayMerge=i.arrayMerge||defaultArrayMerge,i.isMergeableObject=i.isMergeableObject||isMergeableObject,i.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var n=Array.isArray(t);return n===Array.isArray(e)?n?i.arrayMerge(e,t,i):mergeObject(e,t,i):cloneUnlessOtherwiseSpecified(t,i)}deepmerge.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce((function(e,i){return deepmerge(e,i,t)}),{})};var deepmerge_1=deepmerge,cjs=deepmerge_1,merge=getDefaultExportFromCjs(cjs);class Ortb2{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const t=window.freestar.config.ortb2||{};this.site=this.merge(t.site,new Site(e)),this.user=this.merge(t.user,new User),this.device=this.merge(t.device,new Device),this.geo=this.merge(t.geo,new Geo),this.ext=this.merge(t.ext,new Ortb2Ext)}merge(){return merge(arguments.length>1?arguments[1]:void 0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}}function isGDPRCountry(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.freestar.locData;return!!e&&(GDPR_MEMBER_GEOS.includes(e.iso)||"QC"===e.state)}const getTcfConsentString=e=>{hasTcfapi()?window.__tcfapi("getTCData",2,((t,i)=>i&&t.tcString?e(t.tcString):e(null))):e(null)},hasTcfapi=()=>Boolean(window.__tcfapi);function generateSchain(e,t,i){const n=i&&i.length;if(t!==SCHAIN_TYPE_NONE||n)return{ver:"1.0",complete:1,nodes:[{asi:FREESTAR_LOCATION_HOST,sid:`${e}`,hp:1}]}}const TOPICS_MODULE_CONFIG={maxTopicCaller:3,bidders:[{bidder:"pubmatic",iframeURL:"https://ads.pubmatic.com/AdServer/js/topics/topics_frame.html",expiry:7},{bidder:"openx",iframeURL:"https://pa.openx.net/topics_frame.html",expiry:7}]};function refreshAds(e){if(e?.adUnitCode){let t=null,i=!1;try{t=freestar.refreshLibrary?.[e.adUnitCode]?.dataRefreshId}catch(e){freestar.log(1,`Error: ${e}`)}if(t){let e=0;const n=RegExp(t,"g");return freestar.refreshSlots.forEach(((t,s)=>{n.test(t.refreshId)&&(e=s,i=!0)})),freestar.refreshSlots.splice(e,1),i}return i}return!1}const pbjsBase={},s2sNetworks=[];let fsxs2s=null;function manipulateCpm(e){let{bidder:t,cpm:i,siteAdjustment:n,networkAdjustment:s,placement:r,bid:a}=e;bidAdjustmentInit({bidder:t,cpm:i,siteAdjustment:n,networkAdjustment:s,placement:r,bid:a});let o=i;const d=getUrlParameter("manipulate-cpm"),l=getUrlParameter("manipulate-bidder");if(d&&l&&t===l)return d;if(d)return d;function c(e){let{adj:t,value:i}=e;const n=Number(i*((100-t)/100)).toFixed(8);return parseFloat(n)}if(s&&s>0&&(o=c({adj:s,value:o})),n&&n>0&&(o=c({adj:n,value:o})),t&&r&&r.networks&&r.networks.length){const e=function(e){let{bidder:t,placement:i}=e;const n=i.networks.filter((function(e){if(t===e.slug&&e.placementLevelBidAdjustment&&e.placementLevelBidAdjustment>0)return e}))[0];return n?n.placementLevelBidAdjustment:0}({bidder:t,placement:r});e&&e>0&&(o=c({adj:e,value:o}))}return bidAdjustmentFinalized({cpm:o,siteAdjustment:n,networkAdjustment:s,bid:a}),o}pbjsBase.initiate=()=>{var e=window.fsprebid||{};return e.que=e.que||[],e.retries=0,e};let payload={};function fetchNetworkAdjustment(e){let{network:t}=e;const{id:i}=t;let n=t.networkBidAdjustment||0;if(freestar.networkMap&&i){const e=freestar.networkMap[i];n=e&&e.bidAdjustment&&Number(e.bidAdjustment)&&e.bidAdjustment>0?e.bidAdjustment:t.networkBidAdjustment||0}return n}function bidAdjustmentCreator(e){payload[e.slug]||(payload[e.slug]={bidCpmAdjustment:function(t,i){const n=getPlacementByName({name:dynamicGet({slotId:i.adUnitCode})}),s=manipulateCpm({bidder:e.slug,cpm:t,siteAdjustment:e.bidAdjustment,networkAdjustment:fetchNetworkAdjustment({network:e}),placement:n,bid:i});return s||t}})}pbjsBase.setNetworks=()=>{fsxs2s=new Fsxs2s,networkBidWonEvents(),freestar.fsdata.networks.forEach((e=>{removeEmptyParamsFromNetwork(e),bidAdjustmentCreator(e)}));freestar.fsdata.placements.filter((e=>e.networks.length)).forEach((function(e){e.networks.forEach((e=>{removeEmptyParamsFromNetwork(e),bidAdjustmentCreator(e)}))}))},pbjsBase.getBidderSettings=()=>{const e=getPrebidAdserverTargetingKeys({freestar:freestar});payload.standard={alwaysUseBid:!1,adserverTargeting:[{key:e.bidder,val:function(e){return unaliasBidder(e.bidderCode)}},{key:e.adid,val:function(e){return e.adId}},{key:e.pb,val:function(e){return"medium"===freestar.fsdata.priceGranularity?e.pbMg:"high"===freestar.fsdata.priceGranularity?e.pbHg:"auto"===freestar.fsdata.priceGranularity?e.pbAg:"dense"===freestar.fsdata.priceGranularity?e.pbDg:e.adUnitCode&&e.cpm&&e.cpm>2&&freestar.gamMap[e.adUnitCode]&&!0===freestar.gamMap[e.adUnitCode]?hbpbRounder({cpm:e.cpm}):e.pbCg}},{key:e.size,val:function(e){return e.size}},{key:e.format,val:function(e){return e.mediaType}},{key:"custom_bidder_size",val:function(e){return[unaliasBidder(e.bidder),e.size].join("_")}},{key:"freestar_domain",val:function(){return freestar.fsdata.domain||location.domain}},{key:"freestar_path",val:function(){return location.pathname}},{key:e.auction_id,val:function(e){return`${e.auctionId}`}},{key:e.source,val:function(e){return e.source}}]},(freestar.fsDfpId||freestar.fsDevDfpId||freestar.fsdata.useFsAdserverTargetingKeys)&&payload.standard.adserverTargeting.push({key:"fspbg",val:"fs_universal"}),payload.concert&&(payload.concert.storageAllowed=!0),payload.criteo&&(payload.criteo.storageAllowed=!0),payload.taboola&&(payload.taboola.storageAllowed=!0)},pbjsBase.setBidderSettings=()=>{fsprebid.bidderSettings=payload};const setPriceGranularity=()=>{if(window.freestar.fsdata.priceGranularity){if(!(window.freestar.fsdata.priceGranularity.length>6))return window.freestar.fsdata.priceGranularity;try{return JSON.parse(freestar.fsdata.priceGranularity)}catch(e){window.freestar.log(10,`Error parsing priceGranularity  ${e}`)}}return{buckets:window.freestar.fsDfpId||window.freestar.fsDevDfpId||window.freestar.fsdata.useFsAdserverTargetingKeys?PRICE_GRANULARITY_BUCKETS.v2:PRICE_GRANULARITY_BUCKETS.v1}};function getTargetingControlsValue(e){let{enableSendAllBids:t,useTargetingKeys:i}=e;const n={};return i&&(n.allowTargetingKeys=["key1"]),t||(n.alwaysIncludeDeals=!0),n}pbjsBase.setEventListeners=()=>{bidAdjustmentResponseLog(),fsprebid.onEvent(PREBID_AUCTION_INIT,(function(e){freestar.performanceLogger.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigPrebidAuctionInit}),e.adUnitCodes.forEach((e=>{freestar.bidsWon[e]&&delete freestar.bidsWon[e]}))})),fsprebid.onEvent(PREBID_BID_RESPONSE,(function(e){const t=freestar.adjustments.bids.find((t=>t.requestId===e.requestId));e.rawCpm=t?.cpm??e.cpm}));const e=[TOKEN.ANALYTICS,TOKEN.BID_WON_ANALYTICS_EVENT_FACTORY];if(freestar.allowBidResponseCollection&&e.push(TOKEN.BID_RESPONSE_ANALYTICS_EVENT_FACTORY),Promise.all(e.map((e=>AppContainer.instance.resolve(e)))).then((e=>{let[t,i,n]=e;fsprebid.onEvent(PREBID_BID_RESPONSE,(e=>{e.adUnitCode&&setRefreshRate({bidder:unaliasBidder(e.bidderCode),adUnitCode:e.adUnitCode}),refreshAds(e),n&&t.track(n.create(e))})),fsprebid.onEvent(PREBID_BID_WON,(e=>{e.adUnitCode&&setRefreshRate({bidder:unaliasBidder(e.bidderCode),adUnitCode:e.adUnitCode});const n=refreshAds(e);e.bidderRefresh=n,t.track(i.create(e))}))})),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{fsprebid.onEvent(PREBID_BID_TIMEOUT,(t=>{setTimeout((()=>{t.forEach((t=>{e.track(new BidTimeoutAnalyticsEvent(t))}))}),50)}))})),freestar.allowBidRequestedCollection){const e=[TOKEN.ANALYTICS,TOKEN.BID_REQUESTED_ANALYTICS_EVENT_FACTORY];Promise.all(e.map((e=>AppContainer.instance.resolve(e)))).then((e=>{let[t,i]=e;fsprebid.onEvent(PREBID_BID_REQUESTED,(e=>{t.track(i.create(e))}))}))}},pbjsBase.setSChain=()=>{const{companyId:e="",schain:t}=window.freestar.fsdata,i=generateSchain(e,t?.type,t?.bidderOverrides);i&&window.fsprebid.setBidderConfig({bidders:getSChainBidders(fsxs2s),config:{schain:{validation:"strict",config:i}}})},pbjsBase.settingConfig=(e,t,i)=>{const n=setPriceGranularity(),s=freestar.fsdata.useFsAdserverTargetingKeys||getUrlParameter("use-fs-adserver-targeting-keys"),r=window.freestar.deviceInfo&&window.freestar.deviceInfo.device.type||"",a=!!window.freestar?.fsdata?.enableSendAllBidsToAdServer,o={performanceMetrics:!1,targetingControls:getTargetingControlsValue({enableSendAllBids:a,useTargetingKeys:s}),ortb2:new Ortb2(r),rubicon:{singleRequest:!0},bidderTimeout:window.freestar.fsdata.timeout||1500,userSync:{auctionDelay:100,enableOverride:!1,filterSettings:{all:{bidders:"*",filter:"include"}},userIds:[],syncDelay:100,syncEnabled:!0,syncsPerBidder:8,topics:TOPICS_MODULE_CONFIG},enableTIDs:!0,enableSendAllBids:a,priceGranularity:n,bidderSequence:"random",publisherDomain:`${window.location.protocol}//${window.location.host}`,useBidCache:!0,gptPreAuction:{enabled:!0,customPbAdSlot:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:`/${FS_DFP_ID}`,{appendDivIdToGpid:i=!0}=freestar.fsdata,n=t;return i&&(n+="/"+e),freestar.log({title:"GPID"},"Payload is:",n),n},mcmEnabled:!0},firstPartyData:{skipEnrichments:!0},cache:{url:"https://prebid.adnxs.com/pbc/v1/cache",ignoreBidderCacheKey:!0}};if(o.userSync.userIds=i.prebidNonRealTimeProvidersConfig,!t.getBypassFirstAuction()){t.getS2sBidders(fsxs2s).forEach((e=>{s2sNetworks.includes(e)||s2sNetworks.push(e)})),s2sNetworks.length&&(window.freestar.log(49,"Setting s2sconfig..."),o.s2sConfig={accountId:"d0cd3243-716f-4f9c-b074-f72637de26f3",enabled:!0,bidders:s2sNetworks,timeout:window.freestar.fsdata.timeout,adapter:"prebidServer",endpoint:"https://s2s.t13.io/openrtb2/auction",syncEndpoint:"https://s2s.t13.io/cookie_sync",cookieSet:!1,cookiesetUrl:"",allowUnknownBidderCodes:!0})}o.realTimeData={auctionDelay:50,dataProviders:i.realtimeProviders.prebidRealTimeDataProviders},i.realtimeProviders.prebidAnalyticProviders.forEach((t=>{e.enableAnalytics(t)})),isGDPRCountry(window.freestar.locData)&&(o.consentManagement=o.consentManagement||{},o.consentManagement.gdpr={cmpApi:"iab",timeout:1200,allowAuctionWithoutConsent:!1}),isUspApplicable(window.freestar.locData)&&(o.consentManagement=o.consentManagement||{},o.consentManagement.usp={timeout:1200}),e.setConfig(o)},pbjsBase.analytics=e=>{e.enableAnalytics([{provider:"freestar",options:{}}])},pbjsBase.enableTIDs=()=>{window.fsprebid.setConfig({enableTIDs:!0})},pbjsBase.updateTimeouts=e=>{let{bidderTimeout:t,s2sTimeout:i}=e;const n={bidderTimeout:t};s2sNetworks.length&&(n.s2sConfig={timeout:i||.75*t}),window.fsprebid.setConfig(n),window.freestar.fsdata.timeout=t};const SUBSEQUENT_BIDDER_TIMEOUT=3e3,OPTIONS={root:null,threshold:.5};let observer=new class{observe(){return null}unobserve(){return null}disconnect(){return null}};const IN_ADVANCE_BID_REFRESH_TIME=.75;"IntersectionObserver"in window&&(observer=new IntersectionObserver((function(e){e.forEach((e=>{if(freestar.refreshLibrary[e.target.id]){const t=e.isIntersecting?e.intersectionRatio:0;freestar.refreshLibrary[e.target.id].intersectionRatio=t}}))}),OPTIONS));let REFRESHERS=[],isTimeoutUpdated=!1;class AdRefresher{constructor(e){freestar.log(25,"REFRESH V2 Enabled"),this.slots=e||getSlots(),this.observers={},this.time={},this.time.default=window.freestar.fsdata.adRefreshRate||0,this.bidTimeout=window.freestar.fsdata.timeout,this.url=window.location.href,this.renderBidMidwayManager=renderBidMidwayManager,this._bindGamEvents(),this.onLoad(e),window.freestar.virtualKeyboardRefreshControl||!window.freestar.fsdata.pauseRefreshOnVirtualKeyboard||window.freestar?.deviceInfo?.device?.type!==DEVICE_TYPE_MOBILE&&window.freestar?.deviceInfo?.device?.type!==DEVICE_TYPE_TABLET||(window.freestar.virtualKeyboardRefreshControl=new VirtualKeyboardRefreshControl,window.freestar.virtualKeyboardRefreshControl.init())}static isTimerSet=!1;_bindGamEvents(){googletag.cmd.push((function(){window.googletag.pubads().addEventListener(GAM_SLOT_REQUESTED,AdRefresher._handleSlotRequested)}))}static _handleSlotRequested(e){const{slot:t}=e;clearExistingAd(t.getSlotElementId())}onLoad(e){this.init(e),AdRefresher.isTimerSet||(window.setInterval((()=>{for(const e in this.observers)freestar.refreshLibrary[e]||(this.observers[e]=!1);let e=!1;if(this.url===window.location.href&&this.placementsChangedViaUrl===freestar.refreshLibrary.length||(e=!0,this.placementsChangedViaUrl=freestar.refreshLibrary.length,this.url=window.location.href),!document.hidden)for(const t in freestar.refreshLibrary){const i=document.getElementById(t);i&&i.id&&(this.counter(i.id),this.observers[t]&&!e||(this.observers[t]=!0,observer.unobserve(i),observer.observe(i)),AdRefresher.checkIsItTimeToPrefetchBids(i.id)&&!freestar.refreshLibrary[t].hasPrefetchCalled&&(AdRefresher.prepareToRefresh(i.id),freestar.refreshLibrary[t].hasPrefetchCalled=!0),AdRefresher.checkIsItTimeToRefresh(i.id)&&(AdRefresher.refresh(i.id),freestar.refreshLibrary[t].hasPrefetchCalled=!1))}}),1e3),AdRefresher.isTimerSet=!0)}init(e){freestar.refreshLibraryCreator=AdRefresher.refreshLibraryCreator;for(let t=0;t<this.slots.length;t++){const i=this.slots[t]?this.slots[t].getSlotElementId():void 0;if(AdRefresher.refreshLibraryCreator(i),e&&e.length>0&&this.slots[t]){const e=getPlacementByName({name:dynamicGet({slotId:i})});this.observers[i]||e.outOfPage||(observer.observe(document.getElementById(i)),this.observers[i]=!0),AdRefresher.refresh(i,document.getElementById(i))}}}static refreshLibraryCreator(e,t){e&&(Array.isArray(e)||(e=[e]),e=(e=e.filter((e=>-1===e.indexOf("_fs-sf")))).filter((e=>document.getElementById(e))),t=t||void 0,e.forEach((e=>{window.freestar.refreshLibrary[e]||(window.freestar.refreshLibrary[e]={});const i=getPlacementByName({name:dynamicGet({slotId:e})});if(!i)return void freestar.log(20,"refreshLibraryCreator","Cannot find placement for ad slot",e);const n=window.freestar.refreshLibrary[e];if(n.pauseRefresh&&isBoolean(n.pauseRefresh)||(n.pauseRefresh=!1),n.viewabilityThresholdMet=!1,n.refreshTime&&isNumber(n.refreshTime)||(n.refreshTime=Number(getRefreshRate(e))),n.isCounterStopped&&isNumber(n.isCounterStopped)||(n.isCounterStopped=!1),n.refreshCounter&&isNumber(n.refreshCounter)||(n.refreshCounter=t||0),n.viewPercentage&&isNumber(n.viewPercentage)||(n.viewPercentage=100),!n.disableRefresh||!isBoolean(n.disableRefresh)){n.disableRefresh=!1;const t=document.getElementById(e);(t&&-1===Number(t.getAttribute("data-refresh-time"))||!0===i.outOfPage)&&(n.disableRefresh=!0)}n.intersectionRatio&&isNumber(n.intersectionRatio)||(n.intersectionRatio=0),n.timesRefreshed&&isNumber(n.timesRefreshed)||(n.timesRefreshed=0),i.interstitialOptions&&!0===i.interstitialOptions.active&&(n.disableRefresh=!0),n.refreshUserIds||(n.refreshUserIds=new RefreshUserIDs),isNil(n.hasPrefetchCalled)&&(n.hasPrefetchCalled=!1)})),window.freestar.globalRefreshUserIDsState=new GlobalRefreshUserIDsState)}static getRefreshTime(e,t){let i=e.refreshTime;return(void 0===i||isNaN(i)||null===i)&&(i=getRefreshRate(t),freestar.log(25," ","freestar.fsdata.adRefreshRate",i)),i}static getRefreshCounter(e){let t=e.refreshCounter;return(void 0===t||isNaN(t))&&(t=0),t}static getGlobalRefreshCount(){return Object.values(window.freestar?.refreshLibrary||{}).reduce((function(e){let{timesRefreshed:t=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e+t}),0)}static isRefreshCapReached(e){const{slotsCombinedRefreshCap:t}=window?.freestar?.fsdata||{};if(!t)return!1;if(window.freestar.isRefreshCapReached)return e.disableRefresh=!0,!0;return AdRefresher.getGlobalRefreshCount()>=t&&(window.freestar.isRefreshCapReached=!0,e.disableRefresh=!0,!0)}static checkIsItTimeToRefresh(e){const t=freestar.refreshLibrary[e];if(!t||t.pauseRefresh||AdRefresher.isRefreshCapReached(t))return!1;const i=AdRefresher.getRefreshCounter(t),n=AdRefresher.getRefreshTime(t,e),s=AdRefresher.getViewabilityThresholdMet(e);return!(n<=0||i<0)&&(i>=n&&s)}static checkIsItTimeToPrefetchBids(e){const t=freestar.refreshLibrary[e];if(!t||t.pauseRefresh||AdRefresher.isRefreshCapReached(t))return!1;const i=AdRefresher.getRefreshCounter(t),n=AdRefresher.getRefreshTime(t,e),s=AdRefresher.getViewabilityThresholdMet(e);return!(n<=0||i<0)&&(s&&i>=n*IN_ADVANCE_BID_REFRESH_TIME&&i<=.85*n)}static getViewabilityThresholdMet(e){return(freestar.refreshLibrary[e]?.intersectionRatio||0)>.49}static addRefresher(e){e instanceof Refresher&&REFRESHERS.push(e)}static removeRefresher(e){e instanceof Refresher&&(REFRESHERS=REFRESHERS.filter((t=>t!==e)))}counter(e){const t=freestar.refreshLibrary[e],i=getPlacementByName({name:dynamicGet({slotId:e})});if(i&&i.lazyAd&&i.selectedSize?.lazyLoadViewportHeight>0&&!t.hasIntersectLazyAd)return void(t.refreshCounter=0);if(t.disableRefresh||t.isCounterStopped)return;const n=AdRefresher.getRefreshTime(t,e),s=AdRefresher.getRefreshCounter(t);if(!(n<=0||s<0||(freestar.log({title:REFRESH_LOG_TITLE},e,t.refreshCounter),s>=n))){if(isNaN(t.refreshCounter)?t.refreshCounter=1:t.refreshCounter+=1,s>=.5*n&&s<.75*n&&AdRefresher.getViewabilityThresholdMet(e)){if(t.checkingForBid)return;t.checkingForBid||(t.checkingForBid=!0),this.renderBidMidwayManager.renderAd({elementId:e})}if(s>.85*n&&t.checkingForBid&&(t.checkingForBid=!1),s>=.8*n&&i&&!floorsHardOffPlacement({siteId:freestar.fsdata.siteId,placement:i})){const t=(getTimesRefreshed(e)||0)+1;floorsManager().prefetchFloorsData({placement:i,slotId:e,timesRefreshed:t})}t?.refreshUserIds&&t.refreshUserIds.check(t,window.freestar.globalRefreshUserIDsState)}}static async prepareToRefresh(e){const t=document.getElementById(e),i=freestar.refreshLibrary[e];if(!i||!t)return;i.isCounterStopped=!0;const n=getPlacementByName({name:dynamicGet({slotId:e})});if(n?.lazyAd&&!i.hasIntersectLazyAd&&n.selectedSize?.lazyLoadViewportHeight>0||i.disableRefresh||i.pauseRefresh||AdRefresher.isRefreshCapReached(i))return;const s=getSlot({elementId:e});s&&s.setTargeting("fs_uuid",generateUUID()),n&&!floorsHardOffPlacement({siteId:freestar.fsdata.siteId,placement:n})&&(freestar.refreshLibrary[e].timesRefreshed+=1,await floorsManager().getFloorsData({placement:n,slotId:e,callback:t=>{let{result:i}=t;freestar.refreshLibrary[e].timesRefreshed-=1,i&&s&&(Object.keys(i).forEach((e=>{s.setTargeting(e,i[e])})),freestar.log({title:"FLOORS"},e,"Refreshed floors value.",i))}})),idealAdStackManager().refreshData(),i.isCounterStopped=!1;for(const t of REFRESHERS)if(t.shouldRefresh({elementId:e,placement:n,refreshAttributes:i})){t.prepareToRefresh({elementId:e,placement:n,refreshAttributes:i}),freestar.log({title:REFRESH_LOG_TITLE},"Making ahead of time bid",e);break}}static async refresh(e){const t=document.getElementById(e),i=freestar.refreshLibrary[e];if(!i||!t)return;const n=getPlacementByName({name:dynamicGet({slotId:e})});if(!(n?.lazyAd&&!i.hasIntersectLazyAd&&n.selectedSize?.lazyLoadViewportHeight>0||i.disableRefresh||i.pauseRefresh||AdRefresher.isRefreshCapReached(i))){i.refreshCounter=1;for(const t of REFRESHERS)if(t.shouldRefresh({elementId:e,placement:n,refreshAttributes:i})){t.refresh({elementId:e,placement:n,refreshAttributes:i});break}1!==i?.timesRefreshed||isTimeoutUpdated||(pbjsBase.updateTimeouts({bidderTimeout:SUBSEQUENT_BIDDER_TIMEOUT}),isTimeoutUpdated=!0)}}static refreshSlots(){let{slotIds:e,sendAdserverSignal:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{slotIds:null};(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&console.warn("freestar.freestarReloadAdSlot() has been deprecated and will be removed in the future use freestar.refreshAllSlots()"),freestar.log(1,`${e?"freestar.refresh":"freestar.refreshAllSlots"}${e?" : "+e:null}`),refreshRebidControls(e),window.fsprebid.que.push((function(){const i=[],n=getSlots().filter((e=>-1===e.getSlotElementId().indexOf("_fs-sf"))).map((function(n){if(n){let s=n.getSlotElementId();if(null===document.getElementById(s))return null;if(freestar.refreshLibrary[s]||AdRefresher.refreshLibraryCreator(s),freestar.refreshLibrary[s].dataRefreshId=generateUUID(),freestar.refreshSlots.push({refreshId:freestar.refreshLibrary[s].dataRefreshId}),!e||e.indexOf(s)>-1)return t||(freestar.refreshLibrary[s].refreshCounter=1),freestar.refreshLibrary[s].timesRefreshed+=1,freestar.refreshLibrary[s]?.refreshUserIds&&freestar.refreshLibrary[s].refreshUserIds.reset(),i.push(s),n.setTargeting("fsrefresh",`${freestar.refreshLibrary[s].timesRefreshed??0}`),n}})).filter((e=>void 0!==e));e&&!i.length||fsRequestBids({elementIds:i,slots:n,sendAdserverSignal:t})}))}static refreshAllSlots(){getSlots().forEach((e=>{if(e){const t=e.getSlotElementId();AdRefresher.refresh(t)}}))}static refreshAllActiveSlots(){getSlots().forEach((function(e){const t=e.getSlotElementId();document.getElementById(t)&&AdRefresher.getViewabilityThresholdMet(t)&&AdRefresher.refresh(t)}))}}function getTimesRefreshed(e){const t=freestar.refreshLibrary[e];if(t)return t.timesRefreshed}function refreshLibraryCreatorVersionCheck(e){const{isRefreshAllowed:t}=idealAdStackManager().determineAdRefreshBehavior();t?AdRefresher.refreshLibraryCreator(e):freestar.log({title:REFRESH_LOG_TITLE},"Ad refresh is disabled for this geo.")}function setupAdRefresherVersionCheck(e){const{isRefreshAllowed:t}=idealAdStackManager().determineAdRefreshBehavior();t?freestar.AdRefresher=new AdRefresher(e):freestar.log({title:REFRESH_LOG_TITLE},"Ad refresh is disabled for this geo.")}AdRefresher.addRefresher(new StickyFooterRefresher),AdRefresher.addRefresher(new SuperflexRefresher),AdRefresher.addRefresher(new DefaultRefresher);let ct=0;const requestQueInitiate=e=>{if(ct++,ct<5&&!window.fsprebid||!window.fsprebid.addAdUnits||!window.googletag||!window.googletag.pubads||!window.googletag.pubads().getSlots)return void setTimeout((function(){freestar.log(1,"RequestQue: There is an error with googletag or prebid loading in requestQueInitiate. Making another attempt."),requestQueInitiate()}),300);if(freestar.requests.que.length<1)return void freestar.log(1,"RequestQue: nothing left in queue returning");let t=freestar.requests.que,i=[],n=[];freestar.log(1,"request que objects",t);addAdUnits({adUnits:t.filter((e=>0!==e.sizes.length)).filter((function(e){i.push(e.code);const t=getSlot({elementId:e.code});if(t&&n.push(t),!fsprebid.adUnits.filter((t=>t.code===e.code))[0])return e}))}),refreshLibraryCreatorVersionCheck(i),freestar.fsRequestBids({elementIds:i,slots:n,timeout:freestar.fsdata.timeout,sendAdserverSignal:e}),freestar.requests.que=[]},observers={},setLazyAdObserver=e=>{let{element:t,placement:i}=e;dynamicSet({placementName:i.name,slotId:t.id});const{lazyLoadViewportHeight:n}=i.selectedSize;let s=observers[n];s||(s=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(isValidIntersection(e)){const i=dynamicGet({slotId:e.target.id});if(i){freestar.newAdSlots([{placementName:i,slotId:e.target.id,source:"lazyAd"}]);const n=freestar.refreshLibrary?.[e.target.id];isObject(n)&&(n.hasIntersectLazyAd=!0),t.unobserve(e.target)}}}))}),{root:null,rootMargin:`${n}% 0px ${n}% 0px`})),s.observe(t)},PRODUCT_MAPPING={videoAdhesion:{prettyName:"Sticky Footer Video Adhesion",disabled:!1},stickyFooter:{prettyName:"Sticky Footer",disabled:!1,refreshDisabled:!1,refreshInterval:0},video:{prettyName:"Video",disabled:!1,refreshDisabled:!1,refreshInterval:0},standAloneVideo:{prettyName:"Stand Alone Video",disabled:!1,refreshDisabled:!1,refreshInterval:0},revolvingRail:{prettyName:"Revolving Rail",disabled:!1,refreshDisabled:!1,refreshInterval:0},pushdown:{prettyName:"Pushdown",disabled:!1,refreshDisabled:!1,refreshInterval:0},dynamicAds:{prettyName:"Dynamic Ads",disabled:!1,refreshDisabled:!1,refreshInterval:0,optionsPath:"dynamicAdOptions"},dynamicAdsV2:{prettyName:"Dynamic Ads V2",disabled:!1,refreshDisabled:!1,refreshInterval:0,optionsPath:"dynamicAdOptionsV2"},footerBidding:{prettyName:"Footer Bidding",disabled:!1,refreshDisabled:!1,refreshInterval:0},superflex:{prettyName:"Superflex",disabled:!1,refreshDisabled:!1,refreshInterval:0},slidingUnit:{prettyName:"Sliding Unit",disabled:!1,refreshDisabled:!1,refreshInterval:0},sideWall:{prettyName:"Sidewall",disabled:!1,refreshDisabled:!1,refreshInterval:0},pageGrabber:{prettyName:"Page Grabber",disabled:!1,refreshDisabled:!1,refreshInterval:0},interstitial:{prettyName:"Interstitial",disabled:!1,refreshDisabled:!1,refreshInterval:0},googleInterstitial:{prettyName:"Google Interstitial",disabled:!1,refreshDisabled:!1,refreshInterval:0},dianomiContentRec:{prettyName:"Dianomi Content Recommendation",disabled:!1,refreshDisabled:!1,refreshInterval:0},lazyLoad:{prettyName:"Lazy Loaded Ads",disabled:!1,refreshDisabled:!1,refreshInterval:0},iai:{prettyName:"Intelligent Ad Insert",disabled:!1,refreshDisabled:!1,refreshInterval:0},stickyRail:{prettyName:"Sticky Rail",disabled:!1,refreshDisabled:!1,refreshInterval:0}},productIsDisabled=function(e){let{name:t}=e;return!(!window.freestar.config.products[t]||!window.freestar.config.products[t].disabled)&&(window.freestar.log(1,`${PRODUCT_MAPPING[t].prettyName} Disabled via freestar.config.products.${t}.disabled`),!0)};function getIdealAdInsertionElementOptions(e){const t=e.selectedSize?.elementTargetedConfig;return t&&t.active?{...t,source:"viewport"}:{active:!1}}const PRODUCT_SLUG="carousel",LOG_TITLE$2="CAROUSEL V1.6.0",LOG_INFO$5={title:LOG_TITLE$2,styles:"background: black; color: white; border-radius: 3px; padding: 3px"},BLOCKED_BIDDERS=["teads","yahoossp"],testParams={percentage:.1,blockedSiteIDs:[1575,1910,1748,1841,6326,2410,1783,1675,1676,1677,1678,1679,1680,1681,1682,1683,1684,1685,1686,1687,1688,1689,1690,1691,1692,1693,1694,1911,1912,1913,1914,1915,1916,1917,1918,1919,1920,1921,1922,1923,1924,1925,1926,1927,1928,1929,1930,1931,1932,1933,1934,1935,1936,1937,1938,1939,1940,1941,1942,1943,1944,1945,1946,1947,1948,1949,1950,1951,1952,1953,1955,1956,1957,1958,1959,1960,1961,1962,1963,1964,1965,1966,1967,1968,1969,1970,1971,1972,1973,1974,1975,1985,2095,2132,2170,2232,2244,2511,5491,1756,2372,1556,2086,2087,2192,2193,2194,2195,2196,2197,2198,2199,2200,2201,2202,2203,2204,2205,2206,2207,2208,2209,2210,2211,2212,2213,2214,2215,2216,2217,2218,2219,2351,2352,2353,2354,2355,2356,2357,2358,2359,2360,2361,2362,2363,2364,2365,2366,2367,2394,2395,2396,2397,2398,2399,2400,2401,2402,2403,2404,2405,2426,3516,5344,3107,3108,3109,3110,3111,3234,6152,6603,1556,1495,5438,6507,6508,6497,6496,6498,6503,6500,6501,6499,6505,6502,6506,5836,258,624]},checkIfInTest=()=>{const e=JSON.parse(sessionStorageGet({key:`fs.${PRODUCT_SLUG}`}))||{};if(!testParams.blockedSiteIDs.includes(freestar.fsdata.siteId)&&void 0===e.inTest){const t=testParams.percentage;Math.random()<t?(e.inTest=!0,e.control=Math.random()<=.5):e.inTest=!1,sessionStorageSet({key:`fs.${PRODUCT_SLUG}`,value:e,type:SESSION_STORAGE_TYPES.object})}return e.inTest&&freestar.log(LOG_INFO$5,`Session is participating in test as ${e.control?"CONTROL":"TEST"}...`),getUrlParameter(`fs-use-${PRODUCT_SLUG}`)||e.inTest},isControl=()=>{const e=JSON.parse(sessionStorageGet({key:`fs.${PRODUCT_SLUG}`}))||{};return e?.inTest&&e?.control},BRANDING={NO_BRANDING:"NO_BRANDING",GREEN:"GREEN",GRAYSCALE:"GRAYSCALE",GREEN_FOOTER_ONLY:"GREEN_FOOTER_ONLY",GRAYSCALE_FOOTER_ONLY:"GRAYSCALE_FOOTER_ONLY"},LOGO_GREEN=`${CORE_BUCKET_LOCATION}/imgs/fslogo-green.svg`,LOGO_GRAYSCALE=`${CORE_BUCKET_LOCATION}/imgs/fslogo-grayscale.svg`,BRANDING_LOGO={[BRANDING.GREEN]:LOGO_GREEN,[BRANDING.GRAYSCALE]:LOGO_GRAYSCALE,[BRANDING.GREEN_FOOTER_ONLY]:LOGO_GREEN,[BRANDING.GRAYSCALE_FOOTER_ONLY]:LOGO_GRAYSCALE},getBrandingLogoUrl=e=>e&&e!==BRANDING.NO_BRANDING?BRANDING_LOGO[e]:null,INVALID_BRANDING_ERROR=`Invalid branding value. Expected one of: ${Object.values(BRANDING).join(", ")}`,MISSING_SLOT_ID_ERROR="Missing mandatory parameter: slotId";class FlyingCarpet{constructor(e){let{background:t="linear-gradient(to bottom, #00c389 10%, black 100%)",height:i="175vh",branding:n="GREEN",showPoweredBy:s=!0,slotId:r,styleVersion:a="new"}=e;if(!r)throw new Error(MISSING_SLOT_ID_ERROR);this.background=t,this.height=i,this.branding=n,this.showPoweredBy=s,this.slotId=r,this.styleVersion=a,this.flyingCarpetElement=null,this._bindEvents()}_bindEvents(){AppContainer.instance.resolve(TOKEN.GAM_MANAGER).then((async e=>{await e.ready,e.instance.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(e=>{let{isEmpty:t,slot:i}=e;i.getSlotElementId()===this.slotId&&this.flyingCarpetElement&&(t?this._elementToggle(!1):this._elementToggle(!0))}))})),AppContainer.instance.resolve(TOKEN.EVENT_BUS).then((e=>{e.subscribe(NATIVE_RENDER_ENDED,(e=>{let{payload:{elementId:t}}=e;t===this.slotId&&this.flyingCarpetElement&&this._elementToggle(!0)}))}))}_elementToggle=(()=>{var e=this;return function(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(e.flyingCarpetElement)if(t){const t="new"===e.styleVersion?"flex":"block";e.flyingCarpetElement.style.setProperty("display",t),e.flyingCarpetElement.style.setProperty("visibility","visible")}else e.flyingCarpetElement.style.setProperty("visibility","hidden")}})();_createLogo(){return createElement({type:"img",attributes:{src:getBrandingLogoUrl(this.branding),alt:"fs-logo",width:30}})}generateHTML(){return this.flyingCarpetElement="new"===this.styleVersion?this._generateStyleV2HTML():this._generateOriginalStyleHTML(),this.flyingCarpetElement}_generateOriginalStyleHTML(){if(![BRANDING.GREEN,BRANDING.GRAYSCALE,BRANDING.NO_BRANDING].includes(this.branding))throw new Error(INVALID_BRANDING_ERROR);const e=createElement({classList:["fs-flying-carpet"],style:{background:this.background,height:this.height}}),t=createElement({classList:["fs-flying-carpet-ad-container"]});if(e.appendChild(t),this.showPoweredBy&&this.branding!==BRANDING.NO_BRANDING){const t=createElement({classList:["fs-powered-by"]});t.appendChild(this._createLogo()),e.appendChild(t)}const i=createElement({classList:["fs-flying-carpet-header"]});i.textContent="Advertisement",e.appendChild(i);const n=createElement({id:this.slotId});return t.appendChild(n),e}_generateStyleV2HTML(){const e=createElement({classList:["fs-flying-carpet-v2"]}),t=createElement({classList:["fs-flying-carpet-v2-text-border"]});t.textContent="ADVERTISEMENT",e.appendChild(t);const i=createElement({classList:["fs-flying-carpet-v2-ad-container"]});e.appendChild(i);const n=createElement({id:this.slotId});i.appendChild(n);const s=createElement({classList:["fs-flying-carpet-v2-text-border"]});return s.textContent="SCROLL TO CONTINUE READING",e.appendChild(s),e}}const LOG_INFO$4={level:20,title:"UserScrollTracker"};class UserScrollTracker{constructor(){if(UserScrollTracker.instance)return UserScrollTracker.instance;this.interactionsMsgCount=0,this.interactionsLastPercentile=0,this.interactionsMaxPercentile=0,this.scrollHeight=this._getScrollHeight(),this._initScrollListener(),this._initMutationObserver(),UserScrollTracker.instance=this,freestar.log(LOG_INFO$4,"initialized")}_initScrollListener(){window.addEventListener("scroll",this._handleScrollData)}_handleScrollData=(()=>debounce((()=>{this.scrollHeight=this._getScrollHeight();const e=window.scrollY/(this.scrollHeight-window.innerHeight)*100;this.interactionsLastPercentile=e,this.interactionsMaxPercentile=Math.max(this.interactionsMaxPercentile,e),this.interactionsMsgCount+=1,freestar.log(LOG_INFO$4,`Updated - Last: ${this.interactionsLastPercentile.toFixed(2)}%, Max: ${this.interactionsMaxPercentile.toFixed(2)}%, Height: ${this.scrollHeight}px, MsgCount: ${this.interactionsMsgCount}`)}),250))();_getScrollHeight(){return document.documentElement.scrollHeight}_initMutationObserver(){new MutationObserver((()=>{this.scrollHeight=this._getScrollHeight()})).observe(document.body,{childList:!0,subtree:!0})}getLastPercentile(){return this.interactionsLastPercentile}getMaxPercentile(){return this.interactionsMaxPercentile}getScrollHeight(){return this.scrollHeight}getMsgCount(){return this.interactionsMsgCount}}class PageviewTerminationService{constructor(e){if(PageviewTerminationService.instance)return PageviewTerminationService.instance;this._onTerminateCallback=e,this._handleTerminationCalled=!1,this._throttlePeriod=2e3,this._initTerminationListeners(),PageviewTerminationService.instance=this}_initTerminationListeners(){window.addEventListener("beforeunload",this._handleTermination),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&this._handleTermination()}))}_handleTermination=()=>{this._handleTerminationCalled||(this._handleTerminationCalled=!0,this._onTerminateCallback&&this._onTerminateCallback(),setTimeout((()=>{this._handleTerminationCalled=!1}),this._throttlePeriod))}}const HIGH_IMPACT_TYPE_MAP={flyingCarpet:"FLYING_CARPET"};function getHighImpactTypeMessageString(e){return HIGH_IMPACT_TYPE_MAP[e]||Object.values(HIGH_IMPACT_TYPE_MAP).find((t=>t===e))||"UNKNOWN"}class HighImpactTracking{constructor(e){let{percentilePlacement:t,highImpactType:i,slotId:n}=e;this.percentilePlacement=t,this.highImpactType=i,this.slotId=n,this.id=generateUUID(),this.sendInit(),this.scrollTracker=new UserScrollTracker,"flyingCarpet"===this.highImpactType&&this.initializePageviewTerminationService()}sendInit(){AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new IaiHighImpactTrackingAnalyticsEvent({sessionId:freestar.msg.sessionId,pageviewId:freestar.msg.pageId,highImpactUnitSessionId:this.id,percentilePlacement:this.percentilePlacement,sessionDepth:freestar.msg.pageviewCount,highImpactType:getHighImpactTypeMessageString(this.highImpactType)}))}))}sendRequest(e){let{auctionId:t,refreshCount:i}=e;AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new IaiHighImpactAdRequestAnalyticsEvent({sessionId:freestar.msg.sessionId,pageviewId:freestar.msg.pageId,auctionId:t,highImpactUnitSessionId:this.id,refreshCount:i}))}))}createInteractionsMessage(){const e=new IaiHighImpactInteractionsAnalyticsEvent({sessionId:freestar.msg.sessionId,pageviewId:freestar.msg.pageId,highImpactUnitSessionId:this.id,interactionsMsgCount:this.scrollTracker.getMsgCount(),interactionsLastPercentile:this.scrollTracker.getLastPercentile(),interactionsMaxPercentile:this.scrollTracker.getMaxPercentile(),scrollHeight:this.scrollTracker.getScrollHeight()});e.setTopic(TOPIC.BEACON),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((t=>{t.track(e)}))}initializePageviewTerminationService(){this.pageviewTerminationService=new PageviewTerminationService(this.createInteractionsMessage.bind(this))}}class HighImpactTrackingManager{constructor(){this.instances={},this.setupRequestMessageListener()}sendRequestMessageAuction=e=>{e.getAdUnits().forEach((t=>{this.sendRequestMessage({slotId:t.getSlotId(),auctionId:e.fsAuctionId})}))};setupRequestMessageListener(){AppContainer.instance.resolve(TOKEN.AUCTION_MANAGER).then((e=>{e.addEventListener("auctionInit",this.sendRequestMessageAuction)}))}newHighImpactTracking(e){let{percentilePlacement:t,highImpactType:i,slotId:n}=e;if(!this.instances[n])return this.instances[n]=new HighImpactTracking({percentilePlacement:t,highImpactType:i,slotId:n});freestar.log({level:1,title:"HighImpactTrackingManager"},`Already tracking a high impact ad in slot "${n}"!`)}sendRequestMessage(e){let{slotId:t,auctionId:i}=e;const n=this.instances[t];if(n){const e=getTimesRefreshed(t)||0;n.sendRequest({auctionId:i,refreshCount:e})}}}const highImpactTrackingManager=ClassInit.getInstanceFn({ClassConstructor:HighImpactTrackingManager,instanceName:"HighImpactTrackingManager"}),LOG_INFO$3={level:20,title:"IAI"};class IntelligentAdInsert{constructor(e){let{name:t,placement:i,intelligentAdInsertConfig:n,parentElement:s,debugIndex:r,lazy:a=!1}=e;this.name=t,this.placement=i,this.config=n,this.parentElement=s,this.debugIndex=r??0,this.lazy=a,this.childElements=[],this.resizeObserver=null,this.parentSize=null,this.mutationObserver=null,this.nextChildIndex=0,this.ads=[],this.adsInsertedCount=0,this.blocklistSelector=(this.config.blocklist||[]).join(", "),this.debugTimeout=null,this.insertTimeout=null,this.intersectionObserver=null,this.slotsAwaitingIntersection={},this.addedFlyingCarpet=!1,this.highImpactTracking=null,this.highImpactPlacementConfig=null,a||this.init()}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];freestar.log(LOG_INFO$3,this.debugIndex,...t)}init(){this.childElements=this.getValidChildElements(),this.monitorParentElement(),this.checkForInsertOpportunities(),this.debug()}isValidChildElement(e){return e instanceof Element&&!e.matches(".iai-label")&&!e.matches(".fs-iai")&&(!this.config.childElement||e.matches(this.config.childElement))}getValidChildElements(){const e=[];for(const t of this.parentElement.children)this.isValidChildElement(t)&&e.push(t);return e}monitorParentElement(){this.monitorParentMutation()}monitorParentResize(){if(!this.resizeObserver){const e=debounce((e=>this.onResize(e)),1e3);this.resizeObserver=new ResizeObserver((t=>{for(const i of t)e(i)})),this.resizeObserver.observe(this.parentElement,{box:"border-box"})}}biToHw(e,t){const i=e.style.writingMode??getComputedStyle(e).writingMode;return!i||i.toLowerCase().startsWith("horizontal")?{height:t.blockSize,width:t.inlineSize}:{height:t.inlineSize,width:t.blockSize}}onResize(e){const{target:t,borderBoxSize:i,contentBoxSize:n,devicePixelContentBoxSize:s}=e,r={borderBoxSize:this.biToHw(t,i[0]),contentBoxSize:this.biToHw(t,n[0]),devicePixelContentBoxSize:this.biToHw(t,s[0])};this.parentSize=r}onMutation(e){e.addedNodes.length&&e.addedNodes.forEach((e=>{this.isValidChildElement(e)&&this.childElements.push(e)}))}monitorParentMutation(){this.mutationObserver||(this.mutationObserver=new MutationObserver((e=>{for(const t of e)this.onMutation(t);this.insertAds(),this.debug()})),this.mutationObserver.observe(this.parentElement,{childList:!0}))}getNumberOfAdsWithinViewport(e){const t=e.getBoundingClientRect().bottom,{maxHeight:i}=this.getSizeMaxes(),n=t+i,s=.95*(window.innerHeight||document.documentElement.clientHeight);let r=0;for(let e=this.ads.length-1;e>=0;e--){if(!(n-this.ads[e].getBoundingClientRect().bottom<s))break;r+=1}return r}isBlocked(e){return!!this.blocklistSelector&&(e.matches(this.blocklistSelector)||e.nextElementSibling?.matches(this.blocklistSelector))}canInsertEveryNElements(e,t,i){const n=e+1;return i<Math.floor(n/t)}canInsert(e){const t=this.childElements[e];let i=!1,n=null;const{maxAdsInView:s,everyNElements:r,maxInserts:a}=this.config;return a&&this.adsInsertedCount>=a?n="maxInserts":this.canInsertEveryNElements(e,r,this.adsInsertedCount)?t.nextElementSibling?.matches(".fs-iai")?n="adAlreadyInserted":this.isBlocked(t)?n="blocklist":s&&this.getNumberOfAdsWithinViewport(t)>s-1?n="maxAdsInView":i=!0:n="everyNElements",{result:i,reason:n}}insertAds(){clearTimeout(this.insertTimeout),this.insertTimeout=setTimeout((()=>this.checkForInsertOpportunities()),1e3)}checkForInsertOpportunities(){for(;this.nextChildIndex<this.childElements.length;){let{reason:e,result:t}=this.canInsert(this.nextChildIndex);if(t)this.info("INSERTING AD @",this.nextChildIndex),this.addSlot(this.nextChildIndex);else if(this.info("NO INSERT @",this.nextChildIndex,"due to",e),"maxInserts"===e)return this.info("maxInserts reached, disconnecting MutationObserver..."),void this.mutationObserver.disconnect();this.nextChildIndex+=1}}getPercentageHeight(e,t){const i=e.getBoundingClientRect(),n=t.getBoundingClientRect(),s=(i.top-n.top+i.height)/n.height;return s<0?0:Math.min(s,.99)}createFlyingCarpetSlot(e,t){const i=this.childElements[e],n=`${this.name}_${this.debugIndex}_${this.adsInsertedCount}_fc`;t.branding="NONE";const s=new FlyingCarpet({background:t.background,height:t.height,branding:t.branding,showPoweredBy:t.showPoweredBy,slotId:n}),r=s.generateHTML();this.ads.push(r),this.parentElement.insertBefore(r,i.nextSibling);const a={placementName:this.getFlyingCarpetPlacementName(),slotId:s.slotId,skipSAU:!0};return this.makeFlyingCarpetPlacement(t),this.registerSlot({element:r,newAdSlotConfig:a}),this.adsInsertedCount+=1,{slotId:n}}static containsSize(e,t){return e.some((e=>e[0]===t[0]&&e[1]===t[1]))}static flyingCarpetAdditionalSizes=[[300,250],[300,600]];makeFlyingCarpetPlacement(e){const t=this.getFlyingCarpetPlacementName();if(freestar.fsdata.placements.some((e=>e.name===t)))return;const i=JSON.parse(JSON.stringify(this.placement));i.name=t,i.freestarBrandingDisabled="NONE"!==e.branding;for(const e of i.sizeMappings)for(const t of IntelligentAdInsert.flyingCarpetAdditionalSizes)IntelligentAdInsert.containsSize(e.size,t)||e.size.push(t);this.addTripleliftTargeting(i),freestar.fsdata.placements.push(i),buildPlacements()}addTripleliftTargeting(e){const t=e=>"triplelift"===e.slug;let i=e.networks?.find(t);if(!i){const n=freestar.fsdata.networks.find(t);n&&(i=JSON.parse(JSON.stringify(n)),e.networks.push(i))}i&&i.sizes.forEach((e=>{e.params||(e.params={}),e.params.inventoryCode="Freestar_RON_Mobile_InContent",e.serverParams&&(e.serverParams.inventoryCode="Freestar_RON_Mobile_InContent")}))}getFlyingCarpetPlacementName(){return`${this.name}_flying_carpet_sizes_placement`}buildAndInsertStandardSlot(e){const t=this.childElements[e],{element:i,newAdSlotConfig:n}=this.buildSlot();this.ads.push(i),this.parentElement.insertBefore(i,t.nextSibling),this.registerSlot({element:i,newAdSlotConfig:n})}getHighImpactPlacementConfig(){if(null==this.highImpactPlacementConfig){this.highImpactPlacementConfig={targetQuartile:[.25,.5][Math.floor(2*Math.random())],type:"flyingCarpet"};const e=getIAIQuartileParam();null==e||Number.isNaN(e)?this.info(`Randomly generated target quartile ${this.highImpactPlacementConfig.targetQuartile}`):(this.highImpactPlacementConfig.targetQuartile=e,this.info(`Targeting quartile ${e} from query parameter`))}return this.highImpactPlacementConfig}getChildPercentageHeight(e){const t=this.childElements[e];return this.getPercentageHeight(t,this.parentElement)}handleHighImpactUnit(e,t){const{flyingCarpet:i}=this.config.highImpact,{slotId:n}=this.createFlyingCarpetSlot(e,i);this.highImpactTracking=highImpactTrackingManager().newHighImpactTracking({...t,slotId:n}),this.addedFlyingCarpet=!0}shouldServeHighImpact(e){if(isFCDisabled())return{shouldServe:!1};const t=this.getHighImpactPlacementConfig();if("flyingCarpet"===t.type&&freestar?.deviceInfo?.device?.type===DEVICE_TYPE_MOBILE&&!this.addedFlyingCarpet){const i=this.config?.highImpact?.flyingCarpet;if(!i||i.active){const i=this.getChildPercentageHeight(e);return{shouldServe:i>=t.targetQuartile-.25,tracking:{percentilePlacement:Math.round(4*t.targetQuartile)+i,highImpactType:"flyingCarpet"}}}}return{shouldServe:!1}}addSlot(e){const{shouldServe:t,tracking:i}=this.shouldServeHighImpact(e);t?this.handleHighImpactUnit(e,i):this.buildAndInsertStandardSlot(e)}getSizeMaxes(){const e=this.placement.sizes.filter((e=>Array.isArray(e)));let t=0,i=0;return e.forEach((e=>{t=Math.max(t,e[0]),i=Math.max(i,e[1])})),{maxWidth:t,maxHeight:i}}buildSlot(){const e=`${this.name}_${this.debugIndex}_${this.adsInsertedCount}`,{maxWidth:t,maxHeight:i}=this.getSizeMaxes(),n=createElement({type:"div",id:e,classList:["fs-iai"],attributes:[{style:`min-height:${i}px; min-width:${t}px;`},{"data-freestar-ad":getFreestarAdValuesByPlacement({placement:this.placement})},{name:this.name}]}),s=e+"_slot",r=createElement({type:"div",id:s});return n.appendChild(r),this.adsInsertedCount+=1,{element:n,newAdSlotConfig:{placementName:this.name,slotId:s,skipSAU:!0}}}intersectionObserverCallback(e,t){e.forEach((e=>{if(e.isIntersecting){const{target:i}=e;t.unobserve(i);const n=this.slotsAwaitingIntersection[i.id];n&&(this.info("Registering new ad slot for",i.id),delete this.slotsAwaitingIntersection[i.id],freestar.newAdSlots([n]))}}))}registerSlot(e){let{element:t,newAdSlotConfig:i}=e;this.intersectionObserver||(this.intersectionObserver=new IntersectionObserver(((e,t)=>this.intersectionObserverCallback(e,t)),{rootMargin:"100%"})),this.slotsAwaitingIntersection[t.id]=i,this.intersectionObserver.observe(t),this.info("Waiting for intersection for",t.id)}debug(){freestar.debug&&(clearTimeout(this.debugTimeout),this.debugTimeout=setTimeout((()=>this._debug()),1e3))}_debug(){this.debugAddStyleNode(),this.debugNames()}getDebugStyleContent(){let e="";if(this.blocklistSelector){e=`\n            ${this.config.blocklist.map((e=>`${this.config.parentElement} > ${e}`)).join(", ")} {\n                outline: dashed red;\n            }\n            `}return`\n        ${this.config.parentElement} {\n            outline: solid blue;\n        }\n        ${this.config.parentElement} > ${this.config.childElement||"*"} {\n            outline: solid fuchsia;\n        }\n        .parent-label {\n            color: blue;\n        }\n        .child-label {\n            color: fuchsia;\n        }\n        .ad-label {\n            color: #00c389;\n        }\n        .iai-label {\n            position: absolute;\n            font: large;\n            background: silver;\n            padding: 3px;\n        }\n        .fs-iai {\n            outline: solid #00c389; /* freestar green */\n        }\n        ${e}\n        `}debugAddStyleNode(){const e=`iai-style-${this.name}`;if(!document.getElementById(e)){const t=document.createElement("style");t.id=e,t.textContent=this.getDebugStyleContent(),document.head.appendChild(t)}}debugNames(){this.debugAddLabel(this.parentElement,"parent-label",`${this.name} parent ${this.debugIndex}`),this.childElements.forEach(((e,t)=>this.debugAddLabel(e,"child-label",`child ${t}`))),this.ads.forEach(((e,t)=>this.debugAddLabel(e,"ad-label",`ad ${t}`)))}debugAddLabel(e,t,i){let n=e.querySelector(".iai-label");n||(n=document.createElement("label"),n.classList.add("iai-label"),e.insertBefore(n,e.firstChild)),n.classList.add(t),n.textContent=i}}class IntelligentAdInsertManager{constructor(){this.configs={},this.instances=[]}registerConfig(e){let{placement:t,intelligentAdInsertConfig:i}=e;const n=t.name;if(!this.configs[n]){const e={name:n,placement:t,intelligentAdInsertConfig:i};this.configs[n]=e}}initConfig(e){let{name:t}=e;if(productIsDisabled({name:"iai"}))return;if(!this.configs[t])return void freestar.log(50,`Cannot init unregistered IAI ${t}!`);const{placement:i,intelligentAdInsertConfig:n}=this.configs[t],s=n.parentElement,r=Array.from(document.querySelectorAll(s)).filter((e=>!this.instances.some((t=>t.parentElement===e))));r.forEach((e=>{const s=new IntelligentAdInsert({name:t,placement:i,intelligentAdInsertConfig:n,parentElement:e,debugIndex:this.instances.length});this.instances.push(s)}))}initDocumentWatcher(){}}function getIntelligentAdInsertConfig(e){let{placement:t}=e;return t?.selectedSize?.intelligentAdInsertConfig}const intelligentAdInsertManager=ClassInit.getInstanceFn({ClassConstructor:IntelligentAdInsertManager,instanceName:"intelligentAdInsertManager"});function _buildTargeting(e,t){let i={};return window.freestar.config.targeting&&Array.isArray(window.freestar.config.targeting)&&(i=window.freestar.config.targeting.find((function(e){return Object.keys(e).includes(t)}))),i&&(e={...e,...i[t]}),e}function slotTargeting(e,t){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const n=_buildTargeting(i,t);if(n)for(const t in n)e.setTargeting(t,n[t])}catch(e){freestar.log(49,"ERROR:","slotTargeting",...arguments),freestar.log(49,"ERROR:","slotTargeting",e)}}function deleteAdSlots$1(e){return freestar.googletagCorrelatorUpdate=!0,freestar.log(25,"deleteAdSlots invoked and the following ID(s) will be destroyed",e),fsprebid.libLoaded&&(googletag||googletag.destroySlots)?void 0===e?(googletag.cmd.push((function(){googletag.destroySlots()})),void(freestar.refreshLibrary={})):(Array.isArray(e)||(e=[e]),void removeAdUnits({list:e})):(freestar.log(10,"destroyAdSlots","Objects not ready, returning..."),freestar.queue.timers=freestar.queue.timers||{},clearTimeout(freestar.queue.timers[e]),void(freestar.queue.timers[e]=setTimeout(deleteAdSlots$1,100,...arguments)))}const removeAdUnits=e=>{let{list:t}=e;t=t.map((e=>adUnitManager.getAdUnitBySlotElementId(e)));let i=[];for(let e of t){const{placement:t}=e;if(t&&t.sizeMappings&&t.sizeMappings.some((e=>e.superflex))){const e=[...document.querySelectorAll(`[name="${t.name}"]`)];i=i.concat(e.flatMap((e=>e.id.includes("fs-sf")&&adUnitManager.getAdUnitBySlotElementId(e.id)||[])))}}t=t.concat(i),t.forEach((e=>{e&&destroySlot({elementId:e.slot.getSlotElementId()})}))};function getElement$1(e,t){let i=document.getElementById(e);i?t(null,i):setTimeout((function(){i=document.getElementById(e),i?t(null,i):t(!0)}),500)}function biddingQueueSet(e){let{placement:t,element:i,newElement:n}=e;const s=format_pbjs(t);s&&(s.code=i.id,"lazyAd"===n.source?freestar.requests.que.push(s):t.selectedSize&&t.selectedSize.lazyLoadViewportHeight>0?setLazyAdObserver({element:i,placement:t}):freestar.requests.que.push(s))}function createAdSlot(e){let{placement:t,slotId:i,targeting:n={},placementName:s=null,newElement:r,element:a=null}=e;function o(e,a){if(a&&s&&(a.setAttribute("name",s),window.freestar.newAdSlotIds.push(i),t=getPlacementByName({name:s}),t)){window.freestar.dynamicSlots.push(i);const e=(e,t)=>e[0]+e[1]<t[0]+t[1]?1:t[0]+t[1]<e[0]+e[1]?-1:0;let o=[];if(t.selectedSize&&!0===t.selectedSize.mediaTypes.includes("video")?o=t.selectedSize.size.sort(e).filter((e=>35843!==e[0]))[0]:t.sizeMappings.some((t=>{if(!0===t.mediaTypes.includes("video")&&fsBrowserWidth()>=t.viewport.size[0])return o=t.size.sort(e).filter((e=>35843!==e[0])),!0})),o.length>0){const e=o[0]>=500?[[640,360],[552,334]]:[[400,225],[300,169]];a.setAttribute("data-freestar-ad",a.getAttribute("data-freestar-ad")+` __${e[0][0]}x${e[0][1]}`)}window.googletag.cmd.push((function(){if(t.sizes&&t.sizes.length||t.fluidAd){let e=getSlot({elementId:i}),o=freestar.config.channel,d=freestar.config.channel,l=t.dfpId;if(t.dfpId.indexOf("{{channel}}")>-1?o="{{channel}}":t.dfpId.indexOf(freestar.config.channel)>-1?o=freestar.config.channel:t.dfpId.indexOf(freestar.config.orignalChannel)>-1&&(o=freestar.config.orignalChannel),d&&(r.path||o)&&(l=t.dfpId.replace(d,r.path||o),e&&window.googletag.destroySlots&&(e=void 0)),e||(e=createGAMSlot({placement:t,slotConfig:{targeting:n},sizes:t.sizes,id:a.id,specialDfpId:l})),e){n={...n,fs_ad_product:getSlotProduct(t),fsrefresh:n?.fsrefresh??"0",fsrebid:n?.fsrebid??"0"};slotTargeting(e,i,s,(()=>void 0!==n&&Object.keys(n).length?n:void 0)())}}}))}}s=s&&s.length?s:t.name,a?o(0,a):getElement$1(i,o)}function getSlotProduct(e){if(!e)return"";const t=["revolvingRail","slidingUnit","topAdhesion","standAloneVideo","stickyRail"].filter((t=>{const i=e[t+"Options"];return i?.active})),i=getIdealAdInsertionElementOptions(e);return i&&i.active&&t.push("dynamicAd"),e.stickyFooterOptions?.active&&t.push(!0===e.stickyFooterOptions.video?"stickyFooterVideo":"stickyFooter"),e.interstitialOptions?.active&&t.push("interstitial"),!0===e.lazyAd&&t.push("lazyLoad"),[1,2].includes(e.sideWallOptions?.type)&&t.push("sideWall"),e.pushdownOptions?.isPushdownUnit&&t.push("pushdown"),e?.carouselOptions&&(isControl()||t.push("carousel")),getIntelligentAdInsertConfig({placement:e})?.active&&t.push("iai"),t.length<=0&&t.push("banner"),t.filter((e=>!productIsDisabled({name:e}))).join(",")}function newAdSlotsQueSet(e){let{elements:t=[],channel:i=null}=e;freestar.newAdSlotsQueue.push(new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.elements=e,this.channel=t,this.used=!1}process(){this.used||(freestar.log(1,"Invoking process for queued new ad slot for the following elements ",this.elements),freestar.log(1,"Invoking process for queued new ad slot using the following channel ",this.channel),this.used=!0,freestar.newAdSlots(this.elements,this.channel))}}(t,i))}function newAdSlots(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2?arguments[2]:void 0;const n="newAdSlots";if(!freestar.newAdSlotsAllowed)return newAdSlotsQueSet({elements:e,channel:t}),void freestar.log(1,"The method newAdSlots not allowed while page grabber is active. Placement the following elements / channel in the newAdSlotsQueue : ",arguments);if(freestar.log(10,`${n} invoked`,...arguments),siteGeoMacroRestriction())throw new Error("Ad serving is blocked in "+freestar.locData.iso);if(void 0===e)return;Array.isArray(e)||(e=[e]);let s=uniqBy(e=e.filter((e=>{const{placementName:t}=e,i=null!=getPlacementByName({name:t});return i||freestar.log(30,n,`cannot find placement for ${t}, ignoring`),i})),"slotId");if(!window.freestar.loaded||!window.fsprebid.libLoaded||!window.googletag)return freestar.log(10,n,"Objects not ready, returning..."),freestar.queue.timers=freestar.queue.timers||{},void(freestar.queue.timers&&s[0]&&s[0].slotId&&(freestar.queue.timers[s[0].slotId]&&clearTimeout(freestar.queue.timers[s[0].slotId]),freestar.queue.timers[s[0].slotId]=setTimeout(newAdSlots,100,...arguments)));!t&&freestar.config.channel&&(t=freestar.config.channel),freestar.config.orignalChannel||(freestar.config.orignalChannel="{{channel}}"),t&&freestar.config.orignalChannel!=t&&(freestar.log(99,n,"Channel is different than originally set, modifying dfpIds"),freestar.fsdata.placements=freestar.fsdata.placements.map((e=>(e.dfpId=e.dfpId.replace(freestar.config.orignalChannel,t),e))),freestar.config.orignalChannel=t,freestar.log(99,n,"New dfpIDs",freestar.fsdata.placements.map((e=>e.dfpId))));for(let e=0;e<s.length;e++)if(-1===freestar.enabledSlotsCalled.indexOf(s[e].slotId)){refreshLibraryCreatorVersionCheck(s[e].placementName);const{placementName:t,slotId:i,targeting:n}=s[e],r=document.getElementById(i),a=getPlacementByName({name:t});a&&(createAdSlot({placement:a,slotId:i,targeting:n,newElement:s[e],element:r}),r&&(biddingQueueSet({placement:a,element:r,newElement:s[e]}),freestar.newAdSlotsCalled.push(r.id),void 0===s[e].skipSAU&&AppContainer.instance.resolve("StickyAd",!0).then((e=>{e?.isSlidingUnit({placement:a})&&e?.attachSlidingUnit({adUnit:a,slotId:i})}))))}requestQueInitiate(i)}function gamTargeting(e){let{key:t,value:i}=e;window.googletag.pubads&&window.googletag.pubads().setTargeting(t,i)}function setTargeting(e){let{slot:t,key:i,value:n}=e;t&&t.setTargeting&&i&&n&&t.setTargeting(i,n)}function getSlots(){return window.googletag.pubads&&window.googletag.pubads().getSlots()}function getSlot(e){let{elementId:t}=e;if(t)return getSlots().filter((e=>e.getSlotElementId()===t))[0]}function destroySlot(e){let{elementId:t}=e,i=getSlot({elementId:t});i&&(window.googletag.destroySlots([i]),t in freestar.refreshLibrary&&delete freestar.refreshLibrary[t])}function isValidDfPId(e){let{specialDfpId:t,dfpId:i}=e;return t||!i.includes("{{channel}}")}function defineOutOfPageSlot(e){let{dfpId:t,elementId:i}=e;return window.googletag.defineOutOfPageSlot(t,i).addService(googletag.pubads())}function createGAMSlot(e){let{placement:t,sizes:i,id:n=null,specialDfpId:s=null,slotConfig:r}=e;if(!t)return void freestar.log("No placement provided, exiting...");if(!i&&(i=getPlacementSizesByScreenResolution(t),!i))return void freestar.log("No sizes found at this resolution, exiting...");n||(n=t.name);let{outOfPage:a,dfpId:o,fluidAd:d}=t,l=getSlot({elementId:n});if(l||(a?isValidDfPId({specialDfpId:s,dfpId:o})&&(l=defineOutOfPageSlot({dfpId:s||o,elementId:n})):(d&&!i.includes("fluid")&&i.push("fluid"),isValidDfPId({specialDfpId:s,dfpId:o})&&(l=googletag.defineSlot(s||o,i,n).addService(googletag.pubads())))),l){if(freestar.fsdata.disableSingleRequest||googletag.pubads().enableSingleRequest(),googletag.enableServices(),gamMapping({id:n,placement:t}),l.setTargeting){let e={fsrefresh:"0",fsrebid:"0",fs_uuid:generateUUID()};floorsHardOffPlacement({siteId:freestar.fsdata.siteId,placement:t})||(e=floorsManager().getInitialFloorKVP({placement:t,keyMap:e})),Object.keys(e).forEach((t=>{l.setTargeting(t,e[t])}))}if(freestar.gptppid&&freestar.gptppid.updateGoogleSlotTargeting(l),t&&(setTargeting({slot:l,key:"fs_placementName",value:t.name}),setTargeting({slot:l,key:"fs_ad_product",value:getSlotProduct(t)})),r&&r.targeting)for(const e in r.targeting)Object.prototype.hasOwnProperty.call(r.targeting,e)&&setTargeting({slot:l,key:e,value:r.targeting[e]});const e=localStorage.getItem("brw.prf");return e&&setTargeting({slot:l,key:"browsiPP",value:e}),publisherSlotOperationsInit({slot:l}),dynamicSet({placementName:t.name,slotId:n,path:s||o}),adUnitManager.add({placement:t,slot:l}),l}}function isFsGam(){return getUrlParameter("fs-dev-gam")?(updatePlacementsDfpId(FS_DFP_DEV_ID),!1):freestar.fsdata.placements.filter((e=>e.dfpId.indexOf(FS_DFP_ID)>-1)).length>0}function isFsDevGam(){return freestar.fsdata.placements.filter((e=>e.dfpId.indexOf(FS_DFP_DEV_ID)>-1)).length>0}function updatePlacementsDfpId(e){freestar&&freestar.fsdata&&Array.isArray(freestar.fsdata.placements)?freestar.fsdata.placements=freestar.fsdata.placements.map((t=>(t.dfpId?.includes(FS_DFP_ID)&&(t.dfpId=t.dfpId.replace(FS_DFP_ID,e)),t))):console.error("Invalid freestar.fsdata.placements structure.")}function getGamSlots(e){let{slotIds:t}=e;return getSlots().map((function(e){if(!t||t.indexOf(e.getSlotElementId())>-1)return e})).filter((e=>void 0!==e))}const byteToHex=[];for(let e=0;e<256;++e)byteToHex.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase()}let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");getRandomValues=crypto.getRandomValues.bind(crypto)}return getRandomValues(rnds8)}const randomUUID="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var native={randomUUID:randomUUID};function v4(e,t,i){if(native.randomUUID&&!t&&!e)return native.randomUUID();const n=(e=e||{}).random??e.rng?.()??rng();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){if((i=i||0)<0||i+16>t.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[i+e]=n[e];return t}return unsafeStringify(n)}function reportTracking(e){let{event:t}=e;if(t.isEmpty)return;const i=t.slot.getSlotElementId();if(!i)return;const n=freestar.bidsWon[i];n&&n.time&&Date.now()-n.time>29e3&&delete freestar.bidsWon[i]}const isOnlyOneByOnePlacement=e=>1===e.length&&1===e[0][0]&&1===e[0][1],isFluidSize=e=>Array.isArray(e)&&e.length>1&&35843===e[0],getFreestarAdValuesByPlacement=e=>{let{placement:t}=e,i="";if(!t)return i;const n=t.sizes.filter((e=>Array.isArray(e))),s={w:maxBy(n,(e=>e[0])),h:maxBy(n,(e=>e[1]))};return s.w&&s.w.length&&(i+=`__${s.w.join("x")}`),s.h&&s.h.length&&(i+=`  __${s.h.join("x")}`),i},addClassToBody=e=>{const t=document.getElementsByTagName("body")[0];-1==t.className.indexOf(`${e}`)&&(t.className+=t.className.length?` ${e}`:e)};function checkForCustomCss(e){if(e){let t=document.getElementsByTagName("head")[0],i=createElement({type:"style",attributes:[{type:"text/css"},{"data-owner":"freestar"}]});i.appendChild(document.createTextNode(e.replace(/(\r\n|\n|\r)/gm,""))),t.appendChild(i)}}const getIABSegments=()=>["v2ContentCategory","v2ContentSource","v2ContentMediaFormat","v2ContentChannel","v2ContentType","v2ContentLanguage","v2ContentSourceGeo"].reduce(((e,t)=>window.freestar.fsdata[t]?[...e,...window.freestar.fsdata[t]]:e),[]),generateUUID=()=>v4(),scriptExists=e=>{let{id:t}=e;return null!==document.querySelector(`#${t}`)};function loadScriptWithDOMTarget(e){let{scriptSrc:t,target:i=null,callback:n,id:s}=e;if(i)try{const e=createElement({type:"script",src:t});e.async=!0,e.type="text/javascript",n&&(e.onload=n),s&&(e.id=s),i.appendChild(e)}catch(e){}}function handleStateChange(e){if(!e.state||0===Object.keys(e.state).length)return;const t=window.location.origin,i=e.state.current?t+e.state.current:window.location.href;freestar.trackPageview({path:i})}function browserInfo(){let e=window.innerWidth,t=window.innerHeight,i=document.body,n=document.documentElement,s=Math.max(i.scrollHeight,i.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight),r=document.querySelector("link[rel='canonical']"),a="";r&&(a=r.getAttribute("href")),0===freestar.msg.loadTime&&(freestar.msg.loadTime=Date.now()-freestar.hitTime),window.freestar.lastHrefPushed=window.freestar.lastHrefPushed||"",window.googletag.cmd.push((function(){window.freestar.lastHrefPushed!==freestar.url&&(window.freestar.lastHrefPushed=freestar.url,AppContainer.instance.resolve(TOKEN.ANALYTICS).then((i=>{i.track(new BrowserInfoAnalyticsEvent({canonical:a,fpc:freestar.msg.fpc,hitTime:freestar.hitTime,loadTime:freestar.msg.loadTime,winHeight:t,winWidth:e,maxHeight:s,isServerToServer:freestar.server.diceRoll,googleVersion:window.googletag.getVersion()||""}))})))}))}function dfpResponseInfoComplete(e){dfpResponseInfo(e,!0)}function dfpEventMessage(e){let{eventObject:t,event:i,complete:n}=e;if(n?i=freestar.dfpSlotInfo[t.elementId]:freestar.dfpSlotInfo[t.elementId]=i,i&&t&&!isGoogleInterstitial({event:i})){const{slot:e}=i,s=e.getTargeting("fs-auuid")[0]||null;Promise.all([AppContainer.instance.resolve(TOKEN.ANALYTICS),AppContainer.instance.resolve("DfpResponseAnalyticsEventFactory")]).then((e=>{let[r,a]=e;r.track(a.create({slotId:t.elementId,placementId:t.placementId,DfpId:t.adUnitPath,advertiserId:i.advertiserId,campaignId:i.campaignId,isEmpty:i.isEmpty,lineItemId:i.lineItemId,serviceName:i.serviceName,size:JSON.stringify(i.size),sourceAgnosticCreativeId:i.sourceAgnosticCreativeId,sourceAgnosticLineItemId:i.sourceAgnosticLineItemId,parentDiv:t.elementId,complete:n||!1,auctionId:t.auctionId?t.auctionId:null,fsAuctionId:s}))}))}i&&isGoogleInterstitial({event:i})&&(window.freestar.googleInterstitialPlacement||(window.freestar.googleInterstitialPlacement={}),window.freestar.googleInterstitialPlacement.event=i)}function dfpResponseInfo(e,t){if(!e)return;const i=e.slot.getSlotElementId(),n=e.slot.getAdUnitPath(),s=dynamicGet({slotId:i,path:n}),r={elementId:i,creativeId:e.creativeId,adUnitPath:n,placementId:s,displayed:!e.isEmpty},a=getPrebidAdserverTargetingKeys({freestar:freestar}),o=e.slot.getTargeting(a.auction_id);0!==o.length&&(r.auctionId=o[0]),s&&"unknown"!==s&&(createCustomEvent({name:"adServerResponse",detail:r}),freestar.pushdownControl&&freestar.pushdownControl.postGamResponse&&freestar.pushdownControl.postGamResponse({event:e}),dfpEventMessage({event:e,eventObject:r,complete:t}),reportTracking({event:e}),freestar.fsdata.customDirectAdRefresh&&getDemandSourceTypes(),collectLineItem(e))}function displayGPTTargeting(e){if(freestar.debug<50)return;freestar.log(25,"GPT Targeting - START ************************");let t=googletag.pubads().getTargetingKeys();for(let e=0;e<t.length;e++){let i=googletag.pubads().getTargeting(t[e]);freestar.log(25,"GPT Targeting - "+t[e]+" = "+i)}e?Array.isArray(e)||(e=[e]):e=getSlots();for(let i=0;i<e.length;i++){let n=e[i],s=n.getSlotElementId();t=n.getTargetingKeys();for(let e=0;e<t.length;e++){let i=n.getTargeting(t[e]);freestar.log(25," GPT Targeting - Slot ("+s+")- "+t[e]+" = "+i)}}freestar.log(25," GPT Targeting - END **************************")}function injectCss(e){let{id:t=null}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=createElement({type:"style",attributes:[{"data-owner":"freestar"}],id:t});i.textContent=e,document.head.append(i)}function getSiteResourceData(){const e={video:[],script:[],iframe:[]};function t(e){const t=e.src;return""!==t&&null!=t&&"about:blank"!==t}Object.keys(e).forEach((i=>{const n=document.querySelectorAll(i);e[i]=Array.from(n).filter(t).map((e=>{let{src:t}=e;return t}))})),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((t=>{t.track(new SnifferAnalyticsEvent({scripts:e.script,videos:e.video,iframes:e.iframe}))}))}function getPlacementSizeMappingByScreenResolution(e){let t=!1;return e.sizeMappings.some((e=>{if(fsBrowserWidth()>=e.viewport.size[0])return t=e,!0})),t}function getPlacementSizesByScreenResolution(e){let t=!1;return e.sizeMappings.some((e=>{if(fsBrowserWidth()>=e.viewport.size[0])return t=e.size.sort(((e,t)=>e[0]+e[1]<t[0]+t[1]?1:t[0]+t[1]<e[0]+e[1]?-1:0)).filter((e=>35843!==e[0])),!0})),t}const getElement=e=>e.indexOf("#")>-1?document.querySelector(e):document.querySelectorAll(e)[0],getPlacementByName=e=>{let{name:t}=e;return window.freestar.fsdata.placements.filter((e=>e.name===t))[0]};function unifiedBiddingConfigCreation(e){let{placement:t,slotId:i,slotConfig:n,targeting:s={}}=e;if(!t)return;dynamicSet({placementName:t.name,slotId:i||t.name});let r=getGamSlots({slotIds:[i||t.name]})[0];r||(r=createGAMSlot({placement:t,id:i,slotConfig:n})),r&&slotTargeting(r,t.name,null,Object.assign(s,{fs_ad_product:getSlotProduct(t)}));const a=format_pbjs(t);return i&&(a.code=i),{slot:r,bidObject:a,placement:t}}const isValidIntersection=e=>e.intersectionRatio>0&&e.isIntersecting&&get(e,"target.id.length",0)>1,isValidEmailAddress=e=>{let{email:t}=e;return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)};class CoppaCompliance{constructor(e,t,i){this.isCoppaInventory=!1,this.global=e,this.prebid=i,this.googletag=t}init(){this.global.config?.isCOPPA&&!0===this.global.config.isCOPPA&&this.set()}set(){this.isCoppaInventory=!0,this.logMethodCall("set"),this.updatePrebidJs(),this.updateGAM()}unset(){this.isCoppaInventory=!1,this.logMethodCall("unset"),this.updatePrebidJs(),this.updateGAM()}info(){return this.global.log("COPPA status is set to "+this.isCoppaInventory),this.isCoppaInventory}logMethodCall(e){this.global.log(`COPPA method ${e} called at ${(new Date).toISOString()}`)}updatePrebidJs(){this.prebid&&this.prebid.setConfig({coppa:this.isCoppaInventory})}updateGAM(){this.googletag&&this.googletag.cmd.push((()=>{this.googletag.pubads().setPrivacySettings({childDirectedTreatment:this.isCoppaInventory})}))}}function isCoppaPage(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Boolean((arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).isCoppaInventory||e.isCOPPA)}let resolve;const AMAZON_LOAD_PROMISE=new Promise((e=>{resolve=e}));function loadAmazonBidder(){!function(e,t,i,n,s,r,a){function o(i,n){t[e]._Q.push([i,n])}t[e]||(t[e]={init:function(){o("i",arguments)},fetchBids:function(){o("f",arguments)},setDisplayBids:function(){},targetingKeys:function(){return[]},_Q:[]},(r=i.createElement(n)).async=!0,r.src="//c.amazon-adsystem.com/aax2/apstag.js",(a=i.getElementsByTagName(n)[0]).parentNode.insertBefore(r,a))}("apstag",window,document,"script"),window.apstag.init({pubID:freestar.amazonPublisherId,adServer:"googletag",schain:_generateAmazonSchain(window.freestar.fsdata.companyId,window.freestar.fsdata.schain?.type,window.freestar.fsdata.schain?.bidderOverrides)},(()=>{resolve()}))}function _generateAmazonSchain(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:SCHAIN_TYPE_NONE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=i&&i.length&&i.includes(AMAZON_BIDDER_SLUG);if((t!==SCHAIN_TYPE_NONE||n)&&(t!==SCHAIN_TYPE_FREESTAR||!n))return generateSchain(e,t,i)}function setupAmazonBidder(){if(idealAdStackManager().getBypassFirstAuction())resolve();else{const e=freestar.fsdata.networks.filter((e=>"amazon"===e.slug))[0];if(e&&!isCoppaPage(window.freestar.coppa,window.freestar.config)){const{clientServer:t}=idealAdStackManager().getConfig();if("off"!==t.amazon){freestar.amazonNetwork=e;const t=freestar.amazonNetwork.sizes.filter((e=>e.params.publisherId))[0];freestar.amazonPublisherId=t&&t.params&&t.params.publisherId&&isString(t.params.publisherId)?t.params.publisherId:"0ab198dd-b265-462a-ae36-74e163ad6159",loadAmazonBidder()}else resolve()}else resolve()}}function isAmazonAd(e){return e.bidders&&e.bidders.some((e=>{let{bidder:t}=e;return"amazon"===t}))}function formatAps(e){const t=e.sizeMappings.find((e=>fsBrowserWidth()>=e.viewport.size[0]));let i=t?t.size:[];return i=i.filter((e=>35843!==e[0])),index({slotID:e.name,slotName:e.dfpId,sizes:i})}function getPlacementByDfpId(e){let t=getPlacements();for(let i=0;i<t.length;i++)if(t[i].dfpId===e)return t[i];return null}function setupAmazonSlots(e){let t=[];if(e)for(let i=0;i<e.length;i++){let n=null;try{n=freestar.dynamicSlotLibrary[e[i].getSlotElementId()],n&&(n=getPlacementByName({name:n})),n||(n=freestar.fsdata.placements.filter((t=>{if(e[i].getSlotElementId()===t.slotId)return t})),0===n.length&&(n=null)),n||(n=getPlacementByDfpId(e[i].getAdUnitPath()))}catch(e){freestar.log(1,`Error: ${e}`)}if(n&&isAmazonAd(n)){const n=e[i],s=n.getSizes().filter((e=>"string"!=typeof e)).map((e=>[e.width,e.height]));if(!s.length)continue;const r={slotID:n.getSlotElementId(),slotName:n.getAdUnitPath(),sizes:s};t.push(index(r))}}else t=getPlacements().filter((e=>isAmazonAd(e)&&isValidAd(e))).map((e=>formatAps(e)));return t}ModuleRegistry.object({token:TOKEN.WINDOW,value:window}),ModuleRegistry.object({token:TOKEN.FREESTAR,dependencies:[TOKEN.WINDOW],factory:e=>{let{dependencies:{window:t}}=e;return t.freestar??{}}}),ModuleRegistry.object({token:TOKEN.FS_DATA,dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;return t.freestar?.fsdata??{}}}),ModuleRegistry.object({token:TOKEN.DEVICE_INFO,dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;return t.freestar?.deviceInfo??{}}}),ModuleRegistry.object({token:TOKEN.GEO_INFO,dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;return t.freestar?.locData??{}}}),ModuleRegistry.object({token:TOKEN.PAGE,defaultAlias:"page",dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;const{freestar:i}=t;return{get pageId(){return i.msg?.pageId},get url(){return i.url},get pageViewCount(){return i.msg?.pageviewCount}}}}),ModuleRegistry.object({token:TOKEN.PERFORMANCE_LOGGER,dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;const{freestar:i}=t;return i.performanceLogger}}),ModuleRegistry.object({token:TOKEN.PREBID_MANAGER,dependencies:[{token:TOKEN.WINDOW,alias:"win"}],factory:e=>{let t,{dependencies:i}=e;const n=new Promise((e=>{t=e}));return i.win.fsprebid=i.win.fsprebid??{},i.win.fsprebid.que=i.win.fsprebid.que??[],i.win.fsprebid.que.push((()=>{t()})),{get instance(){return i.win.fsprebid},get ready(){return n}}}}),ModuleRegistry.object({token:TOKEN.GAM_MANAGER,dependencies:[{token:TOKEN.WINDOW,alias:"win"}],factory:e=>{let t,{dependencies:i}=e;const n=new Promise((e=>{t=e}));return i.win.googletag.cmd.push((()=>{t()})),{get instance(){return i.win.googletag},get ready(){return n}}}}),ModuleRegistry.object({token:TOKEN.AMAZON_MANAGER,dependencies:[{token:TOKEN.WINDOW,alias:"win"}],factory:e=>{let{dependencies:t}=e;return{get instance(){return t.win.apstag},get ready(){return AMAZON_LOAD_PROMISE}}}}),ModuleRegistry.object({token:TOKEN.IDEAL_AD_STACK_MANAGER,defaultAlias:"idealAdStackManager",factory:()=>idealAdStackManager()});class AnalyticsMessage{_events=[];constructor(e){let{context:t,events:i=[]}=e;this._context=t,i.forEach((e=>this.addEvent(e)))}addEvent(e){this._events.push(e)}getJSON(){const e=this._events.reduce(((e,t)=>(e[t.type]=e[t.type]??[],e[t.type].push(t.payload),e)),{});return{...this._context,...e}}get size(){return this._events.length}}const FREESTAR_SESSION_NAME="fs.session",ITF_GROUP_KEY="fs.itf.group",ITF_PROVIDERS_KEY="fs.itf.targeting",IDENTITY_DATA_KEY="fs.ident";class SessionStorageManager$1{constructor(){this.session=null,this._init()}_init(){this.session=sessionStorageGet({key:FREESTAR_SESSION_NAME,type:SESSION_STORAGE_TYPES.object.type}),this.session&&Object.keys(this.session).length||(this.session={id:generateUUID()});const e=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].flatMap((e=>{const t=getUrlParameter(e);return t?{key:e,value:t}:[]})).reduce(((e,t)=>{let{key:i,value:n}=t;return e[i]=n,e}),{});this.session.utm=e,sessionStorageSet({key:FREESTAR_SESSION_NAME,type:SESSION_STORAGE_TYPES.object,value:this.session})}getSessionId(){return this.session.id}getUTMValue(e){return this.session.utm?.[e]}}ModuleRegistry.class(SessionStorageManager$1,{token:TOKEN.SESSION_STORAGE_MANAGER,defaultAlias:"sessionStorageManager"});class AnalyticsMessageFactory{constructor(e){let{page:t,sessionStorageManager:i,dispensaryData:n}=e;this._page=t,this._sessionStorageManager=i,this._dispensaryData=n}create(e){let{events:t=[]}=e;const i=this._collectContextInfo();return new AnalyticsMessage({context:i,events:t})}_collectContextInfo(){const{pageId:e,pageViewCount:t,url:i}=this._page||{};return{messageId:generateUUID(),referalURL:document.referrer||void 0,pageId:e,url:i,userAgent:navigator.userAgent,pageviewCount:t,...this._getDispensaryData(),...this._getTestData(),...this._getSessionData()}}_getSessionData(){return{...Object.fromEntries([["utmSource","utm_source"],["utmMedium","utm_medium"],["utmCampaign","utm_campaign"],["utmTerm","utm_term"],["utmContent","utm_content"]].map((e=>{let[t,i]=e;return[t,this._sessionStorageManager.getUTMValue(i)]}))),sessionId:this._sessionStorageManager.getSessionId()}}_getTestData(){const e=sessionStorageGet({key:TEST_GROUP_KEY,type:SESSION_STORAGE_TYPES.number.type})||0;return{testName:sessionStorageGet({key:TEST_ID_KEY})||null,testGroup:e,testVariantId:sessionStorageGet({key:TEST_VARIANT_KEY})||null}}_getDispensaryData(){let e=Object.fromEntries(["accountId","siteId","deploymentId","templateVersionId"].map((e=>[e,this._dispensaryData.getValue(e)]))),t=this._dispensaryData.getValue("gitHash");return null==e.templateVersionId&&t&&(e.templateVersionId=t),e}}ModuleRegistry.class(AnalyticsMessageFactory,{token:TOKEN.ANALYTICS_MESSAGE_FACTORY,defaultAlias:"analyticsMessageFactory",dependencies:[TOKEN.PAGE,TOKEN.SESSION_STORAGE_MANAGER,TOKEN.DISPENSARY_DATA]});class APIError extends Error{constructor(e){let{message:t,details:i,context:n}=e;super(t),this.details=i,this.context=n}}class DataCollectorAPI{constructor(){let{logger:e,apiHost:t=COLLECTOR_URL,version:i="v2"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.apiHost=t,this.version=i,this.url=`${this.apiHost}/${this.version}/c`,this._logger=e,this._logger.setContext(TOKEN.DATA_COLLECTOR_API),this._logger.setLevel(80)}async send(e){if(e){this._logger.log(["Sending data to collector",e]);try{const t=await fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(t?.ok)return;throw t}catch(t){const i={status:t?.status?.toString(),statusText:t?.statusText};let n="Data Collector API Error: ";throw n+=t?.status?`Status: ${t?.status} ${t?.statusText}`:`Status: ${t.message}`,new APIError({message:n,details:i,context:e})}}}sendBeacon(e){const t=new Blob([JSON.stringify(e)],{type:"application/json"});if(!navigator.sendBeacon(this.url,t)){const t={status:"0",statusText:"Failed to send via sendBeacon"},i="Data Collector API Error: sendBeacon failed to send the data.";throw this._logger.warning([i,t]),new APIError({message:i,details:t,context:e})}}}ModuleRegistry.class(DataCollectorAPI,{token:TOKEN.DATA_COLLECTOR_API,dependencies:[TOKEN.LOGGER],defaultAlias:"dataCollectorAPI"});const LOG_LEVEL={SILENT:0,CORE:5,MODULE:50,VERBOSE:99};class Logger{static _instancesCount=0;constructor(e){const t=isNil(e?.level)?LOG_LEVEL.VERBOSE:e.level,i=isNil(e?.defaultLevel)?LOG_LEVEL.VERBOSE:e.defaultLevel;this._level=Math.max(t,LOG_LEVEL.SILENT),this._defaultLevel=Math.max(i,LOG_LEVEL.SILENT),this._context=e?.context??"Pubfig",this.id=e?.id??Logger._instancesCount,Logger._instancesCount+=1}log(e,t){if(this.level===LOG_LEVEL.SILENT)return;const{level:i=this._defaultLevel}=t??{};this.level>=i&&console.info(...this._getLogArguments(e,t))}error(e,t){console.error(...this._getArguments(e,t?.context))}warning(e,t){console.warn(...this._getArguments(e,t?.context))}info(e,t){console.info(...this._getArguments(e,t?.context))}setLevel(e){this._defaultLevel=e}get level(){return this._level}setContext(e){this._context=e}createLogger(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._defaultLevel;return Logger._instancesCount+=1,new Logger({level:this.level,defaultLevel:t,context:e,id:Logger._instancesCount})}_getLogArguments(e){let{context:t,styles:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[`%c${t??this._context}:`,this._getStyles(i),...this._getMessages(e)]}_getStyles(e){if(e)return e;return`background: hsl(${(150+30*this.id)%360}, 40%, 50%); color: #fff; border-radius: 3px; padding: 3px`}_getMessages(e){return Array.isArray(e)?e:[e]}_getArguments(e,t){const i=Array.isArray(e)?e:[e];return[`${t??this._context}: `,...i]}}ModuleRegistry.class(Logger,{token:TOKEN.LOGGER,defaultAlias:"logger",injectionMode:INJECTION_MODE.FOR_FEATURE,dependencies:[TOKEN.CONFIG_MANAGER],factory:e=>{let{dependencies:{config:t}={}}=e;return new Logger({level:t.logLevel})}});const MODULE_STATUS={INIT:"Init",INIT_COMPLETE:"Init complete",INIT_FAILED:"Init failed"},ANALYTICS_EVENT_TYPE={ERROR:"analyticsError"};class AnalyticsMiddleware{beforeMessageSend(e,t){t(e)}}class UnaliasBidderMiddleware extends AnalyticsMiddleware{static propertiesToUnalias=["bidder","bidderCode","adapterCode"];beforeMessageSend(e,t){const{payload:i}=e;UnaliasBidderMiddleware.propertiesToUnalias.forEach((e=>{i[e]&&(i[e]=unaliasBidder(i[e]))})),t()}}class Analytics{constructor(e){let{logger:t,mainQueue:i,errorQueue:n,immediateQueue:s,beaconQueue:r,eventBus:a}=e;this._logger=t,this._logger.setContext(TOKEN.ANALYTICS),this._logger.setLevel(2),this._errorReportingEnabled=Math.random()<=.01,this._mainQueue=i,this._errorQueue=n,this._immediateQueue=s,this._beaconQueue=r,this._middlewares=[],this._eventBus=a,this._topicMap={[TOPIC.ERROR]:this._errorQueue,[TOPIC.BEACON]:this._beaconQueue,[TOPIC.IMMEDIATE]:this._immediateQueue,[TOPIC.MAIN]:this._mainQueue},this._errorReportingEnabled&&this._eventBus.subscribe(ANALYTICS_EVENT_TYPE.ERROR,this._reportError),this._init()}_init(){this._logger.log(MODULE_STATUS.INIT),this._mainQueue.start(),this._logger.log([MODULE_STATUS.INIT_COMPLETE,"Queue processing started."])}addMiddleware(e){if(!(e instanceof AnalyticsMiddleware))throw new Error("Middleware must be an instance of AnalyticsMiddleware");this._middlewares.includes(e)||this._middlewares.push(e)}removeMiddleware(e){this._middlewares=this._middlewares.filter((t=>t!==e))}track(e){if(!e.type||!e.payload)return void this._logger.error("Invalid event type. event must be an instance of AnalyticsEvent.");const t=this._applyBeforeSendMiddleware(e);if(!t)return;(this._topicMap[t.topic]||this._topicMap[TOPIC.MAIN]).enqueue(t)}_reportError=e=>{let{payload:t}=e;this._errorQueue.enqueue(new CustomAnalyticsEvent({eventName:"MESSAGE_ERROR",eventType:t.details?.status,data:{error:t.details,message:t.message,timestamp:(new Date).toISOString()}}))};_applyBeforeSendMiddleware(e){const t=this._middlewares.filter((e=>e.beforeMessageSend));if(!t.length)return e;try{const i=()=>{if(!t.length)return;t.shift().beforeMessageSend(e,i)};return i(),e}catch{return null}}}ModuleRegistry.class(Analytics,{token:TOKEN.ANALYTICS,defaultAlias:"analytics",dependencies:[TOKEN.LOGGER,TOKEN.MAIN_QUEUE,TOKEN.ERROR_QUEUE,TOKEN.IMMEDIATE_QUEUE,TOKEN.BEACON_QUEUE,TOKEN.EVENT_BUS],factory:e=>{let{dependencies:t}=e;const i=new Analytics(t);return i.addMiddleware(new UnaliasBidderMiddleware),i}});class BaseQueue{enqueue(){throw new Error("Method not implemented")}}class DelayedQueue extends BaseQueue{_name="DelayedQueue";constructor(e){let{analyticsMessageFactory:t,eventBus:i,logger:n,api:s,batchLimit:r=MAX_MESSAGES_IN_BUFFER,intervalMs:a=QUEUE_POLL_INTERVAL_MS}=e;super(),this._eventBus=i,this._logger=n,this._messageFactory=t,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[],this._api=s,this._intervalMs=a,this._batchLimit=r,this._isProcessing=!1,this._intervalId=null}enqueue(e){const t=this._queue[this._queue.length-1];t&&t.size<this._batchLimit?t.addEvent(e):this._queue.push(this._messageFactory.create({events:[e]}))}start(){this._processQueue(),this._intervalId=setInterval((()=>{this._processQueue()}),this._intervalMs)}stop(){clearInterval(this._intervalId)}async _processQueue(){if(this._isProcessing)return;const e=this._queue.shift();if(e?.size)try{this._isProcessing=!0,await this._api.send(e.getJSON())}catch(e){this._logger.warning(["Failed to process queue",e]),this._eventBus.emit(ANALYTICS_EVENT_TYPE.ERROR,e)}finally{this._isProcessing=!1}}}class ImmediateQueue extends BaseQueue{_name="ImmediateQueue";constructor(e){let{analyticsMessageFactory:t,eventBus:i,logger:n,api:s,reportErrors:r=!0}=e;super(),this._eventBus=i,this._logger=n,this._messageFactory=t,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[],this._api=s,this._reportErrors=r,this._isProcessing=!1}enqueue(e){this._queue.push(this._messageFactory.create({events:[e]})),this._processQueue()}async _processQueue(){for(;this._queue.length;)try{const e=this._queue.shift();if(!e?.size)continue;await this._api.send(e.getJSON())}catch(e){this._logger.warning(["Failed to process queue",e]),this._reportErrors&&this._eventBus.emit(ANALYTICS_EVENT_TYPE.ERROR,e)}}}class BeaconQueue extends BaseQueue{_name="BeaconQueue";constructor(e){let{analyticsMessageFactory:t,logger:i,api:n}=e;super(),this._messageFactory=t,this._api=n,this._logger=i,this._logger.setContext(`Analytics Queue: ${this._name}`),this._logger.setLevel(2),this._queue=[]}enqueue(e){const t=this._messageFactory.create({events:[e]});this._sendBeacon(t)}_sendBeacon(e){try{this._api.sendBeacon(e.getJSON())}catch(e){this._logger.warning(["Failed to send beacon",e])}}}const queueDependencies=[TOKEN.EVENT_BUS,TOKEN.LOGGER,{token:TOKEN.DATA_COLLECTOR_API,alias:"api"},TOKEN.ANALYTICS_MESSAGE_FACTORY];class MainQueue extends DelayedQueue{_name=(()=>TOKEN.MAIN_QUEUE)()}class ErrorQueue extends ImmediateQueue{_name=(()=>TOKEN.IMMEDIATE_QUEUE)()}ModuleRegistry.class(MainQueue,{token:TOKEN.MAIN_QUEUE,defaultAlias:"mainQueue",dependencies:queueDependencies,factory:e=>{let{dependencies:t}=e;return new MainQueue({...t,batchLimit:MAX_MESSAGES_IN_BUFFER,intervalMs:QUEUE_POLL_INTERVAL_MS})}}),ModuleRegistry.class(ErrorQueue,{token:TOKEN.ERROR_QUEUE,defaultAlias:"errorQueue",dependencies:queueDependencies,factory:e=>{let{dependencies:t}=e;return new ErrorQueue({...t,reportErrors:!1})}}),ModuleRegistry.class(ImmediateQueue,{token:TOKEN.IMMEDIATE_QUEUE,defaultAlias:"immediateQueue",dependencies:queueDependencies}),ModuleRegistry.class(BeaconQueue,{token:TOKEN.BEACON_QUEUE,defaultAlias:"beaconQueue",dependencies:[TOKEN.ANALYTICS_MESSAGE_FACTORY,TOKEN.LOGGER,TOKEN.EVENT_BUS,{token:TOKEN.DATA_COLLECTOR_API,alias:"api"}],factory:e=>{let{dependencies:t}=e;return new BeaconQueue({analyticsMessageFactory:t.analyticsMessageFactory,api:t.api,eventBus:t.eventBus,logger:t.logger})}});var sha256={exports:{}};function commonjsRequire(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var core={exports:{}},_nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),require$$0=getAugmentedNamespace(_nodeResolve_empty$1),hasRequiredCore;function requireCore(){return hasRequiredCore||(hasRequiredCore=1,function(e,t){var i;e.exports=(i=i||function(e,t){var i;if("undefined"!=typeof window&&window.crypto&&(i=window.crypto),"undefined"!=typeof self&&self.crypto&&(i=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(i=globalThis.crypto),!i&&"undefined"!=typeof window&&window.msCrypto&&(i=window.msCrypto),!i&&void 0!==commonjsGlobal&&commonjsGlobal.crypto&&(i=commonjsGlobal.crypto),!i&&"function"==typeof commonjsRequire)try{i=require$$0}catch(e){}var n=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),r={},a=r.lib={},o=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},d=a.WordArray=o.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,i=e.words,n=this.sigBytes,s=e.sigBytes;if(this.clamp(),n%4)for(var r=0;r<s;r++){var a=i[r>>>2]>>>24-r%4*8&255;t[n+r>>>2]|=a<<24-(n+r)%4*8}else for(var o=0;o<s;o+=4)t[n+o>>>2]=i[o>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],i=0;i<e;i+=4)t.push(n());return new d.init(t,e)}}),l=r.enc={},c=l.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],s=0;s<i;s++){var r=t[s>>>2]>>>24-s%4*8&255;n.push((r>>>4).toString(16)),n.push((15&r).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n+=2)i[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new d.init(i,t/2)}},u=l.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,n=[],s=0;s<i;s++){var r=t[s>>>2]>>>24-s%4*8&255;n.push(String.fromCharCode(r))}return n.join("")},parse:function(e){for(var t=e.length,i=[],n=0;n<t;n++)i[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new d.init(i,t)}},h=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},f=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new d.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i,n=this._data,s=n.words,r=n.sigBytes,a=this.blockSize,o=r/(4*a),l=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,c=e.min(4*l,r);if(l){for(var u=0;u<l;u+=a)this._doProcessBlock(s,u);i=s.splice(0,l),n.sigBytes-=c}return new d.init(i,c)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=f.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new p.HMAC.init(e,i).finalize(t)}}});var p=r.algo={};return r}(Math),i)}(core,core.exports)),core.exports}core.exports,sha256.exports,function(e,t){var i;e.exports=(i=requireCore(),function(e){var t=i,n=t.lib,s=n.WordArray,r=n.Hasher,a=t.algo,o=[],d=[];!function(){function t(t){for(var i=e.sqrt(t),n=2;n<=i;n++)if(!(t%n))return!1;return!0}function i(e){return 4294967296*(e-(0|e))|0}for(var n=2,s=0;s<64;)t(n)&&(s<8&&(o[s]=i(e.pow(n,.5))),d[s]=i(e.pow(n,1/3)),s++),n++}();var l=[],c=a.SHA256=r.extend({_doReset:function(){this._hash=new s.init(o.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],c=i[5],u=i[6],h=i[7],f=0;f<64;f++){if(f<16)l[f]=0|e[t+f];else{var p=l[f-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,m=l[f-2],E=(m<<15|m>>>17)^(m<<13|m>>>19)^m>>>10;l[f]=g+l[f-7]+E+l[f-16]}var _=n&s^n&r^s&r,y=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),I=h+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&c^~o&u)+d[f]+l[f];h=u,u=c,c=o,o=a+I|0,a=r,r=s,s=n,n=I+(y+_)|0}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+a|0,i[4]=i[4]+o|0,i[5]=i[5]+c|0,i[6]=i[6]+u|0,i[7]=i[7]+h|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;return i[s>>>5]|=128<<24-s%32,i[14+(s+64>>>9<<4)]=e.floor(n/4294967296),i[15+(s+64>>>9<<4)]=n,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(c),t.HmacSHA256=r._createHmacHelper(c)}(Math),i.SHA256)}(sha256,sha256.exports);var sha256Exports=sha256.exports,SHA256=getDefaultExportFromCjs(sha256Exports),sha1={exports:{}};sha1.exports,function(e,t){var i;e.exports=(i=requireCore(),function(){var e=i,t=e.lib,n=t.WordArray,s=t.Hasher,r=e.algo,a=[],o=r.SHA1=s.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,n=i[0],s=i[1],r=i[2],o=i[3],d=i[4],l=0;l<80;l++){if(l<16)a[l]=0|e[t+l];else{var c=a[l-3]^a[l-8]^a[l-14]^a[l-16];a[l]=c<<1|c>>>31}var u=(n<<5|n>>>27)+d+a[l];u+=l<20?1518500249+(s&r|~s&o):l<40?1859775393+(s^r^o):l<60?(s&r|s&o|r&o)-1894007588:(s^r^o)-899497514,d=o,o=r,r=s<<30|s>>>2,s=n,n=u}i[0]=i[0]+n|0,i[1]=i[1]+s|0,i[2]=i[2]+r|0,i[3]=i[3]+o|0,i[4]=i[4]+d|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(n+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=s._createHelper(o),e.HmacSHA1=s._createHmacHelper(o)}(),i.SHA1)}(sha1,sha1.exports);var sha1Exports=sha1.exports,SHA1=getDefaultExportFromCjs(sha1Exports),md5={exports:{}};md5.exports,function(e,t){var i;e.exports=(i=requireCore(),function(e){var t=i,n=t.lib,s=n.WordArray,r=n.Hasher,a=t.algo,o=[];!function(){for(var t=0;t<64;t++)o[t]=4294967296*e.abs(e.sin(t+1))|0}();var d=a.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var n=t+i,s=e[n];e[n]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this._hash.words,a=e[t+0],d=e[t+1],f=e[t+2],p=e[t+3],g=e[t+4],m=e[t+5],E=e[t+6],_=e[t+7],y=e[t+8],I=e[t+9],b=e[t+10],S=e[t+11],A=e[t+12],v=e[t+13],w=e[t+14],T=e[t+15],R=r[0],O=r[1],C=r[2],N=r[3];R=l(R,O,C,N,a,7,o[0]),N=l(N,R,O,C,d,12,o[1]),C=l(C,N,R,O,f,17,o[2]),O=l(O,C,N,R,p,22,o[3]),R=l(R,O,C,N,g,7,o[4]),N=l(N,R,O,C,m,12,o[5]),C=l(C,N,R,O,E,17,o[6]),O=l(O,C,N,R,_,22,o[7]),R=l(R,O,C,N,y,7,o[8]),N=l(N,R,O,C,I,12,o[9]),C=l(C,N,R,O,b,17,o[10]),O=l(O,C,N,R,S,22,o[11]),R=l(R,O,C,N,A,7,o[12]),N=l(N,R,O,C,v,12,o[13]),C=l(C,N,R,O,w,17,o[14]),R=c(R,O=l(O,C,N,R,T,22,o[15]),C,N,d,5,o[16]),N=c(N,R,O,C,E,9,o[17]),C=c(C,N,R,O,S,14,o[18]),O=c(O,C,N,R,a,20,o[19]),R=c(R,O,C,N,m,5,o[20]),N=c(N,R,O,C,b,9,o[21]),C=c(C,N,R,O,T,14,o[22]),O=c(O,C,N,R,g,20,o[23]),R=c(R,O,C,N,I,5,o[24]),N=c(N,R,O,C,w,9,o[25]),C=c(C,N,R,O,p,14,o[26]),O=c(O,C,N,R,y,20,o[27]),R=c(R,O,C,N,v,5,o[28]),N=c(N,R,O,C,f,9,o[29]),C=c(C,N,R,O,_,14,o[30]),R=u(R,O=c(O,C,N,R,A,20,o[31]),C,N,m,4,o[32]),N=u(N,R,O,C,y,11,o[33]),C=u(C,N,R,O,S,16,o[34]),O=u(O,C,N,R,w,23,o[35]),R=u(R,O,C,N,d,4,o[36]),N=u(N,R,O,C,g,11,o[37]),C=u(C,N,R,O,_,16,o[38]),O=u(O,C,N,R,b,23,o[39]),R=u(R,O,C,N,v,4,o[40]),N=u(N,R,O,C,a,11,o[41]),C=u(C,N,R,O,p,16,o[42]),O=u(O,C,N,R,E,23,o[43]),R=u(R,O,C,N,I,4,o[44]),N=u(N,R,O,C,A,11,o[45]),C=u(C,N,R,O,T,16,o[46]),R=h(R,O=u(O,C,N,R,f,23,o[47]),C,N,a,6,o[48]),N=h(N,R,O,C,_,10,o[49]),C=h(C,N,R,O,w,15,o[50]),O=h(O,C,N,R,m,21,o[51]),R=h(R,O,C,N,A,6,o[52]),N=h(N,R,O,C,p,10,o[53]),C=h(C,N,R,O,b,15,o[54]),O=h(O,C,N,R,d,21,o[55]),R=h(R,O,C,N,y,6,o[56]),N=h(N,R,O,C,T,10,o[57]),C=h(C,N,R,O,E,15,o[58]),O=h(O,C,N,R,v,21,o[59]),R=h(R,O,C,N,g,6,o[60]),N=h(N,R,O,C,S,10,o[61]),C=h(C,N,R,O,f,15,o[62]),O=h(O,C,N,R,I,21,o[63]),r[0]=r[0]+R|0,r[1]=r[1]+O|0,r[2]=r[2]+C|0,r[3]=r[3]+N|0},_doFinalize:function(){var t=this._data,i=t.words,n=8*this._nDataBytes,s=8*t.sigBytes;i[s>>>5]|=128<<24-s%32;var r=e.floor(n/4294967296),a=n;i[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),i[14+(s+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(i.length+1),this._process();for(var o=this._hash,d=o.words,l=0;l<4;l++){var c=d[l];d[l]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return o},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,i,n,s,r,a){var o=e+(t&i|~t&n)+s+a;return(o<<r|o>>>32-r)+t}function c(e,t,i,n,s,r,a){var o=e+(t&n|i&~n)+s+a;return(o<<r|o>>>32-r)+t}function u(e,t,i,n,s,r,a){var o=e+(t^i^n)+s+a;return(o<<r|o>>>32-r)+t}function h(e,t,i,n,s,r,a){var o=e+(i^(t|~n))+s+a;return(o<<r|o>>>32-r)+t}t.MD5=r._createHelper(d),t.HmacMD5=r._createHmacHelper(d)}(Math),i.MD5)}(md5,md5.exports);var md5Exports=md5.exports,MD5=getDefaultExportFromCjs(md5Exports);const TESTING_GROUPS_STATES={ALL_DISABLED:"disabled",ALL_ENABLED:"enabled",TEST_PARTNERS:"test"},PROVIDERS_SETTINGS={criteo:{itfPosition:0,itfTestPercent:.95,enabled:void 0},uid2:{itfPosition:1,itfTestPercent:.95,enabled:void 0},fabrickId:{itfPosition:2,itfTestPercent:.95,enabled:void 0},hadronId:{itfPosition:3,itfTestPercent:.95,enabled:void 0},id5Id:{itfPosition:4,itfTestPercent:.95,enabled:void 0},pairId:{itfPosition:5,itfTestPercent:.95,enabled:void 0},"33acrossId":{itfPosition:6,itfTestPercent:.95,enabled:void 0},sharedId:{itfPosition:7,itfTestPercent:.95,enabled:void 0},connectid:{itfPosition:8,itfTestPercent:.95,enabled:void 0},identityLink:{itfPosition:9,itfTestPercent:.95,enabled:void 0},liveIntentId:{itfPosition:11,itfTestPercent:.95,enabled:void 0},unifiedId:{itfPosition:12,itfTestPercent:.95,enabled:void 0},intentIqId:{itfPosition:13,itfTestPercent:.95,enabled:!0},carbon:{itfPosition:14,itfTestPercent:.95,enabled:void 0},airgrid:{itfPosition:15,itfTestPercent:.95,enabled:void 0},linkedInAdsId:{itfPosition:16,itfTestPercent:.95,enabled:void 0},symitri:{itfPosition:17,itfTestPercent:.95,enabled:void 0},gamera:{itfPosition:18,itfTestPercent:.95,enabled:void 0},optable:{itfPosition:19,itfTestPercent:.95,enabled:void 0}},IDENTITY_CSS_STYLE="\n@import url('https://fonts.googleapis.com/css2?family=Varela+Round&display=swap');\n\n.__fs-modal__overlay {\n    position: absolute;\n    z-index: 10000;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    background-color: rgba(255,255,255,0.75);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n.__fs-modal {\n    font-family: 'Varela Round', sans-serif !important;\n    font-size: 16px;\n    width: 45vw;\n    border-radius: 5px;\n    background-color: white;\n    box-shadow: 0 10px 25px 0 rgb(0 195 137 / 50%);\n    border: 1px solid rgb(0 195 137);\n}\n.__fs-modal__content {\n    margin: 1rem;\n    padding: 1rem;\n    height: calc(100% - 2rem);\n}\n.__fs-modal__header {\n    width: 100%;\n    text-align: left;\n    font-size: 2rem;\n}\nh2.__fs-modal__header {\n    border-bottom: 3px solid rgb(0 195 137);\n    margin-bottom: 1rem;\n}\nh3.__fs-modal__header {\n    font-size: 1.5rem;\n}\n.__fs-modal__description {\n    width: 100%;\n    font-size: 1rem;\n    margin-bottom: .75rem;\n}\n.__fs-modal__content span {\n    width: 100%;\n    font-size: 1.25rem;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n}\n.__fs-modal__content span input,\n.__fs-modal__content span button {\n    width: 100%;\n    font-size: 1.25em;\n    padding: .25rem;\n}\n.__fs-modal__content span button {\n    border: 0;\n    border-radius: 5px;\n    background-color: rgb(0 195 137);\n    color: white;\n    font-family: 'Varela Round', sans-serif !important;\n}\n@media only screen and (min-device-width : 320px) and (max-device-width : 768px) {\n    .__fs-modal {\n         width: 100vw;\n         border-radius: 0;\n         background-color: white;\n         box-shadow: initial;\n         border: 0;\n         position: fixed;\n         top: 0;\n         bottom: 0;\n    }\n}\n",IDENTITY_MODAL_HTML='\n<div class="__fs-modal">\n    <form class="__fs-modal__content">\n        <h2 class="__fs-modal__header">Welcome!</h2>\n        <p class="__fs-modal__description">Our trusted advertising partners using the UID identifier and/or encrypted email addresses  are committed to delivering relevant advertising that also respects your choice.  Advertising enables access to your favorite content across the internet.</p>\n        <h3 class="__fs-modal__header">Opt-Out</h3>\n        <p class="__fs-modal__description">Your choice to Opt-Out will indicate to trusted advertising partners that you no longer wish to receive targeted advertising based on your UID/email.  The scope of this Opt-Out is limited to this site which use UID/email.  For choice with respect to advertising based on cookies, please visit https://optout.aboutads.info.  To opt out of UID across all sites please visit <a href="https://transparentadvertising.org/" target="_blank">https://transparentadvertising.org/</a></p>\n        <p class="__fs-modal__description">Note: this choice may limit your ability to access ad supported content.  You may be asked to Opt-In again in the future to access such content.</p>\n        <span>\n            <button type="submit" id="__fs-model__submit">OPT OUT</button>&nbsp;\n            <button id="__fs-model__cancel">CANCEL</button>\n        </span>\n    </form>\n</div>\n',UID2_PUBLIC_KEY_PARAM="serverPublicKey",UID2_SUBSCRIPTION_ID_PARAM="subscriptionId",UID2_EMAIL_HASH_PARAM="emailHash",UID2_REQUIRED_PARAMS=[UID2_PUBLIC_KEY_PARAM,UID2_SUBSCRIPTION_ID_PARAM],LIVEINTENT_GAM_KEY="fs_liveintent",LIVEINTENT_SLUG="liveIntentId",LIVEINTENT_HIRO_TREATMENT_RATE=.95,CARBON_SLUG_NAME="carbon",DEFAULT_CARBON_PARTNER_ID="4d97a662ad",AIRGRID_SLUG_NAME="airgrid",DEFAULT_AIRGRID_ACC_ID="PV483g",DEFAULT_AIRGRID_PUB_ID="FpZbsa",DEFAULT_AIRGRID_API_KEY="cdeffa51-8532-473f-8ba0-200d751fd73e",DEFAULT_CARBON_ANALYTICS_ENDPOINT="https://pb-ing.ccgateway.net",CARBON_PROVIDER_PARAMS={PARENT_ID:"parentId",ENDPOINT:"endpoint",ANALYTICS_ENDPOINT:"analyticsEndpoint"},HADRON_SLUG_NAME="hadronId",DEFAULT_HADRON_PARTNER_ID=474,SYMITRI_SLUG_NAME="symitri",DEFAULT_SYMITRI_API_HOSTNAME="freestar.dap.symitri.net",DEFAULT_SYMITRI_API_VERSION="x1",DEFAULT_SYMITRI_IDENTITY_TYPE="hashedid",DEFAULT_SYMITRI_SEGTAX=708,DEFAULT_SYMITRI_PIXEL_URL="https://prodfreestarapp.azurewebsites.net/v1/impression",GAMERA_SLUG_NAME="gamera",RTD_ONLY_IDENTITY_PROVIDERS=[AIRGRID_SLUG_NAME,CARBON_SLUG_NAME,SYMITRI_SLUG_NAME,GAMERA_SLUG_NAME],HASHED_EMAIL_PROVIDER_NAMES={FABRICK_ID:"fabrickId",CONNECT_ID:"connectid",ID5_ID:"id5Id",LIVEINTENT_ID:"liveIntentId",UID2:"uid2",IDENTITY_LINK:"identityLink",AMAZON:"amazon"},VALID_SHA1_LENGTH=40,VALID_SHA256_LENGTH=64,VALID_MD5_LENGTH=32,LIVERAMP_IDENTITY_PROVIDER_ID=2,LIVERAMP_DEFAULT_PID=106,OPTABLE_SLUG_NAME="optable",OPTABLE_URL="https://freestar.solutions.cdn.optable.co/public-assets/freestar-sdk.js",IIQ_SLUG_NAME="intentIqId",IIQ_URL="https://a.pub.network/core/intentIQ/20250226/IIQUniversalID.js";class UID2DiiNormalization{static EMAIL_EXTENSION_SYMBOL="+";static EMAIL_DOT=".";static GMAIL_DOMAIN="gmail.com";static normalizeEmail(e){if(!e?.length)return;const t=e.trim().toLowerCase();if(t.includes(" "))return;const i=this.splitEmailIntoAddressAndDomain(t);if(!i)return;const{address:n,domain:s}=i,r=this.isGmail(s),a=this.normalizeAddressPart(n,r,r);return a?`${a}@${s}`:void 0}static bytesToBase64(e){const t=Array.from(e,(e=>String.fromCodePoint(e))).join("");return btoa(t)}static hashUID2(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((function(e){return parseInt(e,16)})));return this.bytesToBase64(new Uint8Array(t))}static splitEmailIntoAddressAndDomain(e){const t=e.split("@");if(2===t.length&&!t.some((e=>""===e)))return{address:t[0],domain:t[1]}}static isGmail(e){return e===this.GMAIL_DOMAIN}static dropExtension(e){return e.split(this.EMAIL_EXTENSION_SYMBOL)[0]}static normalizeAddressPart(e,t,i){let n=e;return t&&(n=replaceAll(n,this.EMAIL_DOT,"")),i&&(n=this.dropExtension(n)),n}}const GAM_TARGETING_KEYS={UUID:"fs_uuid",REFRESH:"fsrefresh",BID:"fsbid",PLACEMENT_NAME:"fs_placementName",REBID:"fsrebid",PRODUCT:"fs_ad_product",FLOORS_ID:"floors_id",FLOORS_HOUR:"floors_hour",ITF:"fsitf"},getHashValueIfValid=(e,t,i)=>e?.length===t?{[i]:e}:{},getValidHashesObject=e=>{const t={...getHashValueIfValid(e?.sha256,VALID_SHA256_LENGTH,"sha256"),...getHashValueIfValid(e?.sha1,VALID_SHA1_LENGTH,"sha1"),...getHashValueIfValid(e?.md5,VALID_MD5_LENGTH,"md5")};return t.sha256||console.warn("Limited support with ID partners due to invalid sha256",e?.sha256),t};class IdentityManager{targeting="----------------------------------------";hashedEmailsPassed=!1;messageSent=!1;prebidNonRealTimeProvidersConfig=null;constructor(e){let{identityConfig:t,hashedEmailProviderManager:i,realtimeProvidersManager:n,logger:s,analytics:r,win:a=window}=e;this._window=a,this._gam=a.googletag,this._identityConfig=t,this._analytics=r,this._logger=s,this._logger.setContext(TOKEN.IDENTITY_MANAGER),this.hashedEmailProviders=i,this.realtimeProviders=n,this._populatePrebidNonRealTimeProvidersConfig(),this._initializeLiveIntentHIRO()}init(){this._logger.log(this._identityConfig.identityProviders?.length?`Eligible providers: ${this._identityConfig.identityProviders.map((e=>e.slug))}`:"No Eligible Providers"),this.hashedEmailProviders.initializeProviders(),this.realtimeProviders.loadHadronScript(),this.realtimeProviders.loadGameraScript(),this._createTargeting(),this._logger.log(`Targeting: ${JSON.stringify(this.targeting)}`),this._setGamTargeting(),this._sendEventMessages(this._identityConfig.providersRules)}_hasIdentitySet(){return!!this._identityConfig.identityData&&!!Object.keys(this._identityConfig.identityData).length}setIdentity(){let{email:e,hashes:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e&&!t)return this._logger.error("Should be called with either email or hashes"),!1;return this._hasIdentitySet()?this._updateProviders(this._identityConfig.identityData):(e&&isValidEmailAddress({email:e})&&this._setIdentityFromEmail(e),t&&this._setIdentityFromHashes(t)),this._sendEventMessages(this._identityConfig.providersRules),!0}_updateProviders(e){this.hashedEmailsPassed||(this.hashedEmailsPassed=!0,this.hashedEmailProviders.updateAllProviders(e,!1))}_setIdentityFromHashes(e){const t=getValidHashesObject(e);if(!Object.keys(t).length)return console.warn("Invalid hashes: ",e),!1;this._identityConfig.setIdentityData(t),this._updateProviders(t)}_setIdentityFromEmail(e){const t=UID2DiiNormalization.normalizeEmail(e),i={sha256:SHA256(t).toString(),sha1:SHA1(t).toString(),md5:MD5(t).toString()};this._identityConfig.setIdentityData(i),this._updateProviders(i)}showModal(){injectCss(IDENTITY_CSS_STYLE);const e=createElement({classList:["__fs-modal__overlay"]});e.innerHTML=IDENTITY_MODAL_HTML,this._window.document.body.appendChild(e);const t=this._window.document.getElementById("__fs-model__submit"),i=this._window.document.getElementById("__fs-model__cancel");t.onclick=async t=>{t.preventDefault(),this._identityConfig.removeIdentityDataFromSessionStorage(),this.hashedEmailProviders.updateAllProviders({},this._identityConfig.testGroup,!1),e.remove(),createCustomEvent({name:"identityModalOptOut",detail:!0})},i.onclick=t=>{t.preventDefault(),e.remove(),createCustomEvent({name:"identityModalClosed",detail:!0})}}get criteoConfig(){const e=this._identityConfig.identityData;return Object.keys(e).length&&this._identityConfig.checkIfProviderEnabled("criteo")?{bidders:["criteo"],config:{ortb2:{user:{ext:{data:{eids:[{source:this._window.location.hostname,uids:[{id:e.md5,atype:3,ext:{stype:"hemmd5"}},{id:e.sha256,atype:3,ext:{stype:"hemsha256"}},{id:e.sha1,atype:3,ext:{stype:"hemsha1"}}]}]}}}}}}:null}addOptOut(e){let{selector:t="#freestarOptOutLink",element:i=!1}=e;if(i=i??document.querySelector(t),!i)return!1;i.onclick=e=>{e.preventDefault(),this.showModal()}}_createTargeting(){if(this._identityTrackingDisabled)return void(this.targeting="0");const e=this._identityConfig.identityProviders.filter((e=>{let{slug:t}=e;return t})).map((e=>{let{slug:t}=e;return t.toLowerCase()}));Object.entries(this._identityConfig.providersRules).forEach((t=>{let[i,n]=t;if(e.includes(i.toLowerCase())&&"boolean"==typeof n.enabled){const e=this.targeting.split("");e[n.itfPosition]=n.enabled?"Y":"N",this.targeting=e.join("")}}))}_setGamTargeting(){if(this._gam.pubads().setTargeting(GAM_TARGETING_KEYS.ITF,this.targeting),"0"===this.targeting)return;const e=PROVIDERS_SETTINGS[LIVEINTENT_SLUG].itfPosition||-1,t=this.targeting.length>0&&this.targeting[e];["Y","N"].includes(t)&&this._gam.pubads().setTargeting(LIVEINTENT_GAM_KEY,t)}get _identityTrackingDisabled(){return!(this._identityConfig.itfY||this._identityConfig.itf_n)&&this._identityConfig.testGroup===TESTING_GROUPS_STATES.ALL_DISABLED}_normalizeStorageConfig(){let config=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{refreshInSeconds:refreshInSeconds,expires:expires}=config??{};try{return{...config,refreshInSeconds:eval(refreshInSeconds),expires:eval(expires)}}catch{return config}}_populatePrebidNonRealTimeProvidersConfig(){if(this._identityTrackingDisabled)return[];this.prebidNonRealTimeProvidersConfig=this._identityConfig.identityProviders.filter((e=>{let{slug:t}=e;return!RTD_ONLY_IDENTITY_PROVIDERS.includes(t)&&this._identityConfig.checkIfProviderEnabled(t)&&this._identityConfig.checkIfProviderIsAllowedInGeo(t)&&OPTABLE_SLUG_NAME!==t&&IIQ_SLUG_NAME!==t})).map((e=>{let{slug:t,params:i,storage:n}=e;const s={name:t,...0!==Object.keys(i||{}).length?{params:i}:{},storage:{...this._normalizeStorageConfig(n)}};switch(t){case"uid2":if(this._identityConfig.identityData?.sha256&&!this.hashedEmailsPassed){this.hashedEmailsPassed=!0;const e=this.hashedEmailProviders.getProviderConfigByName(t,this._identityConfig.identityData);s.params=Object.assign(s.params,e.params)}break;case"merkleId":s.params=Object.assign(s.params,{sv_domain:window.location.hostname});break;case"pairId":if(s.params?.liveramp){const e=getJsonParamSafe("liveramp",s.params);s.params=Object.assign(s.params,{liveramp:e})}break;case"liveIntentId":if(s.params?.requestedAttributesOverrides){const e=getJsonParamSafe("requestedAttributesOverrides",s.params);"object"!=typeof e||Array.isArray(e)||null===e||Object.keys(e).forEach((t=>{e[t]=["nonId","uid2","medianet","magnite","bidswitch","pubmatic","openx","sovrn","index","thetradedesk","triplelift","vidazoo","sonobi","sharethrough"].includes(t)&&"true"===e[t]})),s.params=Object.assign(s.params,{requestedAttributesOverrides:e})}}return s}))}_sendEventMessages(e){let t={};e&&"object"==typeof e&&!Array.isArray(e)&&(t=Object.keys(e).reduce(((t,i)=>(e[i].enabled?t.available.push(i):t.unavailable.push(i),t)),{available:[],unavailable:[]}));const i=t&&(t.available?.length||t.unavailable?.length);!this.messageSent&&this._hasIdentitySet()&&i&&(this._analytics.track(new CustomAnalyticsEvent({eventType:"IDENTITY",eventName:"HASHED_EMAIL_PROVIDERS",data:t})),this.messageSent=!0)}_initializeLiveIntentHIRO(){void 0===this._window.liModuleEnabled&&(this._window.liModuleEnabled=Math.random()<LIVEINTENT_HIRO_TREATMENT_RATE,this._window.liTreatmentRate=LIVEINTENT_HIRO_TREATMENT_RATE)}}ModuleRegistry.class(IdentityManager,{token:TOKEN.IDENTITY_MANAGER,dependencies:[TOKEN.IDENTITY_CONFIG,TOKEN.HASHED_EMAIL_PROVIDERS,TOKEN.REALTIME_PROVIDERS,TOKEN.LOGGER,TOKEN.ANALYTICS,TOKEN.OPTABLE_MANAGER,TOKEN.IIQ_MANAGER,{token:"window",alias:"win"}]});class ATSManager{_atsKey="ats";version=2;atsEnabled=!1;constructor(e){let{dispensaryData:t,logger:i,identityConfig:n,prebidManager:s,win:r=window}=e;this._window=r,this._identityConfig=n,this._dispensaryData=t,this._prebidManager=s,this._instance=null,this._logger=i,this._logger.setContext(TOKEN.ATS_MANAGER),this._init()}_init(){if(!this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.IDENTITY_LINK))return;if(!this._isGeoAllowed)return;this.atsEnabled=this._dispensaryData.fsdata.atsEnabledV2,this.atsEnabled&&this._loadScript();(null!==this._dispensaryData.fsdata.atsAnalyticsEnabled&&void 0!==this._dispensaryData.fsdata.atsAnalyticsEnabled?this._dispensaryData.fsdata.atsAnalyticsEnabled:this._dispensaryData.fsdata.atsEnabledV2)&&this._enablePrebidAnalytics()}get _isGeoAllowed(){const e=this._dispensaryData.locData?.iso;return e?!!this._identityConfig.checkIfProviderIsAllowedInGeo(HASHED_EMAIL_PROVIDER_NAMES.IDENTITY_LINK)||(this._logger.log(`LiveRamp ATS does not run for users in ${e}.`,{level:10}),!1):(this._logger.log("LiveRamp ATS does not run for users "+(e?`in ${e}.`:"without location data."),{level:10}),!1)}getConfigV2(){const e=this._identityConfig.identityData;return e?{id:Object.values(e),type:"emailHashes"}:{}}_enablePrebidAnalytics(){const e=this._identityConfig.identityProviders.find((e=>e.id===LIVERAMP_IDENTITY_PROVIDER_ID)),t=e?.params?.pid??LIVERAMP_DEFAULT_PID;this._prebidManager.instance.enableAnalytics([{provider:"atsAnalytics",options:{pid:t}}])}get _atsURL(){return`https://launchpad-wrapper.privacymanager.io/${this._dispensaryData.fsdata.atsV2ConfigUUID}/launchpad-liveramp.js`}_checkIfAtsIsLoaded(){if(this._window[this._atsKey]?.setAdditionalData)return this._instance=this._window[this._atsKey],this.setConfig(),!0}_loadScript(){load_script$1(this._atsURL,(()=>{if(!this._checkIfAtsIsLoaded()){const e=setInterval((()=>{this._checkIfAtsIsLoaded()&&clearInterval(e)}),10)}}))}setConfig(){const e=this.getConfigV2();0!==Object.keys(e).length&&this._instance?.setAdditionalData(e)}}ModuleRegistry.class(ATSManager,{token:TOKEN.ATS_MANAGER,dependencies:[TOKEN.DISPENSARY_DATA,{token:"window",alias:"win"},TOKEN.LOGGER,TOKEN.IDENTITY_CONFIG,TOKEN.PREBID_MANAGER],factory:async e=>{let{dependencies:t}=e;return await t.prebidManager.ready,new ATSManager({...t})}});class HashedEmailProviderManager{constructor(e){let{identityConfig:t,dispensaryData:i,atsManager:n,prebidManager:s,amazonManager:r,win:a=window}=e;this._prebid=s,this._amazon=r,this._ats=n,this._identityConfig=t,this._dispensaryData=i,this._window=a}getProviderConfigByName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case HASHED_EMAIL_PROVIDER_NAMES.FABRICK_ID:return this._getFabrickConfig(t);case HASHED_EMAIL_PROVIDER_NAMES.CONNECT_ID:return this._getYahooConfig(t);case HASHED_EMAIL_PROVIDER_NAMES.ID5_ID:return this._getID5Config(t);case HASHED_EMAIL_PROVIDER_NAMES.LIVEINTENT_ID:return this._getLiveIntentConfig(t);case HASHED_EMAIL_PROVIDER_NAMES.UID2:return this._getUid2Config(t);default:return{}}}updateAllProviders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this._identityConfig.testGroup&&this._identityConfig.testGroup!==TESTING_GROUPS_STATES.ALL_DISABLED&&(this._hasAmazonNetwork&&this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.AMAZON)&&this._hasSha256(e)&&this._updateAmazon(e,t),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.IDENTITY_LINK)&&this._updateATS(),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.FABRICK_ID)&&this._updatePrebidUserSyncConfig(this._getFabrickConfig(e)),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.CONNECT_ID)&&this._updatePrebidUserSyncConfig(this._getYahooConfig(e)),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.ID5_ID)&&this._updatePrebidUserSyncConfig(this._getID5Config(e)),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.LIVEINTENT_ID)&&this._updatePrebidUserSyncConfig(this._getLiveIntentConfig(e)),this._identityConfig.checkIfProviderEnabled(HASHED_EMAIL_PROVIDER_NAMES.UID2)&&this._updatePrebidUserSyncConfig(this._getUid2Config(e)),this._prebid.instance.refreshUserIds())}initializeProviders(){this._hasSha256(this._identityConfig.identityData)&&this._identityConfig.testGroup!==TESTING_GROUPS_STATES.ALL_DISABLED&&this._hasAmazonNetwork&&this._initializeAmazon(this._identityConfig.identityData)}_hasSha256(e){return void 0!==e?.sha256}get _hasAmazonNetwork(){return this._dispensaryData.fsdata.networks.find((e=>{let{slug:t}=e;return t===HASHED_EMAIL_PROVIDER_NAMES.AMAZON}))}_initializeAmazon(e){this._amazon.ready.then((()=>{this._amazon.instance?.renewId({hashedRecords:[{type:"email",record:e.sha256}]})}))}_getConfigBySlug(e){return this._identityConfig.identityProviders.find((t=>{let{slug:i}=t;return i===e}))}_getFabrickConfig(e){if(this._dispensaryData.locData.iso){const t=this._getConfigBySlug(HASHED_EMAIL_PROVIDER_NAMES.FABRICK_ID);if(this._hasSha256(e)&&t)return{name:HASHED_EMAIL_PROVIDER_NAMES.FABRICK_ID,params:{...t.params,e:e.sha256},storage:t.storage}}return{}}_getYahooConfig(e){const t=this._getConfigBySlug(HASHED_EMAIL_PROVIDER_NAMES.CONNECT_ID);return this._hasSha256(e)&&t?{name:t.slug,params:{...t.params,he:e.sha256},storage:t.storage}:{}}_getID5Config(e){const t=this._getConfigBySlug(HASHED_EMAIL_PROVIDER_NAMES.ID5_ID)?.params?.partner;if(this._hasSha256(e)&&t){const i={1:e.sha256},n=Object.keys(i).map((e=>e+"="+i[e])).join("&"),s=btoa(n);return{name:HASHED_EMAIL_PROVIDER_NAMES.ID5_ID,params:{partner:t,pd:s}}}return{}}_getLiveIntentConfig(e){const t=this._getConfigBySlug(HASHED_EMAIL_PROVIDER_NAMES.LIVEINTENT_ID),i=e?.sha256??e?.sha1??e?.md5;return void 0!==i&&t?{name:HASHED_EMAIL_PROVIDER_NAMES.LIVEINTENT_ID,params:{...t.params,emailHash:i}}:{}}_getUid2Config(e){const t=this._getConfigBySlug(HASHED_EMAIL_PROVIDER_NAMES.UID2);return UID2_REQUIRED_PARAMS.every((e=>!!t?.params[e]))&&this._hasSha256(e)?{name:HASHED_EMAIL_PROVIDER_NAMES.UID2,params:{...t.params,[UID2_EMAIL_HASH_PARAM]:UID2DiiNormalization.hashUID2(e.sha256)},storage:t.storage}:{}}_updatePrebidUserSyncConfig(e){if(0===Object.keys(e).length)return;const t=this._prebid.instance.getConfig("userSync"),i=t.userIds.find((t=>{let{name:i}=t;return i.toLowerCase()===e.name.toLowerCase()}));if(i){const n=t.userIds.filter((t=>{let{name:i}=t;return i.toLowerCase()!==e.name.toLowerCase()}));t.userIds=[...n,{...i,...e}],this._prebid.instance.mergeConfig({userSync:t})}}_updateAmazon(e,t){this._amazon.ready.then((()=>{this._amazon.instance?.updateId({optOut:t,hashedRecords:[{type:"email",record:e.sha256}]})}))}_updateATS(){this._window.addEventListener("pairIdEnvelopePresent",(()=>{this._prebid.instance.refreshUserIds()})),this._window.addEventListener("lrEnvelopePresent",(()=>{this._prebid.instance.refreshUserIds()})),this._ats.setConfig()}}ModuleRegistry.class(HashedEmailProviderManager,{token:TOKEN.HASHED_EMAIL_PROVIDERS,dependencies:[TOKEN.IDENTITY_CONFIG,TOKEN.DISPENSARY_DATA,TOKEN.ATS_MANAGER,TOKEN.PREBID_MANAGER,TOKEN.AMAZON_MANAGER,{token:"window",alias:"win"}],factory:async e=>{let{dependencies:t}=e;return await t.prebidManager.ready,new HashedEmailProviderManager(t)}});class RealtimeProvidersManager{HADRON_NAME="_hadron";HADRON_SRC="https://cdn.hadronid.net/hadron.js";GAMERA_SRC="https://metrics.rapidedge.io/gamera.js?ltv=1&audience=1&tpcs=1&partner=freestar";prebidAnalyticProviders=[];prebidRealTimeDataProviders=[];constructor(e){let{identityConfig:t,dispensaryData:i,logger:n,win:s=window}=e;this._window=s,this._logger=n,this._logger.setContext(TOKEN.REALTIME_PROVIDERS),this._identityConfig=t,this._dispensaryData=i,this._carbonInit(),this._hadronInit(),this._airgridInit(),this._permutiveInit(),this._symitriInit(),this._gameraInit()}_getIdentityProviderConfigBySlug(e){return this._identityConfig.identityProviders.find((t=>t?.slug===e))}_getConfigValue(e,t){if(e.params=e.params||{},!isNil$1(e.params[t])&&""!==e.params[t])return e.params[t]}_getConfigValueOrDefault(e,t,i){return this._getConfigValue(e,t)||i}_getHadronId(e,t){const i=this._getConfigValue(e,"partnerId");return isNil$1(i)||Number.isNaN(i)?t:"number"==typeof i||Number.isNaN(Number(i))?i:Number(i)}loadHadronScript(){const e=this._getIdentityProviderConfigBySlug(HADRON_SLUG_NAME);if(!e||!this._identityConfig.checkIfProviderEnabled(HADRON_SLUG_NAME))return;const t=this._getConfigValueOrDefault(e,"partnerId",DEFAULT_HADRON_PARTNER_ID);!function(e,t,i,n,s,r,a){e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r]({config:{dm:!0}});const o=t.createElement(i);t.async=!0,o.src=n+"?url="+encodeURIComponent(e.location.href)+"&ref="+encodeURIComponent(t.referrer)+"&_it=freestar&partner_id="+s+"&ha="+r;const d=t.getElementsByTagName(i)[0];d.parentNode.insertBefore(o,d)}(window,document,"script",this.HADRON_SRC,t,this.HADRON_NAME)}_carbonInit(){const e=this._getIdentityProviderConfigBySlug(CARBON_SLUG_NAME);if(!e||!this._identityConfig.checkIfProviderEnabled(CARBON_SLUG_NAME)||!this._identityConfig.checkIfProviderIsAllowedInGeo(CARBON_SLUG_NAME))return;const t=this._getConfigValueOrDefault(e,CARBON_PROVIDER_PARAMS.PARENT_ID,DEFAULT_CARBON_PARTNER_ID);if(!t)return;const i=this._getConfigValueOrDefault(e,CARBON_PROVIDER_PARAMS.ANALYTICS_ENDPOINT,DEFAULT_CARBON_ANALYTICS_ENDPOINT);this.prebidAnalyticProviders.push({provider:CARBON_SLUG_NAME,options:{parentId:t,endpoint:i}})}_hadronInit(){const e=this._getIdentityProviderConfigBySlug(HADRON_SLUG_NAME);if(e&&this._identityConfig.checkIfProviderEnabled(HADRON_SLUG_NAME)){const t=this._getHadronId(e,"partnerId")||DEFAULT_HADRON_PARTNER_ID;t&&this.prebidRealTimeDataProviders.push({name:"hadron",waitForIt:!0,params:{partnerId:t}})}}_airgridInit(){const e=this._getIdentityProviderConfigBySlug(AIRGRID_SLUG_NAME);if(e&&this._identityConfig.checkIfProviderEnabled(AIRGRID_SLUG_NAME)){const t=this._getConfigValueOrDefault(e,"accountId",DEFAULT_AIRGRID_ACC_ID),i=this._getConfigValueOrDefault(e,"publisherId",DEFAULT_AIRGRID_PUB_ID),n=this._getConfigValueOrDefault(e,"apiKey",DEFAULT_AIRGRID_API_KEY),s={name:AIRGRID_SLUG_NAME,waitForIt:!0,params:{apiKey:n,accountId:t,publisherId:i}},r=this._getConfigValue(e,"bidders");r&&(s.params.bidders=r.split(",").map((e=>e.trim()))),this.prebidRealTimeDataProviders.push(s)}}_permutiveInit(){this._dispensaryData.fsdata.permutiveEnabled&&this.prebidRealTimeDataProviders.push({name:"permutive",waitForIt:!0,params:{acBidders:[this._dispensaryData.fsdata.permutiveBidders.split(",")]}})}_symitriInit(){const e=this._getIdentityProviderConfigBySlug(SYMITRI_SLUG_NAME);if(!e||!this._identityConfig.checkIfProviderEnabled(SYMITRI_SLUG_NAME)||!this._identityConfig.checkIfProviderIsAllowedInGeo(SYMITRI_SLUG_NAME))return;const t=this._getConfigValueOrDefault(e,"apiHostname",DEFAULT_SYMITRI_API_HOSTNAME),i=this._getConfigValueOrDefault(e,"apiVersion",DEFAULT_SYMITRI_API_VERSION),n=this._getConfigValueOrDefault(e,"segtax",DEFAULT_SYMITRI_SEGTAX),s=this._getConfigValueOrDefault(e,"pixelUrl",DEFAULT_SYMITRI_PIXEL_URL),r=this._identityConfig.identityData,a={name:SYMITRI_SLUG_NAME,waitForIt:!0,params:{apiHostname:t,apiVersion:i,domain:window.freestar.fsdata.domain,segtax:n,pixelUrl:s,...r?.sha256?{identityType:DEFAULT_SYMITRI_IDENTITY_TYPE,identityValue:r.sha256}:{}}};this.prebidRealTimeDataProviders.push(a)}_gameraInit(){if(!this._getIdentityProviderConfigBySlug(GAMERA_SLUG_NAME)||!this._identityConfig.checkIfProviderEnabled(GAMERA_SLUG_NAME)||!this._identityConfig.checkIfProviderIsAllowedInGeo(GAMERA_SLUG_NAME))return;const e={name:GAMERA_SLUG_NAME,waitForIt:!0};this.prebidRealTimeDataProviders.push(e)}loadGameraScript(){if(!this._getIdentityProviderConfigBySlug(GAMERA_SLUG_NAME)||!this._identityConfig.checkIfProviderEnabled(GAMERA_SLUG_NAME)||!this._identityConfig.checkIfProviderIsAllowedInGeo(GAMERA_SLUG_NAME))return;const e=document.createElement("script");e.src=this.GAMERA_SRC,e.type="text/javascript",e.async=!0,e.id="__gamera__",document.body.appendChild(e)}}ModuleRegistry.class(RealtimeProvidersManager,{token:TOKEN.REALTIME_PROVIDERS,dependencies:[TOKEN.IDENTITY_CONFIG,TOKEN.DISPENSARY_DATA,TOKEN.LOGGER,{token:"window",alias:"win"}]});class IdentityConfig{providersRules=[];constructor(e){let{dispensaryData:t,logger:i}=e;this._dispensaryData=t,this._logger=i,this._logger.setContext(TOKEN.IDENTITY_CONFIG),this.itfY=getUrlParameter("itf_y"),this.itf_n=getUrlParameter("itf_n"),this.identityData=this.identityDataFromSessionStorage,this._populateIdentityTestGroup(),this._populateProviderRules()}get identityProviders(){return this._dispensaryData.fsdata.identityProviders||[]}get identityDataFromSessionStorage(){return sessionStorageGet({key:IDENTITY_DATA_KEY,type:SESSION_STORAGE_TYPES.object.type})}setIdentityData(e){this.identityData=e,sessionStorageSet({key:IDENTITY_DATA_KEY,value:e,type:SESSION_STORAGE_TYPES.object})}removeIdentityDataFromSessionStorage(){this.identityDataFromSessionStorage&&(sessionStorageRemove({key:IDENTITY_DATA_KEY}),this.identityData=null)}checkIfProviderEnabled(e){return!this.providersRules[e]||!1!==this.providersRules[e]?.enabled}checkIfProviderIsAllowedInGeo(e){const t=this._dispensaryData?.locData?.iso;if(!t)return!1;const i=this.identityProviders.find((t=>{let{slug:i}=t;return i===e}));if(!i)return!1;const{disallowedGeos:n,allowedGeos:s}=i;return n?.length?!n.includes(t):!s?.length||s.includes(t)}_itfTestLambda(e,t){return Math.random()<=t.itfTestPercent}_populateProviderRules(){try{this.providersRules=JSON.parse(atob(sessionStorageGet({key:ITF_PROVIDERS_KEY,type:SESSION_STORAGE_TYPES.string.type})))}catch(e){this.providersRules=this._getProvidersRulesByTestGroup()}this._updateProvidersRulesByUrlParams()}_getProvidersRulesByTestGroup(){let e={};return this.testGroup===TESTING_GROUPS_STATES.TEST_PARTNERS&&(e=this._getDefaultProviderRules(this._itfTestLambda.bind(this))),this.testGroup===TESTING_GROUPS_STATES.ALL_DISABLED&&(e=this._getDefaultProviderRules(!1)),sessionStorageSet({key:ITF_PROVIDERS_KEY,value:btoa(JSON.stringify(e)),type:SESSION_STORAGE_TYPES.string.type}),e}_getDefaultProviderRules(e){const t={};return Object.entries(PROVIDERS_SETTINGS).forEach((i=>{let[n,s]=i;const r="function"==typeof e?e(n,s):e;t[n]=Object.assign({},s,{enabled:r})})),t}_populateIdentityTestGroup(){let e=sessionStorageGet({key:ITF_GROUP_KEY,type:SESSION_STORAGE_TYPES.string.type});e||(e=Math.random()<=.99?TESTING_GROUPS_STATES.TEST_PARTNERS:TESTING_GROUPS_STATES.ALL_DISABLED),sessionStorageSet({key:ITF_GROUP_KEY,value:e,type:SESSION_STORAGE_TYPES.string.type}),this.testGroup=e}_updateProvidersRulesByUrlParams(){if(this.itfY&&this._logger.log(`itf_y parameter found: ${this.itfY}`),this.itf_n&&this._logger.log(`itf_n parameter found: ${this.itf_n}`),this.itfY||this.itf_n){const e=this.itfY?this.itfY.split(","):[],t=this.itf_n?this.itf_n.split(","):[];this._logger.log(`Provider Rules before update: ${this.providersRules}`),this.providersRules=Object.keys(this.providersRules).reduce(((i,n)=>(e.includes(n)?(this._logger.log(`Enabling identity provider: ${n}`),i[n]={...this.providersRules[n],enabled:!0}):t.includes(n)&&(this._logger.log(`Disabling identity provider: ${n}`),i[n]={...this.providersRules[n],enabled:!1}),i)),this.providersRules),this._logger.log(`Provider Rules after update: ${this.providersRules}`)}}}ModuleRegistry.class(IdentityConfig,{token:TOKEN.IDENTITY_CONFIG,dependencies:[TOKEN.DISPENSARY_DATA,TOKEN.LOGGER]});class OptableManager{version=1;constructor(e){let{dispensaryData:t,logger:i,identityConfig:n,win:s=window}=e;this._window=s,this._identityConfig=n,this._dispensaryData=t,this._logger=i,this._logger.setContext(TOKEN.OPTABLE_MANAGER),this._init()}_init(){const e=this._getSlug();this._identityConfig.checkIfProviderEnabled(OPTABLE_SLUG_NAME)&&this._isGeoAllowed&&e&&this._loadScript(e)}get _isGeoAllowed(){const e=this._dispensaryData.locData?.iso,t="Optable does not run for users";return e?!!this._identityConfig.checkIfProviderIsAllowedInGeo(OPTABLE_SLUG_NAME)||(this._logger.log(`${t} in ${e}.`,{level:10}),!1):(this._logger.log(`${t} without location data.`,{level:10}),!1)}_getSlug(){try{const e=this._dispensaryData.fsdata.domain.split(".");let t=e.slice(-2);const i=["co.uk","org.uk","gov.uk","com.au","net.au"],n=e.slice(-2).join("."),s=e.slice(-3).join(".");i.includes(n)?t=e.slice(-3):i.includes(s)&&(t=e.slice(-4));let r=t.join("-");return r=r.replace(/_/g,"-"),/^\d/.test(r)&&(r=`s-${r}`),r}catch(e){return null}}_loadScript(e){window.optable=window.optable||{cmd:[]},window.optable.site=e,load_script$1(OPTABLE_URL,this._checkStorage)}_checkStorage(){try{const e=localStorage.getItem("OPTABLE_RESOLVED");if(e){const t=JSON.parse(e);t&&"object"==typeof t&&fsprebid.que.push((()=>{fsprebid.mergeConfig(t)}))}}catch(e){console.error("Error parsing OPTABLE_RESOLVED from localStorage:",e)}}}ModuleRegistry.class(OptableManager,{token:TOKEN.OPTABLE_MANAGER,dependencies:[TOKEN.DISPENSARY_DATA,{token:"window",alias:"win"},TOKEN.LOGGER,TOKEN.IDENTITY_CONFIG,TOKEN.PREBID_MANAGER]});class IntentIqManager{version=1;constructor(e){let{dispensaryData:t,identityConfig:i,prebidManager:n,win:s=window}=e;this._window=s,this._identityConfig=i,this._dispensaryData=t,this._prebidManager=n,this._iiq=null,this._init()}_init(){this._identityConfig.checkIfProviderEnabled(IIQ_SLUG_NAME)&&this._isGeoAllowed&&this._loadScript()}get _isGeoAllowed(){const e=this._dispensaryData.locData?.iso;return!!e&&this._identityConfig.checkIfProviderIsAllowedInGeo(IIQ_SLUG_NAME)}_iiqPrebidOperations(){this._prebidManager.instance.onEvent("bidWon",(e=>{if(null!=this._iiq){const t={biddingPlatformId:1,bidderCode:e?.bidder,prebidAuctionId:e?.auctionId,cpm:e?.cpm,currency:e?.currency,originalCpm:e?.originalCpm,originalCurrency:e?.originalCurrency,status:e?.status,placementId:e?.adUnitCode};this._iiq.reportExternalWin(t)}}))}_iiqGAMKVPSetting(){const e="intent_iq_group";try{googletag.cmd.push((()=>{googletag.pubads().setTargeting(e,this._iiq.intentIqConfig.abTesting.currentTestGroup||"U")}))}catch(t){googletag.cmd.push((function(){googletag.pubads().setTargeting(e,"N")}))}}_iiqGAMPPIDSetting(){const e=(e=>{try{const t=e.eids;for(let e=0;e<t.length;e++){const i=t[e];if("intentiq.com"===i.source){const e=i.uids;for(let t=0;t<e.length;t++){const i=e[t];if("ppuid"===i.ext.stype)return i.id}}}return null}catch(e){return null}})(this._iiq.getIntentIqData());null!=e&&googletag.pubads().setPublisherProvidedId(e)}_iiqGAMOperations(){null!=this._iiq&&(this._iiqGAMKVPSetting(),this._iiqGAMPPIDSetting())}_loadScript(){load_script$1(IIQ_URL,(()=>{this._iiq=new IntentIqObject({partner:1434517136,pbjs:this._prebidManager.instance,callback:()=>{createCustomEvent({name:"iiqInit",detail:!0})},timeoutInMillis:400,ABTestingConfigurationSource:"IIQServer",allowGDPR:!1,manualWinReportEnabled:!0,domainName:this._dispensaryData.domainName,vrBrowserBlackList:["chrome"]}),this._iiqPrebidOperations(),this._iiqGAMOperations()}))}}ModuleRegistry.class(IntentIqManager,{token:TOKEN.IIQ_MANAGER,dependencies:[TOKEN.DISPENSARY_DATA,TOKEN.IDENTITY_CONFIG,TOKEN.PREBID_MANAGER],factory:async e=>{let{dependencies:t}=e;return await t.prebidManager.ready,new IntentIqManager(t)}});class EventBus{_events;constructor(){this._events={}}subscribe(e,t){this._events[e]||(this._events[e]=[]),this._events[e].push(t)}unsubscribe(e,t){this._events[e]&&(this._events[e]=this._events[e].filter((e=>e!==t)))}emit(e,t){this._events[e]&&this._events[e].forEach((i=>i({eventName:e,payload:t})))}hasSubscribers(e){return Boolean(this._events[e]?.length)}}ModuleRegistry.class(EventBus,{token:TOKEN.EVENT_BUS,defaultAlias:"eventBus"});const STICKY_FOOTER_RESIZE="STICKY_FOOTER_RESIZE",NATIVE_RENDER_ENDED="NATIVE_RENDER_ENDED",BEFORE_NATIVE_RENDER="BEFORE_NATIVE_RENDER",BOTS=[{owner:"google",ua:"googlebot"},{owner:"google",ua:"mediapartners-google"},{owner:"google",ua:"adsbot-google"},{owner:"bing",ua:"bingbot"},{owner:"yahoo",ua:"slurp"},{owner:"duckduckgo",ua:"duckduckbot"},{owner:"baidu",ua:"baiduspider"},{owner:"yandex",ua:"yandexbot"},{owner:"exabot",ua:"konqueror/3.5"},{owner:"exabot",ua:"Exabot/3.0"},{owner:"facebook",ua:"facebot"},{owner:"facebook",ua:"facebookexternalhit/1.0"},{owner:"facebook",ua:"facebookexternalhit/1.1"},{owner:"alexa",ua:"ia_archiver"}];class BotTraffic{constructor(e){let{win:t,analytics:i}=e;this._win=t,this._analytics=i,this._isDetected=!1}get isDetected(){return this._isDetected}checkForBot(){const e=this._win.navigator?.userAgent||navigator.userAgent,t="fs.bot.found",i=getCookie({name:t});i&&!0===Boolean(i)?this._handleBotDetected(t,e):e&&!i&&(BOTS.forEach((i=>{RegExp(i.ua.toLowerCase()).test(e.toLowerCase())&&this._handleBotDetected(t,e)})),setCookie({name:t,value:!1}))}_handleBotDetected(e,t){throw this._isDetected=!0,this._trackEvent(),setCookie({botCookieName:e,value:!0}),`pubfig code disabled as the user agent ${t} is a bot`}_trackEvent(){this._analytics.track(new CustomAnalyticsEvent({eventName:"BOT_DETECTED",eventType:"botDetected",data:{detected:!0}}))}}ModuleRegistry.class(BotTraffic,{token:"BotTraffic",dependencies:[TOKEN.ANALYTICS,{token:"window",alias:"win"}]});const getCurrentStickyFooterHeight=()=>{const e=getCurrentStickyFooterElement();return e?.offsetHeight||0},getCurrentStickyFooterElement=()=>(freestar?.currentStickyFooter?.footer||freestar?.currentStickyFooter||{}).slotWrapper,BIDDERS_WITH_AD_SIZE_ISSUES=["kargo","teads","seedtag"],isValidAdSize=e=>{if("banner"===e.mediaType){const t=fsprebid.adUnits.find((t=>{let{code:i}=t;return i===e.adUnitCode})),i=t?.sizes?.some((t=>{let[i=0,n=0]=t;return i===e.width&&n===e.height}));if(!i)return freestar.log(10,`Invalid bid size for ad unit: ${e.adUnitCode}`),!1}const t=unaliasBidder(e.bidderCode);if(!BIDDERS_WITH_AD_SIZE_ISSUES.some((e=>unaliasBidder(e)===t)))return!0;const{width:i,height:n,ad:s}=e;if(!s||!i||!n)return!0;const r=String(s).toLowerCase().includes(`${i}x${n}`);return r||freestar.log(10,`Invalid ad size for ${e.bidderCode} bid: ${i}x${n}`),r},waitForIframe=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return new Promise(((i,n)=>{e&&"complete"!==e.contentWindow?.document?.readyState?(e.addEventListener("load",(()=>{Number(e?.width)<=1?n(new Error("Iframe width is less than or equal to 1")):i()}),{once:!0}),setTimeout((()=>{i()}),t)):i()}))};class Auction{constructor(e){let{type:t,prebidAuctionId:i=null}=e;this.fsAuctionId=generateUUID(),this.type=t,this.prebidAuctionId=i,this.adUnits=new Set,this.reportedPlacements=new Set,this.timestamp=Date.now()}addAdUnit(e){this.adUnits.add(e)}getAdUnits(){return Array.from(this.adUnits)}isAuctionEndReported(e){return this.reportedPlacements.has(e)}}const adSenseSiteParams={"scribd-com":{clientId:"ca-pub-1211639399720391",sizes:{"300x100":6475080870,"300x250":7125817567,"300x50":1716797968,"320x100":9052362509,"320x50":4499654227,"336x280":4367012037,"468x60":5113117491,"728x90":7843222610,"970x250":5105378639,"970x90":6338569255}}},getAdSenseSiteParams=()=>freestar?.config?.adsense||adSenseSiteParams[getCurrentSitePath()];class AdSenseManager{constructor(){this.params=!1,this.init()}init(){this.params=getAdSenseSiteParams()}render(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!getAdSenseSiteParams())return;this.params||(this.params=getAdSenseSiteParams()),window.adsbygoogle||(load_script$1("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"),window.adsbygoogle=[]);const t=adUnitManager.getAdUnitByPrebidCode(e),{placement:i}=t,n=Object.keys(this.params.sizes),s=getLargestPossibleDimensions$1({placement:i,sizesAllowed:n});document.getElementById(e).innerHTML=`<ins class="adsbygoogle"\n            style="display:block; width:${s[0]}px; height:${s[1]}px;"\n            data-ad-client="${this.params.clientId}"\n            data-ad-slot="${this.params.sizes[s.join("x")]}"\n        ></ins>`,window.adsbygoogle.push({})}}const adSenseManager=new AdSenseManager,AUCTION_TYPE={PREBID:"PREBID",PREBID_GAM:"PREBID-GAM",GAM:"GAM"};class AuctionManager{constructor(e){let{adUnitManager:t,analytics:i,prebidManager:n,gamManager:s,idealAdStackManager:r,rebidManager:a,dispensaryData:o,logger:d,nativeRenderManager:l}=e;this._adUnitManager=t,this._idealAdStackManager=r,this._analytics=i,this._prebidManager=n,this._gamManager=s,this._rebidManager=a,this._dispensaryData=o,this._nativeRenderManager=l,this._logger=d,this._logger.setContext(TOKEN.AUCTION_MANAGER),this.auctions=new Map,this._bindPrebidEvents(),this._bindGamEvents(),this._listeners={auctionInit:[]}}addEventListener(e,t){if(!this._listeners[e])throw new Error(`Invalid event type: ${e}`);this._listeners[e].includes(t)||this._listeners[e].push(t)}removeEventListener(e,t){this._listeners[e]=this._listeners[e].filter((e=>e!==t))}_bindGamEvents(){this._gamManager.instance.pubads().addEventListener(GAM_SLOT_REQUESTED,this._handleSlotRequested.bind(this)),this._gamManager.instance.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,this._handleSlotRenderEnded.bind(this))}_bindPrebidEvents(){this._prebidManager.instance.onEvent(PREBID_AUCTION_INIT,this._handleAuctionInit.bind(this)),this._prebidManager.instance.onEvent(PREBID_AUCTION_END,this._handleAuctionEnd.bind(this))}_createAuction(e){const t=new Auction({type:e,prebidAuctionId:arguments.length>1&&void 0!==arguments[1]?arguments[1]:null});return this.auctions.set(t.fsAuctionId,t),t}_handleAuctionInit(e){const{adUnits:t,auctionId:i}=e,n=this._idealAdStackManager.isGAMEnabled()?AUCTION_TYPE.PREBID_GAM:AUCTION_TYPE.PREBID,s=this._createAuction(n,i),r=s.fsAuctionId;t.forEach((e=>{const{code:t}=e,a=this._adUnitManager.getAdUnitByPrebidCode(t);a&&(a.saveState({fsAuctionId:r,auctionType:n,prebidAuctionId:i}),s.addAdUnit(a),this._trackAuctionStart(a,r,n,i))})),this._listeners.auctionInit.forEach((e=>e(s)))}_handleAuctionEnd(e){var t=this;const{auctionId:i}=e,n=this.getAuctionByPrebidAuctionId(i);n&&n.adUnits.forEach((s=>{const r=function(r){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t._trackAuctionEnd(s,n.fsAuctionId,r,e,i,a,!1)};if(n.type===AUCTION_TYPE.PREBID){const e=this._nativeRenderManager.getHighestBid(s.prebid.code);e?this._nativeRenderManager.renderAd(e,s.prebid.code).then((()=>{r(AUCTION_TYPE.PREBID,!0)})):getAdSenseSiteParams()&&s.isDisplayAd()?adSenseManager.render(s.prebid.code):r(AUCTION_TYPE.PREBID)}else s.slot||r(AUCTION_TYPE.PREBID_GAM)}))}_handleSlotRequested(e){const{slot:t}=e,i=this._adUnitManager.getAdUnitBySlotElementId(t.getSlotElementId());if(i){const e=t.getTargeting("fs-auuid")[0],n=this.getAuctionByFsAuctionId(e);if(n?.type===AUCTION_TYPE.PREBID_GAM||n?.type===AUCTION_TYPE.PREBID)return;const s=this._createAuction(AUCTION_TYPE.GAM);i.saveState({fsAuctionId:s.fsAuctionId,auctionType:AUCTION_TYPE.GAM}),this._trackAuctionStart(i,s.fsAuctionId,AUCTION_TYPE.GAM)}}_handleSlotRenderEnded(e){var t=this;const{slot:i}=e,n=i.getSlotElementId(),s=this._adUnitManager.getAdUnitBySlotElementId(n);if(!s)return;const r=i?.getTargeting("fs-auuid")[0],a=this.getAuctionByFsAuctionId(r);if(!a)return;const o=function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t._trackAuctionEnd(s,r,a.type,e,a.prebidAuctionId,i,i)};if(getUrlParameter("fs-force-rebid"))return this._rebidEmptySlot(e,n),o(),void this._logger.log("When in 'fs-force-rebid' mode, ads will not be rendered natively");if(!e.isEmpty)return o(),void this._rebidManager.resetRebidStatus(n);if(getAdSenseSiteParams()&&s.isDisplayAd())return void adSenseManager.render(n);const d=this._nativeRenderManager.getHighestBid(n);d?this._nativeRenderManager.renderAd(d,n).then((()=>{o(!0)})).catch((e=>{this._logger.log(`Error native rendering prebid ad: ${e}`)})):(this._rebidEmptySlot(e,n),o())}_rebidEmptySlot(e,t){!this._dispensaryData.fsdata.secondAuctionDisabled&&this._idealAdStackManager.isRebidAllowed()&&this._rebidManager.handleNoBidScenario(e,t)}_trackAuctionStart(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s={...this._buildBaseAuctionPayload(e,t,i,n),fsAuctionId:t};this._analytics.track(new AuctionStartAnalyticsEvent(s))}_trackAuctionEnd(e,t,i,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;const o=this.getAuctionByFsAuctionId(t);if(o&&!o.reportedPlacements.has(e.placement.name)){const d=this._buildAuctionEndPayload(e,t,i,n,s,r,a);this._analytics.track(new AuctionEndAnalyticsEvent(d)),o.reportedPlacements.add(e.placement.name)}}_buildAuctionEndPayload(e,t,i,n,s,r,a){return{...this._buildBaseAuctionPayload(e,t,i,s),...this._extractAuctionEndData(n),...this._calculateAuctionStatusFields(t,i,n,r,a),fsAuctionId:t,winningBid:e.getWinningBid(),isS2SDisabled:this._idealAdStackManager.isS2SDisabled()}}_buildBaseAuctionPayload(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{placementId:e.placement.name,DfpId:e.slot?.getAdUnitPath(),fsAuctionId:t,auctionId:n,auctionType:i,location:freestar.locData??{},userIds:this._prebidManager.instance.getConfig().userSync.userIds.map((e=>e.name)),kvps:e.getKVPs()}}_extractAuctionEndData(e){return{...e,size:JSON.stringify(e.size)}}_calculateAuctionStatusFields(e,t,i,n,s){let r,a;return t===AUCTION_TYPE.PREBID?(r=!0,a=!n):(r=!1,a=i.isEmpty&&!n&&!s),{isNativeRender:n,isGamBypass:r,unfilled:a}}getAuctionByFsAuctionId(e){return this.auctions.get(e)||null}getAuctionByPrebidAuctionId(e){return Array.from(this.auctions.values()).find((t=>t.prebidAuctionId===e))||null}}ModuleRegistry.class(AuctionManager,{token:TOKEN.AUCTION_MANAGER,dependencies:[TOKEN.ANALYTICS,TOKEN.FREESTAR,TOKEN.PREBID_MANAGER,TOKEN.GAM_MANAGER,TOKEN.DISPENSARY_DATA,TOKEN.LOGGER,TOKEN.NATIVE_RENDER_MANAGER],factory:async e=>{let{dependencies:t}=e;return await t.prebidManager.ready,await t.gamManager.ready,new AuctionManager({...t,idealAdStackManager:idealAdStackManager(),adUnitManager:adUnitManager,rebidManager:rebidManager})}});class NativeRender{constructor(e){let{prebidManager:t,adUnitManager:i,logger:n,eventBus:s,ancillary:r}=e;this._prebidManager=t,this._adUnitManager=i,this._ancillary=r,this._eventBus=s,this._logger=n,this._logger.setContext(TOKEN.NATIVE_RENDER_MANAGER)}getHighestBid(e){const t=this._prebidManager.instance.getBidResponsesForAdUnitCode(e);if(t.bids&&t.bids.length>0){const e=t.bids.filter((e=>"rendered"!==e.status&&isValidAdSize(e)));if(e.length>0)return e.sort(((e,t)=>t.cpm-e.cpm)),e[0]}return null}getAdUnit(e){return this._adUnitManager.getAdUnitBySlotElementId(e)}_sendEvents(e,t,i){this._eventBus.emit(NATIVE_RENDER_ENDED,{elementId:t,bid:i})}async renderAd(e,t){const i=document.getElementById(t);if("none"===i.style.display)return;const n=this.getAdUnit(t);if(!n)return void console.warn(`[nativeRender-renderAd] AdUnit not found for elementId: ${t}`);if(n.renderMap.has(e.adId))return;n.renderMap.set(e.adId,!0),await this.clearExistingAd(t);const s=this.createAdElement(e);i.appendChild(s),this.executeRenderAd(e.adId),this._ancillary.create({id:t,placement:n.placement,container:s}),this._sendEvents(n,t,e)}clearExistingAd(e){return new Promise((t=>{this._ancillary.hide(e),clearExistingAd(e),this._eventBus.emit(BEFORE_NATIVE_RENDER,{elementId:e}),t()}))}createAdElement(e){return createElement({id:NATIVE_RENDER_IFRAME_CONTAINER,children:[createElement({type:"iframe",id:`_fs-ad-${e.adId||e.amzniid}`,attributes:[{width:e.width||"100%",height:e.height||"100%",frameBorder:"0",marginHeight:"0",marginWidth:"0",scrolling:"no"}]})]})}executeRenderAd(e){this._prebidManager.instance.renderAd(document.querySelector(`#_fs-ad-${e}`).contentWindow.document,e),this._logger.log(`rendered #_fs-ad-${e} natively`)}}ModuleRegistry.class(NativeRender,{token:TOKEN.NATIVE_RENDER_MANAGER,dependencies:[TOKEN.PREBID_MANAGER,TOKEN.LOGGER,TOKEN.EVENT_BUS,TOKEN.ANCILLARY],factory:async e=>{let{dependencies:t}=e;return await t.prebidManager.ready,new NativeRender({...t,adUnitManager:adUnitManager})}});class Confiant{prebidNameSpace="fsprebid";constructor(e){let{window:t,freestar:i,dispensaryData:n,logger:s,analytics:r,prebidManager:a,rebidManager:o}=e;this._win=t,this._freestar=i,this._dispensaryData=n,this._logger=s,this._logger.setContext("Confiant"),this._logger.setLevel(50),this._analytics=r,this._rebidManager=o,this._prebidManager=a}async init(){await this._loadScript(),this._logger.log("Confiant module initialized")}async _loadScript(){const{adQualityOptions:e}=this._dispensaryData.fsdata||{};if(e&&"CONFIANT"===e.vendor&&(e.desktopEnabled||e.mobileEnabled)){const t=e.vendorId;this._buildBasicConfiantObject(),await loadScriptAsync(`https://cdn.confiant-integrations.net/${t}/gpt_and_prebid/config.js`),this._logger.log("Inserted Confiant script"),this._subscribe()}}_buildBasicConfiantObject(){this._win.confiant=this._win.confiant||{},this._win.confiant.prebidNameSpace=this.prebidNameSpace,this._win.confiant.callback=(e,t,i,n,s,r)=>{this._win.postMessage({message:"CONFIANT_CALLBACK",isBlocked:i,impressionData:r})}}_sendMessage(e){let{args:t}=e;this._analytics.track(new AdBlockedEvent(t))}_subscribe(){this._win.addEventListener("message",this._handleEvent.bind(this))}_handleEvent=e=>{const{data:t}=e;if("CONFIANT_CALLBACK"===t.message&&1===t.isBlocked){const e=t.impressionData||{},i=e.prebid?.s||e.dfp?.s;if(!i)return void this._logger.log("domId not found in impressionData");e.prebid?this._prebidBlockProcess(e):this._dfpBlockProcess({domId:i}),this._rebidBlockedAd({domId:i})}};_prebidBlockProcess(e){const{adId:t}=e.prebid,i=this._win.fsprebid.getAllWinningBids().find((e=>e.adId===t));if(i){const e=Object.keys(i).reduce(((e,t)=>("adserverTargeting"!==t&&"ad"!==t&&(e[t]=i[t]),e)),{}),t=merge({blockingType:"prebid",isBlocked:!0,bidCpm:e.cpm},e);this._sendMessage({args:t}),this._prebidBlockExcludeBidderSet({bidResponse:i})}}_prebidBlockExcludeBidderSet(e){let{bidResponse:t}=e;const i=sessionStorageGet(prebidExcludeConfig);i.includes(t.bidder)||i.push(t.bidder),sessionStorageSet({key:PREBID_EXCLUDE_CONFIG_KEY,value:i,type:SESSION_STORAGE_TYPES.array}),this._removeBidder(t)}_removeBidder(e){let{bidder:t}=e;this._prebidManager.instance.adUnits.forEach((e=>{e.bids=e.bids.filter((e=>unaliasBidder(e.bidder)!==unaliasBidder(t)))}))}_dfpBlockProcess(e){let{domId:t}=e;const i={blockingType:"dfp",isBlocked:!0,adUnitCode:t};this._sendMessage({args:i})}_rebidBlockedAd(e){let{domId:t}=e;this._rebidManager.track({elementId:t}),this._rebidManager.isAbleToRebid({elementId:t})?(this._logger.log(`Rebid for blocked ad on ${t}`),this._freestar?.freestarReloadAdSlot?.(t)):this._logger.log(`Rebid attempt maximum reached for ${t}. There will not be another attempt to fill`)}reportSingleAd(e){try{this._win.confiant.services().reportSingleAd(e)}catch(e){alert("Unable to report the ad: "+e.toString())}}}ModuleRegistry.class(Confiant,{token:TOKEN.CONFIANT,defaultAlias:"confiant",dependencies:[TOKEN.WINDOW,TOKEN.FREESTAR,TOKEN.DISPENSARY_DATA,TOKEN.LOGGER,TOKEN.ANALYTICS,TOKEN.PREBID_MANAGER],factory:async e=>{let{dependencies:t}=e;await t.prebidManager.ready;return new Confiant({...t,rebidManager:rebidManager})}});const DEFAULT_OPTIONS={sampleInterval:6e4,maxSnapshots:180,warningThresholdMb:200,criticalThresholdMb:500,minLeakThreshold:512e3},formatBytes=e=>{const t=["B","KB","MB","GB"];let i=e,n=0;for(;i>=1024&&n<t.length-1;)i/=1024,n++;return`${i.toFixed(2)} ${t[n]}`};class MemoryMonitor{constructor(e){this._logger=e.logger,this._logger.setContext(TOKEN.MEMORY_MONITOR),this._analytics=e.analytics,this._deviceInfo=e.deviceInfo,this._geoInfo=e.geoInfo;const t=!!sessionStorageGet({key:TEST_ID_KEY}),i=window.performance&&window.performance.memory,n=t||Math.random()<=.05;if(!i||!n)return this.enabled=!1,void(this.intervalId=null);this.enabled=!0,this.snapshots=[],this.intervalId=null,this.options={...DEFAULT_OPTIONS}}start(){this.enabled&&(this._takeSnapshot(),this.intervalId||(this.intervalId=setInterval((()=>this._takeSnapshot()),this.options.sampleInterval)))}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}_getDisplayedAdsCount(){return(Object.keys(window?.freestar?.refreshLibrary||{}).length||0)+AdRefresher.getGlobalRefreshCount()}_getMemoryUsage(){const{usedJSHeapSize:e=0,totalJSHeapSize:t=0,jsHeapSizeLimit:i=0}=window.performance&&window.performance.memory||{};return{usedJSHeapSize:e,totalJSHeapSize:t,jsHeapSizeLimit:i}}_takeSnapshot(){const e=this._getMemoryUsage(),t=Date.now();if(this.snapshots.length>0){const i=this.snapshots[this.snapshots.length-1],n=(t-i.timestamp)/1e3,s=e.usedJSHeapSize-i.usedJSHeapSize,r=s/n/1048576,a=60*r;this._trackGrowthRate({currentUsage:e.usedJSHeapSize,previousUsage:i.usedJSHeapSize,memoryDiff:s,growthRatePerSecond:r,growthRatePerMinute:a,timeDiffSeconds:n})}this.snapshots.push({timestamp:t,...e}),this.snapshots.length>this.options.maxSnapshots&&this.snapshots.shift(),e.usedJSHeapSize>1024*this.options.criticalThresholdMb*1024?this._handleCriticalMemory(e):e.usedJSHeapSize>1024*this.options.warningThresholdMb*1024&&this._handleWarningMemory(e)}_trackGrowthRate(e){let{currentUsage:t,previousUsage:i,memoryDiff:n,growthRatePerSecond:s,growthRatePerMinute:r,timeDiffSeconds:a}=e;const o=this._formatDeviceInfo(),d=this._getDisplayedAdsCount(),l=new CustomAnalyticsEvent({eventName:"MEMORY_MONITOR",eventType:"GROWTH_RATE",data:{currentUsage:t,previousUsage:i,memoryDiff:n,growthRatePerSecond:s.toFixed(2),growthRatePerMinute:r.toFixed(2),timeDiffSeconds:a,currentUsageFormatted:formatBytes(t),deviceInfo:o,timestamp:Date.now(),adsCount:d}});this._analytics.track(l)}_detectMemoryLeak(){if(this.snapshots.length<3)return null;const e=this.snapshots.slice(-3),t=[];for(let i=1;i<e.length;i++){const n=e[i-1],s=e[i],r=(s.timestamp-n.timestamp)/1e3,a=(s.usedJSHeapSize-n.usedJSHeapSize)/r;t.push(a)}return t.every((e=>e>this.options.minLeakThreshold))?{averageGrowthRate:t.reduce(((e,t)=>e+t),0)/t.length,lastSnapshot:this.snapshots[this.snapshots.length-1]}:null}getReport(){if(0===this.snapshots.length)return null;const e=this.snapshots[this.snapshots.length-1],t=this.snapshots[0],i=e.usedJSHeapSize-t.usedJSHeapSize,n=(e.timestamp-t.timestamp)/1e3;return{currentUsage:formatBytes(e.usedJSHeapSize),totalGrowth:formatBytes(i),growthRate:formatBytes(i/n)+"/s",snapshots:this.snapshots,potentialLeak:this._detectMemoryLeak()}}_handleWarningMemory(e){this._logger.log(`Memory usage warning: ${formatBytes(e.usedJSHeapSize)}`)}_handleCriticalMemory(e){this._logger.log(`Critical memory usage: ${formatBytes(e.usedJSHeapSize)}`);const t=this._formatDeviceInfo(),i=this._getDisplayedAdsCount();this._analytics.track(new CustomAnalyticsEvent({eventName:"MEMORY_MONITOR",eventType:"CRITICAL",data:{usedJSHeapSize:e.usedJSHeapSize,totalJSHeapSize:e.totalJSHeapSize,jsHeapSizeLimit:e.jsHeapSizeLimit,formattedUsed:formatBytes(e.usedJSHeapSize),deviceInfo:t,timestamp:Date.now(),adsCount:i}}))}_formatDeviceInfo(){const e=this._geoInfo?.iso;return{browser:{name:this._deviceInfo.browser?.name,version:this._deviceInfo.browser?.version},device:{type:this._deviceInfo.device?.type,os:this._deviceInfo.os?.name,osVersion:this._deviceInfo.os?.version},engine:{name:this._deviceInfo.engine?.name,version:this._deviceInfo.engine?.version},geo:{country:e}}}}ModuleRegistry.class(MemoryMonitor,{token:TOKEN.MEMORY_MONITOR,defaultAlias:"memoryMonitor",dependencies:[TOKEN.LOGGER,TOKEN.FREESTAR,TOKEN.ANALYTICS,TOKEN.DEVICE_INFO,TOKEN.GEO_INFO],factory:e=>{let{dependencies:t}=e;return new MemoryMonitor(t)}});class Component{getElement(){throw new Error("Method not implemented.")}destroy(){}get enabled(){return!0}}const ENABLE_BRANDING_PARAM="fsbranding";class BrandingLink extends Component{constructor(e){let{placement:t,dispensaryData:i,win:n=window}=e;super(),this._win=n,this._placement=t,this._dispensaryData=i}get enabled(){const e=this.getLogoUrl(this._placement);return Boolean(e)}getElement(){return this.enabled?createElement({type:"a",style:{color:"#999"},attributes:{href:this.getLink(this._placement),target:"_blank",rel:"noreferrer"},textContent:"Freestar.com"},this._win.document):null}getLogoUrl(){const e=getUrlParameter(ENABLE_BRANDING_PARAM,this._win);if(this._placement?.freestarBrandingDisabled&&!e)return null;const{branding:t}=this._dispensaryData.fsdata;let i=getBrandingLogoUrl(t);return e&&(i=getBrandingLogoUrl(BRANDING.GREEN)),this._placement?.stickyFooterOptions?.active?i:[BRANDING.GREEN_FOOTER_ONLY,BRANDING.GRAYSCALE_FOOTER_ONLY].includes(t)?null:i}getLink(e){const t=getSlotProduct(e);return`https://ads.${FREESTAR_LOCATION_HOST}/?${new URLSearchParams({utm_campaign:"branding",utm_medium:t,utm_source:this._dispensaryData.fsdata.domain,utm_content:e.name}).toString()}`}}class BrandingIcon extends BrandingLink{getElement(){const e=this.getLogoUrl(this._placement);return e?createElement({type:"div",classList:["__fs-branding"],children:[createElement({type:"a",attributes:{href:this.getLink(this._placement),target:"_blank",rel:"noreferrer"},children:[createElement({type:"img",src:e,attributes:{alt:"freestar",width:"14",height:"14"}},this._win.document)]},this._win.document)]},this._win.document):null}}class FreestarBranding{constructor(e){let{dispensaryData:t,win:i}=e;this._dispensaryData=t,this._win=i}createLink(e){return new BrandingLink(this._getParams(e))}createIcon(e){return new BrandingIcon(this._getParams(e))}getGlobalBranding(){const{branding:e}=this._dispensaryData.fsdata;return!e||[BRANDING.NO_BRANDING,BRANDING.GRAYSCALE_FOOTER_ONLY,BRANDING.GREEN_FOOTER_ONLY].includes(e)?null:e}_getParams(e){return{placement:e,dispensaryData:this._dispensaryData,win:this._win}}}ModuleRegistry.class(FreestarBranding,{token:TOKEN.BRANDING,dependencies:[TOKEN.DISPENSARY_DATA,{token:TOKEN.WINDOW,alias:"win"}]});const REPORT_AD_TEXT="Report This Ad",ENABLE_REPORT_AD_PARAM="fsreportad";class ReportAdComponent extends Component{constructor(e){let{id:t,placement:i,confiantReportThisAdEnabled:n,idealAdStackManager:s,confiant:r,win:a=window}=e;super(),this.placement=i,this._confiantReportThisAdEnabled=n,this._confiant=r,this._id=t,this._win=a,this._idealAdStackManager=s,this._abortController=new AbortController,this._createElement()}getElement(){return this._element}destroy(){this._abortController.abort(),this._element?.remove(),this._element=null}_createElement(){throw new Error("Method not implemented.")}get enabled(){if(getUrlParameter(ENABLE_REPORT_AD_PARAM,this._win))return!0;if(this.placement?.adQualityOptions?.disabled)return!1;return!("CONFIANT"!==fetchAdQualityVendor()||!this._confiantReportThisAdEnabled||!this._idealAdStackManager.allowConfiant())}_report=e=>{e.preventDefault(),e.stopPropagation(),this._confiant.reportSingleAd(this._id)}}class ReportAdTextButton extends ReportAdComponent{_createElement(){this.enabled&&(this._element=createElement({type:"button",classList:["fs-report-ad-button"],attributes:{"aria-label":REPORT_AD_TEXT},innerHTML:REPORT_AD_TEXT},this._win.document),this._element.addEventListener("click",this._report,{signal:this._abortController.signal}))}}class ReportAdIconButton extends ReportAdComponent{_createElement(){if(!this.enabled)return null;const e=createElement({type:"button",classList:["fs-report-ad-button-icon"],attributes:{"aria-label":REPORT_AD_TEXT}},this._win.document);e.addEventListener("click",this._report,{signal:this._abortController.signal}),this._element=createElement({children:[e]},this._win.document)}}class ReportAd{constructor(e){let{confiant:t,dispensaryData:i,win:n,idealAdStackManager:s}=e;this._confiant=t,this._win=n,this._idealAdStackManager=s,this._confiantReportThisAdEnabled=i.fsdata?.adQualityOptions?.confiantReportThisAdEnabled}createTextButton(e,t){return new ReportAdTextButton(this._getParams(e,t))}createIconButton(e,t){return new ReportAdIconButton(this._getParams(e,t))}_getParams(e,t){return{id:e,placement:t,confiant:this._confiant,confiantReportThisAdEnabled:this._confiantReportThisAdEnabled,win:this._win,idealAdStackManager:this._idealAdStackManager}}}ModuleRegistry.class(ReportAd,{token:TOKEN.REPORT_AD,dependencies:[TOKEN.CONFIANT,TOKEN.DISPENSARY_DATA,TOKEN.IDEAL_AD_STACK_MANAGER,{token:TOKEN.WINDOW,alias:"win"}]});class Spacer extends Component{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;super(),this._win=e}getElement(){return createElement({classList:["fs-branding-spacer"]},this._win.document)}}class AncillarySlot{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._element=null,this._components=e}getElement(){return this._element}hide(){this._element&&(this._element.style.visibility="hidden")}show(){this._element&&(this._element.style.visibility="visible")}destroy(){this._components.forEach((e=>e.destroy())),this._element?.remove(),this._element=null,this._components=[]}}class AncillarySlotInline extends AncillarySlot{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]);const t=this._components.flatMap((e=>e?.enabled?e:[]));t.length&&!t.every((e=>e instanceof Spacer))&&(this._element=createElement({classList:["__fs-ancillary"],style:{visibility:"hidden"},children:t.map((e=>e.getElement()))},e.document))}}class Ancillary{constructor(e){let{freestar:t,gamManager:i,branding:n,reportAd:s,win:r}=e;this._freestar=t,this._gamManager=i,this._branding=n,this._reportAd=s,this._win=r,this._items=new Map,this._handleSlotEvents()}_handleSlotEvents(){this._gamManager.instance.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(e=>{const t=e.slot.getSlotElementId(),i=this._win.document.getElementById(t),n=i?.querySelector(`#${CSS.escape(t)} > div[id*="google_ads_iframe_"]`);this.create({id:t,placement:getPlacementByName({name:dynamicGet({slotId:t})}),container:n})})),this._gamManager.instance.pubads().addEventListener(GAM_SLOT_REQUESTED,(e=>{const t=e.slot.getSlotElementId();this.hide(t)}))}create(e){let{id:t,placement:i,container:n}=e;if([t,i,n,this.isEnabled({id:t,placement:i})].some((e=>!e)))return;const s=this._items.get(t);let r=n.querySelector("__fs-ancillary");if(s&&r)return void s.show();s?.hide(),s?.destroy(),r?.remove();const a=this._branding?.createIcon(i),o=this._reportAd?.createTextButton(t,i),d=new AncillarySlotInline([a,new Spacer(this._win),o],this._win);if(r=d.getElement(),!r)return;this._items.set(t,d),n.appendChild(r);const[l]=n.getElementsByTagName("iframe")||[];l&&waitForIframe(l).then((()=>{d.show()}))}get(e){return this._items.get(e)||null}show(e){const t=this._items.get(e);t&&t.show()}hide(e){const t=this._items.get(e);t&&t.hide()}isEnabled(e){let{id:t,placement:i}=e;if(i&&(isGoogleInterstitialPlacement(i)||isOnlyOneByOnePlacement(i.sizes||[])))return!1;if(t){const e=this._win.document.getElementById(t);return"false"!==e?.getAttribute(ANCILLARY_CONTROL_KEY)}return!0}}ModuleRegistry.class(Ancillary,{token:TOKEN.ANCILLARY,dependencies:[TOKEN.GAM_MANAGER,TOKEN.BRANDING,TOKEN.REPORT_AD,{token:TOKEN.WINDOW,alias:"win"}],factory:async e=>{let{dependencies:t}=e;return await t.gamManager.ready,new Ancillary(t)}}),ModuleRegistry.object({token:TOKEN.CONFIG_MANAGER,dependencies:[TOKEN.FREESTAR],defaultAlias:"config",factory:e=>{let{dependencies:t}=e;const i=t.freestar?.configManager??{};return delete t.freestar?.configManager,i}}),ModuleRegistry.object({token:TOKEN.DISPENSARY_DATA,defaultAlias:"dispensaryData",dependencies:[TOKEN.FREESTAR],factory:e=>{let{dependencies:t}=e;const{freestar:i}=t,n=i.dispensaryData||{};return delete i.dispensaryData,n}});const LOG_INFO$2={title:"IDEAL AD STACK v3.0"};window.freestar=window.freestar||{};class IdealAdStack{constructor(){this.active=!0,this.config=null,this.configByRtt=null,this.refreshCallback=()=>this.refreshData(),this.refreshingInProgress=!0,this.logs=new Logger$1,this.init(),this.asyncInit(),this.debugOrTestSession=null,this.allowedBothBidders=null,this.s2sBidders=null}init(){let e,t,i;const n=requestHandler().get({requestId:"getIdealData"});if(n)({config:e,source:t,errors:i}=this.parseRequestHandlerResult(n));else{const n=sessionStorageGetWithExpiry({key:IDEAL_AD_STACK_SESSION_STORAGE_NAME});n?(e=n,i=[],t=DATA_SOURCE_SESSION_STORAGE):(e={},i=["data not yet available"],t=DATA_SOURCE_NETWORK_REQUEST)}this.logs.add(`Got config from ${t}`),i.length>0&&(this.sendErrorMessage(i),this.logs.add("Config invalid!",JSON.stringify(e))),this.setConfig(e),this.setKVPs(),this.logs.show(LOG_INFO$2)}setConfig(e){this.config=e,this.setConfigByRtt()}sendErrorMessage(e){AppContainer.instance.resolve(TOKEN.ANALYTICS).then((t=>{t.track(new CustomAnalyticsEvent({eventName:"DYNAMIC_AUCTION_TIMEOUT_TEST",eventType:"ERRORS",data:{errors:e.join(", ")}}))}))}sessionStoreConfig(e){let{config:t}=e;const i=t?.floors,n=!floorsHardOffSite({siteId:freestar.fsdata.siteId}),s=t?.testGroup;n&&(!i&&"experiment"!==s||i?.error)?sessionStorageSet15Min({key:IDEAL_AD_STACK_SESSION_STORAGE_NAME,value:t}):n&&0===i?.length?sessionStorageSet5Min({key:IDEAL_AD_STACK_SESSION_STORAGE_NAME,value:t}):sessionStorageSetHour({key:IDEAL_AD_STACK_SESSION_STORAGE_NAME,value:t})}async asyncInit(){const e=await requestHandler().fetch({requestId:"getIdealData",fetchFn:getIdealAdstackConfig}),{config:t,source:i,errors:n}=this.parseRequestHandlerResult(e);i===DATA_SOURCE_NETWORK_REQUEST&&0===n.length&&this.sessionStoreConfig({config:t}),t.knownUser||this.bindEvents(),this.refreshingInProgress=!1}async refreshData(){if(this.refreshingInProgress)return;this.refreshingInProgress=!0;const e=await requestHandler().fetch({requestId:"getIdealData",fetchFn:getIdealAdstackConfig});if(!this.parseRequestHandlerResult(e).config.knownUser&&userState.isKnown){requestHandler().clearClassCachedData({requestId:"getIdealData"});const e=await requestHandler().fetch({requestId:"getIdealData",fetchFn:getIdealAdstackConfigFromNetworkRequest}),{config:t,source:i,errors:n}=this.parseRequestHandlerResult(e);i===DATA_SOURCE_NETWORK_REQUEST&&0===n.length&&(this.sessionStoreConfig({config:t}),window.freestar.queue.push((()=>{window.fsprebid.offEvent(PREBID_AUCTION_END,this.refreshCallback)})))}this.refreshingInProgress=!1}bindEvents(){window.freestar&&window.freestar.queue&&window.freestar.queue.push((()=>{window.fsprebid.onEvent(PREBID_AUCTION_END,this.refreshCallback)}))}parseRequestHandlerResult(e){let t,i,n;const{data:s,error:r}=e;return r?(t={},n=[r.toString()]):(({data:t,source:i}=s),n=i===DATA_SOURCE_NETWORK_REQUEST?this.getErrors(t):[]),{config:t,source:i,errors:n}}getConfigByRtt(){return this.configByRtt}setConfigByRtt(){if(this.configByRtt=this.config,null==this.config.roundTripTime)return;const e=Number(this.config.roundTripTime);if(Number.isNaN(e))return;const t=this.config?.clientServerRTT?.find((t=>{const[i,n]=t.rttRange;return e>=i&&e<n}));t&&(this.configByRtt=t.config)}getAllowedBothBidderOverrides(e){let{clientServer:t={}}=e;const i=[],n=this.getAllowedBothBidders();return Object.entries(t).forEach((e=>{let[t,s]=e;s!==BidderTypes.BOTH||n.includes(t)||i.push(t)})),i}getConfig(){const e={...this.getConfigByRtt()};e.clientServer||(e.clientServer={}),e.clientServer={...this.applyTestSessionOverride(e.clientServer)};const t=this.getAllowedBothBidderOverrides({clientServer:e.clientServer});return t.length>0&&(delete e.clientServerMask,t.forEach((t=>{delete e.clientServer[t]}))),e}getAllowedBothBidders(){return this.allowedBothBidders||(this.allowedBothBidders=this._buildAllowedBothBidders()),this.allowedBothBidders}_buildAllowedBothBidders(){return(freestar.fsdata?.networks||[]).filter((e=>e.allowConcurrent&&(!e.distinctParamsRequired||e.sizes.some((e=>e.serverParams))))).map((e=>e.slug))}applyTestSessionOverride(e){if(!this.isDebugOrTestSession())return e;const t={...e};return Object.keys(t).forEach((e=>{const i=window?.freestar?.fsdata?.networks?.find((t=>t.slug===e))||null;if(i){"off"!==t[e]&&(i.isClient?t[e]=BidderTypes.CLIENT:i.isPrebidServer?t[e]=BidderTypes.SERVER:i.isClientAndServer&&(t[e]=BidderTypes.BOTH))}})),t}getServerToServerDetails(){if(!this.active)return{};let{testGroup:e}=this.config,{clientServerMask:t}=this.getConfig();return{clientServerMask:t,testGroup:e}}getDynamicAuctionTimeoutDetails(){const{maxTimeout:e=window.freestar.fsdata.timeout,roundTripTime:t=null}=this.config;return{maxTimeout:e,roundTripTime:t}}getMaxAuctionTimeout(){const{maxTimeout:e}=this.getDynamicAuctionTimeoutDetails();return e}setGlobalTimeout(){const e=this.getMaxAuctionTimeout()||3e3;window.freestar.fsdata.timeout=e,window.freestar.fsdata.mobileTimeout=e}setKVPs(){const{roundTripTime:e=null}=this.getDynamicAuctionTimeoutDetails(),{clientServerMask:t=null,testGroup:i=null}=this.getServerToServerDetails();freestar.queue.push((()=>{googletag.pubads().setTargeting("floors_user",String(userState.isKnown)),e&&googletag.pubads().setTargeting("floors_rtt",`${e}`),this.isDebugOrTestSession()||(t&&googletag.pubads().setTargeting("fs_clientservermask",t),i&&googletag.pubads().setTargeting("fs_testgroup",`${i}`))})),this.logs.add(`fs_clientservermask: ${t}\nfs_testgroup: ${i}\nfloors_user: ${userState.isKnown}\nfloors_rtt: ${e}`)}getErrors(e){const t=[];return 0===Object.keys(e).length?t.push("no params"):void 0===e.maxTimeout&&t.push("no maxTimeout"),t}async getFloorsData(){const e=await requestHandler().fetch({requestId:"getIdealData",fetchFn:getIdealAdstackConfig}),{config:t}=this.parseRequestHandlerResult(e);return t&&t.floors}getBypassFirstAuction(){const e=this.getConfig();return"off"===e?.preGAMAuction}getFeatureConfig(){return this.config&&this.config.features||{}}allowBrowsi(){return"off"!==this.getFeatureConfig().browsi}allowConfiant(){return"off"!==this.getFeatureConfig().confiant}allowBlockthrough(){return"off"!==this.getFeatureConfig().blockthrough}isRebidAllowed(){return"off"!==this.getFeatureConfig().rebid}isGAMEnabled(){return"off"!==this.getFeatureConfig().gam}getS2sBidders(e){return this.s2sBidders||(this.s2sBidders=this._buildS2sBidders(e)),this.s2sBidders}_buildS2sBidders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Fsxs2s;const t=new Set;window.freestar.fsdata.networks.forEach((function(e){e.isPrebidServer&&t.add(e.slug)})),window.freestar.fsdata.placements.forEach((function(e){e.networks.forEach((function(e){e.isPrebidServer&&t.add(e.slug)}))}));const{clientServer:i}=this.getConfig();return Object.entries(i).forEach((e=>{let[i,n]=e;"off"===n||n===BidderTypes.CLIENT?t.delete(i):n!==BidderTypes.SERVER&&n!==BidderTypes.BOTH||t.add(i)})),!t.size&&e&&e.hasValidStoredRequests()&&t.add(e.getSlug()),Array.from(t)}isS2SDisabled(){return 0===this.getS2sBidders().length}allowRefresh(){return"off"!==this.getFeatureConfig().refresh}determineAdRefreshBehavior(){const e=!!window.freestar?.fsdata?.adRefreshDisabled,t=!this.isGAMEnabled()&&this.isS2SDisabled(),i=this.allowRefresh();return{isRefreshAllowed:!e&&(t||i)}}_getDebugOrTestSession(){const e=getUrlParameter(QUERY_STRING_KEYS.fsdebug),t=getUrlParameter(QUERY_STRING_KEYS.fsaltconfig),i=window.freestar?.fsdata?.networks?.some((e=>void 0!==e.isClient||void 0!==e.isPrebidServer));if(e||t)return i;const n=sessionStorageGet({key:PUBFIG_CONFIG_SESSION_KEY,type:SESSION_STORAGE_TYPES.object.type})?.pubfigSettings?.abtest?.testType,s=sessionStorageGet({key:TEST_TYPE_KEY,type:SESSION_STORAGE_TYPES.string.type});return(null!=n||null!=s)&&(![n,s].some((e=>"PUBFIG_TEMPLATE"===e))&&i)}isDebugOrTestSession(){return null===this.debugOrTestSession&&(this.debugOrTestSession=this._getDebugOrTestSession()),this.debugOrTestSession}}const idealAdStackManager=ClassInit.getInstanceFn({ClassConstructor:IdealAdStack,instanceName:"idealAdstackManager"});class MaxBidTracker{constructor(){this.slotMaxBids={},this.slotToPlacement={},this.placementToSlots={}}initiateWatcher(e){e.que.push((()=>{e.onEvent(PREBID_BID_RESPONSE,this.handleBidResponse.bind(this))}))}handleBidResponse(e){this.addSlotPlacementAssociation(e.adUnitCode),this.addBidResponse(e)}addSlotPlacementAssociation(e){if(e&&!this.slotToPlacement[e]){const t=dynamicGet({slotId:e});t&&(this.slotToPlacement[e]=t,this.placementToSlots[t]||(this.placementToSlots[t]=[]),this.placementToSlots[t].push(e))}}addBidResponse(e){const{adUnitCode:t,cpm:i}=e;t&&i&&(!this.slotMaxBids[t]||this.slotMaxBids[t]<i)&&(this.slotMaxBids[t]=i)}getSlotMaxBid(e){return MaxBidTracker.validateMaxBid(this.slotMaxBids[e])}getPlacementMaxBidBySlot(e){const t=this.slotToPlacement[e];return this.getPlacementMaxBid(t)}getPlacementMaxBid(e){const t=this.placementToSlots[e]||[];return MaxBidTracker.validateMaxBid(Math.max(...t.map((e=>this.getSlotMaxBid(e)))))}static validateMaxBid(e){return!Number.isNaN(e)&&null!=e&&e>0?e:null}}let instance$1=null;function getMaxBidTracker(){return null==instance$1&&(instance$1=new MaxBidTracker),instance$1}async function getFloorsData(e){let{deviceVendor:t,deviceType:i,refreshNumber:n,placement:s,maxBid:r,isFloorsActive:a}=e;const o=getDomain(),d="Apple"===t?"smartphone-ios":i,l=userState.isKnown,c=s&&null!=r?`&mb=${r}&au=${encodeURIComponent(s)}`:"",u=freestar.locData?freestar.locData.iso:"",h=fetch(`${FLOOR_API_LOCATION}?${`d=${o}&t=${d}&k=${l}&r=${n}${c}&c=${u}`}`,{headers:{"x-api-key":FLOOR_API_KEY,"x-lm":a?"0":"1"}}),f=await h;if(!f.ok)throw new Error(`Request failed with status ${f.status}`);return f.json()}class FloorsManager{constructor(e,t){this.idealAdStackManager=e,this.maxBidTracker=t,this.initialData=null,this.requests=[],this.maxBidRequests={},this.failedRequestCount=0,this.throttleRequests=!1,this.throttleExpiry=0}async getInitialFloorsData(){if(floorsHardOffSite({siteId:freestar.fsdata.siteId}))return this.initialData={timestamp:new Date,floors:[]};const{timestamp:e,floors:t}=this.getRequest(0);return this.initialData?await t:this.initialData={timestamp:e,floors:await t},this.initialData}getRequest(e,t,i){if(this.shouldThrottleRequests()){const n=t&&null!=i?`, placement ${t}, maxBid ${i}`:"";return freestar.log({level:20,title:"Floors"},`Floors throttled: fetch skipped for refresh ${e}${n}`),{timestamp:new Date,floors:Promise.resolve([])}}return t&&null!=i?(this.maxBidRequests[t.name]||(this.maxBidRequests[t.name]=[null]),this.maxBidRequests[t.name][e]||(this.maxBidRequests[t.name][e]={}),this.maxBidRequests[t.name][e][i]||(this.maxBidRequests[t.name][e][i]={timestamp:new Date,floors:this.fetchData(e,t.dfpId,i)}),this.maxBidRequests[t.name][e][i]):(this.requests[e]||(this.requests[e]={timestamp:new Date,floors:this.fetchData(e)}),this.requests[e])}reportError(e){freestar.log({level:40,title:"Floors"},"Floors error",e),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((t=>{t.track(new CustomAnalyticsEvent({eventName:"FLOORS_ERROR",eventType:"FETCH_RESPONSE",data:{message:e}}))}))}async fetchInitialData(){const e=await this.idealAdStackManager().getFloorsData();if(e)return!e.error&&e.length>0?e:(e?.error&&e?.message&&this.reportError(e.message),this.startThrottle(),[]);const{data:t,error:i}=await requestHandler().fetch({requestId:"getFloorsData",fetchFn:()=>getFloorsData({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:0,isFloorsActive:window.freestar?.fsdata?.isTriple13Enabled})});if(i)this.reportError(i.toString());else{if(t&&!t.error&&t.length>0)return t;t?.error&&t?.message&&this.reportError(t.message)}return this.startThrottle(),[]}static MAX_FAILED_REQUESTS=2;static FAILED_REQUEST_TIMEOUT=9e5;countRequestFailed(){this.failedRequestCount+=1,this.failedRequestCount>=FloorsManager.MAX_FAILED_REQUESTS&&this.startThrottle()}startThrottle(){this.throttleRequests=!0,this.throttleExpiry=Date.now()+FloorsManager.FAILED_REQUEST_TIMEOUT}countRequestSucceeded(){this.failedRequestCount=0,this.throttleRequests=!1}shouldThrottleRequests(){return this.throttleRequests&&Date.now()>this.throttleExpiry?(this.startThrottle(),!1):this.throttleRequests}async fetchData(e,t,i){if(0===e)return await this.fetchInitialData();let n,s;try{n=await getFloorsData({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:e,placement:t,maxBid:i,isFloorsActive:window.freestar?.fsdata?.isTriple13Enabled})}catch(e){s=e}if(s)this.reportError(s.toString());else{if(n&&!n.error&&n.length>0)return this.countRequestSucceeded(),n;n?.error&&n?.message&&this.reportError(n.message)}return this.countRequestFailed(),[]}getFloor(e,t,i){const n=t.find((e=>i.dfpId===e.adUnit)),s=n?n.upr:"timeout",r=n?new Date(n.lastUpdated):e;return{floors_id:s,floors_hour:String(r.getUTCHours())}}getInitialFloorKVP(e){let{placement:t,keyMap:i}=e;return i||(i={}),Object.assign(i,this.getFloor(this.initialData.timestamp,this.initialData.floors,t))}async getFloorsData(e){let t,i,{placement:n,slotId:s,callback:r,isRebid:a=!1}=e;if(floorsHardOffPlacement({siteId:freestar.fsdata.siteId,placement:n}))return t=null,i="inactive",void r({result:t,reason:i});const o=(getTimesRefreshed(s)||0)+(a?1:0);let d,l;if(0===o||a)({timestamp:d,floors:l}=this.getRequest(o));else{const e=this.maxBidTracker.getSlotMaxBid(s),t=FloorsManager.formatMaxBid(e);({timestamp:d,floors:l}=this.getRequest(o,n,t))}t=this.getFloor(d,await l,n),i=null,r&&r({result:t,reason:i})}prefetchFloorsData(e){let{placement:t,slotId:i,timesRefreshed:n}=e;const s=this.maxBidTracker.getSlotMaxBid(i),r=FloorsManager.formatMaxBid(s);this.getRequest(n,t,r)}static formatMaxBid(e){if(null!=e){const t=e.toString();if(t){if(t.includes("e-"))return"0";if(t.includes("e"))return e.toPrecision(3);const i=e.toString().match(/^-?\d*(?:\.\d{0,2})?/);if(i){let e=i[0];for(;e.includes(".")&&(e.endsWith("0")||e.endsWith("."));)e=e.slice(0,-1);return e}}}return null}}const floorsManager=ClassInit.getInstanceFn({ClassConstructor:FloorsManager,instanceName:"floorsManager",params:[idealAdStackManager,getMaxBidTracker()]});function isNetworkAllowedByDeviceType(e){let{freestar:t=window.freestar,network:i}=e;return!i.deviceExclusive||i.deviceExclusive.toLowerCase()===t.deviceInfo.device.type}function bidderSetup(e,t){if("indexExchange".indexOf(t.bidder)>-1&&t.params&&t.params.id&&t.params.id<0&&(t.dynamicId=!0),"conversant"===t.bidder){t.params.secure=freestar.isHttps;for(const e in t.params)switch(e){case"bidfloor":case"position":case"maxduration":t.params[e]=Number(t.params[e])}}if("cox"===t.bidder&&(t.params.id=Number(t.params.id),t.params.siteId=Number(t.params.siteId)),"justpremium"===t.bidder&&t.params&&(t.params.allow=just_premium_params(t.params.allow),t.params.exclude=just_premium_params(t.params.exclude),void 0===t.params.allow||null!==t.params.allow&&0!==t.params.allow.length||delete t.params.allow,void 0===t.params.exclude||null!==t.params.exclude&&0!==t.params.exclude.length||delete t.params.exclude),"pulsepoint"===t.bidder)for(const e in t.params)"cf"==e&&(t.params[e]=t.params[e].replace("X","x"));if("connectad"===t.bidder)for(let e in t.params)"siteId"!==e&&"networkId"!==e||(t.params[e]=Number(t.params[e]));if("grid"===t.bidder&&t.params&&t.params.uid&&(t.params.uid=Number(t.params.uid)),"beachfront"===t.bidder)for(var i in t.params)"video"!=i&&"banner"!=i||(t.params[i]="object"==typeof t.params[i]?t.params[i]:JSON.parse(t.params[i]));if("undertone"===t.bidder&&(t.params.publisherId=Number(t.params.publisherId),t.params.placementId=Number(t.params.placementId)),"zid"===t.bidder&&(t.params.adUnitID=toNumber(t.params.adUnitID)),"mantis"===t.bidder&&(t.params.zone=e.name),"districtmDMX"===t.bidder&&(t.params.dmxid=Number(t.params.dmxid),t.params.memberid=Number(t.params.memberid)),"answermedia"===t.bidder&&(t.params.siteId=toNumber(t.params.siteId),t.params.networkId=toNumber(t.params.networkId),t.params.zoneIds&&isString(t.params.zoneIds)&&t.params.zoneIds.split(",").length>0?t.params.zoneIds=t.params.zoneIds.split(",").map((function(e){return toNumber(e)})):t.params.zoneIds=[]),"consumable"===t.bidder&&(t.params.siteId=toNumber(t.params.siteId),t.params.networkId=toNumber(t.params.networkId),t.params.unitId=toNumber(t.params.unitId)),["appnexus","appnexusAst","brealtime","pagescience","defymedia","gourmetads","matomy","featureforward","oftmedia"].indexOf(t.bidder)>-1)for(const e in t.params)"placementId"==e&&(t.params[e]=Number(t.params[e])),["allowSmallerSizes","member","invCode"].indexOf(e)>-1&&delete t.params[e];if(["defymedia","zid"].indexOf(t.bidder)>-1)return!1;"sortable"===t.bidder&&(t.params.tagId=e.name);return!(!0===e.stickyFooter&&["sharethrough","triplelift"].indexOf(t.bidder)>-1)&&("criteo"===t.bidder&&(t.params.zoneId=Number(t.params.zoneId)),"taboola"===t.bidder&&(t.params.tagId=e.name),index(t))}function isGeoAllowed(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1===t)return!0;let{allowedGeos:i=[],disallowedGeos:n=[]}=e;const{iso:s}=t,r=freestar.networkMap[e.id];return r&&(r.allowedGeos&&r.allowedGeos.length&&(i=r.allowedGeos),r.disallowedGeos&&r.disallowedGeos.length&&(n=r.disallowedGeos)),!(i&&i.length&&-1===i.indexOf(s)||n&&n.length&&-1!==n.indexOf(s))||(freestar.log(1,`Users in ${freestar.locData.iso} are not allowed to use ${e.slug}!`),!1)}function isNetworkActive(e){let{network:t}=e;if(!1===freestar.networkMap||0===Object.keys(freestar.networkMap).length)return!0;const i=freestar.networkMap[t.id];return!i||isPageSpeedOptimized()&&-1!==NETWORKS_TO_BLOCK_IF_PAGE_SPEED_OPTIMIZED.indexOf(t.slug)?(freestar.log(1,"isNetworkActive - Page Speed Optimized in effect, or network is inactive filtering out",t.slug),!1):!i||!isBoolean(i.active)||i.active}function format_pbjs_bidder(e){return contains_size(e.size,[0,0])&&delete e.size,e}function fsBrowserWidth(){return window.innerWidth&&document.documentElement.clientWidth?Math.min(window.innerWidth,document.documentElement.clientWidth):window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth}function supports_size(e,t){if(t.length>0&&Array.isArray(t[0])){let i=t.length;if(0===t[0][0]&&0===t[0][1])return!0;for(;i--;)if(supports_size(e,t[i]))return!0}let i=e.length;for(;i--;)if(e[i][0]===t[0]&&e[i][1]===t[1])return!0;return!1}function contains_size(e,t){let i=e.length;for(;i--;)if(e[i][0]===t[0]&&e[i][1]===t[1])return!0;return!1}function getPlacements(){return freestar.fsdata.placements}function isValidAd(e){return!(!e.validAdSizes||!e.bidders||0===e.bidders.length||e.stickyFooter||e.dynamicAd)&&nameExists(e)}function nameExists(e){return void 0===freestar.config||void 0===freestar.config.enabled_slots||contains(freestar.config.enabled_slots,e.name)}function contains(e,t){for(let i=0;i<e.length;i++)if(e[i].placementName===t){if("complete"!==document.readyState)return!0;if(window.document.getElementById(t))return!0}return!1}function just_premium_params(e){if(!e)return null;let t=null;try{t=JSON.parse(e)}catch(e){t=null}return null!==t&&t.length>0?t:null}function isNetworkAllowed(e){let{network:t,adQualityBlockList:i}=e;return isGeoAllowed(t,window.freestar.locData)&&isNetworkActive({network:t})&&isNetworkAllowedViaAdQuality({network:t,adQualityBlockList:i})&&isNetworkAllowedByDeviceType({network:t})}async function buildPlacements(){const e=fetchAdQualityBlockList();function t(e,t){"ix"===unaliasBidder(e.bidder)?t.sizes.forEach((i=>{const n={bidder:e.bidder,params:{siteId:e.params.siteId,size:i}};t.bidders.push(n)})):e&&t.bidders.push(e)}function i(e,i,n){const{clientServer:s}=idealAdStackManager().getConfig();let r=s[e.slug];if("off"===r)return;r||(r=e.isPrebidServer?"server":"client");const a=freestar.fsdata.networks.find((t=>t.slug===e.slug));if("both"===r)[{bidderName:aliasBidder(e.slug),params:i.params},{bidderName:e.slug,params:i.serverParams}].forEach((s=>{let{bidderName:r,params:a}=s;if(a){const s={bidder:e.slug,size:i.size,params:a},o=bidderSetup(n,format_pbjs_bidder(s));o&&t({...o,bidder:r},n)}}));else{let s=i.params;if((a?.distinctParamsRequired||e.distinctParamsRequired)&&"server"===r){if(!i.serverParams)return;s=i.serverParams}const o={bidder:e.slug,size:i.size,params:s},d=bidderSetup(n,format_pbjs_bidder(o));d&&t(d,n)}}let n=freestar.config.channel||freestar.fsdata.defaultChannel;n&&(freestar.log(9," Setting the channel to:"+n),freestar.config.orignalChannel=n),freestar.fsdata.placements=freestar.fsdata.placements.filter((e=>!e.archived)),freestar.fsdata.placements.forEach((async t=>{n&&(t.dfpId=t.dfpId.replace("{{channel}}",n),freestar.log(9," Setting the dfp id to:"+t.dfpId)),t.bidders=[],t.sizes=[],t.validAdSizes=!1,t.sizeMappings.sort((function(e,t){return e.viewport.size[0]===t.viewport.size[0]?0:e.viewport.size[0]>t.viewport.size[0]?-1:1}));for(let e=0;e<t.sizeMappings.length;e++){let i=t.sizeMappings[e];if(fsBrowserWidth()>=i.viewport.size[0]){for(let e=0;e<i.size.length;e++){let n=i.size[e];t.selectedSize=i,35843==n[0]?(t.fluidAd=!0,t.validAdSizes=!0):supports_size(i.size,n)&&!contains_size(t.sizes,n)&&(freestar.forceSize&&isEqual(freestar.forceSize.sort(),n.sort())?t.sizes.push(n):freestar.forceSize||t.sizes.push(n))}t.sizes.length>0&&(t.validAdSizes=!0);break}}t.ignoreSiteBidders||freestar.fsdata.networks.forEach((n=>{isNetworkAllowed({network:n,adQualityBlockList:e})&&isValidArrayWithLength({value:n.sizes})&&n.sizes.forEach((e=>{supports_size(t.sizes,e.size)&&i(n,e,t)}))}));let s=[];if(t.networks.forEach((n=>{isNetworkAllowed({network:n,adQualityBlockList:e})&&n.sizes.forEach((e=>{if(s.push(e.size[0]),supports_size(t.sizes,e.size)){if(e.deviceExclusive&&e.deviceExclusive.toLowerCase()!==freestar.deviceInfo.device.type)return;i(n,e,t)}}))})),t.sizes=uniqArrayOfObjects(t.sizes),t.bidders=uniqArrayOfObjects(t.bidders),t.sizes.length>0){const{active:e,adhesionRemove:i}=optionObjectFetch({placement:t,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS});e&&i&&document.getElementById("fs-special-remove")&&(t.bidders=t.bidders.filter((e=>!["33across","gumgum"].includes(unaliasBidder(e.bidder)))))}})),freestar.log(1," freestar.fsdata.placements : "+JSON.stringify(freestar.fsdata.placements))}const getPlacementByAdUnitPath=e=>{let{adUnitPath:t}=e;return window.freestar.fsdata.placements.find((e=>t===e.dfpId))};function siteGeoMacroRestriction(){const e=GEO_BASED_NETWORK_BIDDING_DISABLED_BY_SITE,t=e.length;let i=!1;if(freestar.locData&&freestar.locData.iso)for(let n=0,s=t;n<s;n++){const t=e[n];if(freestar.fsdata.siteId===t.siteId&&t.restrictedCountries.indexOf(freestar.locData.iso)>-1){i=!0;break}}return i}function format_pbjs(e){let t={},i=index({code:e.name,sizes:e.sizes,mediaTypes:null,bids:e.bidders}),n=getSlotProduct(e);const{battr:s=null}=window.freestar.fsdata.ortb||{};i.ortb2Imp={ext:{data:{fs_ad_product:n}},tagid:e.name,battr:s},e.storedRequestId&&(i.ortb2Imp.ext.prebid={storedrequest:{id:e.storedRequestId}});let r=!1;if(e.sizeMappings.forEach((i=>{!r&&fsBrowserWidth()>=i.viewport.size[0]&&(i.mediaTypes.forEach((n=>{void 0===t[n]&&(t[n]={}),void 0===t[n].sizes&&(t[n].sizes=[]),i.size.forEach((e=>{if(e[0]<35843){if(("banner"===n||"native"===n)&&"302x170, 443x250, 554x312, 640x360".includes(`${e[0]}x${e[1]}`))return;t[n].sizes.push(e)}})),t[n].sizes=uniq(t[n].sizes);const s=PREBID_ACCEPTED_SIZES.map((e=>e.join("x")));let r=[];const a=fetchAdQualityBlockList();e.networks&&e.networks.forEach((e=>{isNetworkAllowedViaAdQuality({network:e,adQualityBlockList:a})&&e.sizes&&e.sizes.forEach((e=>{e.size.forEach((e=>{r.push(e)}))}))}));const o=r.filter((e=>Array.isArray(e))).map((e=>e.join("x"))),d=e.sizes.filter((e=>Array.isArray(e))).map((e=>e.join("x")));if(t[n].sizes=t[n].sizes.filter((e=>{if(-1!==s.indexOf(e.join("x"))||-1!==d.indexOf(e.join("x"))&&-1!==o.indexOf(e.join("x")))return e})),t[n].sizes=t[n].sizes.sort(((e,t)=>e[0]+e[1]<t[0]+t[1]?1:t[0]+t[1]<e[0]+e[1]?-1:0)),"native"===n&&(t[n]=Object.assign(t[n],{type:"image",sendTargetingKeys:!1})),"video"===n){let e=[1,1];t[n].sizes.forEach((t=>{e[0]<t[0]&&(e=t)}));const i=e[0]>=500?[[552,334],[640,360]]:[[300,169],[400,225]];t[n]=Object.assign({},t[n],{api:[2],context:"instream",delivery:[2],linearity:2,maxduration:window.freestar.fsdata.adRefreshRate,mimes:["video/mp4","application/javascript","video/webm"],minduration:1,placement:1,playbackmethod:[6],playerSize:i[0],plcmt:4,protocols:[2,3,5,6],size:i,skip:0,useCacheKey:!0,renderer:{render:e=>{AppContainer.instance.create(TOKEN.IN_BANNER_VIDEO_PLAYER,{provide:{params:{bid:e}}})},url:"https://a.pub.network/superflex/loader.js"}})}})),r=!0)})),i.mediaTypes=t,!i.bids)return;for(let e=i.bids.length-1;e>=0;e--){if(i.bids[e].dynamicId&&(i.bids[e].params.id=++freestar.dynamicIdNum),i.bids[e].bidder){const t={minViewPort:[0,0],relevantMediaTypes:["banner","native"]},s={minViewPort:[0,0],relevantMediaTypes:["banner","native","video"]};switch(unaliasBidder(i.bids[e].bidder)){case"zid":i.bids[e].params.adUnitID=Number(i.bids[e].params.adUnitID),i.bids[e].sizeConfig=[t];break;case"appnexus":i.bids[e].params.keywords={fs_ad_product:[n||""]},i.bids[e].sizeConfig=[s];break;case"amazon":i.bids.splice(e,1),i.bids[e].sizeConfig=[t];break;case"onemobile":i.bids[e].params.ext=Object.assign(i.bids[e].params.ext||{},{req:location.href}),i.bids[e].sizeConfig=[t];break;case"ttd":i.bids[e].params.publisherId=freestar.fsdata.companyId,i.bids[e].sizeConfig=[t];break;case"gourmetads":i.bids[e].params.use_pmt_rule&&"true"===i.bids[e].params.use_pmt_rule&&(i.bids[e].params.use_pmt_rule=!0),i.bids[e].params.usePaymentRule&&"true"===i.bids[e].params.usePaymentRule&&(i.bids[e].params.usePaymentRule=!0),i.bids[e].sizeConfig=[t];break;case"resetdigital":allowRequestToResetDigital()||i.bids.splice(e,1);break;case"fsxs2s":case"pubmatic":case"rubicon":case"ix":case"unruly":case"yieldmo":case"openx":case"yahoo":case"mediagrid":i.bids[e].sizeConfig=[s];break;default:i.bids[e].sizeConfig=[t]}}i.bids[e].size?checkBidSize(i.bids[e].size[0],i.mediaTypes.banner.sizes)||i.bids.splice(e,1):i.bids[e].params.size&&(checkBidSize(i.bids[e].params.size,i.mediaTypes.banner.sizes)||i.bids.splice(e,1))}const a=new Fsxs2s;return a.hasValidStoredRequests()&&!e.ignoreSiteBidders&&i.bids.push(a.addToPlacementAsBidder()),i}function checkBidSize(e,t){for(let i=0;i<t.length;i++)if(JSON.stringify(e)===JSON.stringify(t[i]))return!0;return!1}function allowRequestToResetDigital(){const e=window.freestar.locData&&window.freestar.locData.iso||null,t=window.freestar.locData&&window.freestar.locData.state||null;return"US"===e&&!["CA","CO","CT","VA","UT"].includes(t)}const LOG_TITLE$1="FREESTAR VIDEO v1.0.0",LOG_INFO$1={title:LOG_TITLE$1,styles:"background: black; color: white; border-radius: 3px; padding: 3px"},FS_PLAYER_NAME="FOP",IBV_PLAYER_NAME="FVP - PBJS IBV",DEFAULT_AMAZON_APS_SLOT="aps_springserve_outstream_ron";function getLargestPossibleSizes(e){const{width:t,height:i}=e.reduce((function(e){let[t=0,i=0]=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t>e.width&&(e.width=t),i>e.height&&(e.height=i),e}),{width:0,height:0});return[t,i]}const EVENTS=["adsready","adRequest","adserror","loadstart","adImpression","adComplete","impression","progress","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","play","pause","ratechange","resize","volumechange"];class VideoPlayer{constructor(e){let{params:t}=e;this.uuid=generateUUID(),this.params=t,this._playerId=`fsPlayer_${this.uuid}`}init(){}updateBottomSpacing(e){this.params.bottomSpacing=e,this.addCSS()}bindEvents(){this.player.on(EVENTS,this.handlePlayerEvent),this.player.on("ads-manager",(e=>{const{adsManager:t}=e;Object.keys(window.google.ima.AdEvent.Type).forEach((e=>{t.addEventListener(window.google.ima.AdEvent.Type[e],this.handlePlayerEvent)}))}))}addPlayer(){this.player=window.videojs(this._playerId,{controls:!1,disablePictureInPicture:!0,enableDocumentPictureInPicture:!1})}addHTML(){}addCSS(){}getLargestPossibleDimensions(e){let{placement:t}=e,{sizes:i}=t;return i=i.filter((e=>Array.isArray(e))),getLargestPossibleSizes(i)}renderAd(){}handlePlayerEvent=e=>{const{type:t}=e;switch(t){case"impression":this.handleImpressionEvent({event:e});break;case"volumechange":case"volumeChange":this.handleVolumeChangeEvent({event:e});break;case"allAdsCompleted":this.handleAllAdsCompleteEvent({event:e});break;case"adsready":this.handleAdsReadyEvent({event:e});break;case"ended":this.handleEndedEvent({event:e});break;case"adserror":this.handleAdsErrorEvent({event:e})}};handleEndedEvent(e){let{event:t}=e;freestar.log(LOG_INFO$1,"handleEnded",t)}handleAdsReadyEvent(e){let{event:t}=e;freestar.log(LOG_INFO$1,"handleAdsReadyEvent",t)}handleAdsErrorEvent(e){let{event:t}=e;freestar.log(LOG_INFO$1,"handleAdsErrorEvent",t)}handleVolumeChangeEvent(){this.player.ima.getAdsManager()&&0!==this.player.ima.getAdsManager().getVolume()&&this.player.ima.getAdsManager().setVolume(0)}handleImpressionEvent(e){let{event:t}=e;freestar.log(LOG_INFO$1,"handleImpressionEvent",t)}handleAllAdsCompleteEvent(e){let{event:t}=e;freestar.log(LOG_INFO$1,"handleAllAdsCompleteEvent",t)}remove(){this.player?.off(EVENTS,this.handlePlayerEvent);const e=this.player?.ima?.getAdsManager();e&&(Object.keys(window.google.ima.AdEvent.Type).forEach((t=>{e.removeEventListener(window.google.ima.AdEvent.Type[t],this.handlePlayerEvent)})),e.destroy());const{controller:t}=this.player?.ima||{},i=t?.sdkImpl?.adsLoader;i&&(i.contentComplete?.(),i.destroy?.()),t.sdkImpl.adDisplayContainer.destroy(),this.player?.dispose(),this.player=null,this.renderer=null,this.callback=null,this.request&&(this.request.cb=null,this.request._prebid=null,this.request._apstag=null,this.request=null)}sendEvent(e){let{name:t=LOG_TITLE$1,type:i,value:n}=e;AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:t,eventType:i,data:{name:this.placement.name,uuid:this.uuid,...n}}))}))}}class RequestBids{constructor(e){let{aps:t=!1,apsSlot:i=DEFAULT_AMAZON_APS_SLOT,pbjs:n=!0,pbjsCode:s,auctionTimeout:r=5e3,cb:a=null,prebid:o,apstag:d}=e;this.aps=t,this.apsSlot=i,this.pbjs=n,this.pbjsCode=s,this.auctionTimeout=r,this.auctionCutoff=2e4,this.cb=a,this.finished=[],this._prebid=o,this._apstag=d,this.init()}init(){this.requestBids()}requestBids(){this.aps&&this.requestAPSBids(),this.pbjs&&this.requestPBJSBids(),(this.aps||this.pbjs)&&(this.timer=setTimeout((()=>{clearTimeout(this.timer),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:LOG_TITLE$1,eventType:"videoAuctionTimeout",data:{pbjsCode:this.pbjsCode}}))})),this.finishRequestingBids()}),this.auctionCutoff))}requestAPSBids(){this._apstag&&this._apstag.fetchBids({timeout:this.auctionTimeout,slots:[{slotID:this.apsSlot,mediaType:"video"}]},(e=>{this.finished.push("aps"),this.apsBids=e,this.checkIfBidsFinished()}))}requestPBJSBids(){this._prebid.requestBids({adUnitCodes:[this.pbjsCode],bidsBackHandler:e=>{const{bids:t=[]}=e[this.pbjsCode]||{};this.finished.push("pbjs"),this.pbjsBids=t,this.checkIfBidsFinished()}})}checkIfBidsFinished(){const e=[];this.aps&&e.push("aps"),this.pbjs&&e.push("pbjs");e.every((e=>this.finished.includes(e)))&&(clearTimeout(this.timer),this.finishRequestingBids())}finishRequestingBids(){if(this.cb)try{this.cb(this)}catch(e){console.error(e)}}}class Renderer{constructor(e){let{player:t,adTagUrl:i="DEFAULT",uuid:n,placement:s}=e;this.player=t,this.adTagUrl=i,this.placement=s,this.uuid=n}renderAd(){"function"==typeof this.player.ima?(this.player.ima({adTagUrl:this.adTagUrl}),this.player.loadMedia({id:"XVXVXVXV",src:`${CORE_BUCKET_LOCATION}/videos/blank1s-20231016.mp4`,type:"video/mp4"})):(this.player.ima.changeAdTag(this.adTagUrl),this.player.ima.requestAds())}}class NativeRenderer extends Renderer{constructor(e){let{player:t,adTagUrl:i,uuid:n,placement:s}=e;super({player:t,adTagUrl:i,uuid:n,placement:s}),this.init(),this.adTagUrl=i}init(){this.renderAd()}}class InBannerVideoPlayer extends VideoPlayer{constructor(e){let{params:t}=e;super({params:t}),this.init()}init(){const{bid:e}=this.params,{adUnitCode:t,vastUrl:i,adId:n}=e;this.adId=n,this.adUnit=adUnitManager.getAdUnitByPrebidCode(t);const{placement:s}=this.adUnit;this.placement=s,this.addCSS(),this.addHTML({targetElm:document.getElementById(t)}),this.addPlayer(),this.bindEvents(),this.renderAd({vastUrl:i,adId:n})}addHTML(e){let{targetElm:t=document.body}=e;t.id&&clearExistingAd(t.id),this.videoPlayer=createElement({type:"div",id:`fs-player-container_${this.uuid}`}),this.videoPlayer.innerHTML=`\n            <div class='fs-player-container-shim'>\n                <video id='fsPlayer_${this.uuid}' muted playsinline disablePictureInPicture class='video-js vjs-16-9 vjs-default-skin'></video>\n            </div>\n        `,t.appendChild(this.videoPlayer)}addCSS(){const e=createElement({type:"style",id:`fs-player_${this.uuid}`}),t=this.getLargestPossibleDimensions({placement:this.adUnit.placement}),i=this.getPlayer16x9Dimensions({width:.95*t[0],height:.95*t[1]});e.textContent=`\n            #fs-player-container_${this.uuid} {\n                width: ${t[0]}px;\n                height: ${t[1]}px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background-color: #d3d3d3;\n            }\n            #fs-player-container_${this.uuid}>.fs-player-container-shim {\n                width: ${i.width}px;\n                height: ${i.height}px;\n                border-radius: 10px;\n                border: 0px;\n                overflow: hidden;\n            }\n        `,document.head.appendChild(e)}getPlayer16x9Dimensions(e){let{width:t,height:i}=e,n=Math.min(t,Math.round(16/9*i));return{width:n,height:Math.round(9/16*n)}}getLargestPossibleDimensions(e){let{placement:t}=e,{sizes:i}=t;return i=i.filter((e=>Array.isArray(e))),getLargestPossibleSizes(i)}renderAd(e){let{vastUrl:t,adId:i}=e;const{prebid:n}=this.adUnit;freestar.refreshLibrary[n.code]&&(freestar.refreshLibrary[n.code].disableRefresh=!0),this.renderer=new NativeRenderer({player:this.player,adTagUrl:t}),fsprebid.markWinningBidAsUsed({adId:i})}handleAdsReadyEvent(){const e={type:"videoBidAttemptedToPlay",value:{player:IBV_PLAYER_NAME,placementId:this.placement.name,adId:this.adId}};this.sendEvent(e),this.player.play()}handleAdsErrorEvent(){this.remove()}handleImpressionEvent(e){let{event:t}=e;const{adSystem:i,creativeAdId:n,creativeId:s,duration:r,universalAdIds:a,vastMediaHeight:o,vastMediaWidth:d}=t.ad.data,l={type:"videoBidImpression",value:{player:IBV_PLAYER_NAME,placementId:this.placement.name,adSystem:i,creativeAdId:n,creativeId:s,duration:r,universalAdIds:a,vastMediaHeight:o,vastMediaWidth:d,adId:this.adId}};this.sendEvent(l)}handleAllAdsCompleteEvent(){this.remove()}remove(){const{prebid:e,slot:t}=this.adUnit;e&&freestar.refreshLibrary[e.code]&&(freestar.refreshLibrary[e.code].disableRefresh=!1),freestar.refresh([t.getSlotElementId()]),this.videoPlayer?.parentNode?.removeChild(this.videoPlayer),this.videoPlayer=null,super.remove()}}ModuleRegistry.class(InBannerVideoPlayer,{token:TOKEN.IN_BANNER_VIDEO_PLAYER,dependencies:[TOKEN.FOP_VIDEO_SCRIPTS]});const sourcepointGMPScript=e=>{let{isGDPRCountry:t,isUspApplicable:i,mspsPrivacyManagerId:n,gdprPrivacyManagerId:s}=e;try{window._sp_queue=[],window._sp_={config:{accountId:1638,baseEndpoint:"https://cdn.privacy-mgmt.com",propertyHref:`https://${document.location.host}`,usnat:{includeUspApi:i},...t?{gdpr:{}}:{},events:{...["onMessageChoiceSelect","onMessageReady","onMessageChoiceError","onPrivacyManagerAction","onPMCancel","onMessageReceiveData","onSPPMObjectReady","onError"].reduce(((e,t)=>(e[t]=function(){console.log(`[event] ${t}`,arguments)},e)),{}),onConsentReady:function(e,t,i,r){"usnat"==e&&r.applies&&(document.getElementById("pmLink").style.visibility="visible",document.getElementById("pmLink").innerHTML="Do Not Sell or Share My Personal Information",document.getElementById("pmLink").onclick=function(){window._sp_.usnat.loadPrivacyManagerModal(String(n))}),"gdpr"==e&&r.applies&&(document.getElementById("pmLink").style.visibility="visible",document.getElementById("pmLink").innerHTML="Privacy Preferences",document.getElementById("pmLink").onclick=function(){window._sp_.gdpr.loadPrivacyManagerModal(String(s))})}}}}}catch(e){console.error("Error in sourcepointGMPScript",e)}},sourcepointCCPAScript=()=>{try{(()=>{var e=window,t=document;function i(t){var i="string"==typeof t.data;try{var n=i?JSON.parse(t.data):t.data;if(n.__cmpCall){var s=n.__cmpCall;e.__uspapi(s.command,s.parameter,(function(e,n){var r={__cmpReturn:{returnValue:e,success:n,callId:s.callId}};t.source.postMessage(i?JSON.stringify(r):r,"*")}))}}catch(n){}}!function i(){if(!e.frames.__uspapiLocator)if(t.body){var n=t.body,s=t.createElement("iframe");s.style.cssText="display:none",s.name="__uspapiLocator",n.appendChild(s)}else setTimeout(i,5)}(),"function"!=typeof __uspapi&&(e.__uspapi=function(){var e=arguments;if(__uspapi.a=__uspapi.a||[],!e.length)return __uspapi.a;"ping"===e[0]?e[2]({gdprAppliesGlobally:!1,cmpLoaded:!1},!0):__uspapi.a.push([].slice.apply(e))},__uspapi.msgHandler=i,e.addEventListener("message",i,!1))})()}catch(e){console.error("Error in sourcepointCCPAScript",e)}},sourcepointGPPScript=()=>{try{window.__gpp_addFrame=function(e){if(!window.frames[e])if(document.body){var t=document.createElement("iframe");t.style.cssText="display:none",t.name=e,document.body.appendChild(t)}else window.setTimeout(window.__gpp_addFrame,10,e)},window.__gpp_stub=function(){var e=arguments;if(__gpp.queue=__gpp.queue||[],__gpp.events=__gpp.events||[],!e.length||1==e.length&&"queue"==e[0])return __gpp.queue;if(1==e.length&&"events"==e[0])return __gpp.events;var t=e[0],i=e.length>1?e[1]:null,n=e.length>2?e[2]:null;if("ping"===t)i({gppVersion:"1.1",cmpStatus:"stub",cmpDisplayStatus:"hidden",signalStatus:"not ready",supportedAPIs:["2:tcfeuv2","5:tcfcav1","6:uspv1","7:usnatv1","8:uscav1","9:usvav1","10:uscov1","11:usutv1","12:usctv1"],cmpId:0,sectionList:[],applicableSections:[],gppString:"",parsedSections:{}},!0);else if("addEventListener"===t){"lastId"in __gpp||(__gpp.lastId=0),__gpp.lastId++;var s=__gpp.lastId;__gpp.events.push({id:s,callback:i,parameter:n}),i({eventName:"listenerRegistered",listenerId:s,data:!0,pingData:{gppVersion:"1.1",cmpStatus:"stub",cmpDisplayStatus:"hidden",signalStatus:"not ready",supportedAPIs:["2:tcfeuv2","5:tcfcav1","6:uspv1","7:usnatv1","8:uscav1","9:usvav1","10:uscov1","11:usutv1","12:usctv1"],cmpId:0,sectionList:[],applicableSections:[],gppString:"",parsedSections:{}}},!0)}else if("removeEventListener"===t){for(var r=!1,a=0;a<__gpp.events.length;a++)if(__gpp.events[a].id==n){__gpp.events.splice(a,1),r=!0;break}i({eventName:"listenerRemoved",listenerId:n,data:r,pingData:{gppVersion:"1.1",cmpStatus:"stub",cmpDisplayStatus:"hidden",signalStatus:"not ready",supportedAPIs:["2:tcfeuv2","5:tcfcav1","6:uspv1","7:usnatv1","8:uscav1","9:usvav1","10:uscov1","11:usutv1","12:usctv1"],cmpId:0,sectionList:[],applicableSections:[],gppString:"",parsedSections:{}}},!0)}else"hasSection"===t?i(!1,!0):"getSection"===t||"getField"===t?i(null,!0):__gpp.queue.push([].slice.apply(e))},window.__gpp_msghandler=function(e){var t="string"==typeof e.data;try{var i=t?JSON.parse(e.data):e.data}catch(e){i=null}if("object"==typeof i&&null!==i&&"__gppCall"in i){var n=i.__gppCall;window.__gpp(n.command,(function(i,s){var r={__gppReturn:{returnValue:i,success:s,callId:n.callId}};e.source.postMessage(t?JSON.stringify(r):r,"*")}),"parameter"in n?n.parameter:null,"version"in n?n.version:"1.1")}},"__gpp"in window&&"function"==typeof window.__gpp||(window.__gpp=window.__gpp_stub,window.addEventListener("message",window.__gpp_msghandler,!1),window.__gpp_addFrame("__gppLocator"))}catch(e){console.error("Error in sourcepointGPPScript",e)}},sourcepointGDPRScript=()=>{try{function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e=function(){for(var e,i,n=[],s=window,r=s;r;){try{if(r.frames.__tcfapiLocator){e=r;break}}catch(e){}if(r===s.top)break;r=r.parent}e||(function e(){var t=s.document,i=!!s.frames.__tcfapiLocator;if(!i)if(t.body){var n=t.createElement("iframe");n.style.cssText="display:none",n.name="__tcfapiLocator",t.body.appendChild(n)}else setTimeout(e,5);return!i}(),s.__tcfapi=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];if(!t.length)return n;"setGdprApplies"===t[0]?t.length>3&&2===parseInt(t[1],10)&&"boolean"==typeof t[3]&&(i=t[3],"function"==typeof t[2]&&t[2]("set",!0)):"ping"===t[0]?"function"==typeof t[2]&&t[2]({gdprApplies:i,cmpLoaded:!1,cmpStatus:"stub"}):n.push(t)},s.addEventListener("message",(function(e){var i="string"==typeof e.data,n={};if(i)try{n=JSON.parse(e.data)}catch(e){}else n=e.data;var s="object"===t(n)&&null!==n?n.__tcfapiCall:null;s&&window.__tcfapi(s.command,s.version,(function(t,n){var r={__tcfapiReturn:{returnValue:t,success:n,callId:s.callId}};e&&e.source&&e.source.postMessage&&e.source.postMessage(i?JSON.stringify(r):r,"*")}),s.parameter)}),!1))},"undefined"!=typeof module?module.exports=e:e()}catch(i){console.error("Error in sourcepointGDPRScript",i)}var e};function loadSourcepoint(e,t){const i=isGDPRCountry(e),n=isUspApplicable(e);sourcepointGMPScript({isGDPRCountry:i,isUspApplicable:n,mspsPrivacyManagerId:freestar.fsdata.mspsPrivacyManagerId||DEFAULT_MSPS_SOURCEPOINT_PRIVACY_MANAGER_ID,gdprPrivacyManagerId:freestar.fsdata.gdprPrivacyManagerId||DEFAULT_GDPR_SOURCEPOINT_PRIVACY_MANAGER_ID}),i&&(sourcepointGDPRScript(),sourcepointGPPScript()),n&&(sourcepointCCPAScript(),sourcepointGPPScript()),load_script$1(SOURCEPOINT_WRAPPING_MESSAGE_SCRIPT,t)}const getUspapiConsentString=e=>{hasUspapi()?window.top.__uspapi("getUSPData",1,((t,i)=>i&&t.uspString?e(t.uspString):e(null))):e(null)},hasUspapi=()=>Boolean(window.top.__uspapi);function loadQuantcast(e){const t=freestar.fsdata.quantcastDomain;if(t){var i="https://cmp.inmobi.com".concat("/choice/","wZt3yQfgdwnz-","/",t,"/choice.js?tag_version=V2"),n=0;load_script$1(i,e),function(){for(var e,t="__tcfapiLocator",i=[],n=window;n;){try{if(n.frames[t]){e=n;break}}catch(e){}if(n===window.top)break;n=n.parent}e||(!function e(){var i=n.document,s=!!n.frames[t];if(!s)if(i.body){var r=i.createElement("iframe");r.style.cssText="display:none",r.name=t,i.body.appendChild(r)}else setTimeout(e,5);return!s}(),n.top.__tcfapi=function(){var e,t=arguments;if(!t.length)return i;if("setGdprApplies"===t[0])t.length>3&&2===t[2]&&"boolean"==typeof t[3]&&(e=t[3],"function"==typeof t[2]&&t[2]("set",!0));else if("ping"===t[0]){var n={gdprApplies:e,cmpLoaded:!1,cmpStatus:"stub"};"function"==typeof t[2]&&t[2](n)}else"init"===t[0]&&"object"==typeof t[3]&&(t[3]=Object.assign(t[3],{tag_version:"V2"})),i.push(t)},n.top.addEventListener("message",(function(e){var t="string"==typeof e.data,i={};try{i=t?JSON.parse(e.data):e.data}catch(e){}var n=i.__tcfapiCall;n&&window.top.__tcfapi(n.command,n.version,(function(i,s){var r={__tcfapiReturn:{returnValue:i,success:s,callId:n.callId}};t&&(r=JSON.stringify(r)),e&&e.source&&e.source.postMessage&&e.source.postMessage(r,"*")}),n.parameter)}),!1))}();var s=function(){var e=arguments;typeof window.top.__uspapi!==s&&setTimeout((function(){void 0!==window.top.__uspapi&&window.top.__uspapi.apply(window.top.__uspapi,e)}),500)};if(void 0===window.top.__uspapi){window.top.__uspapi=s;var r=setInterval((function(){n++,window.top.__uspapi===s&&n<3?console.warn("USP is not accessible"):clearInterval(r)}),6e3)}}else freestar.log(10,"loadQuantcast","Could not get quantcastDomain from fsdata, quantcast will not be loaded!")}function setUsPrivacy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date((new Date).getTime()+33696e6);function t(e,t,i){return i.substring(0,e)+t+i.substring(e+t.length)}if("FREESTAR"===window.freestar.fsdata.cmpType&&"US"===window.freestar.locData.iso){const i="usprivacy",n=getCookie({name:i});if(USP_GEOS.includes(window.freestar.locData.state))if(n){const s="//a[text()='Do Not Sell My Personal Information']",r=document.evaluate(s,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;"N"===n[1]&&setCookie(r?{name:i,value:t(1,"Y",n),domain:`.${window.location.host}`,expires:e}:{name:i,value:t(1,"-",n),domain:`.${window.location.host}`,expires:e})}else setCookie({name:i,value:"1-N-",domain:`.${window.location.host}`,expires:e})}}function runRestrictedAds(e,t){const i=t.fsdata?.disallowedGeos?.includes(t.locData.iso);if(!e){if(siteGeoMacroRestriction())throw new Error("Ad serving is blocked in "+t.locData.iso);i||t.fsdata.placements.length&&(queue(),t.newAdSlots=restrictedAdsNewAdSlots,t.deleteAdSlots=deleteAdSlots,t.refresh=refresh,t.trackPageview=trackPageview,t.config.enabled_slots.length&&(googletag.cmd.push((function(){googletag.pubads().setTargeting("fspbg","freestar"),googletag.pubads().setPrivacySettings({nonPersonalizedAds:!0})})),restrictedAdsNewAdSlots(t.config.enabled_slots)))}}function restrictedAdsNewAdSlots(e,t){const i=uniqBy(e=e.filter((e=>void 0!==getPlacementByName({name:e.placementName}))),"slotId");!t&&freestar.config.channel&&(t=freestar.config.channel),freestar.config.orignalChannel||(freestar.config.orignalChannel="{{channel}}"),t&&freestar.config.orignalChannel!==t&&(freestar.fsdata.placements=freestar.fsdata.placements.map((e=>(e.dfpId=e.dfpId.replace(freestar.config.orignalChannel,t),e))),freestar.config.orignalChannel=t),i.forEach((function(e){const{placementName:t,slotId:i,targeting:n}=e,s=document.getElementById(i),r=getPlacementByName({name:t}),a=getPlacementSizesByScreenResolution(r);s&&s.id&&r&&a&&googletag.cmd.push((function(){const e=googletag.defineSlot(r.dfpId,a,r.name).addService(googletag.pubads());n&&Object.keys(n).forEach((t=>{e.setTargeting(t,n[t])})),googletag.pubads().enableSingleRequest(),googletag.enableServices(),googletag.display(s.id),googletag.pubads().refresh([e])}))}))}function deleteAdSlots(e){void 0!==e?(Array.isArray(e)||(e=[e]),e.forEach((e=>{let t=getSlot({elementId:e});t&&googletag.destroySlots([t])}))):googletag.cmd.push((function(){googletag.destroySlots()}))}function refresh(){}function trackPageview(){}function queue(){let e=extend({queue:[]},freestar);freestar.queue={push:function(e){googletag.cmd.push(e)}};for(let t=0;t<e.queue.length;t++)freestar.queue.push(e.queue[t])}const EVENT_STATUS_TYPES=["tcloaded","useractioncomplete"],PURPOSE_1=1,PURPOSE_10=10;let loadedPubfig=!1,checkCount=0;const getConsentStrings=e=>{const t={gdpr:!1,usp:{uspString:"1---"}};isUspApplicable()?getUspapiConsentString((i=>{i&&(t.usp={uspString:i}),e(t)})):isGDPRCountry()?getTcfConsentString((i=>{i&&(t.gdpr={tcString:i}),e(t)})):e(t)},updateConsentData=function(e){let{consents:t}=e;freestar.consentManagement.consentData={consents:{[PURPOSE_1]:t?t[PURPOSE_1]:void 0,[PURPOSE_10]:t?t[PURPOSE_10]:void 0}}};function hasPurposesConsents(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return!(!e||!i)&&i.every((t=>!!e[t]))}function hasVendorConsents(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return!(!e||!i)&&i.every((t=>!!e[t]))}const tcfParseConsent=function(e){let{data:t}=e;const{eventStatus:i}=t;if(EVENT_STATUS_TYPES.includes(i)){const{purpose:e,vendor:i}=t,n=e?e.consents:void 0,s=i?i.consents:void 0;return updateConsentData({consents:n}),hasPurposesConsents(n,PURPOSE_1,PURPOSE_10)&&hasVendorConsents(s,FREESTAR_IAB_TCF_VENDOR_ID)}},tcfCallback=e=>(t,i)=>{if("cmpuishown"===t.eventStatus)return;const n=tcfParseConsent({data:t});i?!loadedPubfig&&n?(loadedPubfig=!0,e()):runRestrictedAds(n,window.freestar):freestar.log(1,"Error: TCF Callback Failed")},checkForTCFConsent=function(e){return checkCount++,50===checkCount?(clearTimeout(freestar.timers.tcfapi),void(freestar.timers.tcfapi=null)):checkCount<50&&!window.top.__tcfapi?(freestar.timers||(freestar.timers={}),void(freestar.timers.tcfapi=setTimeout((()=>checkForTCFConsent(e)),500))):(freestar.timers&&freestar.timers.tcfapi&&(clearTimeout(freestar.timers.tcfapi),freestar.timers.tcfapi=null),void window.top.__tcfapi("addEventListener",2,tcfCallback(e)))};function cmpMessage(e,t,i){const n=t||i,s={cmpType:e,tcfapi:t,uspapi:i};freestar?.analyticsQueue?.push(new CustomAnalyticsEvent({eventName:"PRIVACY_COMPLIANCE",eventType:`SITE_HAS_CMP=${n}`,data:s})),freestar.log(0,`PRIVACY_COMPLIANCE SITE_HAS_CMP=${n} ${JSON.stringify(s)}`)}const CMP_TYPES={QUANTCAST:"FREESTAR",PUBFIG:"FS_SOURCEPOINT_PUBFIG"},initCmp=(e,t,i)=>{const n=e===CMP_TYPES.PUBFIG,s=e===CMP_TYPES.QUANTCAST,r=Boolean(window.top.__tcfapi),a=Boolean(window.top.__uspapi),o=isUspApplicable(t)&&!a,d=isGDPRCountry(t)&&!r;n&&(o||d)?loadSourcepoint(t,i):s&&(o||d)?loadQuantcast(i):i(),cmpMessage(e,r,a)};function checkForGDPR(e){disabledProductsTemporaryShim(),GDPR_MEMBER_GEOS.indexOf(freestar.locData.iso)>-1?checkForTCFConsent(e):(freestar.log(0,"Outside GDPR Zone"),e())}class SpringServeRenderer extends Renderer{constructor(e){let{player:t,placement:i,bids:n,uuid:s,videoAd:r}=e;super({player:t,uuid:s,placement:i}),this.videoAd=r,this.bids=n,this.consentData=null,getConsentStrings((e=>{this.consentData=e})),this.init()}init(){this.updateAdTagURL(),this.renderAd()}updateAdTagURL(){this.adTagUrl=`https://tv.springserve.com/rt/${this.videoAd.videoId}?w=400&h=225&url=${encodeURIComponent(location.href)}&cb=${Math.random()}&consent=${this.consentData&&this.consentData.gdpr?this.consentData.gdpr.tcString:""}&gdpr=${this.consentData&&this.consentData.gdpr?1:0}&us_privacy=${this.consentData&&this.consentData.usp?this.consentData.usp.uspString:""}&schain=1.0,1!${FREESTAR_LOCATION_HOST},${window.freestar.fsdata.companyId},1,,,,`+this.getFloorBasedOnBids()+this.getAPSBids()+this.getGPID()}getGPID(){return this.placement.dfpId&&this.placement.name?`&gpid=${this.placement.dfpId}/${this.placement.name}`:""}getFloorBasedOnBids(){return this.bids.pbjsBids&&0!==this.bids.pbjsBids.length?`&bid_floor=${this.bids.pbjsBids[0].cpm}`:""}getAPSBids(){if(!this.bids.apsBids||this.bids.apsBids.length<=0)return"";const e=this.bids.apsBids[0];return"&amznbid="+e.amznbid+"&amzniid="+e.amzniid}}const LEVELS={session:"session",page:"page"},CAP_OPTION_PATHS={productOption:"productOption",placementSessionCap:"placementSessionCap",placementPageCap:"placementPageCap"};class FrequencyCapManagerV2{constructor(e){let{win:t=window,placement:i,product:n,callback:s,pageLevelCapPathOption:r=CAP_OPTION_PATHS.placementPageCap,sessionLevelCapPathOption:a=CAP_OPTION_PATHS.placementSessionCap}=e;this.win=t,this.placement=i,this.product=n,this.productKey=n+"Options",this.pageLevelCapPathOption=r,this.sessionLevelCapPathOption=a,this.key=`fs.${this.product}.sessionfrequencycap`,this.callback=s,this.pageLevelData={},this.sessionLevelData={},this.init()}init(){this.win.freestar?.frequencyLibraryV2||(this.win.freestar.frequencyLibraryV2={}),this.setCapData(),this.win.freestar.frequencyLibraryV2[this.placement.name]=this}resetIteration(){let{level:e=LEVELS.page}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e===LEVELS.page?this.pageLevelData.iteration=0:(this.sessionLevelData.iteration=0,sessionStorage.setItem(this.key,"0"))}incrementIteration(){this.pageLevelData.iteration++,this.sessionLevelData.iteration++,sessionStorage.setItem(this.key,this.sessionLevelData.iteration.toString())}subtractIteration(){this.win.freestar.log(1,"Frequency Cap: iteration will remove this attempt as an iteration. Setting new sessionStorage item value."),this.pageLevelData.iteration>0&&this.pageLevelData.iteration--,this.sessionLevelData.iteration>0&&(this.sessionLevelData.iteration--,sessionStorage.setItem(this.key,this.sessionLevelData.iteration.toString()))}getCapPath(e){return{[CAP_OPTION_PATHS.productOption]:this.placement?.[this.productKey]?.cap,[CAP_OPTION_PATHS.placementSessionCap]:this.placement?.sessionFrequencyCap,[CAP_OPTION_PATHS.placementPageCap]:this.placement?.pageViewFrequencyCap}[e]}getCapValue(e){return e&&e>0?e:-1}setCapData(){this.pageLevelData={cap:this.getCapValue(this.getCapPath(this.pageLevelCapPathOption)),iteration:this.getIteration({level:LEVELS.page})},this.sessionLevelData={iteration:this.getIteration({level:LEVELS.session}),cap:this.getCapValue(this.getCapPath(this.sessionLevelCapPathOption))}}getIteration(){let{level:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e===LEVELS.session){const e=sessionStorage.getItem(this.key);return Number(e)||0}if(e===LEVELS.page)return this.pageLevelData.iteration||0}hasExceededCap(e){const{iteration:t,cap:i}=e;return i>0&&t>=i}isProductAllowed(){const e=this.hasExceededCap(this.sessionLevelData),t=this.hasExceededCap(this.pageLevelData);if(e||t){const t=e?"session":"page",i=e?this.sessionLevelData:this.pageLevelData;return this.win.freestar.log(1,`Frequency Cap: iteration of ${i.iteration} is higher than cap of ${i.cap}. ${this.product} will not run again until the next ${t}.`),!1}return this.win.freestar.log(1,`Frequency Cap: iteration of ${Math.max(this.sessionLevelData.iteration+1,this.pageLevelData.iteration+1)} is lower than or equal to the cap. Continue with ${this.product}.`),!0}}const FLOATING_AD_POSITION={BR:{bottom:10,right:10},BL:{bottom:10,left:10},TR:{top:10,right:10},TL:{top:10,left:10},mobile:{top:10,left:"50%",transform:"translateX(-50%)"}},PLAYER_SIZE={SMALL:"SMALL",LARGE:"LARGE",CUSTOM:"CUSTOM"},COMMON_VIDEO_DEPENDENCIES=[{token:TOKEN.WINDOW,alias:"win"},TOKEN.FREESTAR,TOKEN.PREBID_MANAGER,TOKEN.AMAZON_MANAGER,TOKEN.DEVICE_INFO,TOKEN.FOP_VIDEO_SCRIPTS],formatStyleValue=e=>"number"==typeof e?`${e}px`:e,getFloatingAdStyles=e=>{let{adLocation:t="BR",isMobile:i=!1,topSpacing:n,bottomSpacing:s}=e;const r=["TR","TL"].includes(t)&&i?FLOATING_AD_POSITION.mobile:FLOATING_AD_POSITION[t];return r?Object.entries(r).reduce(((e,t)=>{let[i,r]=t;return"top"===i&&"number"==typeof r&&n&&(r+=n),"bottom"===i&&"number"==typeof r&&s&&(r+=s),e+`${i}: ${formatStyleValue(r)};`}),""):""},getCustomVideoSizes=function(){let e,{width:t=0,maxWidth:i=null,widthOnMaxExceeded:n=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=t;return i&&t>i?(s=n||i,e=calculateHeight(i)):e=calculateHeight(s),[s,e]},calculateHeight=e=>Math.round(9*e/16),PLAYER_CONTAINER_DESKTOP_DIMENSIONS={[PLAYER_SIZE.SMALL]:()=>[312,176],[PLAYER_SIZE.LARGE]:()=>[400,225],[PLAYER_SIZE.CUSTOM]:getCustomVideoSizes},PLAYER_CONTAINER_MOBILE_DIMENSIONS={[PLAYER_SIZE.SMALL]:()=>["45%",300],[PLAYER_SIZE.LARGE]:()=>["100%",400],[PLAYER_SIZE.CUSTOM]:getCustomVideoSizes},DESKTOP_SIZES={[PLAYER_SIZE.SMALL]:()=>[300,200],[PLAYER_SIZE.LARGE]:()=>[400,300],[PLAYER_SIZE.CUSTOM]:getCustomVideoSizes},MOBILE_SIZES={[PLAYER_SIZE.SMALL]:()=>[300,200],[PLAYER_SIZE.LARGE]:()=>[400,300],[PLAYER_SIZE.CUSTOM]:getCustomVideoSizes},MIN_BID_CPM=1;class InContentVideoAd extends VideoPlayer{static adType="INCONTENT";constructor(e){let{params:t,freestar:i,prebidManager:n,amazonManager:s,doc:r=document,win:a=window,deviceInfo:o}=e;super({params:t}),this._loggingLevel=1,this._name="InContentVideoAd";const{callback:d,videoAd:l}=this.params;if(d&&"function"!=typeof d)throw new Error("Callback must be a function");this.callback=d,this.videoAd=l,this._document=r,this._window=a,this._freestar=i,this._prebidManager=n,this._deviceInfo=o,this._prebidManager=n,this._amazonManager=s,this._stylesheetId=`fs-player-${this.uuid}`,this._containerId=`fs-player-container-${this.uuid}`,this.placement=this._createVideoPlacement(l),this.adUnit=this._createAdUnit(this.placement);const{timeToWaitBetweenVideos:c=5}=this.videoAd;this._delayBetweenAdsMs=1e3*c,this._nextAdTimeoutId=null,this.init()}init(){if(this.initFrequencyCap(),!this.frequencyCapManager.isProductAllowed())return this.callback(null,{uuid:this.uuid});if(!this.targetElement)return this._window.freestar.log(this._loggingLevel,`${this._name}: Target element "${this.videoAd.name}" not found.`),void this.callback?.(`Target element "${this.videoAd.name}" not found.`,{uuid:this.uuid});this._validateVideoAd()&&(this.addHTML(),this.addCSS(),this._prebidManager.instance.addAdUnits([this.adUnit]),this._requestFirstBid(),this._freestar.log(this._loggingLevel,`InContentVideoPlayer: Initialized for "${this.videoAd.name}"`))}initFrequencyCap(){const{videoAd:e}=this.params,{vendor:t,adType:i}=e;this.frequencyCapManager=new FrequencyCapManagerV2({placement:e,product:`${t}_${i}`,win:this._window})}get targetElement(){const{parentElement:e,classIndex:t,name:i}=this.videoAd;if(e){const i=t>-1?t:0;return this._document.querySelectorAll(e)[i]}return this._document.getElementById(i)}get playerContainerElement(){return this._document.getElementById(this._containerId)}addHTML(){if(!this.playerContainerElement){const e=createElement({type:"div",id:this._containerId});this.targetElement.appendChild(e)}}_removeHTML(){this.playerContainerElement?.remove()}_addVideoElement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.playerContainerElement;if(!e)return;let t=this._document.getElementById(this._playerId);t||(t=createElement({type:"video",id:this._playerId,classList:["video-js","vjs-16-9","vjs-default-skin"],attributes:[{muted:!0},{playsinline:!0}]}),e.appendChild(t))}addCSS(){const{width:e,height:t}=this._getVideoPlayerDimensions();let i=!1,n=this._document.getElementById(this._stylesheetId);n||(n=createElement({type:"style",id:this._stylesheetId}),i=!0),n.textContent=`\n            #${this._containerId} {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n\n                width: ${e};\n                min-height: ${t};\n\n                margin: 0 auto;\n                border-radius: 10px;\n\n                position: relative;\n\n                border-radius: 10px;\n                border: 0px;\n                overflow: hidden;\n            }\n\n            #${this._containerId}:after {\n                content: 'ADVERTISEMENT';\n\n                display: block;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translateX(-50%);\n                z-index: 1;\n\n                font-family: sans-serif;\n                font-size: 0.8rem;\n                color: #646464;\n            }\n        `,i&&this._document.head.appendChild(n)}_getVideoPlayerDimensions(){const e=this._deviceInfo.device.type===DEVICE_TYPE_MOBILE?PLAYER_CONTAINER_MOBILE_DIMENSIONS:PLAYER_CONTAINER_DESKTOP_DIMENSIONS,t=e[this.videoAd.playerSize]||e[PLAYER_SIZE.LARGE],[i,n]=t({width:this.videoAd.width});return{width:"number"==typeof i?`${i}px`:i,height:"number"==typeof n?`${n}px`:n}}renderAd(e){this._addVideoElement(),this.addPlayer(),this.bindEvents(),this._freestar.debug&&this._freestar.log(this._loggingLevel,`${this._name}: Rendering Ad for "${this.videoAd.name}"`),this.bids=e,this.renderer=new SpringServeRenderer({player:this.player,bids:e,placement:this.placement,videoAd:this.videoAd}),this.onRender?.()}completeAd(){if(this.player){if(this.player.dispose(),this.player=null,this.renderer=null,this._freestar.debug&&this._freestar.log(this._loggingLevel,`${this._name}: Video Ad "${this.videoAd.name}" completed.`),this.frequencyCapManager.incrementIteration(),!this.frequencyCapManager.isProductAllowed())return this.callback(null,{uuid:this.uuid});this._scheduleNextAd(),this.onCompleted?.()}}handleEndedEvent(){this.completeAd()}handleAdsReadyEvent(){this.player.play()}handleAdsErrorEvent(){const{pbjsBids:e}=this.bids??{},[t]=e||[];this.renderer instanceof SpringServeRenderer&&t?.cpm>=MIN_BID_CPM?this.renderer=new NativeRenderer({player:this.player,adTagUrl:t.vastUrl}):this.completeAd()}handleAllAdsCompleteEvent(){this.completeAd()}remove(){this._removeHTML(),this._window.clearTimeout(this._nextAdTimeoutId),this._prebidManager.instance.removeAdUnit(this.adUnit.code),super.remove()}_scheduleNextAd=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e._delayBetweenAdsMs;e._nextAdTimeoutId&&e._window.clearTimeout(e._nextAdTimeoutId),e._freestar.debug&&e._freestar.log(e._loggingLevel,`${e._name}: Scheduling next Ad in ${t}ms for "${e.videoAd.name}"`),e._nextAdTimeoutId=e._window.setTimeout((()=>{e._requestBids()}),t)}})();_requestBids(){this.request=new RequestBids({aps:this.videoAd.amazonActive,apsSlot:this.videoAd.amazonApsSlot||null,pbjs:!0,pbjsCode:this.adUnit.code,cb:this._handleBidResponse,prebid:this._prebidManager.instance,apstag:this._amazonManager.instance})}_requestFirstBid(){this.videoAd.delayTime?this._scheduleNextAd(1e3*this.videoAd.delayTime):this._requestBids()}_handleBidResponse=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.renderAd(t)}})();_createVideoPlacement(e){const{name:t,prebidStoredRequestId:i}=e,n=this._getPlayerSize();return{name:t,bidders:[{bidder:"appnexus",params:{placementId:32347997}}],sizes:n,ignoreSiteBidders:!0,sizeMappings:[{size:n,viewport:{size:[0,0]},mediaTypes:["video"]},{size:n,viewport:{size:[768,0]},mediaTypes:["video"]}],storedRequestId:i}}_getPlayerSize(){const{width:e,playerSize:t}=this.videoAd,i=this._deviceInfo.device.type===DEVICE_TYPE_MOBILE?MOBILE_SIZES:DESKTOP_SIZES;return[(i[t]??i[PLAYER_SIZE.LARGE])({width:e})]}_createAdUnit(e){const t=format_pbjs(e);return t.mediaTypes.video={...t.mediaTypes.video,context:"outstream",renderer:{url:`${CORE_BUCKET_LOCATION}/videos/blank1s-20231016.mp4`,render:()=>{}}},this._prebidManager.instance.addAdUnits([t]),t}_validateVideoAd(){const{adType:e,vendor:t}=this.videoAd;return e===this.constructor.adType&&"FREESTAR_OUTSTREAM_PLAYER"===t||(this._freestar.log(this._loggingLevel,`${this._name}: Invalid ad type or vendor for "${this.videoAd.name}".`),this.callback?.(`Invalid ad type or vendor for "${this.videoAd.name}".`,{uuid:this.uuid}),!1)}}ModuleRegistry.class(InContentVideoAd,{token:TOKEN.INCONTENT_VIDEO_AD,dependencies:COMMON_VIDEO_DEPENDENCIES});const MESSAGE_BASE="Video Messaging: ";function bidWonMessage(e){let{bidder:t,cpm:i=null,requestTimestamp:n,videoAd:s,playerType:r=null}=e;const a=Date.now(),o={bidder:unaliasBidder(t),cpm:i,playerType:r,placementId:s.name||s.id,requestTimestamp:n,responseTimestamp:a,timeToRespond:a-n,bidCpm:i};freestar.log({title:VIDEO_LOG_TITLE},MESSAGE_BASE+`bid won for bidder ${t} and placement id ${s.name}.\nVIDEO MSG OBJECT: ${JSON.stringify(o)}`),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new OutstreamBidWonAnalyticsEvent(o))}))}function tagLoadedMessage(e){let{bidder:t,placementId:i,tagUrl:n}=e;const s={bidder:unaliasBidder(t),placementId:i,tagUrl:n};freestar.log({title:VIDEO_LOG_TITLE},MESSAGE_BASE+`tag loaded for bidder ${t} and placement id ${i}.\nVIDEO MSG OBJECT: ${JSON.stringify(s)}`),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new OutstreamTagLoadAnalyticsEvent(s))}))}const PLAYER_DIMENSIONS={[DEVICE_TYPE_DESKTOP]:{[PLAYER_SIZE.SMALL]:()=>["312px","176px"],[PLAYER_SIZE.LARGE]:()=>["400px","225px"],[PLAYER_SIZE.CUSTOM]:getCustomVideoSizes},[DEVICE_TYPE_MOBILE]:{[PLAYER_SIZE.SMALL]:()=>["45%","112px"],[PLAYER_SIZE.LARGE]:()=>["100%","175px"],[PLAYER_SIZE.CUSTOM]:e=>getCustomVideoSizes({...e,maxWidth:300,widthOnMaxExceeded:"100%"})}},createVideoPlacement=e=>{const{name:t,sizeMappings:i}=index(e),n={name:t,bidders:[{bidder:"appnexus",params:{placementId:32347997}},{bidder:"pubmatic",params:{adSlot:"Freestar_FOP_RON_Outstream",publisherId:156696,siteId:1260033}}],sizes:[[400,300]],sizeMappings:i};return n.name=n.name+"_outstream",n.ignoreSiteBidders=!0,n.sizeMappings=n.sizeMappings.map((e=>(e.mediaTypes=["video"],e.playerSize&&"LARGE"===e.playerSize&&(e.size=[[400,300]]),e.playerSize&&"SMALL"===e.playerSize&&(e.size=[[300,200]]),e))),n._storedRequestId="6d0caa66-2299-488d-a87a-1a82fcea7862",n};let setAuctionEndEvent=!1,sendTagLoadedEvent=!1;class OutstreamVideoPlayer extends VideoPlayer{constructor(e){let{params:t,prebidManager:i,amazonManager:n}=e;super({params:t}),this.params=t;const{callback:s,videoAd:r,placement:a}=this.params;this.callback=s,this.placement=a,this.videoAd=r,this._prebidManager=i,this._amazonManager=n,this.abortController=new AbortController,this.videoPlacement=createVideoPlacement(this.placement),this.prebidAdUnit=this.addPrebidAdUnit(),this.pbjsConfigs={original:{ortb2:{...i.instance.getConfig("ortb2")},s2sConfig:{...i.instance.getConfig("s2sConfig")}},outstream:{ortb2:{...i.instance.getConfig("ortb2")},s2sConfig:{...i.instance.getConfig("s2sConfig")}}},this.pbjsConfigs.outstream.ortb2.ext.prebid.storedrequest||(this.pbjsConfigs.outstream.ortb2.ext.prebid.storedrequest={}),this.pbjsConfigs.outstream.ortb2.ext.prebid.storedrequest.id="6d0caa66-2299-488d-a87a-1a82fcea7862",this.pbjsConfigs.outstream.s2sConfig.bidders=["appnexus"],this.init()}init(){sendTagLoadedEvent||(sendTagLoadedEvent=!0,this.sendEvent({type:"videoTagLoaded",value:{player:FS_PLAYER_NAME,placementId:this.placement.name}})),this.sendEvent({type:"videoPlayerLoaded",value:{player:FS_PLAYER_NAME,placementId:this.placement.name}}),this.initFrequencyCap(),this.frequencyCapManager.isProductAllowed()&&(this.addCSS(),this.addHTML(),this.addPlayer(),this.bindEvents(),setAuctionEndEvent||(this._prebidManager.instance.onEvent(PREBID_AUCTION_END,this.handlePrebidAuctionEndEvent),setAuctionEndEvent=!0),this.updatePrebidConfig(),this.requestBids())}handlePrebidAuctionEndEvent=e=>{e.adUnitCodes.includes(this.prebidAdUnit.code)&&this.updatePrebidConfig("original")};addPrebidAdUnit(){const e=format_pbjs(this.videoPlacement);return e.mediaTypes.video.context="outstream",this._prebidManager.instance.addAdUnits([e]),e}initFrequencyCap(){const{videoAd:e}=this.params,{vendor:t,adType:i}=e;this.frequencyCapManager=new FrequencyCapManagerV2({placement:e,product:`${t}_${i}`})}getDeviceType(){return freestar.deviceInfo.device.type!==DEVICE_TYPE_MOBILE?DEVICE_TYPE_DESKTOP:DEVICE_TYPE_MOBILE}getVideoPlayerDimensions(){const e=this.getDeviceType(),t=this.videoAd?.playerSize,i=this.videoAd.width,n=PLAYER_DIMENSIONS[e]||PLAYER_DIMENSIONS[DEVICE_TYPE_DESKTOP],s=n[t]||n[PLAYER_SIZE.LARGE],[r,a]=s({width:i});return{width:"number"==typeof r?`${r}px`:r,height:"number"==typeof a?`${a}px`:a}}addHTML(){const e=createElement({type:"div",id:"fs-player-container"});e.innerHTML=`\n            <div class='fs-player-close' aria-labe='Close Player'>\n                <button class='fs-close-button'>&nbsp;</button>\n            </div>\n            <div class='fs-player-container-shim'>\n                <video id='fsPlayer_${this.uuid}' muted playsinline class='video-js vjs-16-9 vjs-default-skin'></video>\n            </div>\n        `,document.body.appendChild(e),e.querySelector("button").addEventListener("click",(()=>{this.remove({params:{userEnded:!0}})}),{signal:this.abortController.signal})}addCSS(){const e=createElement({type:"style",id:"fs-video-player"}),{width:t,height:i}=this.getVideoPlayerDimensions(),n="B"===this.videoAd.videoAdhesionPosition.split("")[0]?"bottom":"top",s="R"===this.videoAd.videoAdhesionPosition.split("")[1]?"right":"left";e.textContent=`\n            #fs-player-container {\n                position: fixed;\n                border: 1px solid black;\n                border-radius: 5px;\n                overflow: visible;\n                background-color: black;\n                z-index: 2147483647;\n                ${n}: 0;\n                ${s}: 0;\n                width: ${t};\n                height: ${i};\n                transition: unset;\n                ${s}: -${t};\n                visibility: hidden;\n            }\n            .fs-player-close {\n                position: absolute;\n                top: -13px;\n                right: 5px;\n                width: 20px;\n                height: 20px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 2147483647;\n            }\n            .fs-player-close button {\n                top: inherit !important;\n                right: inherit !important;\n            }\n        `,this.getDeviceType()===DEVICE_TYPE_DESKTOP?e.textContent+=`\n                #fs-player-container {\n                    box-shadow: 0px 0px 15px 0px rgba(0,0,0,0.75);\n                    ${n}: 10px;\n                }\n                #fs-player-container.fs-show {\n                    visibility: visible;\n                    ${s}: 10px;\n                    transition: ${s} 0.5s;\n                }\n            `:e.textContent+="\n                .fs-player-container-shim {\n                    margin: 0 auto;\n                    max-width: 300px;\n                }\n            ",document.head.appendChild(e)}updatePrebidConfig(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"outstream",t=this._prebidManager.instance.getConfig("s2sConfig"),i=this._prebidManager.instance.getConfig("ortb2");if("outstream"===e)t.bidders=["appnexus","pubmatic"],i.ext.prebid.storedrequest.id="6d0caa66-2299-488d-a87a-1a82fcea7862";else t.bidders=this.pbjsConfigs.original.s2sConfig.bidders,i.ext.prebid.storedrequest.id=this.pbjsConfigs.original.ortb2.ext.prebid.storedrequest.id;this._prebidManager.instance.mergeConfig({s2sConfig:t,ortb2:i})}requestBids(){this.request=new RequestBids({aps:this.videoAd.amazonActive,apsSlot:this.videoAd.amazonApsSlot||null,pbjs:!0,pbjsCode:this.prebidAdUnit.code,cb:this.handleBidResponse,prebid:this._prebidManager.instance,apstag:this._amazonManager.instance})}handleBidResponse=e=>{this.sendPbjsBidsEvent(),this.renderAd({data:e})};sendPbjsBidsEvent(){this.request.pbjsBids?.forEach((e=>{this.sendEvent({type:"videoBidRequest",value:{placementId:this.placement.name,player:FS_PLAYER_NAME,bids:[e]}})}))}renderAd(e){let{data:t}=e;this.bids=t,this.renderer=new SpringServeRenderer({player:this.player,bids:this.bids,placement:this.placement,videoAd:this.videoAd})}handleAdsReadyEvent(){this.player.play()}handleAdsErrorEvent(){const{pbjsBids:e=[]}=this.bids;this.renderer instanceof SpringServeRenderer&&e&&0!==e.length&&e[0].cpm>=1?this.renderer=new NativeRenderer({player:this.player,adTagUrl:this.bids.pbjsBids[0].vastUrl}):this.callback&&this.callback(!1,{ended:!0,uuid:this.uuid})}handleImpressionEvent(e){let{event:t}=e;if(this.show(),bidWonMessage({bidder:LOG_TITLE$1,requestTimestamp:Date.now(),videoAd:this.videoAd,playerType:this.renderer instanceof SpringServeRenderer?"springserve":"prebid"}),this.renderer instanceof NativeRenderer){const e={...this.request.pbjsBids[0]};e.videoAdserverTargeting=[e.adserverTargeting],delete e.adserverTargeting,this.sendEvent({type:"videoBidImpression",value:{player:FS_PLAYER_NAME,placementId:this.placement.name,...e}})}const{adSystem:i,creativeAdId:n,creativeId:s,duration:r,universalAdIds:a,vastMediaHeight:o,vastMediaWidth:d}=t.ad.data;this.sendEvent({type:"videoAdImpression",value:{player:FS_PLAYER_NAME,placementId:this.placement.name,adSystem:i,creativeAdId:n,creativeId:s,duration:r,universalAdIds:a,vastMediaHeight:o,vastMediaWidth:d}})}handleAllAdsCompleteEvent(){this.frequencyCapManager.incrementIteration(),this.hide(),this.callback&&this.callback(null,{ended:!0,uuid:this.uuid})}show(){const e=document.getElementById("fs-player-container");e&&e.classList.add("fs-show")}hide(){const e=document.getElementById("fs-player-container");e&&e.classList.remove("fs-show")}remove(){this.hide();const e=document.getElementById("fs-video-player");e&&e.remove(),this._prebidManager.instance.removeAdUnit(this.prebidAdUnit.code);const t=document.getElementById("fs-player-container");t&&t.remove(),super.remove(),this.abortController.abort(),this._prebidManager.instance.offEvent(PREBID_AUCTION_END,this.handlePrebidAuctionEndEvent)}}ModuleRegistry.class(OutstreamVideoPlayer,{token:TOKEN.OUTSTREAM_VIDEO_PLAYER,dependencies:COMMON_VIDEO_DEPENDENCIES});class FloatingVideoAd extends InContentVideoAd{static adType="FLOATING";constructor(e){super(e),this._name="FloatingVideoAd"}get targetElement(){const{parentElement:e,classIndex:t,name:i}=this.videoAd;if(e){const i=t>-1?t:0;return this._document.querySelectorAll(e)[i]}const n=this._document.getElementById(i);return n||this._document.body}addCloseButton(){if(!this.playerContainerElement)return;const e=createElement({type:"div",classList:["fs-player-close"],attributes:[{"aria-label":"Close Player"}]}),t=createElement({type:"button",classList:["fs-close-button"]});t.innerHTML="&nbsp;",t.addEventListener("click",(()=>this.callback(null,{uuid:this.uuid}))),e.appendChild(t),this.playerContainerElement.appendChild(e)}addHTML(){super.addHTML(),this.addCloseButton()}addCSS(){const{width:e,height:t}=this._getVideoPlayerDimensions();let i=!1,n=this._document.getElementById(this._stylesheetId);n||(n=createElement({type:"style",id:this._stylesheetId}),i=!0),n.textContent=`\n            #${this._containerId} {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n\n                width: ${e};\n                min-height: ${t};\n\n                margin: 0 auto;\n                border-radius: 10px;\n                border: 0px;\n\n                position: fixed;\n                z-index: 9999;\n                ${this._adPosition}\n            }\n\n            #${this._containerId} .fs-player-close {\n                visibility: hidden;\n\n                position: absolute;\n                ${["TL","TR"].includes(this._adLocation)?"bottom":"top"}: -13px;\n                right: 5px;\n\n                z-index: 10000;\n            }\n\n            #${this._containerId} .fs-player-close button {\n                top: inherit !important;\n                right: inherit !important;\n            }\n        `,i&&this._document.head.appendChild(n)}get _adPosition(){const{headerHeight:e}=this.videoAd,{bottomSpacing:t}=this.params||{},i=(this._deviceInfo.device.type||DEVICE_TYPE_DESKTOP)===DEVICE_TYPE_MOBILE;return getFloatingAdStyles({adLocation:this._adLocation,isMobile:i,topSpacing:e,bottomSpacing:t})}get _adLocation(){return this.videoAd.adLocation||"BR"}_setCloseButtonVisibility(e){const t=this.playerContainerElement.querySelector(".fs-player-close");t&&(t.style.visibility=e?"visible":"hidden")}onRender(){this._setCloseButtonVisibility(!0)}onCompleted(){this._setCloseButtonVisibility(!1)}}function createCloseButton(){let{classList:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return createElement({type:"button",classList:e,attributes:[{"aria-label":"Close Ad"},{tabindex:0}]})}ModuleRegistry.class(FloatingVideoAd,{token:TOKEN.FLOATING_VIDEO_AD,dependencies:COMMON_VIDEO_DEPENDENCIES});const INTERSECTION_OBSERVER_OPTIONS={root:null,rootMargin:"0px",threshold:.5},IN_CONTENT_CLASS_NAME="fs-in-content",FLOATING_CLASS_NAME="fs-floating";class InContentToFloatingVideoAd extends InContentVideoAd{static adType="INCONTENT_TO_FLOATING";constructor(e){super(e),this._name="InContentToFloatingVideoAd",this._observer=null,this._isInFloatingMode=!1,this._isLockedInContent=!1,this._attachIntersectionObserver()}addHTML(){if(!this.playerContainerElement){const e=createCloseButton({classList:["fs-close-button"]});e.addEventListener("click",(()=>this._handleClose()));const t=createElement({type:"div",id:this._containerId,children:[createElement({type:"div",classList:["fs-player-close"],attributes:[{"aria-label":"Close Player"}],children:[e]})]}),i=createElement({type:"div",id:`${this._containerId}-placeholder`,children:[t]});this.targetElement.appendChild(i)}}addCSS(){const{width:e,height:t}=this._getVideoPlayerDimensions(),i=this._deviceInfo?.device?.type===DEVICE_TYPE_MOBILE,{headerHeight:n}=this.videoAd,{bottomSpacing:s}=this.params||{};let r=!1,a=this._document.getElementById(this._stylesheetId);a||(a=createElement({type:"style",id:this._stylesheetId}),r=!0),a.textContent=`\n                #${this._containerId}-placeholder {\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n\n                    width: ${e};\n                    min-height: ${t};\n\n                    margin: 0 auto;\n                    border-radius: 10px;\n\n                    position: relative;\n\n                    overflow: hidden;\n                }\n\n                #${this._containerId}-placeholder:after {\n                    content: 'ADVERTISEMENT';\n\n                    display: block;\n\n                    position: absolute;\n                    top: 50%;\n                    left: 50%;\n                    z-index: 1;\n                    transform: translateX(-50%);\n\n                    font-family: sans-serif;\n                    font-size: 0.8rem;\n                    color: #646464;\n                }\n\n                #${this._containerId} {\n                    width: ${e};\n                    min-height: ${t};\n\n                    border-radius: 10px;\n                    border: 0px;\n                }\n\n                .${IN_CONTENT_CLASS_NAME} {\n                    position: relative;\n                }\n\n                .${FLOATING_CLASS_NAME} {\n                    position: fixed;\n                    z-index: 9999;\n\n                    ${getFloatingAdStyles({adLocation:this._adLocation,isMobile:i,topSpacing:n,bottomSpacing:s})}\n                }\n\n                #${this._containerId} .fs-player-close {\n                    visibility: hidden;\n\n                    position: absolute;\n                    ${["TL","TR"].includes(this._adLocation)?"bottom":"top"}: -13px;\n                    right: 5px;\n\n                    z-index: 10000;\n                }\n\n                #${this._containerId} .fs-player-close button {\n                    top: inherit !important;\n                    right: inherit !important;\n                }\n            `,r&&this._document.head.appendChild(a)}_setCloseButtonVisibility(e){const t=this.playerContainerElement.querySelector(".fs-player-close");t&&(t.style.visibility=e?"visible":"hidden")}_removeHTML(){const e=this._document.getElementById(`${this._containerId}-placeholder`);e?.remove()}remove(){this._observer?.disconnect(),this._observer=null,super.remove()}_updateStyles(){if(!this.playerContainerElement)return;const{classList:e}=this.playerContainerElement;if(this._isInFloatingMode&&!this._isLockedInContent)return e.add(FLOATING_CLASS_NAME),void e.remove(IN_CONTENT_CLASS_NAME);e.remove(FLOATING_CLASS_NAME),e.add(IN_CONTENT_CLASS_NAME)}get _adLocation(){return this.videoAd.adLocation||"BR"}_handleClose(){this._isLockedInContent=!0,this._updateStyles()}_attachIntersectionObserver(){this._observer=new IntersectionObserver(this._onIntersection,INTERSECTION_OBSERVER_OPTIONS),this._observer.observe(this.targetElement)}_onIntersection=e=>{e.forEach((e=>{const t=!e.isIntersecting;t!==this._isInFloatingMode&&(this._isInFloatingMode=t,this._updateStyles())}))};onRender(){this._setCloseButtonVisibility(!0)}onCompleted(){this._setCloseButtonVisibility(!1)}}function getConfigByType(e){let{type:t,device:i}=e;return t&&(i&&i===DEVICE_TYPE_MOBILE||i===DEVICE_TYPE_DESKTOP)&&t[i]?t[i]:t[DEVICE_TYPE_MOBILE]}function getSupportedDeviceType(){const e=freestar.deviceInfo.device.type;return e===DEVICE_TYPE_TABLET||e===DEVICE_TYPE_MOBILE&&window.innerWidth>780?DEVICE_TYPE_DESKTOP:e}function getDesktopPosition(e){let{selectedSize:t}=e;return t&&t.videoAdhesionPosition&&"DEFAULT_VIDEO_ADHESION_POSITION"!==t.videoAdhesionPosition?t.videoAdhesionPosition:"BR"}ModuleRegistry.class(InContentToFloatingVideoAd,{token:TOKEN.INCONTENT_TO_FLOATING_VIDEO_AD,dependencies:COMMON_VIDEO_DEPENDENCIES});let hasSentTagLoadedMessage=!1;function springserve(e){let{callback:t,videoAd:i,placement:n}=e;const s=window.freestar.fsdata.placementVideos.find((e=>e.id===i.videoId)),r=getSupportedDeviceType(),a={mobile:"625208",desktop:"625207"},o=getDesktopPosition(n),d=getDesktopPosition(n),l={mobile:{widthm:"LARGE"===i.playerSize?"100%":"45%",heightm:"LARGE"===i.playerSize?"175":"112",posm:d},desktop:{widthd:"LARGE"===i.playerSize?"400":"312",heightd:"LARGE"===i.playerSize?"225":"176",posd:o}};if(window.freestar.fsdata.networks.some((e=>"amazon"===e.slug))&&s.amazonActive){const e=s.amazonApsSlot||`springserve_${window.freestar.fsdata.siteId}_${location.host.split(".").length>2?location.host.split(".")[1]:location.host.split(".")[0]}`;l.mobile.apsSlot=e,l.desktop.apsSlot=e}const c=()=>s.supplyId&&s.supplyId.length?s.supplyId:getConfigByType({type:a,device:r}),u={mobile:{spIdm:c()},desktop:{spIdd:c()}},h=`https://cdn.springserve.com/assets/0/playerJS/${getConfigByType({type:{mobile:"frstrOSm_8",desktop:"frstrOSd_8"},device:r})}.js`;function f(){let{userEnded:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};freestar.log(1,"Spring Serve Footer Video Iteration Complete",arguments),delete window.AdPlayerPro,"function"==typeof t&&(t(void 0,e?{userEnded:!0}:{ended:!0}),t=void 0)}window._ssPlayer=Object.assign(getConfigByType({type:u,device:r}),getConfigByType({type:l,device:r}));const p=Date.now(),g=()=>{window.AdPlayerPro().on("AdStarted",(function(){freestar.log(1,"Spring Serve Footer Video Started"),bidWonMessage({bidder:"springserve",videoAd:i,requestTimestamp:p}),freestar.frequencyLibrary[n.name]&&freestar.frequencyLibrary[n.name].cap&&freestar.frequencyLibrary[n.name].incrementIteration()})),window.AdPlayerPro().on("AdError",(function(){freestar.log(1,"Spring Serve Footer Ad Fetch Error"),f({})})),window.AdPlayerPro().on("AdUserClose",(function(){freestar.log(1,"Spring Serve Footer Ad User Ended"),f({userEnded:!0})}));["AdStopped","AdVideoComplete"].forEach((e=>{window.AdPlayerPro().on(e,f)}))};load_script$1(h,(()=>{hasSentTagLoadedMessage||(hasSentTagLoadedMessage=!0,tagLoadedMessage({bidder:"springserve",placementId:i.videoId?i.videoId:"",tagUrl:h}));let e=0;const t=setInterval((()=>{if(window.AdPlayerPro&&"function"==typeof window.AdPlayerPro&&"object"==typeof window.AdPlayerPro()&&"function"==typeof window.AdPlayerPro().on?(clearInterval(t),g()):e+=1,e>=50)try{g()}catch(e){freestar.log(1,"Error binding events to SpringServe Video Player",e)}}),10)}))}const waitForElement=e=>{let{elementSelector:t,callback:i,timeout:n=5e3,frequency:s=300,doc:r=document}=e,a=0;const o=r.querySelector(t),d=!!o;if(d)return void i(d,o);const l=setInterval((()=>{a+=1;const e=r.querySelector(t),o=!!e;(o||a>=n/s)&&(i(o,e),clearInterval(l))}),s)};function AddStickyFooter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.body=document.body,this.placement=e,this.iteration=0,this.FOOTER_CORDIAL_KEY="fs.stickyfooter.cordial",this.stickyFooterId="fs-sticky-footer",this.stickyElement=void 0,this.stickySlotElement=void 0,this.slotWrapper=void 0,this.closeButton=void 0,this.brandingElement=void 0,this.error=!1,this.disabled=!1,this.options=optionObjectFetch({placement:this.placement,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS}),this.errorSet=()=>{this.error=!0},this.disabledSet=()=>{this.disabled=!0},this.cordial={set:()=>{if(this.cordial.isCordial()){freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial is being set in local storage with the following time : "+this.options.session);const e=this.options.session&&this.options.session>0?this.options.session:180,t=Date.now()+6e4*e;localStorage.setItem(this.FOOTER_CORDIAL_KEY,t.toString())}},isCordial:()=>(this.options.cordial?freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial is active."):freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial is not active."),this.options.cordial),isActivated:()=>{const e=localStorage.getItem(this.FOOTER_CORDIAL_KEY);return e?e&&Date.now()>e?(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial storage item found, but time has lapsed and storage item will be removed."),localStorage.removeItem(this.FOOTER_CORDIAL_KEY),!1):(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial is activated. Exiting process"),!0):(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Cordial storage item not found. Cordial not activated."),!1)}},this.isAdhesionDisabled=()=>{if(!(this.placement&&this.options&&this.placement.sizes.length&&this.body))return freestar.log({title:STICKY_FOOTER_LOG_TITLE},"No document body, placement, options, or sizes found! Exiting process."),this.errorSet(),!0;if(productIsDisabled({name:"stickyFooter"}))return this.disabledSet(),!0;if(this.options.remove){if(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Option to remove is true."),document.querySelector("fs-select-footer-remove")||document.querySelector(this.options.remove))return freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Option to remove is on DOM! Exiting process."),this.disabledSet(),!0;freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Option to remove is not on DOM sticky footer will continue.")}return freestar.frequencyLibrary[this.placement.name].cap>-1&&!freestar.frequencyLibrary[this.placement.name].allowProduct()?(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Frequency Cap has been met. Exiting process."),this.disabledSet(),!0):this.cordial.isCordial()&&this.cordial.isActivated()?(this.disabledSet(),!0):(freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Placement, options, and sizes found. No rules to disable have been accepted. Process will continue."),!1)},this.gumgumBidderRemoval=function(){this.options.gumgumSelect&&!document.getElementById("adhesion-select-one")&&(remove(this.placement.bidders,(e=>"gumgum"===e.bidder)),window.fsprebid.adUnits=window.fsprebid.adUnits.map((e=>(e.code===this.placement.name&&remove(e.bids,(function(e){return"gumgum"===unaliasBidder(e.bidder)})),e))),freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Gumgum has been removed as a bidder"))},this.createStickyElement=function(){this.stickyElement=createElement({type:"div",id:this.stickyFooterId,classList:[this.stickyFooterId]}),this.stickyElement.style.zIndex=this.options.zindex&&`${this.options.zindex}`||"",this.body.appendChild(this.stickyElement)},this.setSlotMinHeight=function(){const{selectedSize:e}=freestar.fsdata.placements.find((e=>e.name===this.placement.name)),t=e.size.map((e=>e[1])),i=Math.max.apply(Math,t),n=freestar.deviceInfo.device.type===DEVICE_TYPE_MOBILE&&"CONFIANT"===fetchAdQualityVendor()&&freestar.fsdata.adQualityOptions&&freestar.fsdata.adQualityOptions.confiantReportThisAdEnabled&&idealAdStackManager().allowConfiant()?i+20:i;this.stickyElement.style.minHeight=`${n}px`},this.createSlotElement=function(){this.stickySlotElement=createElement({type:"div",id:this.placement.name,classList:["fs-sticky-slot-element"],attributes:{name:this.placement.name,[ANCILLARY_CONTROL_KEY]:"false"}}),this.stickySlotElement.style.visibility="inherit",refreshLibraryCreatorVersionCheck(this.placement.name),this.slotWrapper=createElement({type:"div",id:"fs-slot-footer-wrapper",classList:["fs-sticky-parent","fs-sticky-wrapper"]}),this.slotWrapper.style.visibility="inherit",this.slotWrapper.style.zIndex="inherit",this.slotWrapper.appendChild(this.stickySlotElement),this.stickyElement.appendChild(this.slotWrapper);this.backgroundColor=(()=>this.options.backgroundRgba&&this.options.backgroundRgba.length?this.options.backgroundRgba:freestar.fsdata.stickyFooterBackgroundRgba&&freestar.fsdata.stickyFooterBackgroundRgba.length?freestar.fsdata.stickyFooterBackgroundRgba:"rgba(247,247,247,.9)")(),this.setSlotMinHeight(),this.stickySlotElement.style.backgroundColor=this.backgroundColor,this.stickyElement.style.backgroundColor=this.backgroundColor;const e=()=>{this.stickyElement.style.minHeight=`${this.slotWrapper.offsetHeight}px`},t=()=>{const e=document.getElementsByClassName("fs-sticky-slot-element")[0]||{},{offsetHeight:t,offsetWidth:i}=e;this.brandingElement&&(t>50&&i<468?this.brandingElement.classList.add("fs-mobile-tall"):this.brandingElement.classList.remove("fs-mobile-tall"))};googletag.pubads().addEventListener("slotOnload",(i=>{i.slot.getSlotElementId()===this.placement.name&&(this.elementToggle("visible"),t(),e())})),googletag.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(e=>{this.onSlotRenderEnded(e)})),fsprebid.que.push((()=>{fsprebid.onEvent(PREBID_BID_WON,(e=>{e.adUnitCode===this.placement.name&&this.onBidWon(e.bidderCode)}))})),AppContainer.instance.resolve(TOKEN.EVENT_BUS).then((e=>{e.subscribe(NATIVE_RENDER_ENDED,(e=>{let{payload:{elementId:i,bid:n}}=e;i===this.placement.name&&(!function(e){const t=document.getElementById(e),i=t?.querySelector("div[id*='google_ads_iframe']");i&&i.setAttribute("style","display: none;")}(i),"number"==typeof n.height&&(this.stickyElement.style.minHeight=`${n.height+4}px`),t(),freestar.log({title:STICKY_FOOTER_LOG_TITLE},"Sticky footer rendered natively."))})),e.subscribe(BEFORE_NATIVE_RENDER,(e=>{let{payload:{elementId:t}}=e;t===this.placement.name&&this.removeSpecialAdhesion()}))}))},this.removeSpecialAdhesion=()=>{this.specialAdhesionElement?.parentNode?.removeChild(this.specialAdhesionElement),delete this.specialAdhesionElement},this.buttonEvents={onPage:!1,clicked:!1},this.closeButtonCreate=()=>{this.closeButton=createCloseButton(),this.closeButton.setAttribute("class","fs-close-button fs-close-button-sticky"),this.closeButton.style.visibility="inherit",this.buttonEvents.onPage||(this.buttonEvents.onPage=!0,AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:"STICKY_BUTTON_SHOWED",eventType:"STICKY_FOOTER",data:{value:!0}}))}))),this.slotWrapper.appendChild(this.closeButton),this.closeButton.addEventListener("click",this.closeButtonMethod)},this.closeButtonMethod=()=>{this.cordial.set(),this.removeStickyElements(),this.buttonEvents.clicked||(this.buttonEvents.clicked=!0,AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:"STICKY_CLOSE_CLICKED",eventType:"STICKY_FOOTER",data:{value:!0}}))})))},this.createReportThisAd=function(e,t){const i=document.createElement("a");i.textContent="Report This Ad",i.style.color="#999",AppContainer.instance.resolve(TOKEN.CONFIANT).then((t=>{i.addEventListener("click",(function(){t.reportSingleAd(e)}))})),t.appendChild(i)},this.createBranding=async()=>{const[e,t]=await Promise.all([TOKEN.BRANDING,TOKEN.REPORT_AD].map((e=>AppContainer.instance.resolve(e,!0))));let i;e&&(i=e.createLink(this.placement));const n=this.placement.name;if(i?.enabled){this.brandingElement=createElement({type:"div",classList:["__fs-branding"]});const e=createElement({type:"a",attributes:[{target:"_blank"}]});this.brandingElement.style.visibility="inherit";const s=createElement({type:"img",src:i.getLogoUrl(),attributes:[{alt:"Freestar"}]});e.style.cursor.pointer,e.appendChild(s),this.brandingElement.appendChild(e),this.slotWrapper.appendChild(this.brandingElement);const r=createElement({classList:["fs-sticky-popup-container"],style:{display:"none"}}),a=document.createElement("div");a.style.position="relative",r.appendChild(i.getElement());const o=t?.createTextButton(n,this.placement);o.enabled&&r.appendChild(o.getElement()),a.appendChild(r),document.body.appendChild(a),this.brandingElement.addEventListener("click",(function(e){e.stopPropagation(),r.style.display="none"===r.style.display?"grid":"none";var t=this.getBoundingClientRect();applyStyles(r,{position:"fixed",top:t.top-70+"px",left:t.left-70+"px",backgroundColor:this.options?.backgroundRgba||freestar.fsdata?.stickyFooterBackgroundRgba||"rgba(247,247,247,.9)"})})),document.addEventListener("click",(function(){r.style.display="none"}))}},this.closeButtonMethod.bind(this),this.frequencyCapInit=()=>{freestar.frequencyLibrary[this.placement.name]=new Frequency({placement:this.placement,product:"stickyFooter"})},this.videoAdRequest=function(e){const i=Date.now();this.hideAdhesion(),t.footerVideoInit?.({videoAd:e,callback:(e,t)=>{if(this.stickyFooterDeleted)return;if(t&&t.userEnded)return freestar.log(1,"Sticky Footer Video: User ended video. Will not refresh sticky footer."),void this.cordial.set();const n=(getRefreshRate(this.placement.name)||30)-(Date.now()-i)/1e3;function s(){n>=10?freestar.currentStickyFooter.fillSlot(n):freestar.currentStickyFooter.fillSlot()}document.hasFocus()?s():freestar.focusQueue.push(s)},placement:this.placement})},this.fillSlot=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,i=arguments.length>1?arguments[1]:void 0;e||this.iteration++;const n=t.videoFetch?.({iteration:this.iteration,placement:this.placement});if(n&&!e)this.isVideo=!0,this.hideAdhesion(),freestar.refreshLibrary&&freestar.refreshLibrary[this.placement.name]&&freestar.refreshLibrary[this.placement.name].refreshTime&&(freestar.refreshLibrary[this.placement.name].refreshTime=-1),this.videoAdRequest(n);else{freestar.refreshLibrary[this.placement.name]||(freestar.refreshLibrary[this.placement.name]={}),this.isVideo=!1,freestar.refreshLibrary[this.placement.name].refreshTime=e||getRefreshRate(this.placement.name),i instanceof Promise?i.then((()=>{freestar.refreshLibrary[this.placement.name].refreshCounter=0})):freestar.refreshLibrary[this.placement.name].refreshCounter=0;const t={fsrefresh:String(freestar.refreshLibrary[this.placement.name].timesRefreshed??0)};newAdSlots([{slotId:this.placement.name,placementName:this.placement.name,targeting:t}],null,i)}},this.elementToggle=e=>{this.stickyElement&&(this.stickyElement.style.setProperty("display","block"),this.stickyElement.style.setProperty("visibility",e),this.stickyElement.style.setProperty("background-color",this.backgroundColor))},this.hideAdhesion=()=>{this.elementToggle("hidden")},this.showAdhesion=()=>{this.elementToggle("visible")},this.fetchCLSElement=()=>document.getElementById(this.placement.name+"-sticky-footer-cls"),this.init=function(){this.frequencyCapInit(),this.isAdhesionDisabled()||(dynamicSet({slotId:this.placement.name,placementName:this.placement.name}),this.gumgumBidderRemoval(),this.options.clsEnabled?(this.stickyElement=this.fetchCLSElement(),this.stickyElement&&(this.stickyElement.className+=` ${this.stickyFooterId}`)):this.createStickyElement(),this.stickyElement?(this.createSlotElement(),this.closeButtonCreate(),this.createBranding(),this.fillSlot()):freestar.log({title:STICKY_FOOTER_LOG_TITLE},"There is no sticky element! Exiting!"))},this.init(),this.onSlotRenderEnded=e=>{let{isEmpty:t,slot:i}=e;i.getSlotElementId()===this.placement.name&&(t?this.hideAdhesion():(this.showAdhesion(),waitForElement({elementSelector:SPECIAL_CREATIVE_SELECTORS.ogury,callback:(e,t)=>{e&&(this.hideAdhesion(),this.specialAdhesionElement=t)}})),freestar.performanceLogger.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigStickyFooterSlotRenderEnded,compareTo:[PERFORMANCE_MARKS_LIST.pubfigStickyFooterSlotRequested]}))},this.onBidWon=function(e){if(e=unaliasBidder(e),SPECIAL_CREATIVE_SELECTORS[e])return this.showAdhesion(),void waitForElement({elementSelector:SPECIAL_CREATIVE_SELECTORS[e],callback:(e,t)=>{e&&(this.hideAdhesion(),this.specialAdhesionElement=t)}});this.showAdhesion()},this.getIsNextVideo=()=>{const e=t.videoFetch?.({iteration:this.iteration+1,placement:this.placement});return Boolean(e)},this.stickyFooterRefresh=e=>{e instanceof Promise?e.then((()=>{this.removeSpecialAdhesion()})):this.removeSpecialAdhesion(),freestar.refreshLibrary[this.placement.name].refreshTime=-1;const t=this.placement.name;e instanceof Promise&&e.then((()=>{window.freestar.superflex&&window.freestar.superflex.removeCSS({elementId:t})}));const i=getSlot({elementId:t});i&&(i.setTargeting("fsrefresh",`${freestar.refreshLibrary[this.placement.name].timesRefreshed??0}`),e instanceof Promise?e.then((()=>{freestar.refreshLibrary[t].refreshCounter=0})):freestar.refreshLibrary[t].refreshCounter=0),this.fillSlot(null,e)},this.removeStickyElements=()=>{[this.stickySlotElement,this.stickyElement,this.slotWrapper].forEach((e=>{try{e&&e.parentNode&&e.parentNode.removeChild(e)}catch(e){freestar.log(1,`Error: ${e}`)}}))},this.deleteStickyFooter=()=>{if(this.stickyFooterDeleted=!0,this.isVideo&&window.AdPlayerPro){window.AdPlayerPro().remove()}this.cordial.set(),destroySlot({elementId:this.placement.name}),this.removeSpecialAdhesion(),this.removeStickyElements()},this.isSticky=e=>this.placement.name===e.slot.getSlotElementId()}const timers={};class AddConcurrentStickyFooterVideo{constructor(e){let{placement:t,videoInstance:i}=e;this.placement=JSON.parse(JSON.stringify(t)),this.videoCount=0,this.timer=null,this._videoInstance=i||{},this.init()}init(){if(this.videoAd=this._videoInstance.getEnabledVideo?.({placement:this.placement}),this.placement.stickyFooterOptions.videoPattern="NO_STICKY_FOOTER_OUTSTREAM_VIDEO_PATTERN",this.placement.stickyFooterOptions.video=!1,this.footer=new AddStickyFooter(this.placement,this._videoInstance),this._appendCSS(),productIsDisabled({name:"videoAdhesion"}))return;let{delayTime:e=0}=this.videoAd||{};e<1&&(e=1),freestar.log({title:VIDEO_LOG_TITLE},`${e}s before video loads...`),timers.delay=setTimeout((()=>{clearTimeout(timers.delay),this.initVendor()}),1e3*e),this._attachStickyFooterResizeListener()}initVendor(){var e=this;freestar.currentStickyFooter&&this.videoAd&&(this.videoCount+=1,this._videoInstance?.videoVendors?.[this.videoAd.vendor]?.({callback:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.handleCallback(t,i)},placement:this.placement,videoAd:this.videoAd}))}_appendCSS(){const e=createElement({type:"style",id:this._getStyleId()}),{offsetHeight:t}=this.footer.slotWrapper;e.textContent=this._getCustomStyles(t),document.head.appendChild(e)}handleCallback(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!freestar.currentStickyFooter)return;if(e)return void freestar.log({title:VIDEO_LOG_TITLE},"ERROR",e);const{frequencyCap:i=0}=this.videoAd;t.userEnded?freestar.log({title:VIDEO_LOG_TITLE},"User exited, no longer loading videos..."):i>0&&this.videoCount>=i?freestar.log({title:VIDEO_LOG_TITLE},`Frequency cap set to ${i}, no longer loading videos...`):document.hasFocus()?this.callNextVideo():freestar.focusQueue.push((()=>{this.callNextVideo()}))}callNextVideo(){if(!freestar.currentStickyFooter)return;const{timeToWaitBetweenVideos:e=0}=this.videoAd;freestar.log({title:VIDEO_LOG_TITLE},`${e}s before next video loads...`),timers.delay=setTimeout((()=>{clearTimeout(timers.delay),freestar.currentStickyFooter.initVendor()}),1e3*e)}stickyFooterRefresh(e){this.footer.stickyFooterRefresh(e)}hideAdhesion(e){this.footer.hideAdhesion(e)}deleteStickyFooter(){if(Object.keys(timers).forEach((e=>{clearTimeout(timers[e])})),freestar.currentStickyFooter.footer.deleteStickyFooter(),window.AdPlayerPro){const e=window.AdPlayerPro();e&&e.remove()}if(freestar.currentOutstreamPlayer){freestar.currentOutstreamPlayer.videoPlayer.dispose();const e=document.getElementById("fs-player-container");e?.parentNode.removeChild(e)}delete freestar.currentStickyFooter}_adjustVideoPosition(e){let{payload:{stickyFooterHeight:t}}=e;const i=document.querySelector(`#${CSS.escape(this._getStyleId())}`);i&&(i.textContent=this._getCustomStyles(t))}_attachStickyFooterResizeListener(){AppContainer.instance.resolve(TOKEN.EVENT_BUS).then((e=>{e.subscribe(STICKY_FOOTER_RESIZE,(e=>this._adjustVideoPosition(e)))}))}_getCustomStyles(){return`\n            #fs-player-container,\n            .orp-player-wrapper {\n                margin-bottom: ${(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)+10}px !important;\n                bottom: 0px !important;\n            }`}_getStyleId(){return`${this.placement.name}-stylesheet`}isVisible(e){return Boolean(e.offsetWidth||e.offsetHeight||e.getClientRects().length)}}let stickyCalled=!1,stickyOnCallFlag=!1;const stickyCallback=function(e){stickyCalled||(stickyCalled=!0,freestar.newStickyFooter()),freestar.log(1,`${e}`)},getPlacementVideoDetailsByScreenResolution=e=>{let t=!1;return e.sizeMappings.some((e=>{if(fsBrowserWidth()>=e.viewport.size[0]){const{stickyFooterOutstreamVideoPattern:i,delayTime:n,playerSize:s,timeToWaitBetweenVideos:r,videoAdhesionPosition:a,videoEnabled:o,videoAdId:d,videoId:l,frequencyCap:c}=e;return t={stickyFooterOutstreamVideoPattern:i,delayTime:n,playerSize:s,timeToWaitBetweenVideos:r,videoAdhesionPosition:a,videoEnabled:o,videoAdId:d,videoId:l,frequencyCap:c},!0}})),t};function newStickyFooter(e,t,i){const n=freestar.fsdata.placements.filter((e=>isOptionActive({placement:e,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS})&&e[PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS].isOnCall));if(isPageSpeedOptimized()&&n.length&&!stickyOnCallFlag)return stickyOnCallFlag=!0,void freestar.log("Sticky Footer: Sticky is on Call and PSO enabled next pub needs to call newStickyFooter");if(isPageSpeedOptimized()&&!freestar.fsdata.psoDisableInteraction&&!stickyCalled)return void waitForUserInteraction({name:"stickyFooter",callback:stickyCallback.bind(null,{})});let s;if(e&&e.length?(freestar.log(1,`Sticky Footer: newStickyFooter method invoked and requesting placement with the name ${e}.`),s=getPlacementByName({name:e})):(s=window.freestar.fsdata.placements.filter((e=>e.stickyFooterOptions&&e.stickyFooterOptions.active))[0],s&&freestar.log(1,`Sticky Footer: newStickyFooter method invoked without a name for a placement. The default Sticky Footer ${s.name} was found and will be used.`)),s){freestar.log(1,`Sticky Footer: newStickyFooter method - attempting a new sticky footer using placement ${s.name}.`),freestar.currentStickyFooter&&freestar.currentStickyFooter.placement&&(freestar.log(1,`Sticky Footer: newStickyFooter method - the current sticky footer will be removed ${freestar.currentStickyFooter.placement.name}.`),freestar.currentStickyFooter=void 0),freestar.currentStickyFooter&&freestar.currentStickyFooter.deleteStickyFooter&&freestar.currentStickyFooter.deleteStickyFooter();let{stickyFooterOutstreamVideoPattern:e}=getPlacementVideoDetailsByScreenResolution(s);freestar.currentStickyFooter="VIDEO_DISPLAY_CONCURRENT"===e?new AddConcurrentStickyFooterVideo({placement:s,videoInstance:t}):new AddStickyFooter(s,t),freestar.deleteStickyFooter=freestar.currentStickyFooter.deleteStickyFooter}else freestar.log(1,"Sticky Footer: newStickyFooter method - no placement found for the sticky footer!");i&&i()}class FooterVideo{videoPatterns=(()=>({DISPLAY_INIT_DISPLAY_CONSECUTIVE:{enabledDisplayIterations:[],disabledVideoIterations:[4,6],enabledVideoIterations:[2,5,7]},DISPLAY_INIT_ALTERNATING:{enabledDisplayIterations:[],disabledVideoIterations:[],enabledVideoIterations:[2]},VIDEO_INIT_ALTERNATING:{enabledDisplayIterations:[2],disabledVideoIterations:[],enabledVideoIterations:[],videoInitial:!0},VIDEO_INIT_DISPLAY_CONSECUTIVE:{videoInitial:!0,enabledDisplayIterations:[],disabledVideoIterations:[10,15,18],enabledVideoIterations:[4,5,9,12,13,17,20,21,29,33]},DISPLAY_INIT_VIDEO_CONSECUTIVE:{enabledDisplayIterations:[],disabledVideoIterations:[],enabledVideoIterations:[...Array(34).keys()].splice(2)}}))();constructor(e){let{freestar:t,freestarOutstreamVideo:i}=e;this._freestar=t,this._freestarOutstreamVideo=i}footerVideoInit(e){let{callback:t,videoAd:i,placement:n}=e;i&&i.vendor&&this.videoVendors[i.vendor]&&this.videoVendors[i.vendor]({callback:t,videoAd:i,placement:n})}getPlacementVideoAd(e){let{placement:t}=e;const{selectedSize:i}=t;if(!i?.videoEnabled)return;let n=freestar.fsdata.videoAds?.find((e=>e.name===i.videoAdId));return!n&&i.videoAdId&&(n=freestar.fsdata.placementVideos?.find((e=>e.id===i.videoId))),n}getEnabledVideo(e){let{placement:t}=e;const i=this.getPlacementVideoAd({placement:t});return!!i&&Object.assign(getPlacementVideoDetailsByScreenResolution(t),i)}getIfEnabledVideo(e){let{placement:t}=e;return!productIsDisabled({name:"videoAdhesion"})&&((!freestar.locData||!freestar.locData.iso||-1===VIDEO_DISALLOWED_GEOS.indexOf(freestar.locData.iso))&&(!(!t.stickyFooterOptions||!t.stickyFooterOptions.video)&&this.getEnabledVideo({placement:t})))}videoFetch(e){let{iteration:t,placement:i}=e;const n=getPlacementSizeMappingByScreenResolution(i),{stickyFooterOutstreamVideoPattern:s}=n;if(s&&"NO_STICKY_FOOTER_OUTSTREAM_VIDEO_PATTERN"!==s&&this.videoPatterns[s]){const{disabledVideoIterations:e,enabledVideoIterations:n,enabledDisplayIterations:r,videoInitial:a=!1}=this.videoPatterns[s];if(a&&1===t)return this.getIfEnabledVideo({placement:i});if(r.length){return!r.map((e=>t%e)).includes(0)&&this.getIfEnabledVideo({placement:i})}if(e.length){if(e.map((e=>t%e)).includes(0))return!1}if(n.length){if(n.map((e=>t%e)).includes(0))return this.getIfEnabledVideo({placement:i})}}return!1}setVideoAdhesionEnabled(e){e?(freestar.currentStickyFooter&&(freestar.currentStickyFooter.iteration=0),freestar.config.products.videoAdhesion.disabled=!1):freestar.config.products.videoAdhesion.disabled=!0}get videoVendors(){return{SPRINGSERVE:springserve,FREESTAR_OUTSTREAM_PLAYER:this._freestarOutstreamVideo}}}const stnInit=e=>{const{name:t,embedCode:i}=e;if(t&&i){const e=document.getElementById(t);if(e){const t=document.createRange().createContextualFragment(i);e.appendChild(t)}else freestar.log(20,`Failed to load STN video ad. Could not find container "${t}".`)}else freestar.log(30,"Failed to load STN video ad. Video ad must be configured with a name and embed code.")},PLAYER_API_ID="freestarPrimisPlayer",PRIMIS_ASPECT_RATIO=1.470588235,PRIMIS_SCRIPT_ID="freestarPrimisScript",loadScript=e=>{let{videoAd:t,container:i}=e;if(i&&i.appendChild){const{primisToken:e,device:i}=t,n=i===DEVICE_TYPE_DESKTOP.toUpperCase()||window.innerWidth>768?400:300,s=parseInt(n/PRIMIS_ASPECT_RATIO,10),r=Math.round((new Date).getTime()/1e3),a=encodeURIComponent(window.location.href),o=`${window.location.protocol}//live.primis.tech/live/liveView.php?s=${e}&cbuster=${r}&pubUrl=${a}&x=${n}&y=${s}&playerApiId=${PLAYER_API_ID}&schain=1.0,1!${FREESTAR_LOCATION_HOST},${window.freestar.fsdata.companyId},1`;tagLoadedMessage({bidder:"primis",tagUrl:o,placementId:t.name}),loadScriptWithDOMTarget({scriptSrc:o,target:getVideoContainer({videoAd:t}),id:PRIMIS_SCRIPT_ID}),window.top.sekindoFlowingPlayerOn=!1}},bindEventHandlers=e=>{let{player:t,requestTimestamp:i,videoAd:n}=e;t.addEventListener("adStarted",(function(){bidWonMessage({bidder:"primis",videoAd:n,requestTimestamp:i})})),window.freestar.deleteVideo=function(){window.freestar.log({title:VIDEO_LOG_TITLE},"Video delete");const e=getVideoContainer({videoAd:n});if(e){const t=document.getElementById(PRIMIS_SCRIPT_ID);t&&t.remove();const i=Array.from(e.children).find((e=>null!==e.querySelector("#primis_container_div")||"primis_container_div"===e.id));i&&e.removeChild(i)}}},getVideoContainer=e=>{let{videoAd:t}=e,i=document.querySelector("body");if(t.parentElement&&0===t.parentElement.indexOf("#")){if(i=document.querySelectorAll(t.parentElement)[0],t.nthElement>-1)try{i=i.children[t.nthElement]}catch(e){return freestar.log({title:VIDEO_LOG_TITLE},"PRIMIS ELEMENT NOT FOUND ON PAGE, SKIPPING"),!1}}else if(t.nthElement>-1)if(t.parentElement&&t.parentElement.length){const e=document.querySelectorAll(t.parentElement)[t.classIndex];try{i=e.children[t.nthElement]}catch(e){return freestar.log({title:VIDEO_LOG_TITLE},"PRIMIS ELEMENT NOT FOUND ON PAGE, SKIPPING"),!1}}else t.nthElement?i=document.body[t.nthElement]:freestar.log({title:VIDEO_LOG_TITLE},"COULD NOT ACQUIRE DOM NODE FOR PRIMIS VIDEO. CONFIGURATION FOR VIDEO INCORRECT!");return i},primisInit=e=>{window.addEventListener("primisPlayerInit",(function(t){t.detail.playerApiId===PLAYER_API_ID&&bindEventHandlers({player:t.detail,requestTimestamp:Date.now(),videoAd:e})}));const t=getVideoContainer({videoAd:e});null!==t?loadScript({videoAd:e,container:t}):freestar.log({title:VIDEO_LOG_TITLE},"COULD NOT ACQUIRE DOM NODE FOR PRIMIS VIDEO")};function connatixScriptLoad$1(e){let{videoAd:t}=e;const i="//cd.connatix.com/connatix.player.js?cid=f9509d53-804e-427d-a0bc-1204c0a3bcb1";freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX ELEMENTS : script loading..."),tagLoadedMessage({bidder:"connatix",placementId:t.name,tagUrl:i}),function(e){if(!window.cnx){window.cnx={},window.cnx.cmd=[];var t=e.createElement("iframe");t.src="javascript:false",t.display="none",t.onload=function(){var e=t.contentWindow.document,n=e.createElement("script");n.src=i,n.setAttribute("async","1"),n.setAttribute("type","text/javascript"),e.body.appendChild(n)},e.head.appendChild(t)}}(document)}function addScriptElement$1(e){let{videoAd:t,targetElement:i}=e;const n=createElement({type:"script",id:t.scriptId});i.appendChild(n),freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX ELEMENTS : script element created : ",n)}function connatixConfig$1(e){let{videoAd:t}=e;const i={playerId:t.playerId,settings:{defaultSoundMode:window.cnx.configEnums.DefaultSoundModeEnum.Off}};return(!t.parentElement.length||t.toFloat||t.adType&&"SLIDER"===t.adType)&&(i.settings.customization={floating:{mode:window.cnx.configEnums.FloatingModeEnum[t.parentElement&&"SLIDER"!==t.adType?"AfterInView":"Always"],fixedPosition:window.cnx.configEnums.FloatingFixedPositionModeEnum.Page,scrollPosition:window.cnx.configEnums.FloatingScrollPositionEnum.BottomRight,floatingWidth:t.width&&t.width>100?t.width:401,floatingGutterX:5,floatingGutterY:100}}),i}function connatixElementsInit(e){if(freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX ELEMENTS : video init..."),!e.scriptId)return;const{parentElement:t,classIndex:i}=e,n=i&&i>-1?i:0,s=t?document.querySelectorAll(t)[n]:document.body;if(s){freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX ELEMENTS : video target element : ",s);const t=Date.now();connatixScriptLoad$1({videoAd:e}),addScriptElement$1({videoAd:e,targetElement:s}),window.cnx.cmd.push((function(){cnx(connatixConfig$1({videoAd:e})).render(e.scriptId,(function(i,n){n&&n.on&&window.cnx.configEvents&&window.cnx.configEvents.AdPlay&&n.on(window.cnx.configEvents.AdPlay,(()=>{bidWonMessage({bidder:"connatix",videoAd:e,requestTimestamp:t})}))}))}))}else freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX ELEMENTS : video ad parent element not found. Skipping...")}function connatixScriptLoad(e){let{videoAd:t}=e;const i="//cd.connatix.com/connatix.playspace.js?cid=f9509d53-804e-427d-a0bc-1204c0a3bcb1";freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX PLAYSPACE : script loading..."),tagLoadedMessage({bidder:"connatix",placementId:t.name,tagUrl:i}),function(e){if(!window.cnxps){window.cnxps={},window.cnxps.cmd=[];var t=e.createElement("iframe");t.src="javascript:false",t.display="none",t.onload=function(){var e=t.contentWindow.document,n=e.createElement("script");n.src=i,n.setAttribute("async","1"),n.setAttribute("type","text/javascript"),e.body.appendChild(n)},e.head.appendChild(t)}}(document)}function addScriptElement(e){let{videoAd:t,targetElement:i}=e;const n=createElement({type:"script",id:t.scriptId});i.appendChild(n),freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX PLAYSPACE : script element created : ",n)}function connatixConfig(e){let{videoAd:t}=e;const i={playerId:t.playerId,settings:{defaultSoundMode:window.cnxps.configEnums.DefaultSoundModeEnum.Off}};return(!t.parentElement.length||t.toFloat||t.adType&&"SLIDER"===t.adType)&&(i.settings.customization={floating:{mode:window.cnxps.configEnums.FloatingModeEnum[t.parentElement&&"SLIDER"!==t.adType?"AfterInView":"Always"],fixedPosition:window.cnxps.configEnums.FloatingFixedPositionModeEnum.Page,scrollPosition:window.cnxps.configEnums.FloatingScrollPositionEnum.BottomRight,floatingWidth:t.width&&t.width>100?t.width:401,floatingGutterX:5,floatingGutterY:100}}),i}function connatixplayspaceInit(e){if(freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX PLAYSPACE : video init..."),!e.scriptId)return;const{parentElement:t,classIndex:i}=e,n=i&&i>-1?i:0,s=t?document.querySelectorAll(t)[n]:document.body;if(s){freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX PLAYSPACE : video target element : ",s);const t=Date.now();connatixScriptLoad({videoAd:e}),addScriptElement({videoAd:e,targetElement:s}),window.cnxps.cmd.push((function(){cnxps(connatixConfig({videoAd:e})).render(e.scriptId,(function(i,n){n&&n.on&&window.cnxps.configEvents&&window.cnxps.configEvents.AdPlay&&n.on(window.cnxps.configEvents.AdPlay,(()=>{bidWonMessage({bidder:"connatix",videoAd:e,requestTimestamp:t})}))}))}))}else freestar.log({title:VIDEO_LOG_TITLE},"CONNATIX PLAYSPACE : video ad parent element not found. Skipping...")}const VIDEO_PLAYERS_MAP={DISPLAY:"InBannerVideoPlayer",OUTSTREAM:"OutstreamVideoPlayer",INCONTENT:"InContentVideoAd",FLOATING:"FloatingVideoAd",INCONTENT_TO_FLOATING:"InContentToFloatingVideoAd"};class Video{videoPlayers={};_stickyFooterVideo;constructor(e){let{freestar:t,eventBus:i,dispensaryData:n}=e;this._freestar=t,this._dispensaryData=n,i.subscribe(STICKY_FOOTER_RESIZE,(e=>{let{payload:{stickyFooterHeight:t}}=e;this._updateBottomSpacingInAllPlayers(t)}))}_updateBottomSpacingInAllPlayers(e){Object.values(this.videoPlayers).forEach((t=>{t.updateBottomSpacing(e)}))}remove=e=>{let{uuid:t=null,name:i=null}=e;t&&this.videoPlayers[t]&&(this.videoPlayers[t].remove(),delete this.videoPlayers[t]),i&&Object.keys(this.videoPlayers).forEach((e=>{this.videoPlayers[e].videoAd.name===i&&(this.videoPlayers[e].remove(),delete this.videoPlayers[t])}))};add=async e=>{if(productIsDisabled({name:"video"}))return;const t=this._dispensaryData.fsdata.videoAds.find((t=>t.name===e));if(!t)return;const{vendor:i,device:n,name:s,videoSelect:r,adType:a}=t;if(i&&n&&this._isVideoAllowed({device:n,videoSelect:r})){if(freestar.log({title:VIDEO_LOG_TITLE},`${s} eligible to run with device type ${freestar.deviceInfo.device.type} and is a ${i} video.`),"FREESTAR_OUTSTREAM_PLAYER"===i){const e=(e,t)=>{t?.uuid&&this.remove({uuid:t.uuid})},i=VIDEO_PLAYERS_MAP[a];if(!i)return;const n=await AppContainer.instance.create(i,{provide:{params:{videoAd:t,callback:e}}});this.videoPlayers[n.uuid]=n;const s=getCurrentStickyFooterHeight();return void n.updateBottomSpacing(s)}const e={connatixInit:connatixElementsInit,primisInit:primisInit,connatixplayspaceInit:connatixplayspaceInit,stnInit:stnInit},n=`${i.split("_").join("").toLowerCase()}Init`;e[n]&&e[n](t)}};init=(()=>{var e=this;return function(){let{isAfterLoadingPage:t=!1,failSafeStart:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e._dispensaryData.fsdata.videoAds&&e._dispensaryData.fsdata.videoAds.length&&(performance.mark("video-initialization-start"),e._dispensaryData.fsdata.videoAds.forEach((n=>{n&&(n.videoAdStarted||"VIDEO_ADHESION_FLOATING"!==n.adType&&(!i&&(!t&&n.delayVideoAd||t&&!n.delayVideoAd)||(e._freestar.log(1,`VIDEO: Checking to see if ${n.name} should run`),n.onCallVideo?e._freestar.log(1,"VIDEO: Video is on call and will not run until the freestar.newVideo method is ran"):(e._freestar.log(1,`VIDEO: ${n.name} is being created!`),e.add(n.name)),n.videoAdStarted=!0)))})),performance.mark("video-initialization-end"))}})();get stickyFooterVideoInstance(){return this._stickyFooterVideo||(this._stickyFooterVideo=new FooterVideo({freestar:this._freestar,freestarOutstreamVideo:e=>{let{videoAd:t,callback:i,placement:n}=e;const s={videoAd:t,callback:(e,t)=>{t?.uuid&&this.remove({uuid:t.uuid}),i(e,t)},placement:n};AppContainer.instance.create(TOKEN.OUTSTREAM_VIDEO_PLAYER,{provide:{params:s}}).then((e=>{this.videoPlayers[e.uuid]=e}))}})),this._stickyFooterVideo}_isVideoAllowed=e=>{let{device:t=DEVICE_TYPE_DESKTOP,videoSelect:i}=e;return this._videoDeviceCheck({videoDeviceType:t.toLowerCase()})||"ALL_DEVICES"===t&&this._videoAllowed({videoSelect:i})};_videoAllowed=e=>{let{videoSelect:t}=e;return!(t&&t.length&&(!t?.length||null===document.getElementById(t)))};_videoDeviceCheck=e=>{let{videoDeviceType:t}=e;return"all_devices"===t||(freestar.deviceInfo.device.type===t||freestar.deviceInfo.device.type===DEVICE_TYPE_TABLET&&t===DEVICE_TYPE_DESKTOP)}}ModuleRegistry.class(Video,{token:TOKEN.VIDEO,dependencies:["freestar",TOKEN.EVENT_BUS,TOKEN.DISPENSARY_DATA],defaultAlias:"video"});const LOG_TITLE="SUPERFLEX V3.1.1",LOG_INFO={title:LOG_TITLE,styles:"background: black; color: white; border-radius: 3px; padding: 3px"},LOG_SUCCESS={level:99,title:LOG_TITLE,styles:"background: lightblue; color: black; border-radius: 3px; padding: 3px"},validBidSizes=[[468,60],[320,50],[320,100],[300,250],[300,50],[300,100]],validParentSizes=[[970,250],[970,90],[728,90],[336,280],[300,600],[300,250]],largeLeaderboardSizes=[[970,250],[970,90],[728,90]],invalidBidders=["onemobile","teads"];function getIframeSize(e){if(!e)return{width:1,height:1};const{height:t,width:i}=e.getBoundingClientRect();if(e.contentDocument&&e.contentDocument.body){const{clientWidth:n,clientHeight:s}=e.contentDocument.body;if(n>1&&s>1)return{width:Math.max(i,n),height:Math.max(t,s)}}return{width:i,height:t}}function getLargestPossibleDimensions(e){let{placement:t}=e,{sizes:i}=t;t?.stickyFooterOptions?.active&&(i=i.filter((e=>970!==e[0])));const n=validParentSizes.map((e=>e.join("x")));return i=i.filter((e=>Array.isArray(e)&&n.includes(e.join("x")))),getLargestPossibleSizes(i)}function isValidBidSize(e){let{size:t}=e;return validBidSizes.map((e=>e.join("x"))).includes(t)}function getValidBids(e){let{bids:t}=e;return Array.isArray(t)&&0!==t.length?t.filter((e=>"superflex"!==e.bidderCode&&!invalidBidders.includes(e.bidderCode)&&(!e.status||"rendered"!==e.status&&"targetingSet"!==e.status)&&isValidBidSize({size:e.size}))).sort(((e,t)=>t.cpm-e.cpm||t.width-e.width||t.height-e.height)):[]}function getLargestBidBySize(e){let{bids:t}=e;return 0===t.length?[]:t.sort(((e,t)=>t.width-e.width||t.height-e.height))[0]}function isViewportSuperflex(e){let t=0;for(let i=0;i<e.length;i++){let n=e[i];n.viewport.size[0]>t&&fsBrowserWidth()>=n.viewport.size[0]&&(t=n.viewport.size[0])}return!!e.find((e=>e.viewport.size[0]===t)).superflex}function getNumberOfPossibleAdditionalAds(e){let{remainingSpace:t=null,adDimensions:i,targetDimension:n}=e;return"width"===n?Math.floor(t/i[0]):1}class SuperflexManager{constructor(e){let{freestar:t,logger:i}=e;this.freestar=t,this.fsprebid=window.fsprebid||{},this.googletag=window.googletag||{},this.logs=i}update(e){let{placements:t}=e;this.placements=t.filter((e=>{let t=!0;if(e.sizeMappings.forEach((e=>{e.size.forEach((e=>{isFluidSize(e)&&(t=!1)}))})),t)return e})),this.active=!productIsDisabled({name:"superflex"})&&0!==t.length;const{blocklist:i=[]}=JSON.parse(sessionStorageGet({key:"fs.superflex"}))||{};this.blocklist=i}checkLineItems(e){e.needed.filter((e=>"TRAFFICKED"===e.demandSourceType||"DIRECT"===e.demandSourceType)).forEach((e=>{e.slots.filter((e=>this.placements.some((t=>t.name===e))&&!this.blocklist.includes(e))).forEach((e=>{this.blocklist.push(e),sessionStorageSet({key:"fs.superflex",value:{blocklist:this.blocklist},type:SESSION_STORAGE_TYPES.object})}))}))}getPlacementsNames(){return this.placements?this.placements.map((e=>e.name)):[]}isSuperflex(e){let{placement:t}=e;return!(!t||!this.getPlacementsNames().includes(t.name))&&!!(t&&t.sizeMappings&&isViewportSuperflex(t.sizeMappings))}removeCSS(e){let{elementId:t}=e;const i=document.getElementById(t);i&&(i.innerHTML=""),document.getElementById(`_fs-sf-${i.className.split("fs-sf-")[1]}-stylesheet`)&&document.getElementById(`_fs-sf-${i.className.split("fs-sf-")[1]}-stylesheet`).remove(),i.className.split(" ").forEach((e=>{-1!==e.indexOf("fs-sf")&&i.classList.remove(e)}))}refresh(e){let{elementId:t,placement:i}=e;this.removeCSS({elementId:t});const n=generateUUID(),s=freestar.refreshLibrary[t];s&&(freestar.refreshLibrary[t]=s,freestar.refreshLibrary[t].timesRefreshed+=1),freestar.newAdSlots([{slotId:t,placementName:i.name,targeting:{"fs-sf-uuid":n,fsrefresh:freestar.refreshLibrary[i.name]?freestar.refreshLibrary[i.name].timesRefreshed:0}}])}auctionEndCallback(e){const{adUnits:t}=e;t.forEach((e=>{const{code:t}=e;if(-1!==e.code.indexOf("_fs-sf-"))return;if(-1!==e.code.indexOf("browsi"))return;if(!(e=window.freestar.adUnitManager.getAdUnitByPrebidCode(t)))return this.logs.add(`Prebid Auction End Event for ${t}`),this.logs.add("Adunit not found"),void this.logs.show(LOG_INFO);const{placement:i,prebid:n,slot:s}=e;if(!this.isSuperflex({placement:i}))return;if(this.logs.add(`Prebid Auction End Event for ${t}`),this.logs.add("Placement is Superflex"),!1===this.shouldRun({placement:i}))return this.logs.add(`There is an active sponsorship for ${i.name}`),void this.logs.show(LOG_INFO);const r=n.bids.filter((e=>-1!==invalidBidders.indexOf(e.bidder)));if(0!==r.length)return this.logs.add(`Placement contains invalid bidder(s): ${[...new Set(r.map((e=>e.bidder)))].join(", ")}`),void this.logs.show(LOG_INFO);let a=this.fsprebid.getBidResponsesForAdUnitCode(t);if(0===a.bids.length)return this.logs.add("Did not receive any bids"),void this.logs.show(LOG_INFO);a=a.bids,this.logs.add(`Received ${a.length} bid(s)`);const o=getValidBids({bids:a});if(0===o.length)return this.logs.add("Did not receive any valid bids"),void this.logs.show(LOG_INFO);this.logs.add(`Received ${o.length} valid bid(s)`);const d=o[0],l=getLargestBidBySize({bids:a});if(d.adId===l.adId)return this.logs.add("topValidBidByCPM is the same ad as topBidBySize"),void this.logs.show(LOG_INFO);if(d.width===l.width&&d.height===l.height)return this.logs.add("topValidBidByCPM is the same dimensions as topBidBySize"),void this.logs.show(LOG_INFO);this.logs.add(`topValidBidByCPM: ${d.adId} $${d.cpm} (${d.width}x${d.height})`),this.logs.add(`topBidBySize: ${l.adId} $${l.cpm} (${l.width}x${l.height})`);const c=getLargestPossibleDimensions({placement:i}),u=c[0]>c[1]?"width":"height",h=c["width"===u?0:1]-d[u];if(h<d[u])return this.logs.add(`There is not enough space (${h}px) left to render additional ads`),void this.logs.show(LOG_INFO);this.logs.add(`There is ${h}px of space remaining`);const f=getNumberOfPossibleAdditionalAds({remainingSpace:h,adDimensions:[d.width,d.height],targetDimension:u});if(f<1)return;if(this.logs.add(`There is space for ${f} more ad(s)`),l.cpm>=d.cpm*(f+1))return this.logs.add(`topBidBySize CPM is greater than the combined potential CPM of ${f+1} ${d.width}x${d.height} ads ($${l.cpm} vs. $${d.cpm*(f+1)})`),void this.logs.show(LOG_INFO);this.logs.add(`topBidBySize CPM is less than the combined potential CPM of ${f+1} ${d.width}x${d.height} ads ($${l.cpm} vs. $${d.cpm*(f+1)})`);const p=s.getTargeting("fs-sf-uuid")[0]||generateUUID(),g=createElement({type:"div",id:`_fs-sf-${s.getSlotElementId()}-0`,attributes:[{name:i.name}]}),m=document.getElementById(s.getSlotElementId());m.classList.add(`fs-sf-${p}`);const E=createElement({type:"style",id:`_fs-sf-${s.getSlotElementId()}-stylesheet`});E.textContent+=`\n                    .fs-sf-${p} {\n                        display: flex !important;\n                        align-items: center !important;\n                        justify-content: space-evenly !important;\n                    }\n                    .fs-sf-${p} .__fs-ancillary {\n                        max-width: ${d.width}px;\n                    }\n                `,"width"===u&&(E.textContent+=`\n                        .fs-sf-${p} {\n                            width: ${c[0]}px !important;\n                            flex-direction: row !important;\n                            margin: 0 auto;\n                        }\n                    `),"height"===u&&(E.textContent+=`\n                        .fs-sf-${p} {\n                            height: ${c[1]}px !important;\n                            flex-direction: column;\n                        }\n                    `),m.innerHTML="",m.appendChild(g),this.googletag.destroySlots([s]),this.fsprebid.removeAdUnit(n.code),a.forEach((e=>{e.adId!==d.adId&&(e.adUnitCode=generateUUID())}));const _=createGAMSlot({placement:i,sizes:[d.width,d.height],id:g.id,slotConfig:{targeting:Object.assign(this.fsprebid.getAdserverTargetingForAdUnitCode(n.code),{"fs-sf-uuid":p,"fs-sf-index":"0",fsrefresh:freestar.refreshLibrary[i.name]?freestar.refreshLibrary[i.name].timesRefreshed:0})}});this.logs.add(`Created an ad for topValidBidByCPM ${g.id}`);const y=[],I=[];for(let e=1;e<=f;e++){const t=createElement({type:"div",id:`_fs-sf-${s.getSlotElementId()}-${e}`,classList:["_fs-sf-ad"],attributes:{name:i.name,[ANCILLARY_CONTROL_KEY]:"false"}});m.appendChild(t),y.push(createGAMSlot({placement:i,sizes:[d.width,d.height],id:t.id,slotConfig:{targeting:{"fs-sf-uuid":p,"fs-sf-index":`${e}`,fsrefresh:freestar.refreshLibrary[i.name]?freestar.refreshLibrary[i.name].timesRefreshed:0}}}));const n=index(i);n.name=`_fs-sf-${s.getSlotElementId()}-${e}`,n.sizes=[[d.width,d.height]],n.sizeMappings=n.sizeMappings.map((e=>(e.size=[[d.width,d.height]],e.mediaTypes=e.mediaTypes.filter((e=>"video"!==e)),e))),n.bidders=n.bidders.filter((e=>-1===invalidBidders.indexOf(e.bidder)));const r=format_pbjs(n);r.mediaTypes.banner.sizes=[[d.width,d.height]],I.push(r),this.logs.add(`Created an additional ad ${t.id}`)}if(document.head.appendChild(E),this.googletag.pubads().refresh([_]),addAdUnits({adUnits:I}),fsRequestBids({elementIds:I.map((e=>e.code)),slots:y}),!freestar.refreshLibrary[s.getSlotElementId()]){const e=setTimeout((()=>{clearTimeout(e),freestar.refreshLibraryCreator(s.getSlotElementId())}),1e3)}this.logs.show(LOG_SUCCESS)}))}slotRequestedCallback(e){const{slot:t}=e;if(-1!==t.getSlotElementId().indexOf("_fs-sf-"))return;const i=window.freestar.adUnitManager.getAdUnitBySlotElementId(t.getSlotElementId());if(!i)return;const{placement:n}=i;if(this.isSuperflex({placement:n})&&0===t.getTargeting("fs-sf-uuid").length){const e=generateUUID();t.setTargeting("fs-sf-uuid",e)}}waitForIFrameElm(e){const t=setTimeout((()=>{clearTimeout(t),this.slotRenderEndedCallback(e)}),250)}isLeaderboardLargeSize(e){let{width:t,height:i}=e;return largeLeaderboardSizes.some((e=>{let[n,s]=e;return t===n&&i===s}))}slotRenderEndedCallback(e){const{slot:t}=e;if(-1!==t.getSlotElementId().indexOf("_fs-sf-"))return;if(-1!==t.getSlotElementId().indexOf("browsi"))return;const i=window.freestar.adUnitManager.getAdUnitBySlotElementId(t.getSlotElementId());if(!i)return this.logs.add(`Slot Render Ended Event for ${t.getSlotElementId()}`),this.logs.add("Adunit not found"),void this.logs.show(LOG_INFO);const{placement:n}=i;if(!this.isSuperflex({placement:n}))return;if(this.logs.add(`Slot Render Ended Event for ${n.name}`),!1===this.shouldRun({placement:n}))return this.logs.add(`There is an active sponsorship for ${n.name}`),void this.logs.show(LOG_INFO);const{enabledSuperflexBlocklist:s,gamSuperflexBlocklist:r}=freestar.fsdata;if(s){if(!["advertiserId","lineItemId","creativeId","campaignId"].every((t=>-1===r.indexOf(e[t]))))return this.logs.add("Slot contains matching entry on blocklist, exiting"),void this.logs.show(LOG_INFO)}const a=document.getElementById(t.getSlotElementId());if(!a)return this.logs.add("Element not found, exiting"),void this.logs.show(LOG_INFO);const o=a.querySelector('div[id*="google_ads_iframe_"]');if(!o)return this.logs.add("Element not found, exiting"),void this.logs.show(LOG_INFO);if(o.classList.contains("_fs-sf-ad"))return;this.logs.add("Placement is Superflex");const d=getLargestPossibleDimensions({placement:n});if(!d)return;this.logs.add(`Largest possible size is ${d[0]}x${d[1]}`);const l=d[0]-d[1]>100?"width":"height",c=a.querySelector('iframe[id*="google_ads_iframe_"]'),u=getIframeSize(c);if(u.width<=1||u.height<=1)return this.logs.add("Element size not found, exiting"),void this.logs.show(LOG_INFO);if(u.width>300&&u.width<320&&(u.width=300),u.width>320&&u.width<330&&(u.width=320),u.width>=330&&u.width<468&&(u.width=336),u.width>468&&u.width<728&&(u.width=468),u.width>728&&u.width<970&&(u.width=970),u.height>50&&u.height<60&&(u.height=50),u.height>60&&u.height<90&&(u.height=60),u.height>90&&u.height<100&&(u.height=90),u.height>100&&u.height<250&&(u.height=100),u.height>250&&u.height<280&&(u.height=250),u.height>280&&u.height<600&&(u.height=280),u.height>600&&(u.height=600),this.logs.add(`Size of ad rendered is ${u.width}x${u.height}`),this.isLeaderboardLargeSize({width:u.width,height:u.height}))return this.logs.add("Superflex with leaderboard large was already rendered"),void this.logs.show(LOG_INFO);const h=d["width"===l?0:1]-u[l];if(h<c[l])return this.logs.add(`There is not enough space (${h}px) left to render additional ads`),void this.logs.show(LOG_INFO);this.logs.add(`There is ${h}px of space remaining`);const f=getNumberOfPossibleAdditionalAds({remainingSpace:h,largestPossibleDimension:d,adDimensions:[u.width,u.height],targetDimension:l});if(f<1)return;this.logs.add(`There is space for ${f} more ad(s)`);const p=t.getTargeting("fs-sf-uuid")[0];a.classList.add(`fs-sf-${p}`);const g=createElement({type:"style",id:`_fs-sf-${t.getSlotElementId()}-stylesheet`});"width"===l&&(g.textContent+=`\n                .fs-sf-${p} {\n                    width: ${d[0]}px;\n                    display: flex;\n                    align-items: center !important;\n                    justify-content: space-evenly !important;\n                    flex-direction: row !important;\n                    flex-wrap: nowrap;\n                    margin: 0 auto;\n                }\n                .fs-sf-${p}>div[id*="google_ads_iframe_"] {\n                    width: ${u.width}px;\n                    height: auto !important;\n                }\n            `),"height"===l&&(g.textContent+=`\n                .fs-sf-${p} {\n                    height: ${d[1]}px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: space-evenly;\n                    flex-direction: column;\n                }\n            `);const m=[],E=[];for(let e=1;e<=f;e++){const i=createElement({type:"div",id:`_fs-sf-${t.getSlotElementId()}-${e}`,classList:["_fs-sf-ad"],attributes:[{name:n.name}]});a.appendChild(i),E.push(createGAMSlot({placement:n,sizes:[[u.width,u.height]],id:i.id,slotConfig:{targeting:{"fs-sf-uuid":p,"fs-sf-index":`${e}`,fsrefresh:freestar.refreshLibrary[n.name]?freestar.refreshLibrary[n.name].timesRefreshed:0}}}));const s=JSON.parse(JSON.stringify(n));s.name=`_fs-sf-${t.getSlotElementId()}-${e}`,s.sizes=[[u.width,u.height]],s.sizeMappings=s.sizeMappings.map((e=>(e.size=[[u.width,u.height]],e.mediaTypes=e.mediaTypes.filter((e=>"video"!==e)),e))),s.bidders=s.bidders.filter((e=>-1===invalidBidders.indexOf(e.bidder)));const r=format_pbjs(s);r.mediaTypes.banner.sizes=[[u.width,u.height]],m.push(r),"width"===l&&(g.textContent+=`\n                    #_fs-sf-${t.getSlotElementId()}-${e}>div[id*="google_ads_iframe_"] {\n                        width: ${u.width}px;\n                    }\n                `),this.logs.add(`Created an additional ad ${i.id} with uuid ${p}`)}document.head.appendChild(g),addAdUnits({adUnits:m}),fsRequestBids({elementIds:m.map((e=>e.code)),slots:E}),this.logs.show(LOG_SUCCESS)}shouldRun(e){let{placement:t}=e;return-1===this.blocklist.indexOf(t.name)}registerSuperflexCallbacks(){const e=!getUrlParameter("sfv3-gam-only"),t=!getUrlParameter("sfv3-prebid-only");e&&this.fsprebid.onEvent(PREBID_AUCTION_END,this.auctionEndCallback.bind(this)),this.googletag.pubads().addEventListener(GAM_SLOT_REQUESTED,this.slotRequestedCallback.bind(this)),t&&this.googletag.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,this.waitForIFrameElm.bind(this))}}class Superflex{constructor(e){let{freestar:t}=e;this.manager=new SuperflexManager({freestar:t,logger:new Logger$1}),this.freestar=t}init(){this.manager.update({placements:this.freestar.fsdata.placements.filter((e=>e.sizeMappings.some((e=>!0===e.superflex))))}),this.manager.active&&this.manager.registerSuperflexCallbacks(),this.freestar.superflex={checkLineItems:this.checkLineItems,refresh:this.refresh,isSuperflex:this.isSuperflex,removeCSS:this.removeCSS}}checkLineItems=e=>this.manager.checkLineItems(e);isSuperflex=e=>this.manager.isSuperflex(e);refresh=e=>this.manager.refresh(e);removeCSS=e=>this.manager.removeCSS(e)}ModuleRegistry.class(Superflex,{token:"Superflex",dependencies:["freestar"],defaultAlias:"superflex"});const domElementFetch=e=>{let{domSelector:t}=e;return document.querySelector(t)};function isBlockedByShim(){const{removeFooter:e,specialAdhesionRemoved:t,customFooter:i}=freestar.fsdata;if(e||t||i){const e=["#fs-select-footer-remove","#fs-special-remove"];for(let t=0;t<e.length;t++)if(domElementFetch({domSelector:e[t]}))return!0}return!1}function footerIsBlocked(e){let{placement:t}=e;if(isBlockedByShim())return!0;const{remove:i,adhesionRemove:n,add:s}=optionObjectFetch({placement:t,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS});return!(!i||!domElementFetch({domSelector:i}))||(!(!n||!domElementFetch({domSelector:n}))||!(!s||document.getElementById("fs-select-footer")))}class StickyFooter{constructor(e){let{freestar:t,video:i={},eventBus:n}=e;this._freestar=t,this._eventBus=n,this._videoInstance=i.stickyFooterVideoInstance||{}}newStickyFooter=e=>{newStickyFooter(e,this._videoInstance,this._attachStickyFooterResizeListener.bind(this))};setVideoAdhesionEnabled=e=>this._videoInstance.setVideoAdhesionEnabled?.(e);_attachStickyFooterResizeListener=()=>{this._resizeObserver&&this._resizeObserver.disconnect(),this._resizeObserver=new ResizeObserver((()=>{const e=getCurrentStickyFooterHeight();this._eventBus.emit(STICKY_FOOTER_RESIZE,{stickyFooterHeight:e})}));const e=getCurrentStickyFooterElement();e&&this._resizeObserver.observe(e)};init=()=>{try{performance.mark("stickyFooter-initialization-start");const e="Sticky Footer: initStickyFooter method - ";this._freestar.log(1,e+" invoked looking for sticky placements!");const t=this._freestar.fsdata.placements.filter((e=>e.validAdSizes&&isOptionActive({placement:e,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS})&&e[PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS].isOnCall));if(t.length)this._freestar.log(1,`${e} there are ${t.length} on call sticky footer placements. There will be no standard sticky footer invoked by Pubfig.js!`);else{this._freestar.log(1,e+" there are no on call sticky footer placements. Attempting to find a default sticky footer placement");const t=this._freestar.fsdata.placements.filter((e=>e.validAdSizes&&isOptionActive({placement:e,type:PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS})&&!e[PRODUCT_OPTIONS.STICKY_FOOTER_OPTIONS].isOnCall))[0];if(t&&!footerIsBlocked({placement:t})){this._freestar.log(1,`${e} ${t.name} is not blocked invoking AddStickyFooter.`);let{stickyFooterOutstreamVideoPattern:i}=getPlacementVideoDetailsByScreenResolution(t);"VIDEO_DISPLAY_CONCURRENT"===i&&t.stickyFooterOptions.video?this._freestar.currentStickyFooter=new AddConcurrentStickyFooterVideo({placement:t,videoInstance:this._videoInstance}):this._freestar.currentStickyFooter=new AddStickyFooter(t,this._videoInstance),this._attachStickyFooterResizeListener(),this._freestar.deleteStickyFooter=this._freestar.currentStickyFooter.deleteStickyFooter||this._freestar.currentStickyFooter.footer.deleteStickyFooter}else this._freestar.log(1,e+"no default sticky placement found or it is blocked due to rules found in the footerIsBlocked method. There will be no standard sticky footer invoked by Pubfig.js!")}performance.mark("stickyFooter-initialization-end")}catch(e){this._freestar.log({title:"STICKY FOOTER",styles:"background: red; color: white; border-radius: 3px; padding: 3px"},e.message)}}}ModuleRegistry.class(StickyFooter,{token:"StickyFooter",dependencies:[TOKEN.FREESTAR,{token:"Video",optional:!0},TOKEN.EVENT_BUS],defaultAlias:"stickyFooter"});class FreestarVideoScripts{async load(){["https://vjs.zencdn.net/7.20.2/video-js.css","https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs-contrib-ads.css","https://cdnjs.cloudflare.com/ajax/libs/videojs-ima/1.11.0/videojs.ima.css"].forEach((e=>{document.head.appendChild(createElement({type:"link",attributes:{rel:"stylesheet",href:e}}))})),await loadScriptAsync("https://vjs.zencdn.net/7.20.2/video.min.js"),await Promise.all([loadScriptAsync("https://imasdk.googleapis.com/js/sdkloader/ima3.js"),loadScriptAsync("https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs-contrib-ads.js"),loadScriptAsync("https://cdnjs.cloudflare.com/ajax/libs/videojs-ima/1.11.0/videojs.ima.js")]),tagLoadedMessage({bidder:LOG_TITLE$1,placementId:"",tagUrl:""})}}ModuleRegistry.class(FreestarVideoScripts,{token:TOKEN.FOP_VIDEO_SCRIPTS,factory:async()=>{const e=new FreestarVideoScripts;return await e.load(),e}});const isMobile=e=>{let{freestar:t}=e;return"mobile"===t?.deviceInfo?.device?.type},PRODUCT_DENSITY=1,getValidPlacements=e=>{let{win:t,fsdata:i}=e,n=[];const{placements:s}=i,r=new Map;return s.forEach((e=>{const i=document.getElementById(e.name);if(!i)return;if(i.offsetTop<t.innerHeight)return;const s=e.sizeMappings.filter((e=>{if(fsBrowserWidth()>=e.viewport.size[0])return e}))[0];if(!s)return;const a=s.size.map((function(){let[e,t]=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return`${e}x${t}`}));a.includes("300x250")&&(r.set(e.name,i.offsetTop),n.push(e))})),n.sort(((e,t)=>r.get(t.name)-r.get(e.name))),n=n.slice(0,PRODUCT_DENSITY),n};class Carousel{constructor(e){let{freestar:t,placement:i,win:n,branding:s}=e;this._freestar=t,this._branding=s,this._win=n,this.parent=i,this.options=this.parent.carouselOptions,this.placements=this._freestar.fsdata.placements.filter((e=>e?.carouselOptions?.active&&e?.carouselOptions?.parent===this.parent.name)),this.init()}init(){const e=Math.floor(this._win.innerHeight-327);this.scrollBoundingDimensions={top:50,height:e}}_addDebug(){const e=createElement({type:"style",id:"_fs-carousel-debug-stylesheet"});e.textContent=`\n            ._fs-carousel-debug {\n                position: fixed;\n                width: 100%;\n                height: ${this.scrollBoundingDimensions.height}px;\n                top: ${this.scrollBoundingDimensions.top}px;\n                border: 1px solid black;\n                pointer-events: none;\n            }\n        `,this._win.document.head.appendChild(e);const t=createElement({type:"div",classList:["_fs-carousel-debug"]});t.setAttribute("name",`_fs-carousel-${this.uuid}`),this._win.document.body.appendChild(t)}getCSS(){const e=this._branding.getGlobalBranding();return`\n            ._fs-carousel-container {\n                position: relative;\n                width: ${310*this.options.numberOfChildren}px !important;\n                height: 277px !important;\n                overflow: hidden;\n            }\n            ._fs-carousel-container ._fs-carousel-wrapper {\n                position: absolute;\n                left: 0px;\n                left: var(--left);\n                width: ${310*this.options.numberOfChildren}px;\n                display: flex;\n                justify-content: space-between;\n                padding-left: 1px;\n            }\n            ._fs-carousel-container ._fs-carousel-child {\n                all: initial;\n                min-width: 300px;\n                height: ${e?277:250}px;\n            }\n        `}addHTML(){this.elm=document.getElementById(`${this.parent.name}-container`),this.elm.classList.add("_fs-carousel-container");const e=createElement({type:"div",classList:["_fs-carousel-wrapper"]});this.placements.forEach((t=>{const i=createElement({type:"div",classList:["_fs-carousel","_fs-carousel-child"]}),n=createElement({type:"div",id:t.name,attributes:[{name:t.name}]});i.appendChild(n),e.appendChild(i)})),this.elm.appendChild(e),this._bindIntersectionObserver()}_bindIntersectionObserver(){let{elm:e=this.elm}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.observer=new IntersectionObserver(this._intersectionCallback.bind(this),{rootMargin:`-${this.scrollBoundingDimensions.top}px 0px -${this._win.innerHeight-(this.scrollBoundingDimensions.top+this.scrollBoundingDimensions.height)}px 0px`,threshold:this._buildThresholdList(this._win.innerHeight/2)}),this.observer.observe(e)}_mapRange(e){let{value:t,inRange:i,outRange:n}=e;const[s,r]=i,[a,o]=n,d=a+(t-s)*(o-a)/(r-s);return d>o?o:d<a?a:d}_buildThresholdList(e){let t=[];for(let i=5;i<=e;i++){let n=i/e;t.push(n)}return t.push(0),t}_getScrollingDirection(e){let{last:t,current:i}=e,n=null;return t>i&&(n="UP"),t<i&&(n="DOWN"),n}_scrollCallback(){this.lastScrollYValue||(this.lastScrollYValue=this._win.scrollY),this.startingScrollYValue||(this.startingScrollYValue=this._win.scrollY);const e=this._getScrollingDirection({last:this.lastScrollYValue,current:this._win.scrollY});if(this.lastScrollYValue=this._win.scrollY,!e)return;"DOWN"===e&&this.lastScrollYValue>=this.startingScrollYValue+this.scrollBoundingDimensions.height&&(clearInterval(this.scrollTimer),this._bindIntersectionObserver()),"UP"===e&&this.lastScrollYValue>=this.startingScrollYValue&&(clearInterval(this.scrollTimer),this._bindIntersectionObserver());const t=this._mapRange({value:this.lastScrollYValue-this.startingScrollYValue,inRange:[1,this.scrollBoundingDimensions.height],outRange:[1,300*(this.options.numberOfChildren-1)]}),i=t>=0?-1*t:0;this.elm.style.setProperty("--left",`${i}px`)}_intersectionCallback(e){for(let t of e)(t.isIntersecting||t.isVisible)&&(this.observer.unobserve(t.target),this.scrollTimer=setInterval(this._scrollCallback.bind(this),10))}}class CarouselManager{constructor(e){let{freestar:t,window:i,analytics:n,branding:s}=e;this._freestar=t,this._win=i,this._analytics=n,this._branding=s}prepopulatePlacements=()=>{isMobile({freestar:this._freestar})&&checkIfInTest()&&(this.control=isControl(),this.placements=getValidPlacements({win:this._win,fsdata:this._freestar.fsdata}),0!==this.placements.length&&(this._sendEvent({type:this.control?"CONTROL_SESSION":"TEST_SESSION",value:{placements:[...this.placements.map((e=>e.name))]}}),this.control||this.placements.forEach(((e,t)=>{const i=`fs-${PRODUCT_SLUG}-${String.fromCharCode(97+t)}-${this._freestar.fsdata.path}-${this._freestar.fsdata.siteId}`,n=document.getElementById(e.name);n.id=`${i}-container`,n.setAttribute("name",i);let{sizeMappings:s,networks:r}=e;s=s.map((e=>(e.size=[[300,250]],e.superflex=!1,e))),r=r.filter((e=>!BLOCKED_BIDDERS.includes(e.slug))),this._freestar.fsdata.placements.push(Object.assign(index(e),{name:i,sizeMappings:s,networks:r,lazyAd:!1,carouselOptions:{active:!0,boundingBoxPercentage:.8,numberOfChildren:2,parent:e.name}}))}))))};init=(()=>{var e=this;return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:()=>{};e.control?e.placements.forEach((e=>{const i=unifiedBiddingConfigCreation({placement:e,slotId:e.slotId,targeting:{fs_carousel:`control:${e.name}`}});t(null,i)})):(e.placements=e._freestar.fsdata.placements.filter((e=>e.carouselOptions&&e.carouselOptions.active)),e.placements&&(e.carousels=e.placements.map(((t,i)=>{for(let n=0;n<t.carouselOptions.numberOfChildren;n++){let{bidders:s}=t;s=s.filter((e=>!BLOCKED_BIDDERS.includes(e.bidder))),e._freestar.fsdata.placements.push(Object.assign(index(t),{name:`fs_carousel_slot_${String.fromCharCode(97+n)}_${e._freestar.fsdata.path}_${e._freestar.fsdata.siteId}`,dfpId:`/${t.dfpId.split("/").slice(1,2)}/fs_carousel_slot_${String.fromCharCode(97+n)}_${e._freestar.fsdata.path}_${e._freestar.fsdata.siteId}`,bidders:s,carouselOptions:{active:!0,parent:`fs-${PRODUCT_SLUG}-${String.fromCharCode(97+i)}-${e._freestar.fsdata.path}-${e._freestar.fsdata.siteId}`}}))}return new Carousel({freestar:e._freestar,branding:e._branding,win:e._win,placement:t})})),e._addCSS(),e._addHTML(),e.carousels.forEach((e=>{e.placements.forEach((i=>{const n=unifiedBiddingConfigCreation({placement:i,slotId:i.slotId,targeting:{fs_carousel:`test:${e.options.parent}`}});t(null,n)}))}))))}})();_addCSS(){const e=createElement({type:"style",id:"_fs-carousels-stylesheet"});this.carousels.forEach((t=>{e.textContent+=t.getCSS()})),document.head.appendChild(e)}_addHTML(){this.carousels.forEach((e=>{e.addHTML()}))}_sendEvent(e){let{name:t=LOG_TITLE$2,type:i,value:n}=e;this._analytics.track(new CustomAnalyticsEvent({eventName:t,eventType:i,data:{...n}}))}}function newStandAlonePlayer(e){let{placementName:t,callback:i}=e;freestar.log(1,"Stand Alone Player: Invoked",arguments);let n=!0;const s=freestar.fsdata.placements.filter((e=>e.name===t))[0];if(s){freestar.log(1,"Stand Alone Player: Placement",s);const e=document.getElementById(s.name),t=document.createElement("div");if(t.style=e.style,t.style.width="100%",t.style.height="100%",t.id="_"+e.id,t.className="_wrapper",e.appendChild(t),freestar.log(1,"Stand Alone Player: Div",e),e){const{width:t}=e.getBoundingClientRect();if(t>=300){freestar.log(1,"Stand Alone Player: eligible width!");const e=freestar.fsdata.placementVideos.filter((e=>e.id===s.standAloneVideoOptions.videoId))[0];e&&(freestar.log(1,"Stand Alone Player: videoAd",e),n=!1,springServeInit({videoAd:e,placement:s,width:t,callback:i}))}else freestar.log(1,"Stand Alone Player: width is not equal to or greater than 400px!")}}n&&i&&(freestar.log(1,"Stand Alone Player: Failure!"),i(!0))}function springServeInit(e){let{videoAd:t,placement:i,width:n,callback:s}=e;performance.mark("springServe-initialization-start"),window._ssPlayer=window._ssPlayer||{spIdi:t.supplyId,widthi:`${n}`,aspecti:"16:9",divi:"_"+i.name};const r="https://cdn.springserve.com/assets/0/playerJS/frstrIN_2.js",a=Date.now();tagLoadedMessage({bidder:"springserve",placementId:t.id?t.id:"",tagUrl:r}),load_script(r,(function(){window.AdPlayerPro().on("AdStarted",(function(){bidWonMessage({bidder:"springserve",videoAd:t,requestTimestamp:a}),s&&s(null,{videoAdStarted:!0}),["AdStopped","AdClosed"].forEach((e=>{window.AdPlayerPro().on(e,(()=>{s&&(s(null,{completed:!0}),s=void 0)}))})),window.AdPlayerPro().on("AdSkipped",(()=>{s&&(s(null,{videoAdSkipped:!0,completed:!0}),s=void 0)}))})),window.AdPlayerPro().on("AdError",(function(){freestar.log(1,"Stand Alone Player: Error loading video requesting bids via new ad slots method"),s&&(s(null,{videoAdStarted:!1}),freestar.standAlonePlayer.callback=s,freestar.standAlonePlayer.slotId=i.name),i.standAloneVideoOptions.backfillDisplayAd?(freestar.log(1,"Stand Alone Player: Backfill display ad requesting."),newAdSlots([{placementName:i.name,slotId:i.name}])):(freestar.log(1,"Stand Alone Player: Backfill display not selected. Process terminating"),s(null,{completed:!0}))})),performance.mark("springServe-initialization-end")}))}function standAloneVideoGamOperations(e){let{event:t}=e;const i=t.slot.getSlotElementId(),n=freestar.fsdata.placements.filter((e=>e.name===i))[0];if(n){const{standAloneVideoOptions:e}=n;if(e&&e.videoId&&e.videoId.length){if(freestar.fsdata.placementVideos.filter((e=>e.id===n.standAloneVideoOptions.videoId))[0]){freestar.standAlonePlayer&&freestar.standAlonePlayer.callback&&"function"==typeof freestar.standAlonePlayer.callback&&(freestar.standAlonePlayer.callback(null,{displayAdServed:!t.isEmpty,completed:!0}),freestar.standAlonePlayer.callback=void 0);const e=document.getElementById(n.name);if(e){const t=e.querySelector("div[id^=google_ads_iframe_]");t&&(t.className+="center-ad")}}}}}function deleteStandAlonePlayer(e){let{placementName:t,callback:i}=e;const n=freestar.fsdata.placements.filter((e=>e.name===t))[0];n&&(freestar.log(1,"Stand Alone Player: Placement",n),document.getElementById(n.name).innerHTML="",delete window.AdPlayerPro),i&&i(!0)}function loadBrowsiScript(){if(window.BrowsiScriptLoaded)return;const e=createElement({type:"script",id:"browsi-tag",src:"https://cdn.browsiprod.com/bootstrap/bootstrap.js",attributes:[{"data-pubKey":"freestar"},{"data-siteKey":"d_mapping"}]});e.type="text/javascript",e.async=!0,e.onload=function(){window.BrowsiScriptLoaded=!0};document.getElementsByTagName("head")[0].appendChild(e)}ModuleRegistry.class(CarouselManager,{token:"Carousel",dependencies:[TOKEN.FREESTAR,TOKEN.WINDOW,TOKEN.ANALYTICS,TOKEN.BRANDING],defaultAlias:"carousel"});let isFirstAdRendered=!1;function slotRenderEnded(e){let{firstAdRequestedElement:t}=e;googletag.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(function(e){t&&e.slot.getSlotElementId()===t&&freestar.performanceLogger.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigSlotRenderEnded,compareTo:[PERFORMANCE_MARKS_LIST.pubfigSlotRequested]}),standAloneVideoGamOperations({event:e}),isFirstAdRendered||(isFirstAdRendered=!0,freestar.fsdata.browsiEnabled&&idealAdStackManager().allowBrowsi()&&(loadBrowsiScript(),freestar.log({title:"Browsi"},"Script loaded")))}))}function fetchPageGrabberPlacement(){return freestar.fsdata.placements.filter((e=>e.interstitialOptions&&e.interstitialOptions.active&&"UNDERTONE_GRABBER"===e.interstitialOptions.type))[0]}function pageGrabberInit(e){if(productIsDisabled({name:"pageGrabber"}))return void e(!0);freestar.log(1,"Page Grabber: Init");const t=fetchPageGrabberPlacement();if(t){performance.mark("pageGrabber-initialization-start"),freestar.log(1,"Page Grabber: placement ",t),freestar.frequencyLibrary[t.name]=new Frequency({placement:t,product:"interstitial",callback:e});const i=Number(sessionStorage.getItem("pageviews")||1),{interstitialPageViewsBefore:n}=optionObjectFetch({placement:t,type:"interstitialOptions"});if(freestar.frequencyLibrary[t.name].cap>-1&&!freestar.frequencyLibrary[t.name].allowProduct())return void e(!0);if(n&&i<n)return void e(!0);const s=createGAMSlot({placement:t}),r=format_pbjs(t);if(r&&addAdUnits({adUnits:r}),s&&t.name&&document.body){const i=function(i){if(i&&i.data)try{const r=!(!i.data||"string"!=typeof i.data)&&JSON.parse(i.data);r.method&&"close"===r.method&&n({slot:s,callback:e,name:t.name})}catch(e){freestar.log(1,`Error: ${e}`)}},n=function(e){let{slot:t,callback:n}=e;freestar.log(1,"Page Grabber: destroying page grabber div!"),freestar.newAdSlotsAllowed=!0,document.removeEventListener("click",i,!1),googletag.destroySlots([t]),n(null,!0)};freestar.newAdSlotsAllowed=!1;const r=createElement({type:"div",id:t.name});document.body.appendChild(r),googletag.cmd.push((function(){googletag.display(r.id)})),fsRequestBids({elementIds:[t.name],slots:[s]});let a=0;const o=setInterval((function(){if(a++,a>50)clearInterval(o);else{const t=document.querySelectorAll('[title="Close"]')[0];t&&(clearInterval(o),t.addEventListener("click",(function(){n({slot:s,callback:e})})))}}),50);window.addEventListener("message",i)}else freestar.log(1,"Page Grabber: define slot error or document.body not available skipping page grabber!"),freestar.frequencyLibrary[t.name].cap&&freestar.frequencyLibrary[t.name].subtractIteration(),e(!0);performance.mark("pageGrabber-initialization-end")}else freestar.log(1,"Page Grabber: no placement aligned skipping page grabber!"),e(!0)}function blockthroughInit(){const e=document.createElement("script");e.src="https://freestar-io.videoplayerhub.com/gallery.js",document.head.insertBefore(e,document.head.firstElementChild),freestar.log("inserted blockthrough script")}const SESSION_NAME="fs.session";class SessionStorageManager{constructor(){this.session=null,this.init()}init(){let e=sessionStorageGet({key:SESSION_NAME});this.session=e?JSON.parse(e):{},this.session.id||(this.session.id=generateUUID());let t=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].map((e=>({key:e,value:getUrlParameter(e)}))).filter((e=>""!==e.value));if(0!==t.length){let e={};t.forEach((t=>{e[t.key]=t.value})),this.session.utm=e}sessionStorageSet({key:SESSION_NAME,type:SESSION_STORAGE_TYPES.object,value:this.session})}getSessionId(){return this.session.id}getUTMValue(e){return this.session.utm?this.session.utm[e]:null}}const sessionStorageManager=new SessionStorageManager,getSessionId=()=>sessionStorageManager.getSessionId();function pageIdSet(){freestar.msg.pageId=MD5(window.location.href+freestar.hitTime+freestar.msg.fpc).toString()}function setFreestarHash(){if(freestar.fsdata&&freestar.fsdata.hashEnabled){const e=getCookie({name:"fs.identifier.hash"});return window.location.hash=e&&e.length?e:function(){const e=function(){let e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxxxx".replace(/[x]/g,(function(){let t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),t.toString(16)}))}();return setCookie({name:"fs.identifier.hash",value:e,expires:1825,path:"/"}),e}(),window.location.hash}return""}function msgInit(){freestar.msg=freestar.msg||{},pageIdSet(),freestar.msg.loadTime=freestar.msg.loadTime||0,freestar.msg.hash=setFreestarHash(),freestar.msg.sessionId=getSessionId()}function modifyParams(e){let{requestedRevolvingRail:t}=e;return"object"!=typeof t&&(t={placementName:t,slotId:t}),t}function groupByContainer(e){let{placements:t}=e,i={};return t.forEach((e=>{const{container:t}=e.revolvingRailOptions;Object.prototype.hasOwnProperty.call(i,t)||(i[t]=[]),i[t].push(e)})),i}function getOnCallPlacement(e){let{placements:t}=e;return t.find((e=>e.revolvingRailOptions.isOnCall&&!0===e.revolvingRailOptions.isOnCall))}function getChildrenAdSlots(e){let{element:t}=e;return[...t.querySelectorAll(".fs-rr-ad-x250, .fs-rr-ad-x600")].map((e=>({slotId:e.id,placementName:e.getAttribute("data-ad-unit")})))}function setRendered(e){let{event:t}=e;document.querySelector(`#${t.slot.getSlotElementId()}`).parentNode.parentNode.classList.add("fs-rr-rendered")}function isBy250(e){let{sizes:t}=e;return 250===t[0][1]&&"x250"}function isBy600(e){let{sizes:t}=e;return 600===t[0][1]&&"x600"}function sendTrackingInfo(e){let{numAds:t}=e;AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:"revolvingRail",data:{numAds:t}}))}))}const injectStyle=function(){injectCss(`\n        .fs-rr-ads-outer {\n            position: relative;\n            height: 200vh;\n            margin-bottom: 50px;\n        }\n\n        .fs-rr-ads-inner {\n            top: ${arguments.length>0&&void 0!==arguments[0]?arguments[0]:0}px;\n            position: sticky;\n        }\n\n        .fs-rr-ad-x250 {\n            text-align: center;\n            height: 250px;\n        }\n\n        .fs-rr-ad-x250:first-child {\n            margin-bottom: 100px;\n        }\n\n        .fs-rr-ad-x600 {\n            text-align: center;\n            height: 600px;\n        }\n    `)},watchAd=e=>{new IntersectionObserver((e=>{let[t]=e;if(t.isIntersecting){const e=[...t.target.classList].indexOf("fs-rr-rendered")>-1,i=getChildrenAdSlots({element:t.target});if(e){const e=i.map((e=>e.slotId));getSlots().forEach((t=>{e.indexOf(t.getSlotElementId())>-1&&googletag.pubads().refresh([t])}))}else window.freestar.newAdSlots(i),sendTrackingInfo({numAds:i.length}),i.forEach((e=>{let{slotId:t}=e;window.freestar.gamImpressionCallbacks[t]=setRendered}))}}),{root:null,rootMargin:`0px 0px ${window.innerHeight/3}px 0px`,threshold:0}).observe(document.querySelector(e))},generate=e=>{let{adUnits:t}=e;const{container:i,padddingTop:n,paddingTop:s}=optionObjectFetch({placement:t[0],type:"revolvingRailOptions"});injectStyle(s||n);const r=getElement(i);r||console.error(`Revolving Rail initialization failed: No ${i} DOM element found in page.`);const a=2*window.innerHeight+window.innerHeight/2+(s||n),o=r.parentNode.offsetHeight,d=t.reduce(((e,t)=>{if(t.sizes.length){const{sizes:i}=t;let n=isBy600({sizes:i})||isBy250({sizes:i});if(!n)return e;e[n]||(e[n]=[]),e[n].push(t)}return e}),{});if(0===Object.keys(d).length)return window.freestar.log({title:"RevolvingRail",style:"background: orange; color: #fff; border-radius: 3px; padding: 3px"},"No usable sizes from revolving rail placements"),!1;const l=createElement({classList:["fs-rr-ads"]});let c=a,u=0,h=0;const f=Object.keys(d),p=f.length-1;for(;c<o;){const e=createElement({classList:["fs-rr-ads-outer"],id:`fs-rr-ads-outer-${h}`}),t=createElement({classList:["fs-rr-ads-inner"]});e.appendChild(t);const i=f[u],n=d[i];if("x250"===i){const e=n[0].name,s=n[1].name;t.appendChild(createElement({classList:[`fs-rr-ad-${i}`],id:`${e}-a-${h}`,attributes:[{"data-ad-unit":e}]})),t.appendChild(createElement({classList:[`fs-rr-ad-${i}`],id:`${s}-b-${h}`,attributes:[{"data-ad-unit":s}]}))}else{const e=n[0].name;t.appendChild(createElement({classList:[`fs-rr-ad-${i}`],id:`${e}-${h}`,attributes:[{"data-ad-unit":e}]}))}c+=a,l.appendChild(e),h++,u=u===p?0:u+1}r.appendChild(l);for(let e=0;e<h;e++)watchAd(`#fs-rr-ads-outer-${e}`)},initRevolvingRail=()=>{if(productIsDisabled({name:"revolvingRail"}))return window.freestar.log(1,"Revolving Rail is disabled."),!1;performance.mark("revolvingRail-initialization-start");const e=groupByContainer({placements:window.freestar.fsdata.placements.filter((e=>isOptionActive({placement:e,type:"revolvingRailOptions"})))});for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const i=e[t],n=getOnCallPlacement({placements:i}),s=getElement(t);!n&&s?isPageSpeedOptimized()&&!freestar.fsdata.psoDisableInteraction?waitForUserInteraction({name:"revolvingRail",callback:generate.bind(null,{adUnits:i,container:s})}):generate({adUnits:i,container:s}):window.freestar.log(1,`Revolving Rail initialization failed for the ${t} container. The Revolving Rail is onCall or  No DOM element found on page.`)}performance.mark("revolvingRail-inititialization-end")},newRevolvingRail=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(!e)return void window.freestar.log(1,'newRevolvingRail - must have either a string with a placement name or an object like {placementName: "myPlacementName", slotId: "my-id-one"}');e=modifyParams({requestedRevolvingRail:e}),window.freestar.log(1,"newRevolvingRail - requested revolving rail ",e);const t=window.freestar.fsdata.placements.find((t=>t.name===e.placementName));let i=getElement(e.slotId);i||(i=getElement(t.revolvingRailOptions.container)),t&&i?generate({adUnits:[t],container:i}):window.freestar.log(1,`newRevolvingRail - initialization failed for the ${e.placementName} requested placement. There is no record of this placement in fsdata or the slotId ${e.slotId} was not found on the DOM.`)},trackPlacements=e=>{let{placements:t}=e;t.forEach((e=>{const{name:t,contextId:i}=e;AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new ContentRecommendationPartnerImpression({partnerName:"DIANOMI",placementName:t,contextId:i}))}))})),performance.mark("dianomi-initialization-end")},injectDianomiDiv=e=>{let{placement:t}=e;const{name:i,contextId:n}=t,s=document.querySelector(`#${i}`);if(!s)return window.freestar.log(1,`Dianomi Target Node with ID "${i}" Does Not Exist`),!1;s.appendChild(createElement({classList:["dianomi_context"],attributes:[{"data-dianomi-context-id":n}]}))},initDianomi=()=>{const e=window.freestar.fsdata.placements.filter((e=>"DIANOMI"===e.partnerName));if(productIsDisabled({name:"dianomiContentRec"})||e.length<1)return!1;performance.mark("dianomi-initialization-start"),e.forEach((e=>{injectDianomiDiv({placement:e})})),scriptExists({id:DIANOMI_SCRIPT_ID})?performance.mark("dianomi-initialization-end"):load_script$1(DIANOMI_SCRIPT_URL,trackPlacements.bind(null,{placements:e}),DIANOMI_SCRIPT_ID)};function focusInit(){window.addEventListener("focus",(()=>{const e=[...freestar.focusQueue];freestar.focusQueue=[],e.forEach((e=>e.apply()))}))}let refresh_event_added=!1;function initVisibilityChangeListener(){refresh_event_added||(refresh_event_added=!0,document.addEventListener("visibilitychange",(function(){return!document.hidden&&freestar.visibilityRefresh.timeLeft&&Date.now()-freestar.visibilityRefresh.timeLeft>1e3*freestar.visibilityRefresh.refreshTimeMinimum&&(freestar.visibilityRefresh.timeLeft=null,freestar.refreshActiveSlots()),freestar.visibilityRefresh.timeLeft=Date.now(),!0})))}function styleInject(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}var css_248z$2=".fs-sticky-footer {\n    display: block;\n    bottom: 0;\n    right: 0;\n    position: fixed;\n    width: 100vw;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    z-index: 2147483647;\n}\n.fs-sticky-slot-element > div > iframe {\n    margin: 0 !important;\n}\n.fs-sticky-slot-element > div {\n    position: relative;\n}\n.fs-sticky-parent {\n    z-index: 2147483647;\n    bottom: 0;\n    padding-top: 0px;\n    position: fixed;\n    left: 0;\n    right: 0;\n    text-align: center;\n}\n.fs-sticky-wrapper {\n    background-color: #f6f3f3;\n    display: inline-block;\n    margin: auto;\n    width: -webkit-fit-content;\n    width: -moz-fit-content;\n    width: fit-content;\n    visibility: inherit;\n    z-index: inherit;\n}\n.fs-dynamic {\n    text-align: center;\n    clear: both;\n}\n.fs-iai {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    clear: both;\n}\n.fs-close-button {\n    all: unset;\n    -moz-appearance: none !important;\n    -webkit-appearance: none !important;\n    -webkit-transition: all 0.3s ease-in-out !important;\n    appearance: none !important;\n    background-color: #ffffff !important;\n    background-image: url('https://a.pub.network/core/imgs/freestar_close_button.svg') !important;\n    background-position: 50% !important;\n    background-repeat: no-repeat !important;\n    border: none !important;\n    border-radius: 50% !important;\n    -webkit-box-shadow:\n        0 0 0 1px #888888,\n        0 0 0 1px rgba(247, 247, 247, 0.75) !important;\n            box-shadow:\n        0 0 0 1px #888888,\n        0 0 0 1px rgba(247, 247, 247, 0.75) !important;\n    -webkit-box-sizing: border-box !important;\n            box-sizing: border-box !important;\n    cursor: pointer !important;\n    display: block !important;\n    height: 20px !important;\n    outline: none !important;\n    padding: 0px !important;\n    position: absolute !important;\n    right: 25px !important;\n    top: 25px !important;\n    transition: all 0.3s ease-in-out !important;\n    width: 20px !important;\n}\n.fs-close-button:hover,\n.fs-close-button:focus {\n    background-color: #000 !important;\n}\n.fs-sticky-popup-container {\n    font-size: 0.8em;\n    text-align: center;\n    font-family: 'arial';\n    white-space: nowrap;\n    width: auto;\n    height: auto;\n    padding: 7px;\n    z-index: 2147483647 !important;\n    -webkit-filter: drop-shadow(2px 2px 2px grey);\n            filter: drop-shadow(2px 2px 2px grey);\n}\n.fs-sticky-popup-container a:nth-child(2) {\n    border-top: 1px solid #999;\n}\n.fs-sticky-popup-container .fs-report-ad-button {\n    color: rgb(153, 153, 153);\n}\n.fs-close-button:hover {\n    -webkit-box-shadow:\n        0 0 0 1px #888888,\n        0 0 0 8px rgba(247, 247, 247, 0.75);\n            box-shadow:\n        0 0 0 1px #888888,\n        0 0 0 8px rgba(247, 247, 247, 0.75);\n}\n.fs-close-button-pushdown {\n    right: 12px !important;\n    top: 12px !important;\n}\n@media screen and (min-width: 820px) {\n    .fs-close-button-sticky {\n        top: 9.3% !important;\n        right: 10px !important;\n    }\n}\n@media screen and (max-width: 820px) {\n    .fs-close-button-sticky {\n        top: 3px !important;\n        right: 10px !important;\n    }\n    .fs-close-button-pushdown {\n        top: 0 !important;\n        right: 0 !important;\n    }\n}\n\n.fs-branding-spacer {\n    -webkit-box-flex: 1;\n        -ms-flex-positive: 1;\n            flex-grow: 1;\n}\n\n.fs-report-ad-button {\n    font-size: 12px;\n    color: black;\n    -webkit-text-decoration: none;\n    text-decoration: none;\n    cursor: pointer;\n    background: none;\n    display: block;\n    border: none;\n    padding: 0;\n}\n\n.fs-report-ad-button-icon {\n    content: '';\n    background-image: url('https://a.pub.network/core/imgs/freestar_report_ad_icon.png');\n    background-size: 18px;\n    background-color: transparent;\n    moz-appearance: none;\n    -webkit-appearance: none;\n       -moz-appearance: none;\n            appearance: none;\n    background-color: #ffffff;\n    background-position: 50%;\n    background-repeat: no-repeat;\n    border: none;\n    border-radius: 50%;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n    cursor: pointer;\n    display: block;\n    height: 16px;\n    outline: none;\n    padding: 0px;\n    width: 16px;\n}\n\n.fs-pushdown {\n    background-color: rgba(247, 247, 247, 0.9);\n    top: 0;\n    text-align: center;\n    z-index: 2147483647;\n    width: 100%;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n}\n.fs-pushdown-sticky {\n    position: sticky !important;\n    background-color: rgba(247, 247, 247, 0.9);\n    top: 0;\n    left: 0 !important;\n    text-align: center;\n    z-index: 2147483647;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n.__fs-ancillary {\n    --childHeight: 16px;\n    width: 100%;\n    width: var(--childWidth, 100%);\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: end;\n        -ms-flex-pack: end;\n            justify-content: flex-end;\n    margin: 0 auto;\n    position: relative;\n    -webkit-box-ordinal-group: 1000;\n        -ms-flex-order: 999;\n            order: 999;\n    width: 100%;\n    height: 16px;\n    height: var(--childHeight, 16px);\n    display: flex;\n    align-items: center;\n    -webkit-box-pack: justify;\n        -ms-flex-pack: justify;\n            justify-content: space-between;\n}\n\n.__fs-ancillary > div > .__fs-branding {\n    -webkit-box-flex: 20;\n        -ms-flex-positive: 20;\n            flex-grow: 20;\n}\n.fs-sticky-wrapper .__fs-ancillary {\n    display: none !important;\n}\n.__fs-branding {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n}\n.__fs-branding > a {\n    width: 100%;\n    max-width: var(--childWidth);\n    height: var(--childHeight);\n    display: block;\n}\n.__fs-branding > a > img {\n    height: calc(var(--childHeight) - 2px) !important;\n    display: block;\n    -webkit-box-shadow: none;\n            box-shadow: none;\n    width: auto !important;\n    width: initial !important;\n    margin: 0 auto 0 0 !important;\n}\n.fs-sticky-wrapper .__fs-branding {\n    position: absolute;\n    top: 0;\n    border: none;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n}\n.fs-sticky-wrapper .__fs-branding {\n    position: absolute;\n    top: 50%;\n    right: 6px;\n    border: none;\n    border-radius: 50%;\n}\n.fs-mobile-tall {\n    top: 30% !important;\n}\n.fs-sticky-wrapper .__fs-branding > a {\n    width: 100%;\n    height: 100%;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n}\n.fs-sticky-wrapper .__fs-branding > a > img {\n    width: 100% !important;\n    height: 100% !important;\n    opacity: 1;\n}\n@media screen and (max-width: 820px) {\n    .fs-sticky-wrapper .__fs-branding > a > img {\n        width: 70% !important;\n        height: 70% !important;\n        opacity: 1;\n    }\n}\n.fs-sticky-wrapper .__fs-branding {\n    background-color: rgba(247, 247, 247, 0.75);\n    background-size: 58%;\n}\n.fs-sticky-wrapper .__fs-branding > a > img {\n    width: 90%;\n    height: 90%;\n}\n.fs-sticky-wrapper {\n    background-color: #f6f3f3;\n    padding-right: 38px;\n    display: inline-block;\n    width: -webkit-fit-content;\n    width: -moz-fit-content;\n    width: fit-content;\n    visibility: inherit;\n    z-index: inherit;\n}\n.center-ad {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n        -ms-flex-direction: column;\n            flex-direction: column;\n}\n._wrapper .orp-player-wrapper {\n    width: 100% !important;\n    height: 100% !important;\n}\n";styleInject(css_248z$2);var css_248z$1=".fs-flying-carpet {\n    background: -webkit-gradient(linear, left top, left bottom, color-stop(10%, #00c389), to(black));\n    background: linear-gradient(to bottom, #00c389 10%, black 100%);\n    position: relative;\n    -webkit-box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    height: 175vh;\n    margin: 0 -1.1rem 0.5rem;\n}\n\n.fs-flying-carpet-ad-container {\n    margin: 0 auto;\n    position: sticky;\n    top: 0;\n    -ms-flex-item-align: center;\n        align-self: center;\n    padding-top: 10vh;\n    padding-bottom: 10vh;\n    bottom: 10vh;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n}\n\n.fs-powered-by {\n    font-size: 18px;\n    color: #00c389;\n    position: absolute;\n    bottom: 0;\n    background-color: black;\n    width: 100%;\n    height: 6vh;\n    text-align: center;\n    padding: 10px 0;\n    -webkit-box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);\n            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n}\n\n.fs-flying-carpet-header {\n    font-size: 11px;\n    font-family: Arial, Helvetica, sans-serif !important;\n    color: white;\n    position: absolute;\n    top: 0;\n    background-color: #34495e;\n    width: 100%;\n    text-align: center;\n    padding: 5px 0;\n    -webkit-box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);\n            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);\n}\n\n/* fc v2 */\n.fs-flying-carpet-v2 {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n        -ms-flex-direction: column;\n            flex-direction: column;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n}\n\n.fs-flying-carpet-v2-ad-container {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    width: 300px;\n    height: 65vh;\n    margin-left: auto;\n    margin-right: auto;\n    background-color: #fff;\n    overflow-y: scroll;\n    overflow-x: hidden;\n    -webkit-box-sizing: border-box;\n            box-sizing: border-box;\n}\n\n.fs-flying-carpet-v2-text-border {\n    width: 100%;\n    background-color: #333;\n    color: #fff;\n    text-align: center;\n    font-family: Arial, sans-serif;\n    font-size: 0.8em;\n    text-transform: uppercase;\n    padding: 5px 0;\n    letter-spacing: 1px;\n}\n";styleInject(css_248z$1);class NormalizeNetworks{constructor(){this.modifications={emxdigital:{modification:"emx_digital"},synacor:{modification:"synacormedia"}}}slugModification(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.modifications[e]?this.modifications[e].modification:e}reassignNetworkSlug(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>(e.slug=this.slugModification(e.slug),e)))}init(){window.freestar.fsdata.networks=this.reassignNetworkSlug(window.freestar.fsdata.networks),window.freestar.fsdata.placements=window.freestar.fsdata.placements.map((e=>(e.networks=this.reassignNetworkSlug(e.networks),e)))}}class ErrorTracker{initiateWatcher(e){e.que.push((()=>{e.onEvent("adRenderFailed",this.handleAdRenderFailed.bind(this))}))}handleAdRenderFailed(e){let{message:t,adId:i,reason:n,bid:s}=e;freestar.log({title:"Pubfig",styles:"background: red; color: white; border-radius: 3px; padding: 3px"},`Prebid adRenderFailed. Reason: ${n} - ${t} - ${s.adUnitCode}`),AppContainer.instance.resolve(TOKEN.ANALYTICS).then((e=>{e.track(new CustomAnalyticsEvent({eventName:"AD_RENDER_FAILED",eventType:t,data:{adId:i,reason:n,bid:s}}))}))}}let instance=null;function getErrorTracker(){return null==instance&&(instance=new ErrorTracker),instance}const resetAllProductsCapIterations=function(){let{win:e=window,level:t=LEVELS.page}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=e?.freestar?.frequencyLibraryV2;i&&Object.values(i).forEach((e=>{e&&"function"==typeof e.resetIteration&&e.resetIteration({level:t})}))},setupGooglePublisherTag=()=>{let e;e=window.googletag||{},e.cmd=e.cmd||[],window.googletag=e,e.cmd.push((()=>{const t=sessionStorageGet({key:TEST_GROUP_KEY});t&&e.pubads().setTargeting("tg",t),e.pubads().setTargeting("fs_session_id",freestar.msg.sessionId),e.pubads().setTargeting("fs_pageview_id",freestar.msg.pageId),e.pubads().setTargeting("fs_version",freestar.version)}))},hasLogging=()=>window.location.search.includes("fslog");function fsLoggingActivate(e){let{isActive:t=!1}=e;window.freestar.debug=!(!t&&!hasLogging())&&99}const appendToBodyWhenLoaded=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:document;"loading"===i.readyState?i.addEventListener("DOMContentLoaded",(()=>{i.body.appendChild(e),t?.()})):(i.body.appendChild(e),t?.())};var css_248z=".fs-test-mode-label {\n    background-color: rgba(0, 0, 0, 0.65);\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    position: fixed;\n    bottom: 40%;\n    right: 0;\n    z-index: 2147483647;\n    border-radius: 5px 0 0 5px;\n    -webkit-transform-origin: left top;\n            transform-origin: left top;\n    font-family: monospace;\n    -webkit-transform: translateX(calc(100% - 25px));\n            transform: translateX(calc(100% - 25px));\n    -webkit-transition:\n        300ms background-color ease-in, 300ms -webkit-transform ease-in;\n    transition:\n        300ms background-color ease-in, 300ms -webkit-transform ease-in;\n    transition:\n        300ms transform ease-in, 300ms background-color ease-in;\n    transition:\n        300ms transform ease-in, 300ms background-color ease-in, 300ms -webkit-transform ease-in;\n    color: white;\n}\n\n.fs-test-mode-label > span:first-of-type {\n    -webkit-writing-mode: tb-rl;\n        -ms-writing-mode: tb-rl;\n            writing-mode: tb-rl;\n    border-right: 1px solid rgb(3, 195, 139);\n    padding: 5px;\n    cursor: pointer;\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n}\n.fs-test-mode-label > span:first-of-type > img {\n    width: 17px;\n    margin-top: 5px;\n}\n.fs-test-mode-label > div > button {\n    padding: 5px 10px;\n    border: none;\n    background-color: rgb(3, 195, 139);\n    border-radius: 5px;\n    font-family: monospace;\n    cursor: pointer;\n    color: white;\n}\n\n.fs-test-mode-label > div {\n    display: -webkit-box;\n    display: -ms-flexbox;\n    display: flex;\n    -webkit-box-orient: vertical;\n    -webkit-box-direction: normal;\n        -ms-flex-direction: column;\n            flex-direction: column;\n    gap: 10px;\n    -webkit-box-pack: center;\n        -ms-flex-pack: center;\n            justify-content: center;\n    -webkit-box-align: center;\n        -ms-flex-align: center;\n            align-items: center;\n    margin: 0 5px;\n}\n\n.fs-test-mode-label > input[type='checkbox'] {\n    width: 0;\n    height: 0;\n    visibility: hidden;\n}\n\n.fs-test-mode-label:has(input[type='checkbox']:checked) {\n    -webkit-transform: translateX(0);\n            transform: translateX(0);\n    background-color: rgba(0, 0, 0, 0.8);\n}\n@media only screen and (max-width: 450px) {\n    .fs-test-mode-label {\n        -webkit-transform: translateX(calc(100% - 30px));\n                transform: translateX(calc(100% - 30px));\n    }\n\n    .fs-test-mode-label > span:first-of-type {\n        font-size: 18px;\n        padding: 7px 5px;\n    }\n    .fs-test-mode-label > span:first-of-type > img {\n        width: 20px;\n    }\n}\n";styleInject(css_248z);const showTestSessionControls=()=>{const e=sessionStorageGet({key:ALT_CONFIG_SESSION_KEY}),t=getUrlParameter(QUERY_STRING_KEYS.fsaltconfig);if(!e&&!t)return;let i=e;t&&e!==t&&(sessionStorageSet({key:ALT_CONFIG_SESSION_KEY,value:t}),i=t);const n=createElement({type:"input",attributes:[{type:"checkbox"}]}),s=createElement({type:"img"});s.src=`${CORE_BUCKET_LOCATION}/imgs/fslogo-green.svg`;const r=createElement({type:"span"});r.textContent="Test Session",r.appendChild(s);const a=createElement({type:"span"});a.textContent=`Config v.${i}`;const o=createElement({type:"span"});o.textContent=`Pubfig v.${freestar.version}`;const d=createElement({type:"button"});d.textContent="End session",d.onclick=()=>{sessionStorageRemove({key:ALT_CONFIG_SESSION_KEY}),removeUrlParameter(QUERY_STRING_KEYS.fsaltconfig)};const l=createElement({children:[a,o,d]}),c=createElement({type:"label",id:ALT_CONFIG_ELEMENT_ID,classList:[ALT_CONFIG_CLASS_NAME],children:[n,r,l]});appendToBodyWhenLoaded(c)},checkPageSpeedOptimizationAndUserConsent=e=>{let{initEngine:t}=e;if(freestar.fsdata.footerBiddingEnabled&&!productIsDisabled({name:"footerBidding"})){let{psoDisableInteraction:e=!1}=freestar.fsdata;(!isPageSpeedOptimized()||isPageSpeedOptimized()&&e)&&("complete"===document.readyState?checkForGDPR(t):window.addEventListener("load",(()=>checkForGDPR(t)))),isPageSpeedOptimized()&&!e&&waitForUserInteraction({name:"engine",callback:()=>checkForGDPR(t)})}else checkForGDPR(t)},validateGfc=function(e){window.googlefc=window.googlefc||{},window.googlefc.callbackQueue=window.googlefc.callbackQueue||[],window.googlefc.callbackQueue.push({CONSENT_DATA_READY:e})},loadInitialDasAndFloors=async()=>{await requestHandler().fetch({fetchFn:getIdealAdstackConfig,requestId:"getIdealData",onError:()=>{floorsHardOffSite({siteId:freestar.fsdata.siteId})||requestHandler().fetch({requestId:"getFloorsData",fetchFn:()=>getFloorsData({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:0,isFloorsActive:window.freestar?.fsdata?.isTriple13Enabled})})},onSuccess:e=>{let{data:t}=e;floorsHardOffSite({siteId:freestar.fsdata.siteId})||t&&t.floors||requestHandler().fetch({requestId:"getFloorsData",fetchFn:()=>getFloorsData({deviceVendor:window.freestar.deviceInfo.device.vendor,deviceType:window.freestar.deviceInfo.device.type,refreshNumber:0,isFloorsActive:window.freestar?.fsdata?.isTriple13Enabled})})}})};async function initEngine(e){let{freestar:t,stickyFooter:i={},sideWall:n={},stickyRail:s={},initDynamicAds:r,newDynamicContent:a,DynamicAds:o,dispensaryData:d,pushdown:l={},video:c={},analytics:u,performanceLogger:h,identityManager:f,slidingUnit:p={},stickyAd:g={},interstitial:m,superflex:E,carousel:_={},joke:y={},confiant:I,memoryMonitor:b}=e;showTestSessionControls(),await loadInitialDasAndFloors(),idealAdStackManager().setGlobalTimeout(),fsLoggingActivate({}),checkForValidity(),msgInit(),setupGooglePublisherTag(),getMaxBidTracker().initiateWatcher(fsprebid),getErrorTracker().initiateWatcher(fsprebid),h.setAnalytics(u),t.analyticsQueue?.length&&t.analyticsQueue.forEach((e=>u.track(e))),delete t.analyticsQueue,h.pushAllPendingMarksToMsgQue(),h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigEngineLoad,compareTo:[PERFORMANCE_MARKS_LIST.pubfigEngineLoadInit]}),t.queue=t.queue||[],t.config=t.config||{},t.identity=f,t.isHttps="https:"===window.location.protocol?1:0,t.dynamicIdNum=t.dynamicIdNum||1,t.refreshSlots=[],t.rebidSlots=[],t.tools={},t.requests={},t.requests.que=[],t.requests.process=[],t.requests.timestamp=void 0,t.url=window.location.href,t.bidRequestNum=0,t.sideWallUnitControl=[],t.dfpSlotInfo={},t.func={},t.refreshLibrary={},t.pushdownControl={},t.visibilityRefresh={},t.newAdSlotIds=[],t.server={},t.bidsWon={},t.networkFloor={},t.blockedRanges={},t.requestReference={},t.dynamicSlots=[],t.dynamicSlotLibrary={},t.googletagCorrelatorUpdate=!0,t.rebidControl={},t.gamMap={},t.reportLibrary={},t.fsDfpId=isFsGam(),t.fsDevDfpId=isFsDevGam(),t.gamImpressionCallbacks=[],t.googleInterstitialPlacement,t.allowBidResponseCollection=!1,t.allowBidRequestedCollection=!1,t.viewableImpression={},t.newAdSlotsAllowed=!0,t.frequencyLibrary={},t.frequencyLibraryV2={},t.newAdSlotsQueue=[],t.focusQueue=[],t.initRequested=!1,t.adjustments={isLogged:getUrlParameter("adjustment-log"),bids:[]},t.logPerformanceMarks=t.performanceLogger.logPerformanceMarkers,t.newAdSlotsCalled=[],t.enabledSlotsCalled=[],t.standAlonePlayer={callback:void 0,slotId:void 0},t.currentStickyFooter=void 0,window.load_script=load_script$1,t.setVideoAdhesionEnabled=wrapIfDisabled(i.setVideoAdhesionEnabled,{name:"setVideoAdhesionEnabled",warn:!0}),t.slotTargeting=slotTargeting,t.newDynamicContent=wrapIfDisabled(a,{name:"newDynamicContent",warn:!0}),t.requestQueInitiate=requestQueInitiate,t.newAdSlots=newAdSlots,t.createAdSlot=createAdSlot,t.newStickyFooter=wrapIfDisabled(i.newStickyFooter,{name:"newStickyFooter",warn:!0}),t.deleteAdSlots=deleteAdSlots$1,t.format_pbjs=format_pbjs,t.freestarReloadAllAdSlots=function(){let{slotIds:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{slotIds:null},i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&console.warn("freestar.freestarReloadAdSlot() has been deprecated and will be removed in the future use freestar.refreshAllSlots()");t.log(1,`${e?"freestar.refresh":"freestar.refreshAllSlots"}${e?" : "+e:null}`);const n=[],s=getSlots().map((function(i){let s=i.getSlotElementId();if(t.refreshLibrary[s]){if(-1===t.refreshLibrary[s].refreshTime)return;try{t.refreshLibrary[s].refreshCounter>-1?t.refreshLibrary[s].refreshCounter++:t.refreshLibrary[s].refreshCounter=1}catch(e){t.log(1,"freestar.refreshAllSlots slot not found",s)}}if(!e||e.indexOf(s)>-1)return n.push(s),t.refreshLibrary[s]&&(t.refreshLibrary[s].refreshCounter=1),i})).filter((e=>void 0!==e));if(e&&!n.length)return;n.forEach((e=>{rebidManager.reset({elementId:e})})),fsRequestBids({elementIds:n,slots:s})},t.func.browserInfo=browserInfo,t.newPushdown=wrapIfDisabled(l.add,{name:"newPushdown",warn:!0}),t.deletePushdown=wrapIfDisabled(l.delete,{name:"deletePushdown",warn:!0}),t.newSidewall=wrapIfDisabled(n.add,{name:"newSidewall",warn:!0}),t.deleteSidewall=wrapIfDisabled(n.delete,{name:"deleteSidewall",warn:!0}),t.newVideo=wrapIfDisabled(c.add,{name:"newVideo",warn:!0}),t.deleteVideo=e=>wrapIfDisabled(c.remove,{name:"deleteVideo",warn:!0})({name:e}),t.logRandomJoke=wrapIfDisabled(y.logRandomJoke,{name:"logRandomJoke",warn:!0}),t.newStandAlonePlayer=newStandAlonePlayer,t.newRevolvingRail=newRevolvingRail,t.newStickyRail=wrapIfDisabled(s.create,{name:"newStickyRail",warn:!0}),t.deleteStickyRail=wrapIfDisabled(s.destroy,{name:"deleteStickyRail",warn:!0}),t.deleteStandAlonePlayer=deleteStandAlonePlayer;const S=window.innerWidth||document.documentElement.clientWidth,A=window.innerHeight||document.documentElement.clientHeight;var v,w,T;if(t.deviceOrientation=getDeviceOrientation({width:S,height:A}),t.reportingAdInfo=()=>{console.warn("freestar.reportingAdInfo() has been deprecated")},t.getActiveModulesFromConfig=getActiveAdTypes(t.fsdata.placements,t.fsdata.videoAds),t?.config?.setNonPersonalizedAds&&t.queue.push((()=>{googletag.pubads().setRequestNonPersonalizedAds(1)})),t?.config?.ppid&&("string"==typeof t.config.ppid?t.queue.push((()=>{googletag.pubads().setPublisherProvidedId(t.config.ppid)})):console.warn("freestar.config.ppid is not a string and will not be set")),async function(){const{isRefreshAllowed:e}=idealAdStackManager().determineAdRefreshBehavior();if(!e){return["freestarReloadAdSlot","reloadAllAdSlots","refreshLibraryCreator","refreshActiveSlots","refreshAllSlots"].forEach((e=>{t[e]=()=>t.log(1,"Ad refresh is disabled.")})),void(t.refresh=()=>console.warn("Ad Refresh is disabled for this geo."))}t.refresh=e=>{!function(e){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&console.warn("freestar.freestarReloadAdSlot() has been deprecated and will be removed in the future use freestar.refresh()");t.queue.push((function(){AdRefresher.refreshSlots({slotIds:"string"==typeof e?[e]:e},i)}))}(e,!1)},t.freestarReloadAdSlot=AdRefresher.refreshSlots,t.reloadAllAdSlots=AdRefresher.refreshSlots,t.refreshAllSlots=AdRefresher.refreshAllSlots,t.refreshActiveSlots=()=>AdRefresher.refreshAllActiveSlots()}().catch((e=>console.error("Error setting up ad refresh logic:",e))),idealAdStackManager().allowConfiant()&&await I.init(),t.deleteStickyFooter=()=>{console.warn("The deleteStickyFooter method is not available!")},t.modulesLoaded.engine=!0,t.disableAutoTrackPageviews||(v=window.history,w=v.pushState,T=v.replaceState,v.pushState=function(e){let t=new CustomEvent("pushState");return t.state=e,window.dispatchEvent(t),w.apply(v,arguments)},v.replaceState=function(e){let t=new CustomEvent("replaceState");return t.state=e,window.dispatchEvent(t),T.apply(v,arguments)}),t.trackPageview=function(){let{path:e=window.location.href}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e!==t.url&&(t.log(1,"TrackPageview invoked."),resetAllProductsCapIterations({level:LEVELS.page}),t.url=e,t.hitTime=Date.now(),setFreestarHash(),pageIdSet(),browserInfo(),incrementPageviewCounter(),a?.())},t.Browsi={pushAd:(e,i,n)=>{t.newAdSlots({placementName:i,slotId:e,targeting:{browsiId:n}})}},t.func.domloaded=!1,t.visibilityRefresh.runRefresh=!0,t.visibilityRefresh.enacted=!1,t.visibilityRefresh.timeLeft=null,t.visibilityRefresh.refreshTimeMinimum=30,t.videoAdsRan=!1,0!=t.fsdata.adRefreshRate&&!0!==(t.fsdata.visibilityRefreshDisabled&&Boolean(t.fsdata.visibilityRefreshDisabled))||(t.visibilityRefresh.runRefresh=!1),t.fsdata.visibilityRefreshTime&&Number(t.fsdata.visibilityRefreshTime)>1&&(t.visibilityRefresh.refreshTimeMinimum=t.fsdata.visibilityRefreshTime),!idealAdStackManager().getBypassFirstAuction()&&t.fsdata.networks.some((e=>"consumable"===e.slug))&&load_script$1("https://sync.serverbid.com/ss/2000462.js"),focusInit(),checkForCustomCss(window.freestar.fsdata.customCss),createCustomEvent({name:"pubfigLoaded",detail:!0}),(getUrlParameter("blockthrough")||t.fsdata.blockthroughEnabled&&2===t.fsdata.blockthroughVersion)&&idealAdStackManager().allowBlockthrough()&&blockthroughInit(),t.queue.push((()=>{t.rebidManager=rebidManager})),pbjsBase.setNetworks(),pbjsBase.getBidderSettings(),pbjsBase.setBidderSettings(),prebidAuctionEndEvent(),window.freestar.fsdata.identityProviders&&-1!==window.freestar.fsdata.identityProviders.findIndex((e=>"merkleId"===e.slug))){const e=document.createElement("script");e.src="//js-sec.indexww.com/ht/p/184310-82987131453484.js",document.head.insertBefore(e,document.head.firstElementChild),t.log("inserted IX Identity Library script")}-1===BIDSRESPONSE_COLLECTION_BLOCKLIST.indexOf(t.fsdata.siteId)&&(t.allowBidResponseCollection=Math.random()<(t.fsdata.prebidLogPercentage||1)/100,(50===Math.floor(99*Math.random())||window.location.search.indexOf("fssniffer")>-1)&&t.queue.push((function(){getSiteResourceData()})));const R=t.fsdata?.bidRequestedLogPercentage||25;t.allowBidRequestedCollection=Math.random()<R/100||window.location.search.indexOf("fssniffer")>-1,publisherSlotOperationsTesting(),t.debug>=99&&(console.clear=function(){}),t.log(1,"Freestar Version: "+t.version),isPageSpeedOptimized()&&(t.log(1,"Page Speed Optimized in effect, filtering out the following products:",PRODUCTS_TO_BLOCK_IF_PAGE_SPEED_OPTIMIZED.join(",")),PRODUCTS_TO_BLOCK_IF_PAGE_SPEED_OPTIMIZED.forEach((e=>{t.config.products[e]||(t.config.products[e]={}),t.config.products[e]=Object.assign(t.config.products[e],{disabled:!0})})),googletag.cmd.push((function(){googletag.pubads().setTargeting("fs_optimization","true")}))),window.setTimeout(window.freestar.func.browserInfo,3e4);const O=t.fsdata.retries,C=getCookie({name:"fs.direct.traffic"});t.fsdirect=C,incrementPageviewCounter(),(new NormalizeNetworks).init(),wrapIfDisabled(_.prepopulatePlacements()),buildPlacements();const N=()=>{h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigEngineSetupStart,compareTo:[PERFORMANCE_MARKS_LIST.pubfigEngineLoad]}),googletag.pubads().disableInitialLoad(),setupAmazonBidder();const e=getUrlParameter("dfpkey"),i=getUrlParameter("block");switch(e&&gamTargeting({key:"test",value:e}),i&&"fsdirect"===i&&(setCookie({name:"fs.direct.traffic",value:!0}),t.fsdirect=!0,gamTargeting({key:"block",value:"fsdirect"})),document.referrer.search(/facebook/i)>0?gamTargeting({key:"referrer",value:"facebook"}):(document.referrer.search(/twiter/i)>0||document.referrer.search(/t.co/i)>0)&&gamTargeting({key:"referrer",value:"twitter"}),navigator.userAgent){case navigator.userAgent.search(/facebook/i)>0:case navigator.userAgent.search(/facebot/i)>0:case navigator.userAgent.search(/FB_IAB/i)>0:case navigator.userAgent.search(/FBAN/i)>0:case navigator.userAgent.search(/FBAV/i):gamTargeting({key:"user-agent",value:"facebook"});break;case navigator.userAgent.search(/Twitter/i)>0:gamTargeting({key:"user-agent",value:"twitter"});break;default:gamTargeting({key:"user-agent",value:function(){const e=t.deviceInfo.browser.name,i=t.deviceInfo.os.name;return"Mac OS"===i&&"Safari"===e?"Safari":"iOS"===i?"iOS":e}()})}["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach((function(e){let t=getUrlParameter(e);t&&gamTargeting({key:e,value:t})}));let n=!1;f.init(),n||(n=!0,fsprebid.que.push((function(){t.log(1,"fspbjs.que.push - init"),Object.keys(t.fsdata.aliases).forEach((function(e){fsprebid.aliasBidder(t.fsdata.aliases[e],e)})),pbjsBase.setEventListeners(),pbjsBase.settingConfig(fsprebid,idealAdStackManager(),f),pbjsBase.setSChain(),pbjsBase.enableTIDs(),fsprebid.refreshUserIds();const e=f.criteoConfig;e&&fsprebid.setBidderConfig(e),addAdUnits({adUnits:getPlacements().filter((e=>isValidAd(e))).map((e=>format_pbjs(e)))}),t.coppa=new CoppaCompliance(window.freestar,window.googletag,window.fsprebid),P()}))),t.fsdata.disableSingleRequest||googletag.pubads().enableSingleRequest();let s=null;googletag.pubads().addEventListener("impressionViewable",(function(e){const i=e.slot.getSlotElementId();t.log(1,`GAM impressionViewable ${i}`),i&&t.gamImpressionCallbacks[i]&&t.gamImpressionCallbacks[i]({event:e}),m?.postRender?.({event:e,elementId:i})})),googletag.pubads().addEventListener(GAM_SLOT_REQUESTED,(function(e){t.log(1,`GAM ${GAM_SLOT_REQUESTED} ${e.slot.getSlotElementId()}`),null===s&&(s=e.slot.getSlotElementId(),h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigSlotRequested})),t.currentStickyFooter&&"function"==typeof t.currentStickyFooter.isSticky&&t.currentStickyFooter.isSticky(e)&&h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigStickyFooterSlotRequested})})),slotRenderEnded({firstAdRequestedElement:s}),t.fsdata.collapseEmptyDivs&&(t.log("GAM Option set to collapseEmptyDivs(true)"),googletag.pubads().collapseEmptyDivs(!0)),googletag.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(function(e){frequencyGamEvaluation(e);const i=e.slot.getSlotElementId();if(t.log(1,`GAM ${GAM_SLOT_RENDER_ENDED} ${i}`),e.slot.getSlotElementId()===s&&h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigSlotRenderEnded,compareTo:[PERFORMANCE_MARKS_LIST.pubfigSlotRequested]}),t.reportLibrary[i]=e,dfpResponseInfo(e,!1),t.fsdata.customDirectAdRefresh&&eventMatchesDirectAdRefresh(e)){setDirectAdRefresh(e.slot.getSlotElementId())}})),googletag.pubads().addEventListener("slotOnload",dfpResponseInfoComplete);const r=getPrebidAdserverTargetingKeys({freestar:t}),a=[r.format,r.size,r.pb,r.adid,r.bidder];googletag.pubads().addEventListener(GAM_SLOT_RENDER_ENDED,(e=>{const{slot:t}=e;a.forEach((e=>{0!==t.getTargeting(e).length&&t.clearTargeting(e)}))})),t.fsdata.customDirectAdRefresh&&setInterval(getDemandSourceTypes,5e3),googletag.enableServices(),h.logMark({markerName:PERFORMANCE_MARKS_LIST.pubfigEngineSetupEnd,compareTo:[PERFORMANCE_MARKS_LIST.pubfigEngineSetupStart]}),d.cdep&&gamTargeting({key:"cdep",value:d.cdep})};if(siteGeoMacroRestriction())throw new Error("Ad serving is blocked in "+t.locData.iso);if(performance.mark("pubfig-init"),googletag.cmd.unshift?googletag.cmd.unshift((function(){t.log(1," googletag.cmd.unshift - init"),floorsManager().getInitialFloorsData().then(N)})):(t.log({title:"WARNING!",styles:"background: red; color: white; border-radius: 3px; padding: 3px"}," googletag.cmd.unshift not found skipping"),floorsManager().getInitialFloorsData().then(N)),"complete"===document.readyState)wrapIfDisabled(c.init)({isAfterLoadingPage:!0}),L();else{let e=setInterval((function(){"complete"===document.readyState&&(clearInterval(e),wrapIfDisabled(c.init)({isAfterLoadingPage:!0}),L())}),100)}function P(){if(t.log(1," initAdserver"),!fsprebid.initAdserverSet){if(!googletag.pubadsReady&&fsprebid.retries<=O)return setTimeout(P,50),void fsprebid.retries++;fsprebid.initAdserverSet=!0,t.log(1," fsInitAdserver"),pageGrabberInit((function(e,a){t.log(1,"Page Grabber: "+(a?"completed page grabber session":"either the grabber placement is failing or there is no grabber placement")),createCustomEvent({name:"pageGrabberComplete",detail:!0}),t.newAdSlotsAllowed=!0,t.newAdSlotsQueue.forEach((e=>e.process())),function(){const e={elementIds:[],bidObjects:[],slots:[]},a=(t,i)=>{i&&(e.elementIds.push(i.placement.name),e.bidObjects.push(i.bidObject),e.slots.push(i.slot))};(function(){if(void 0!==t.fsdata.quantcast&&!1===t.fsdata.quantcast||(window._qevents=window._qevents||[],Array.isArray(window._qevents)&&window._qevents.push({qacct:"p-UeXruRVtZz7w6"}),load_script$1("https://secure.quantserve.com/quant.js")),t.fsdata.scripts2&&Array.isArray(t.fsdata.scripts2)){const e=t.fsdata.scripts2;for(let i=0;i<e.length;i++)if(!0===e[i].active){const n=Math.floor(100*Math.random())+1,s=e[i].versions;let r=0;t.log(2,`Rolled ${n} for script ${e[i].name}`);for(let a=0;a<s.length;a++)if(!0===s[a].active&&(r+=s[a].trafficPercentage,n<=r)){t.log(2,`Selecting version ${s[a].name} for script ${e[i].name}. ${s[a].trafficPercentage}% chance.`);try{load_script$1(s[a].href)}catch(e){console.error(e)}break}}}else if(t.fsdata.scripts&&Array.isArray(t.fsdata.scripts))for(let e=0;e<t.fsdata.scripts.length;e++)try{load_script$1(t.fsdata.scripts[e])}catch(e){console.error(e)}})(),wrapIfDisabled(l.init)(a),wrapIfDisabled(n.init)(a),wrapIfDisabled(_.init)(a),initRevolvingRail(),E?.init(),wrapIfDisabled(s.init)(),initDianomi(),wrapIfDisabled(p.init)(),wrapIfDisabled(g.init)(),t.fsdata.singleLineEnabled&&(t.log({title:"SLO"},"Single line of code enabled"),t.fsdata.placements.forEach((e=>{(function(e){let{placement:t}=e;for(const e in PRODUCT_MAPPING){let i;if(i="dynamicAds"===e?getIdealAdInsertionElementOptions(t):t[PRODUCT_MAPPING[e].optionsPath||`${e}Options`],i&&i.active||i&&"pushdown"===e&&i.isPushdownUnit||i&&"sideWall"===e&&i.type>0)return!1}return!!document.getElementById(t.name)})({placement:e})&&t.config.enabled_slots.push({placementName:e.name,slotId:e.name})}))),wrapIfDisabled(r)(),t.newIai=e=>{t.fsdata.placements.forEach((t=>{if(e&&t.name!==e)return;const i=getIntelligentAdInsertConfig({placement:t});i?.active&&(intelligentAdInsertManager().registerConfig({placement:t,intelligentAdInsertConfig:i}),intelligentAdInsertManager().initConfig(t))}))},t.newIai(),wrapIfDisabled(c.init)();const o=setTimeout((()=>{wrapIfDisabled(c.init)({failSafeStart:!0}),window.clearTimeout(o)}),2e4);t.visibilityRefresh.enacted||!0!==t.visibilityRefresh.runRefresh||(t.visibilityRefresh.enacted=!0,initVisibilityChangeListener()),isPageSpeedOptimized()?(t.log({title:"PSO"},"Loading Page Speed Optimized Sticky Footer"),t.newStickyFooter()):wrapIfDisabled(i.init)(),t.loaded=!0;let d=extend({queue:[]},t);t.queue={push:function(e){googletag.cmd.push(e)}};for(let e=0;e<d.queue.length;e++)t.queue.push(d.queue[e]);async function u(){const{isRefreshAllowed:e}=idealAdStackManager().determineAdRefreshBehavior();e&&new AdRefresher}d={},D(),(!t.initCallback||t.initCallback&&"function"==typeof t.initCallback&&-1===t.initCallback.toString().indexOf("enabled_slots"))&&t.config&&t.config.enabled_slots&&t.config.enabled_slots.length&&(performance.mark("check-ad-enabled-slots-start"),t.config.enabled_slots.forEach((function(t){"object"!=typeof t&&(t={placementName:t,slotId:t});const i=getPlacementByName({name:dynamicGet({slotId:t.placementName})}),n=document.getElementById(t.slotId),{targeting:s={}}=t;if(n&&i&&i.validAdSizes)if(n.setAttribute("name",i.name),i.lazyAd&&i.selectedSize&&i.selectedSize.lazyLoadViewportHeight>0)setLazyAdObserver({element:n,placement:i});else{const n=unifiedBiddingConfigCreation({placement:i,slotId:t.slotId,targeting:s});n&&(e.elementIds.push(t.slotId),n.bidObject&&e.bidObjects.push(n.bidObject),n.slot&&e.slots.push(n.slot))}})),performance.mark("check-ad-enabled-slots-end"),t.config.enabled_slots=[],e.bidObjects=e.bidObjects.filter((e=>-1===fsprebid.adUnits.map((e=>e.code)).indexOf(e.code)))),e.bidObjects.length&&addAdUnits({adUnits:e.bidObjects}),e.elementIds.length&&fsRequestBids({elementIds:e.elementIds,slots:e.slots}),setTimeout((()=>{u().catch((e=>console.error("Error setting up ad refresh logic:",e)))}),750)}()})),m?.init()}}function D(){if(t.callbackIntervalCount++,fsprebid.initAdserverSet&&void 0!==t.initCallback&&void 0===t.initCallbackCalled&&"function"==typeof t.initCallback){return t.initCallbackCalled=!0,clearInterval(t.callbackInterval),createCustomEvent({name:"initCallbackExecuted",detail:{timestamp:Date.now(),callbackIntervalCount:t.callbackIntervalCount}}),t.initCallback(),function(e,t){e.push=function(i){Array.prototype.push.call(e,i),t(e)}}(t.config.enabled_slots,(function(e){newAdSlots([e[e.length-1]])})),!0}return t.callbackIntervalCount>50&&clearInterval(t.callbackInterval),!1}function L(){if(t.func.domloaded)return;const e=document.getElementsByTagName("body")[0];browserInfo(),t.disableAutoTrackPageviews||(window.addEventListener("pushState",(e=>setTimeout((()=>handleStateChange(e)),1))),window.addEventListener("replaceState",(e=>handleStateChange(e))),window.addEventListener("popstate",(()=>t.trackPageview()))),t.fsdata.addIsFreestar&&!e.classList.contains("is-freestar")&&addClassToBody("is-freestar"),t.fsdata.reorientationRefresh&&!t.config.disableReorientation&&(t.config.alwaysRefresh||(t.config.alwaysRefresh=t.fsdata.placements.map((e=>e.name))),deviceOrientationRefresh()),t.func.domloaded=!0,t.callbackIntervalCount=0,t.callbackInterval=window.setInterval(D,200),t.deviceInfo.device.type===DEVICE_TYPE_MOBILE&&window.addEventListener("orientationchange",k),setUsPrivacy(),b?.enabled&&(b.start(),t.getMemoryReport=()=>b.getReport())}function k(){void 0!==t.resizetimer&&window.clearTimeout(t.resizetimer),t.resizetimer=window.setTimeout((function(){buildPlacements(),t.currentStickyFooter&&t.currentStickyFooter.hideAdhesion()}),300)}window.addEventListener("load",(function(e){wrapIfDisabled(c.init)({isAfterLoadingPage:!0}),L()})),t.disableRefresh=disableRefresh,t.disableRefreshOn=disableRefreshOn,t.enableRefresh=enableRefresh,t.enableRefreshOn=enableRefreshOn,t.DynamicAds=o,t.fsRequestBids=fsRequestBids}function main(e){let{botTraffic:t,initEngine:i}=e;if(t.checkForBot(),t.isDetected)return;const n="FUNDING_CHOICES"===window.freestar.fsdata.cmpType?()=>validateGfc((()=>{checkPageSpeedOptimizationAndUserConsent({initEngine:i}),window.addEventListener("pubfigLoaded",(()=>freestar.log(1,"checkPageSpeedOptimizationAndUserConsent called after googlefc validation")))})):()=>initCmp(window.freestar.fsdata.cmpType,window.freestar.locData,(()=>{checkPageSpeedOptimizationAndUserConsent({initEngine:i}),window.addEventListener("pubfigLoaded",(()=>freestar.log(1,"checkPageSpeedOptimizationAndUserConsent called after CMP initialization")))}));freestar?.pubfigState?.configReady?n():window.addEventListener("pubfigRunEngine",n)}ModuleRegistry.function(initEngine,{token:"initEngine",dependencies:["freestar","DispensaryData",{token:"StickyFooter",optional:!0},{token:"Joke",optional:!0},{token:"SideWall",optional:!0},{token:"initDynamicAds",optional:!0},{token:"newDynamicContent",optional:!0},{token:"DynamicAds",optional:!0},{token:"SlidingUnit",optional:!0},{token:"StickyAd",optional:!0},{token:"StickyRail",optional:!0},{token:"Interstitial",optional:!0},{token:"Pushdown",optional:!0},{token:"Video",optional:!0},{token:"Superflex",optional:!0},{token:"Carousel",optional:!0},TOKEN.ANCILLARY,TOKEN.ANALYTICS,TOKEN.PERFORMANCE_LOGGER,TOKEN.IDENTITY_MANAGER,TOKEN.CONFIANT,TOKEN.MEMORY_MONITOR]}),ModuleRegistry.function(main,{token:"main",dependencies:["BotTraffic","initEngine"]}),AppContainer.instance.call("main"),exports.StickyFooter=StickyFooter,exports.VIDEO_PLAYERS_MAP=VIDEO_PLAYERS_MAP,exports.Video=Video,Object.defineProperty(exports,"__esModule",{value:!0})})({});
